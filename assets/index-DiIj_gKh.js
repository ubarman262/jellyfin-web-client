function OE(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in n)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(n,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();function NE(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var rp={exports:{}},ml={},sp={exports:{}},ge={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var uo=Symbol.for("react.element"),ME=Symbol.for("react.portal"),FE=Symbol.for("react.fragment"),UE=Symbol.for("react.strict_mode"),BE=Symbol.for("react.profiler"),$E=Symbol.for("react.provider"),jE=Symbol.for("react.context"),GE=Symbol.for("react.forward_ref"),VE=Symbol.for("react.suspense"),HE=Symbol.for("react.memo"),KE=Symbol.for("react.lazy"),th=Symbol.iterator;function zE(n){return n===null||typeof n!="object"?null:(n=th&&n[th]||n["@@iterator"],typeof n=="function"?n:null)}var ip={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},op=Object.assign,ap={};function Hs(n,e,t){this.props=n,this.context=e,this.refs=ap,this.updater=t||ip}Hs.prototype.isReactComponent={};Hs.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};Hs.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function lp(){}lp.prototype=Hs.prototype;function vd(n,e,t){this.props=n,this.context=e,this.refs=ap,this.updater=t||ip}var Ed=vd.prototype=new lp;Ed.constructor=vd;op(Ed,Hs.prototype);Ed.isPureReactComponent=!0;var nh=Array.isArray,up=Object.prototype.hasOwnProperty,xd={current:null},cp={key:!0,ref:!0,__self:!0,__source:!0};function dp(n,e,t){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)up.call(e,r)&&!cp.hasOwnProperty(r)&&(s[r]=e[r]);var a=arguments.length-2;if(a===1)s.children=t;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];s.children=l}if(n&&n.defaultProps)for(r in a=n.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:uo,type:n,key:i,ref:o,props:s,_owner:xd.current}}function WE(n,e){return{$$typeof:uo,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function Sd(n){return typeof n=="object"&&n!==null&&n.$$typeof===uo}function YE(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var rh=/\/+/g;function Kl(n,e){return typeof n=="object"&&n!==null&&n.key!=null?YE(""+n.key):e.toString(36)}function sa(n,e,t,r,s){var i=typeof n;(i==="undefined"||i==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case uo:case ME:o=!0}}if(o)return o=n,s=s(o),n=r===""?"."+Kl(o,0):r,nh(s)?(t="",n!=null&&(t=n.replace(rh,"$&/")+"/"),sa(s,e,t,"",function(u){return u})):s!=null&&(Sd(s)&&(s=WE(s,t+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(rh,"$&/")+"/")+n)),e.push(s)),1;if(o=0,r=r===""?".":r+":",nh(n))for(var a=0;a<n.length;a++){i=n[a];var l=r+Kl(i,a);o+=sa(i,e,t,l,s)}else if(l=zE(n),typeof l=="function")for(n=l.call(n),a=0;!(i=n.next()).done;)i=i.value,l=r+Kl(i,a++),o+=sa(i,e,t,l,s);else if(i==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Lo(n,e,t){if(n==null)return n;var r=[],s=0;return sa(n,r,"","",function(i){return e.call(t,i,s++)}),r}function qE(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var xt={current:null},ia={transition:null},XE={ReactCurrentDispatcher:xt,ReactCurrentBatchConfig:ia,ReactCurrentOwner:xd};function fp(){throw Error("act(...) is not supported in production builds of React.")}ge.Children={map:Lo,forEach:function(n,e,t){Lo(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return Lo(n,function(){e++}),e},toArray:function(n){return Lo(n,function(e){return e})||[]},only:function(n){if(!Sd(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};ge.Component=Hs;ge.Fragment=FE;ge.Profiler=BE;ge.PureComponent=vd;ge.StrictMode=UE;ge.Suspense=VE;ge.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=XE;ge.act=fp;ge.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=op({},n.props),s=n.key,i=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=xd.current),e.key!==void 0&&(s=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(l in e)up.call(e,l)&&!cp.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:uo,type:n.type,key:s,ref:i,props:r,_owner:o}};ge.createContext=function(n){return n={$$typeof:jE,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:$E,_context:n},n.Consumer=n};ge.createElement=dp;ge.createFactory=function(n){var e=dp.bind(null,n);return e.type=n,e};ge.createRef=function(){return{current:null}};ge.forwardRef=function(n){return{$$typeof:GE,render:n}};ge.isValidElement=Sd;ge.lazy=function(n){return{$$typeof:KE,_payload:{_status:-1,_result:n},_init:qE}};ge.memo=function(n,e){return{$$typeof:HE,type:n,compare:e===void 0?null:e}};ge.startTransition=function(n){var e=ia.transition;ia.transition={};try{n()}finally{ia.transition=e}};ge.unstable_act=fp;ge.useCallback=function(n,e){return xt.current.useCallback(n,e)};ge.useContext=function(n){return xt.current.useContext(n)};ge.useDebugValue=function(){};ge.useDeferredValue=function(n){return xt.current.useDeferredValue(n)};ge.useEffect=function(n,e){return xt.current.useEffect(n,e)};ge.useId=function(){return xt.current.useId()};ge.useImperativeHandle=function(n,e,t){return xt.current.useImperativeHandle(n,e,t)};ge.useInsertionEffect=function(n,e){return xt.current.useInsertionEffect(n,e)};ge.useLayoutEffect=function(n,e){return xt.current.useLayoutEffect(n,e)};ge.useMemo=function(n,e){return xt.current.useMemo(n,e)};ge.useReducer=function(n,e,t){return xt.current.useReducer(n,e,t)};ge.useRef=function(n){return xt.current.useRef(n)};ge.useState=function(n){return xt.current.useState(n)};ge.useSyncExternalStore=function(n,e,t){return xt.current.useSyncExternalStore(n,e,t)};ge.useTransition=function(){return xt.current.useTransition()};ge.version="18.3.1";sp.exports=ge;var D=sp.exports;const oa=NE(D),QE=OE({__proto__:null,default:oa},[D]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var JE=D,ZE=Symbol.for("react.element"),ex=Symbol.for("react.fragment"),tx=Object.prototype.hasOwnProperty,nx=JE.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,rx={key:!0,ref:!0,__self:!0,__source:!0};function hp(n,e,t){var r,s={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)tx.call(e,r)&&!rx.hasOwnProperty(r)&&(s[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:ZE,type:n,key:i,ref:o,props:s,_owner:nx.current}}ml.Fragment=ex;ml.jsx=hp;ml.jsxs=hp;rp.exports=ml;var S=rp.exports,mp={exports:{}},jt={},gp={exports:{}},pp={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(M,P){var N=M.length;M.push(P);e:for(;0<N;){var j=N-1>>>1,H=M[j];if(0<s(H,P))M[j]=P,M[N]=H,N=j;else break e}}function t(M){return M.length===0?null:M[0]}function r(M){if(M.length===0)return null;var P=M[0],N=M.pop();if(N!==P){M[0]=N;e:for(var j=0,H=M.length,Q=H>>>1;j<Q;){var ae=2*(j+1)-1,J=M[ae],ue=ae+1,Ie=M[ue];if(0>s(J,N))ue<H&&0>s(Ie,J)?(M[j]=Ie,M[ue]=N,j=ue):(M[j]=J,M[ae]=N,j=ae);else if(ue<H&&0>s(Ie,N))M[j]=Ie,M[ue]=N,j=ue;else break e}}return P}function s(M,P){var N=M.sortIndex-P.sortIndex;return N!==0?N:M.id-P.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],u=[],c=1,d=null,f=3,h=!1,m=!1,g=!1,p=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function E(M){for(var P=t(u);P!==null;){if(P.callback===null)r(u);else if(P.startTime<=M)r(u),P.sortIndex=P.expirationTime,e(l,P);else break;P=t(u)}}function T(M){if(g=!1,E(M),!m)if(t(l)!==null)m=!0,V(A);else{var P=t(u);P!==null&&W(T,P.startTime-M)}}function A(M,P){m=!1,g&&(g=!1,y(I),I=-1),h=!0;var N=f;try{for(E(P),d=t(l);d!==null&&(!(d.expirationTime>P)||M&&!F());){var j=d.callback;if(typeof j=="function"){d.callback=null,f=d.priorityLevel;var H=j(d.expirationTime<=P);P=n.unstable_now(),typeof H=="function"?d.callback=H:d===t(l)&&r(l),E(P)}else r(l);d=t(l)}if(d!==null)var Q=!0;else{var ae=t(u);ae!==null&&W(T,ae.startTime-P),Q=!1}return Q}finally{d=null,f=N,h=!1}}var R=!1,L=null,I=-1,C=5,_=-1;function F(){return!(n.unstable_now()-_<C)}function B(){if(L!==null){var M=n.unstable_now();_=M;var P=!0;try{P=L(!0,M)}finally{P?ie():(R=!1,L=null)}}else R=!1}var ie;if(typeof v=="function")ie=function(){v(B)};else if(typeof MessageChannel<"u"){var z=new MessageChannel,Y=z.port2;z.port1.onmessage=B,ie=function(){Y.postMessage(null)}}else ie=function(){p(B,0)};function V(M){L=M,R||(R=!0,ie())}function W(M,P){I=p(function(){M(n.unstable_now())},P)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(M){M.callback=null},n.unstable_continueExecution=function(){m||h||(m=!0,V(A))},n.unstable_forceFrameRate=function(M){0>M||125<M?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<M?Math.floor(1e3/M):5},n.unstable_getCurrentPriorityLevel=function(){return f},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(M){switch(f){case 1:case 2:case 3:var P=3;break;default:P=f}var N=f;f=P;try{return M()}finally{f=N}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(M,P){switch(M){case 1:case 2:case 3:case 4:case 5:break;default:M=3}var N=f;f=M;try{return P()}finally{f=N}},n.unstable_scheduleCallback=function(M,P,N){var j=n.unstable_now();switch(typeof N=="object"&&N!==null?(N=N.delay,N=typeof N=="number"&&0<N?j+N:j):N=j,M){case 1:var H=-1;break;case 2:H=250;break;case 5:H=1073741823;break;case 4:H=1e4;break;default:H=5e3}return H=N+H,M={id:c++,callback:P,priorityLevel:M,startTime:N,expirationTime:H,sortIndex:-1},N>j?(M.sortIndex=N,e(u,M),t(l)===null&&M===t(u)&&(g?(y(I),I=-1):g=!0,W(T,N-j))):(M.sortIndex=H,e(l,M),m||h||(m=!0,V(A))),M},n.unstable_shouldYield=F,n.unstable_wrapCallback=function(M){var P=f;return function(){var N=f;f=P;try{return M.apply(this,arguments)}finally{f=N}}}})(pp);gp.exports=pp;var sx=gp.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ix=D,$t=sx;function $(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var yp=new Set,Oi={};function ts(n,e){Os(n,e),Os(n+"Capture",e)}function Os(n,e){for(Oi[n]=e,n=0;n<e.length;n++)yp.add(e[n])}var Wn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Qu=Object.prototype.hasOwnProperty,ox=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,sh={},ih={};function ax(n){return Qu.call(ih,n)?!0:Qu.call(sh,n)?!1:ox.test(n)?ih[n]=!0:(sh[n]=!0,!1)}function lx(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function ux(n,e,t,r){if(e===null||typeof e>"u"||lx(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function St(n,e,t,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var it={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){it[n]=new St(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];it[e]=new St(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){it[n]=new St(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){it[n]=new St(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){it[n]=new St(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){it[n]=new St(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){it[n]=new St(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){it[n]=new St(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){it[n]=new St(n,5,!1,n.toLowerCase(),null,!1,!1)});var Td=/[\-:]([a-z])/g;function Ad(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(Td,Ad);it[e]=new St(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(Td,Ad);it[e]=new St(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(Td,Ad);it[e]=new St(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){it[n]=new St(n,1,!1,n.toLowerCase(),null,!1,!1)});it.xlinkHref=new St("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){it[n]=new St(n,1,!1,n.toLowerCase(),null,!0,!0)});function Ld(n,e,t,r){var s=it.hasOwnProperty(e)?it[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(ux(e,t,s,r)&&(t=null),r||s===null?ax(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):s.mustUseProperty?n[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,r=s.attributeNamespace,t===null?n.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var Qn=ix.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Io=Symbol.for("react.element"),fs=Symbol.for("react.portal"),hs=Symbol.for("react.fragment"),Id=Symbol.for("react.strict_mode"),Ju=Symbol.for("react.profiler"),vp=Symbol.for("react.provider"),Ep=Symbol.for("react.context"),Rd=Symbol.for("react.forward_ref"),Zu=Symbol.for("react.suspense"),ec=Symbol.for("react.suspense_list"),_d=Symbol.for("react.memo"),or=Symbol.for("react.lazy"),xp=Symbol.for("react.offscreen"),oh=Symbol.iterator;function ei(n){return n===null||typeof n!="object"?null:(n=oh&&n[oh]||n["@@iterator"],typeof n=="function"?n:null)}var Me=Object.assign,zl;function yi(n){if(zl===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);zl=e&&e[1]||""}return`
`+zl+n}var Wl=!1;function Yl(n,e){if(!n||Wl)return"";Wl=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(n,[],e)}else{try{e.call()}catch(u){r=u}n.call(e.prototype)}else{try{throw Error()}catch(u){r=u}n()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,a=i.length-1;1<=o&&0<=a&&s[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==i[a]){var l=`
`+s[o].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=o&&0<=a);break}}}finally{Wl=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?yi(n):""}function cx(n){switch(n.tag){case 5:return yi(n.type);case 16:return yi("Lazy");case 13:return yi("Suspense");case 19:return yi("SuspenseList");case 0:case 2:case 15:return n=Yl(n.type,!1),n;case 11:return n=Yl(n.type.render,!1),n;case 1:return n=Yl(n.type,!0),n;default:return""}}function tc(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case hs:return"Fragment";case fs:return"Portal";case Ju:return"Profiler";case Id:return"StrictMode";case Zu:return"Suspense";case ec:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case Ep:return(n.displayName||"Context")+".Consumer";case vp:return(n._context.displayName||"Context")+".Provider";case Rd:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case _d:return e=n.displayName||null,e!==null?e:tc(n.type)||"Memo";case or:e=n._payload,n=n._init;try{return tc(n(e))}catch{}}return null}function dx(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return tc(e);case 8:return e===Id?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Ir(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Sp(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function fx(n){var e=Sp(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,i=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function Ro(n){n._valueTracker||(n._valueTracker=fx(n))}function Tp(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=Sp(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function wa(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function nc(n,e){var t=e.checked;return Me({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function ah(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=Ir(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Ap(n,e){e=e.checked,e!=null&&Ld(n,"checked",e,!1)}function rc(n,e){Ap(n,e);var t=Ir(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?sc(n,e.type,t):e.hasOwnProperty("defaultValue")&&sc(n,e.type,Ir(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function lh(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function sc(n,e,t){(e!=="number"||wa(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var vi=Array.isArray;function Is(n,e,t,r){if(n=n.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<n.length;t++)s=e.hasOwnProperty("$"+n[t].value),n[t].selected!==s&&(n[t].selected=s),s&&r&&(n[t].defaultSelected=!0)}else{for(t=""+Ir(t),e=null,s=0;s<n.length;s++){if(n[s].value===t){n[s].selected=!0,r&&(n[s].defaultSelected=!0);return}e!==null||n[s].disabled||(e=n[s])}e!==null&&(e.selected=!0)}}function ic(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error($(91));return Me({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function uh(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error($(92));if(vi(t)){if(1<t.length)throw Error($(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:Ir(t)}}function Lp(n,e){var t=Ir(e.value),r=Ir(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function ch(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function Ip(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function oc(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?Ip(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var _o,Rp=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,s){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,s)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(_o=_o||document.createElement("div"),_o.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=_o.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function Ni(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var Ti={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},hx=["Webkit","ms","Moz","O"];Object.keys(Ti).forEach(function(n){hx.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),Ti[e]=Ti[n]})});function _p(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Ti.hasOwnProperty(n)&&Ti[n]?(""+e).trim():e+"px"}function wp(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,s=_p(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,s):n[t]=s}}var mx=Me({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ac(n,e){if(e){if(mx[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error($(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error($(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error($(61))}if(e.style!=null&&typeof e.style!="object")throw Error($(62))}}function lc(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var uc=null;function wd(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var cc=null,Rs=null,_s=null;function dh(n){if(n=ho(n)){if(typeof cc!="function")throw Error($(280));var e=n.stateNode;e&&(e=El(e),cc(n.stateNode,n.type,e))}}function kp(n){Rs?_s?_s.push(n):_s=[n]:Rs=n}function Cp(){if(Rs){var n=Rs,e=_s;if(_s=Rs=null,dh(n),e)for(n=0;n<e.length;n++)dh(e[n])}}function bp(n,e){return n(e)}function Dp(){}var ql=!1;function Pp(n,e,t){if(ql)return n(e,t);ql=!0;try{return bp(n,e,t)}finally{ql=!1,(Rs!==null||_s!==null)&&(Dp(),Cp())}}function Mi(n,e){var t=n.stateNode;if(t===null)return null;var r=El(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error($(231,e,typeof t));return t}var dc=!1;if(Wn)try{var ti={};Object.defineProperty(ti,"passive",{get:function(){dc=!0}}),window.addEventListener("test",ti,ti),window.removeEventListener("test",ti,ti)}catch{dc=!1}function gx(n,e,t,r,s,i,o,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(c){this.onError(c)}}var Ai=!1,ka=null,Ca=!1,fc=null,px={onError:function(n){Ai=!0,ka=n}};function yx(n,e,t,r,s,i,o,a,l){Ai=!1,ka=null,gx.apply(px,arguments)}function vx(n,e,t,r,s,i,o,a,l){if(yx.apply(this,arguments),Ai){if(Ai){var u=ka;Ai=!1,ka=null}else throw Error($(198));Ca||(Ca=!0,fc=u)}}function ns(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function Op(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function fh(n){if(ns(n)!==n)throw Error($(188))}function Ex(n){var e=n.alternate;if(!e){if(e=ns(n),e===null)throw Error($(188));return e!==n?null:n}for(var t=n,r=e;;){var s=t.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){t=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===t)return fh(s),n;if(i===r)return fh(s),e;i=i.sibling}throw Error($(188))}if(t.return!==r.return)t=s,r=i;else{for(var o=!1,a=s.child;a;){if(a===t){o=!0,t=s,r=i;break}if(a===r){o=!0,r=s,t=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===t){o=!0,t=i,r=s;break}if(a===r){o=!0,r=i,t=s;break}a=a.sibling}if(!o)throw Error($(189))}}if(t.alternate!==r)throw Error($(190))}if(t.tag!==3)throw Error($(188));return t.stateNode.current===t?n:e}function Np(n){return n=Ex(n),n!==null?Mp(n):null}function Mp(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=Mp(n);if(e!==null)return e;n=n.sibling}return null}var Fp=$t.unstable_scheduleCallback,hh=$t.unstable_cancelCallback,xx=$t.unstable_shouldYield,Sx=$t.unstable_requestPaint,$e=$t.unstable_now,Tx=$t.unstable_getCurrentPriorityLevel,kd=$t.unstable_ImmediatePriority,Up=$t.unstable_UserBlockingPriority,ba=$t.unstable_NormalPriority,Ax=$t.unstable_LowPriority,Bp=$t.unstable_IdlePriority,gl=null,Cn=null;function Lx(n){if(Cn&&typeof Cn.onCommitFiberRoot=="function")try{Cn.onCommitFiberRoot(gl,n,void 0,(n.current.flags&128)===128)}catch{}}var cn=Math.clz32?Math.clz32:_x,Ix=Math.log,Rx=Math.LN2;function _x(n){return n>>>=0,n===0?32:31-(Ix(n)/Rx|0)|0}var wo=64,ko=4194304;function Ei(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function Da(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,s=n.suspendedLanes,i=n.pingedLanes,o=t&268435455;if(o!==0){var a=o&~s;a!==0?r=Ei(a):(i&=o,i!==0&&(r=Ei(i)))}else o=t&~s,o!==0?r=Ei(o):i!==0&&(r=Ei(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-cn(e),s=1<<t,r|=n[t],e&=~s;return r}function wx(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function kx(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,s=n.expirationTimes,i=n.pendingLanes;0<i;){var o=31-cn(i),a=1<<o,l=s[o];l===-1?(!(a&t)||a&r)&&(s[o]=wx(a,e)):l<=e&&(n.expiredLanes|=a),i&=~a}}function hc(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function $p(){var n=wo;return wo<<=1,!(wo&4194240)&&(wo=64),n}function Xl(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function co(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-cn(e),n[e]=t}function Cx(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var s=31-cn(t),i=1<<s;e[s]=0,r[s]=-1,n[s]=-1,t&=~i}}function Cd(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-cn(t),s=1<<r;s&e|n[r]&e&&(n[r]|=e),t&=~s}}var Ae=0;function jp(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var Gp,bd,Vp,Hp,Kp,mc=!1,Co=[],pr=null,yr=null,vr=null,Fi=new Map,Ui=new Map,dr=[],bx="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function mh(n,e){switch(n){case"focusin":case"focusout":pr=null;break;case"dragenter":case"dragleave":yr=null;break;case"mouseover":case"mouseout":vr=null;break;case"pointerover":case"pointerout":Fi.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ui.delete(e.pointerId)}}function ni(n,e,t,r,s,i){return n===null||n.nativeEvent!==i?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=ho(e),e!==null&&bd(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),n)}function Dx(n,e,t,r,s){switch(e){case"focusin":return pr=ni(pr,n,e,t,r,s),!0;case"dragenter":return yr=ni(yr,n,e,t,r,s),!0;case"mouseover":return vr=ni(vr,n,e,t,r,s),!0;case"pointerover":var i=s.pointerId;return Fi.set(i,ni(Fi.get(i)||null,n,e,t,r,s)),!0;case"gotpointercapture":return i=s.pointerId,Ui.set(i,ni(Ui.get(i)||null,n,e,t,r,s)),!0}return!1}function zp(n){var e=Br(n.target);if(e!==null){var t=ns(e);if(t!==null){if(e=t.tag,e===13){if(e=Op(t),e!==null){n.blockedOn=e,Kp(n.priority,function(){Vp(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function aa(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=gc(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);uc=r,t.target.dispatchEvent(r),uc=null}else return e=ho(t),e!==null&&bd(e),n.blockedOn=t,!1;e.shift()}return!0}function gh(n,e,t){aa(n)&&t.delete(e)}function Px(){mc=!1,pr!==null&&aa(pr)&&(pr=null),yr!==null&&aa(yr)&&(yr=null),vr!==null&&aa(vr)&&(vr=null),Fi.forEach(gh),Ui.forEach(gh)}function ri(n,e){n.blockedOn===e&&(n.blockedOn=null,mc||(mc=!0,$t.unstable_scheduleCallback($t.unstable_NormalPriority,Px)))}function Bi(n){function e(s){return ri(s,n)}if(0<Co.length){ri(Co[0],n);for(var t=1;t<Co.length;t++){var r=Co[t];r.blockedOn===n&&(r.blockedOn=null)}}for(pr!==null&&ri(pr,n),yr!==null&&ri(yr,n),vr!==null&&ri(vr,n),Fi.forEach(e),Ui.forEach(e),t=0;t<dr.length;t++)r=dr[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<dr.length&&(t=dr[0],t.blockedOn===null);)zp(t),t.blockedOn===null&&dr.shift()}var ws=Qn.ReactCurrentBatchConfig,Pa=!0;function Ox(n,e,t,r){var s=Ae,i=ws.transition;ws.transition=null;try{Ae=1,Dd(n,e,t,r)}finally{Ae=s,ws.transition=i}}function Nx(n,e,t,r){var s=Ae,i=ws.transition;ws.transition=null;try{Ae=4,Dd(n,e,t,r)}finally{Ae=s,ws.transition=i}}function Dd(n,e,t,r){if(Pa){var s=gc(n,e,t,r);if(s===null)ou(n,e,r,Oa,t),mh(n,r);else if(Dx(s,n,e,t,r))r.stopPropagation();else if(mh(n,r),e&4&&-1<bx.indexOf(n)){for(;s!==null;){var i=ho(s);if(i!==null&&Gp(i),i=gc(n,e,t,r),i===null&&ou(n,e,r,Oa,t),i===s)break;s=i}s!==null&&r.stopPropagation()}else ou(n,e,r,null,t)}}var Oa=null;function gc(n,e,t,r){if(Oa=null,n=wd(r),n=Br(n),n!==null)if(e=ns(n),e===null)n=null;else if(t=e.tag,t===13){if(n=Op(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return Oa=n,null}function Wp(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Tx()){case kd:return 1;case Up:return 4;case ba:case Ax:return 16;case Bp:return 536870912;default:return 16}default:return 16}}var hr=null,Pd=null,la=null;function Yp(){if(la)return la;var n,e=Pd,t=e.length,r,s="value"in hr?hr.value:hr.textContent,i=s.length;for(n=0;n<t&&e[n]===s[n];n++);var o=t-n;for(r=1;r<=o&&e[t-r]===s[i-r];r++);return la=s.slice(n,1<r?1-r:void 0)}function ua(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function bo(){return!0}function ph(){return!1}function Gt(n){function e(t,r,s,i,o){this._reactName=t,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?bo:ph,this.isPropagationStopped=ph,this}return Me(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=bo)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=bo)},persist:function(){},isPersistent:bo}),e}var Ks={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Od=Gt(Ks),fo=Me({},Ks,{view:0,detail:0}),Mx=Gt(fo),Ql,Jl,si,pl=Me({},fo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Nd,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==si&&(si&&n.type==="mousemove"?(Ql=n.screenX-si.screenX,Jl=n.screenY-si.screenY):Jl=Ql=0,si=n),Ql)},movementY:function(n){return"movementY"in n?n.movementY:Jl}}),yh=Gt(pl),Fx=Me({},pl,{dataTransfer:0}),Ux=Gt(Fx),Bx=Me({},fo,{relatedTarget:0}),Zl=Gt(Bx),$x=Me({},Ks,{animationName:0,elapsedTime:0,pseudoElement:0}),jx=Gt($x),Gx=Me({},Ks,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),Vx=Gt(Gx),Hx=Me({},Ks,{data:0}),vh=Gt(Hx),Kx={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},zx={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Wx={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Yx(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=Wx[n])?!!e[n]:!1}function Nd(){return Yx}var qx=Me({},fo,{key:function(n){if(n.key){var e=Kx[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=ua(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?zx[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Nd,charCode:function(n){return n.type==="keypress"?ua(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?ua(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),Xx=Gt(qx),Qx=Me({},pl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Eh=Gt(Qx),Jx=Me({},fo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Nd}),Zx=Gt(Jx),eS=Me({},Ks,{propertyName:0,elapsedTime:0,pseudoElement:0}),tS=Gt(eS),nS=Me({},pl,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),rS=Gt(nS),sS=[9,13,27,32],Md=Wn&&"CompositionEvent"in window,Li=null;Wn&&"documentMode"in document&&(Li=document.documentMode);var iS=Wn&&"TextEvent"in window&&!Li,qp=Wn&&(!Md||Li&&8<Li&&11>=Li),xh=" ",Sh=!1;function Xp(n,e){switch(n){case"keyup":return sS.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Qp(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var ms=!1;function oS(n,e){switch(n){case"compositionend":return Qp(e);case"keypress":return e.which!==32?null:(Sh=!0,xh);case"textInput":return n=e.data,n===xh&&Sh?null:n;default:return null}}function aS(n,e){if(ms)return n==="compositionend"||!Md&&Xp(n,e)?(n=Yp(),la=Pd=hr=null,ms=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return qp&&e.locale!=="ko"?null:e.data;default:return null}}var lS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Th(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!lS[n.type]:e==="textarea"}function Jp(n,e,t,r){kp(r),e=Na(e,"onChange"),0<e.length&&(t=new Od("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var Ii=null,$i=null;function uS(n){u0(n,0)}function yl(n){var e=ys(n);if(Tp(e))return n}function cS(n,e){if(n==="change")return e}var Zp=!1;if(Wn){var eu;if(Wn){var tu="oninput"in document;if(!tu){var Ah=document.createElement("div");Ah.setAttribute("oninput","return;"),tu=typeof Ah.oninput=="function"}eu=tu}else eu=!1;Zp=eu&&(!document.documentMode||9<document.documentMode)}function Lh(){Ii&&(Ii.detachEvent("onpropertychange",e0),$i=Ii=null)}function e0(n){if(n.propertyName==="value"&&yl($i)){var e=[];Jp(e,$i,n,wd(n)),Pp(uS,e)}}function dS(n,e,t){n==="focusin"?(Lh(),Ii=e,$i=t,Ii.attachEvent("onpropertychange",e0)):n==="focusout"&&Lh()}function fS(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return yl($i)}function hS(n,e){if(n==="click")return yl(e)}function mS(n,e){if(n==="input"||n==="change")return yl(e)}function gS(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var fn=typeof Object.is=="function"?Object.is:gS;function ji(n,e){if(fn(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var s=t[r];if(!Qu.call(e,s)||!fn(n[s],e[s]))return!1}return!0}function Ih(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Rh(n,e){var t=Ih(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=Ih(t)}}function t0(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?t0(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function n0(){for(var n=window,e=wa();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=wa(n.document)}return e}function Fd(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function pS(n){var e=n0(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&t0(t.ownerDocument.documentElement,t)){if(r!==null&&Fd(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var s=t.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!n.extend&&i>r&&(s=r,r=i,i=s),s=Rh(t,i);var o=Rh(t,r);s&&o&&(n.rangeCount!==1||n.anchorNode!==s.node||n.anchorOffset!==s.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),n.removeAllRanges(),i>r?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var yS=Wn&&"documentMode"in document&&11>=document.documentMode,gs=null,pc=null,Ri=null,yc=!1;function _h(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;yc||gs==null||gs!==wa(r)||(r=gs,"selectionStart"in r&&Fd(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Ri&&ji(Ri,r)||(Ri=r,r=Na(pc,"onSelect"),0<r.length&&(e=new Od("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=gs)))}function Do(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var ps={animationend:Do("Animation","AnimationEnd"),animationiteration:Do("Animation","AnimationIteration"),animationstart:Do("Animation","AnimationStart"),transitionend:Do("Transition","TransitionEnd")},nu={},r0={};Wn&&(r0=document.createElement("div").style,"AnimationEvent"in window||(delete ps.animationend.animation,delete ps.animationiteration.animation,delete ps.animationstart.animation),"TransitionEvent"in window||delete ps.transitionend.transition);function vl(n){if(nu[n])return nu[n];if(!ps[n])return n;var e=ps[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in r0)return nu[n]=e[t];return n}var s0=vl("animationend"),i0=vl("animationiteration"),o0=vl("animationstart"),a0=vl("transitionend"),l0=new Map,wh="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function kr(n,e){l0.set(n,e),ts(e,[n])}for(var ru=0;ru<wh.length;ru++){var su=wh[ru],vS=su.toLowerCase(),ES=su[0].toUpperCase()+su.slice(1);kr(vS,"on"+ES)}kr(s0,"onAnimationEnd");kr(i0,"onAnimationIteration");kr(o0,"onAnimationStart");kr("dblclick","onDoubleClick");kr("focusin","onFocus");kr("focusout","onBlur");kr(a0,"onTransitionEnd");Os("onMouseEnter",["mouseout","mouseover"]);Os("onMouseLeave",["mouseout","mouseover"]);Os("onPointerEnter",["pointerout","pointerover"]);Os("onPointerLeave",["pointerout","pointerover"]);ts("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ts("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ts("onBeforeInput",["compositionend","keypress","textInput","paste"]);ts("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ts("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ts("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var xi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),xS=new Set("cancel close invalid load scroll toggle".split(" ").concat(xi));function kh(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,vx(r,e,void 0,n),n.currentTarget=null}function u0(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==i&&s.isPropagationStopped())break e;kh(s,a,u),i=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,u=a.currentTarget,a=a.listener,l!==i&&s.isPropagationStopped())break e;kh(s,a,u),i=l}}}if(Ca)throw n=fc,Ca=!1,fc=null,n}function _e(n,e){var t=e[Tc];t===void 0&&(t=e[Tc]=new Set);var r=n+"__bubble";t.has(r)||(c0(e,n,2,!1),t.add(r))}function iu(n,e,t){var r=0;e&&(r|=4),c0(t,n,r,e)}var Po="_reactListening"+Math.random().toString(36).slice(2);function Gi(n){if(!n[Po]){n[Po]=!0,yp.forEach(function(t){t!=="selectionchange"&&(xS.has(t)||iu(t,!1,n),iu(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[Po]||(e[Po]=!0,iu("selectionchange",!1,e))}}function c0(n,e,t,r){switch(Wp(e)){case 1:var s=Ox;break;case 4:s=Nx;break;default:s=Dd}t=s.bind(null,e,t,n),s=void 0,!dc||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?n.addEventListener(e,t,{capture:!0,passive:s}):n.addEventListener(e,t,!0):s!==void 0?n.addEventListener(e,t,{passive:s}):n.addEventListener(e,t,!1)}function ou(n,e,t,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;o=o.return}for(;a!==null;){if(o=Br(a),o===null)return;if(l=o.tag,l===5||l===6){r=i=o;continue e}a=a.parentNode}}r=r.return}Pp(function(){var u=i,c=wd(t),d=[];e:{var f=l0.get(n);if(f!==void 0){var h=Od,m=n;switch(n){case"keypress":if(ua(t)===0)break e;case"keydown":case"keyup":h=Xx;break;case"focusin":m="focus",h=Zl;break;case"focusout":m="blur",h=Zl;break;case"beforeblur":case"afterblur":h=Zl;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":h=yh;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":h=Ux;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":h=Zx;break;case s0:case i0:case o0:h=jx;break;case a0:h=tS;break;case"scroll":h=Mx;break;case"wheel":h=rS;break;case"copy":case"cut":case"paste":h=Vx;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":h=Eh}var g=(e&4)!==0,p=!g&&n==="scroll",y=g?f!==null?f+"Capture":null:f;g=[];for(var v=u,E;v!==null;){E=v;var T=E.stateNode;if(E.tag===5&&T!==null&&(E=T,y!==null&&(T=Mi(v,y),T!=null&&g.push(Vi(v,T,E)))),p)break;v=v.return}0<g.length&&(f=new h(f,m,null,t,c),d.push({event:f,listeners:g}))}}if(!(e&7)){e:{if(f=n==="mouseover"||n==="pointerover",h=n==="mouseout"||n==="pointerout",f&&t!==uc&&(m=t.relatedTarget||t.fromElement)&&(Br(m)||m[Yn]))break e;if((h||f)&&(f=c.window===c?c:(f=c.ownerDocument)?f.defaultView||f.parentWindow:window,h?(m=t.relatedTarget||t.toElement,h=u,m=m?Br(m):null,m!==null&&(p=ns(m),m!==p||m.tag!==5&&m.tag!==6)&&(m=null)):(h=null,m=u),h!==m)){if(g=yh,T="onMouseLeave",y="onMouseEnter",v="mouse",(n==="pointerout"||n==="pointerover")&&(g=Eh,T="onPointerLeave",y="onPointerEnter",v="pointer"),p=h==null?f:ys(h),E=m==null?f:ys(m),f=new g(T,v+"leave",h,t,c),f.target=p,f.relatedTarget=E,T=null,Br(c)===u&&(g=new g(y,v+"enter",m,t,c),g.target=E,g.relatedTarget=p,T=g),p=T,h&&m)t:{for(g=h,y=m,v=0,E=g;E;E=as(E))v++;for(E=0,T=y;T;T=as(T))E++;for(;0<v-E;)g=as(g),v--;for(;0<E-v;)y=as(y),E--;for(;v--;){if(g===y||y!==null&&g===y.alternate)break t;g=as(g),y=as(y)}g=null}else g=null;h!==null&&Ch(d,f,h,g,!1),m!==null&&p!==null&&Ch(d,p,m,g,!0)}}e:{if(f=u?ys(u):window,h=f.nodeName&&f.nodeName.toLowerCase(),h==="select"||h==="input"&&f.type==="file")var A=cS;else if(Th(f))if(Zp)A=mS;else{A=fS;var R=dS}else(h=f.nodeName)&&h.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(A=hS);if(A&&(A=A(n,u))){Jp(d,A,t,c);break e}R&&R(n,f,u),n==="focusout"&&(R=f._wrapperState)&&R.controlled&&f.type==="number"&&sc(f,"number",f.value)}switch(R=u?ys(u):window,n){case"focusin":(Th(R)||R.contentEditable==="true")&&(gs=R,pc=u,Ri=null);break;case"focusout":Ri=pc=gs=null;break;case"mousedown":yc=!0;break;case"contextmenu":case"mouseup":case"dragend":yc=!1,_h(d,t,c);break;case"selectionchange":if(yS)break;case"keydown":case"keyup":_h(d,t,c)}var L;if(Md)e:{switch(n){case"compositionstart":var I="onCompositionStart";break e;case"compositionend":I="onCompositionEnd";break e;case"compositionupdate":I="onCompositionUpdate";break e}I=void 0}else ms?Xp(n,t)&&(I="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(I="onCompositionStart");I&&(qp&&t.locale!=="ko"&&(ms||I!=="onCompositionStart"?I==="onCompositionEnd"&&ms&&(L=Yp()):(hr=c,Pd="value"in hr?hr.value:hr.textContent,ms=!0)),R=Na(u,I),0<R.length&&(I=new vh(I,n,null,t,c),d.push({event:I,listeners:R}),L?I.data=L:(L=Qp(t),L!==null&&(I.data=L)))),(L=iS?oS(n,t):aS(n,t))&&(u=Na(u,"onBeforeInput"),0<u.length&&(c=new vh("onBeforeInput","beforeinput",null,t,c),d.push({event:c,listeners:u}),c.data=L))}u0(d,e)})}function Vi(n,e,t){return{instance:n,listener:e,currentTarget:t}}function Na(n,e){for(var t=e+"Capture",r=[];n!==null;){var s=n,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=Mi(n,t),i!=null&&r.unshift(Vi(n,i,s)),i=Mi(n,e),i!=null&&r.push(Vi(n,i,s))),n=n.return}return r}function as(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function Ch(n,e,t,r,s){for(var i=e._reactName,o=[];t!==null&&t!==r;){var a=t,l=a.alternate,u=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&u!==null&&(a=u,s?(l=Mi(t,i),l!=null&&o.unshift(Vi(t,l,a))):s||(l=Mi(t,i),l!=null&&o.push(Vi(t,l,a)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var SS=/\r\n?/g,TS=/\u0000|\uFFFD/g;function bh(n){return(typeof n=="string"?n:""+n).replace(SS,`
`).replace(TS,"")}function Oo(n,e,t){if(e=bh(e),bh(n)!==e&&t)throw Error($(425))}function Ma(){}var vc=null,Ec=null;function xc(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Sc=typeof setTimeout=="function"?setTimeout:void 0,AS=typeof clearTimeout=="function"?clearTimeout:void 0,Dh=typeof Promise=="function"?Promise:void 0,LS=typeof queueMicrotask=="function"?queueMicrotask:typeof Dh<"u"?function(n){return Dh.resolve(null).then(n).catch(IS)}:Sc;function IS(n){setTimeout(function(){throw n})}function au(n,e){var t=e,r=0;do{var s=t.nextSibling;if(n.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(r===0){n.removeChild(s),Bi(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=s}while(t);Bi(e)}function Er(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function Ph(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var zs=Math.random().toString(36).slice(2),Rn="__reactFiber$"+zs,Hi="__reactProps$"+zs,Yn="__reactContainer$"+zs,Tc="__reactEvents$"+zs,RS="__reactListeners$"+zs,_S="__reactHandles$"+zs;function Br(n){var e=n[Rn];if(e)return e;for(var t=n.parentNode;t;){if(e=t[Yn]||t[Rn]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=Ph(n);n!==null;){if(t=n[Rn])return t;n=Ph(n)}return e}n=t,t=n.parentNode}return null}function ho(n){return n=n[Rn]||n[Yn],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function ys(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error($(33))}function El(n){return n[Hi]||null}var Ac=[],vs=-1;function Cr(n){return{current:n}}function we(n){0>vs||(n.current=Ac[vs],Ac[vs]=null,vs--)}function Re(n,e){vs++,Ac[vs]=n.current,n.current=e}var Rr={},ft=Cr(Rr),kt=Cr(!1),Yr=Rr;function Ns(n,e){var t=n.type.contextTypes;if(!t)return Rr;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in t)s[i]=e[i];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=s),s}function Ct(n){return n=n.childContextTypes,n!=null}function Fa(){we(kt),we(ft)}function Oh(n,e,t){if(ft.current!==Rr)throw Error($(168));Re(ft,e),Re(kt,t)}function d0(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error($(108,dx(n)||"Unknown",s));return Me({},t,r)}function Ua(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Rr,Yr=ft.current,Re(ft,n),Re(kt,kt.current),!0}function Nh(n,e,t){var r=n.stateNode;if(!r)throw Error($(169));t?(n=d0(n,e,Yr),r.__reactInternalMemoizedMergedChildContext=n,we(kt),we(ft),Re(ft,n)):we(kt),Re(kt,t)}var Gn=null,xl=!1,lu=!1;function f0(n){Gn===null?Gn=[n]:Gn.push(n)}function wS(n){xl=!0,f0(n)}function br(){if(!lu&&Gn!==null){lu=!0;var n=0,e=Ae;try{var t=Gn;for(Ae=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}Gn=null,xl=!1}catch(s){throw Gn!==null&&(Gn=Gn.slice(n+1)),Fp(kd,br),s}finally{Ae=e,lu=!1}}return null}var Es=[],xs=0,Ba=null,$a=0,Wt=[],Yt=0,qr=null,Vn=1,Hn="";function Nr(n,e){Es[xs++]=$a,Es[xs++]=Ba,Ba=n,$a=e}function h0(n,e,t){Wt[Yt++]=Vn,Wt[Yt++]=Hn,Wt[Yt++]=qr,qr=n;var r=Vn;n=Hn;var s=32-cn(r)-1;r&=~(1<<s),t+=1;var i=32-cn(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,Vn=1<<32-cn(e)+s|t<<s|r,Hn=i+n}else Vn=1<<i|t<<s|r,Hn=n}function Ud(n){n.return!==null&&(Nr(n,1),h0(n,1,0))}function Bd(n){for(;n===Ba;)Ba=Es[--xs],Es[xs]=null,$a=Es[--xs],Es[xs]=null;for(;n===qr;)qr=Wt[--Yt],Wt[Yt]=null,Hn=Wt[--Yt],Wt[Yt]=null,Vn=Wt[--Yt],Wt[Yt]=null}var Ut=null,Ft=null,Ce=!1,ln=null;function m0(n,e){var t=qt(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function Mh(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,Ut=n,Ft=Er(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,Ut=n,Ft=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=qr!==null?{id:Vn,overflow:Hn}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=qt(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,Ut=n,Ft=null,!0):!1;default:return!1}}function Lc(n){return(n.mode&1)!==0&&(n.flags&128)===0}function Ic(n){if(Ce){var e=Ft;if(e){var t=e;if(!Mh(n,e)){if(Lc(n))throw Error($(418));e=Er(t.nextSibling);var r=Ut;e&&Mh(n,e)?m0(r,t):(n.flags=n.flags&-4097|2,Ce=!1,Ut=n)}}else{if(Lc(n))throw Error($(418));n.flags=n.flags&-4097|2,Ce=!1,Ut=n}}}function Fh(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Ut=n}function No(n){if(n!==Ut)return!1;if(!Ce)return Fh(n),Ce=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!xc(n.type,n.memoizedProps)),e&&(e=Ft)){if(Lc(n))throw g0(),Error($(418));for(;e;)m0(n,e),e=Er(e.nextSibling)}if(Fh(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error($(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){Ft=Er(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}Ft=null}}else Ft=Ut?Er(n.stateNode.nextSibling):null;return!0}function g0(){for(var n=Ft;n;)n=Er(n.nextSibling)}function Ms(){Ft=Ut=null,Ce=!1}function $d(n){ln===null?ln=[n]:ln.push(n)}var kS=Qn.ReactCurrentBatchConfig;function ii(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error($(309));var r=t.stateNode}if(!r)throw Error($(147,n));var s=r,i=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=s.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof n!="string")throw Error($(284));if(!t._owner)throw Error($(290,n))}return n}function Mo(n,e){throw n=Object.prototype.toString.call(e),Error($(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function Uh(n){var e=n._init;return e(n._payload)}function p0(n){function e(y,v){if(n){var E=y.deletions;E===null?(y.deletions=[v],y.flags|=16):E.push(v)}}function t(y,v){if(!n)return null;for(;v!==null;)e(y,v),v=v.sibling;return null}function r(y,v){for(y=new Map;v!==null;)v.key!==null?y.set(v.key,v):y.set(v.index,v),v=v.sibling;return y}function s(y,v){return y=Ar(y,v),y.index=0,y.sibling=null,y}function i(y,v,E){return y.index=E,n?(E=y.alternate,E!==null?(E=E.index,E<v?(y.flags|=2,v):E):(y.flags|=2,v)):(y.flags|=1048576,v)}function o(y){return n&&y.alternate===null&&(y.flags|=2),y}function a(y,v,E,T){return v===null||v.tag!==6?(v=gu(E,y.mode,T),v.return=y,v):(v=s(v,E),v.return=y,v)}function l(y,v,E,T){var A=E.type;return A===hs?c(y,v,E.props.children,T,E.key):v!==null&&(v.elementType===A||typeof A=="object"&&A!==null&&A.$$typeof===or&&Uh(A)===v.type)?(T=s(v,E.props),T.ref=ii(y,v,E),T.return=y,T):(T=pa(E.type,E.key,E.props,null,y.mode,T),T.ref=ii(y,v,E),T.return=y,T)}function u(y,v,E,T){return v===null||v.tag!==4||v.stateNode.containerInfo!==E.containerInfo||v.stateNode.implementation!==E.implementation?(v=pu(E,y.mode,T),v.return=y,v):(v=s(v,E.children||[]),v.return=y,v)}function c(y,v,E,T,A){return v===null||v.tag!==7?(v=Hr(E,y.mode,T,A),v.return=y,v):(v=s(v,E),v.return=y,v)}function d(y,v,E){if(typeof v=="string"&&v!==""||typeof v=="number")return v=gu(""+v,y.mode,E),v.return=y,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Io:return E=pa(v.type,v.key,v.props,null,y.mode,E),E.ref=ii(y,null,v),E.return=y,E;case fs:return v=pu(v,y.mode,E),v.return=y,v;case or:var T=v._init;return d(y,T(v._payload),E)}if(vi(v)||ei(v))return v=Hr(v,y.mode,E,null),v.return=y,v;Mo(y,v)}return null}function f(y,v,E,T){var A=v!==null?v.key:null;if(typeof E=="string"&&E!==""||typeof E=="number")return A!==null?null:a(y,v,""+E,T);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case Io:return E.key===A?l(y,v,E,T):null;case fs:return E.key===A?u(y,v,E,T):null;case or:return A=E._init,f(y,v,A(E._payload),T)}if(vi(E)||ei(E))return A!==null?null:c(y,v,E,T,null);Mo(y,E)}return null}function h(y,v,E,T,A){if(typeof T=="string"&&T!==""||typeof T=="number")return y=y.get(E)||null,a(v,y,""+T,A);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case Io:return y=y.get(T.key===null?E:T.key)||null,l(v,y,T,A);case fs:return y=y.get(T.key===null?E:T.key)||null,u(v,y,T,A);case or:var R=T._init;return h(y,v,E,R(T._payload),A)}if(vi(T)||ei(T))return y=y.get(E)||null,c(v,y,T,A,null);Mo(v,T)}return null}function m(y,v,E,T){for(var A=null,R=null,L=v,I=v=0,C=null;L!==null&&I<E.length;I++){L.index>I?(C=L,L=null):C=L.sibling;var _=f(y,L,E[I],T);if(_===null){L===null&&(L=C);break}n&&L&&_.alternate===null&&e(y,L),v=i(_,v,I),R===null?A=_:R.sibling=_,R=_,L=C}if(I===E.length)return t(y,L),Ce&&Nr(y,I),A;if(L===null){for(;I<E.length;I++)L=d(y,E[I],T),L!==null&&(v=i(L,v,I),R===null?A=L:R.sibling=L,R=L);return Ce&&Nr(y,I),A}for(L=r(y,L);I<E.length;I++)C=h(L,y,I,E[I],T),C!==null&&(n&&C.alternate!==null&&L.delete(C.key===null?I:C.key),v=i(C,v,I),R===null?A=C:R.sibling=C,R=C);return n&&L.forEach(function(F){return e(y,F)}),Ce&&Nr(y,I),A}function g(y,v,E,T){var A=ei(E);if(typeof A!="function")throw Error($(150));if(E=A.call(E),E==null)throw Error($(151));for(var R=A=null,L=v,I=v=0,C=null,_=E.next();L!==null&&!_.done;I++,_=E.next()){L.index>I?(C=L,L=null):C=L.sibling;var F=f(y,L,_.value,T);if(F===null){L===null&&(L=C);break}n&&L&&F.alternate===null&&e(y,L),v=i(F,v,I),R===null?A=F:R.sibling=F,R=F,L=C}if(_.done)return t(y,L),Ce&&Nr(y,I),A;if(L===null){for(;!_.done;I++,_=E.next())_=d(y,_.value,T),_!==null&&(v=i(_,v,I),R===null?A=_:R.sibling=_,R=_);return Ce&&Nr(y,I),A}for(L=r(y,L);!_.done;I++,_=E.next())_=h(L,y,I,_.value,T),_!==null&&(n&&_.alternate!==null&&L.delete(_.key===null?I:_.key),v=i(_,v,I),R===null?A=_:R.sibling=_,R=_);return n&&L.forEach(function(B){return e(y,B)}),Ce&&Nr(y,I),A}function p(y,v,E,T){if(typeof E=="object"&&E!==null&&E.type===hs&&E.key===null&&(E=E.props.children),typeof E=="object"&&E!==null){switch(E.$$typeof){case Io:e:{for(var A=E.key,R=v;R!==null;){if(R.key===A){if(A=E.type,A===hs){if(R.tag===7){t(y,R.sibling),v=s(R,E.props.children),v.return=y,y=v;break e}}else if(R.elementType===A||typeof A=="object"&&A!==null&&A.$$typeof===or&&Uh(A)===R.type){t(y,R.sibling),v=s(R,E.props),v.ref=ii(y,R,E),v.return=y,y=v;break e}t(y,R);break}else e(y,R);R=R.sibling}E.type===hs?(v=Hr(E.props.children,y.mode,T,E.key),v.return=y,y=v):(T=pa(E.type,E.key,E.props,null,y.mode,T),T.ref=ii(y,v,E),T.return=y,y=T)}return o(y);case fs:e:{for(R=E.key;v!==null;){if(v.key===R)if(v.tag===4&&v.stateNode.containerInfo===E.containerInfo&&v.stateNode.implementation===E.implementation){t(y,v.sibling),v=s(v,E.children||[]),v.return=y,y=v;break e}else{t(y,v);break}else e(y,v);v=v.sibling}v=pu(E,y.mode,T),v.return=y,y=v}return o(y);case or:return R=E._init,p(y,v,R(E._payload),T)}if(vi(E))return m(y,v,E,T);if(ei(E))return g(y,v,E,T);Mo(y,E)}return typeof E=="string"&&E!==""||typeof E=="number"?(E=""+E,v!==null&&v.tag===6?(t(y,v.sibling),v=s(v,E),v.return=y,y=v):(t(y,v),v=gu(E,y.mode,T),v.return=y,y=v),o(y)):t(y,v)}return p}var Fs=p0(!0),y0=p0(!1),ja=Cr(null),Ga=null,Ss=null,jd=null;function Gd(){jd=Ss=Ga=null}function Vd(n){var e=ja.current;we(ja),n._currentValue=e}function Rc(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function ks(n,e){Ga=n,jd=Ss=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(wt=!0),n.firstContext=null)}function Qt(n){var e=n._currentValue;if(jd!==n)if(n={context:n,memoizedValue:e,next:null},Ss===null){if(Ga===null)throw Error($(308));Ss=n,Ga.dependencies={lanes:0,firstContext:n}}else Ss=Ss.next=n;return e}var $r=null;function Hd(n){$r===null?$r=[n]:$r.push(n)}function v0(n,e,t,r){var s=e.interleaved;return s===null?(t.next=t,Hd(e)):(t.next=s.next,s.next=t),e.interleaved=t,qn(n,r)}function qn(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var ar=!1;function Kd(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function E0(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function zn(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function xr(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,ve&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,qn(n,t)}return s=r.interleaved,s===null?(e.next=e,Hd(r)):(e.next=s.next,s.next=e),r.interleaved=e,qn(n,t)}function ca(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,Cd(n,t)}}function Bh(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var s=null,i=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};i===null?s=i=o:i=i.next=o,t=t.next}while(t!==null);i===null?s=i=e:i=i.next=e}else s=i=e;t={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function Va(n,e,t,r){var s=n.updateQueue;ar=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var l=a,u=l.next;l.next=null,o===null?i=u:o.next=u,o=l;var c=n.alternate;c!==null&&(c=c.updateQueue,a=c.lastBaseUpdate,a!==o&&(a===null?c.firstBaseUpdate=u:a.next=u,c.lastBaseUpdate=l))}if(i!==null){var d=s.baseState;o=0,c=u=l=null,a=i;do{var f=a.lane,h=a.eventTime;if((r&f)===f){c!==null&&(c=c.next={eventTime:h,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var m=n,g=a;switch(f=e,h=t,g.tag){case 1:if(m=g.payload,typeof m=="function"){d=m.call(h,d,f);break e}d=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=g.payload,f=typeof m=="function"?m.call(h,d,f):m,f==null)break e;d=Me({},d,f);break e;case 2:ar=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,f=s.effects,f===null?s.effects=[a]:f.push(a))}else h={eventTime:h,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},c===null?(u=c=h,l=d):c=c.next=h,o|=f;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;f=a,a=f.next,f.next=null,s.lastBaseUpdate=f,s.shared.pending=null}}while(!0);if(c===null&&(l=d),s.baseState=l,s.firstBaseUpdate=u,s.lastBaseUpdate=c,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);Qr|=o,n.lanes=o,n.memoizedState=d}}function $h(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],s=r.callback;if(s!==null){if(r.callback=null,r=t,typeof s!="function")throw Error($(191,s));s.call(r)}}}var mo={},bn=Cr(mo),Ki=Cr(mo),zi=Cr(mo);function jr(n){if(n===mo)throw Error($(174));return n}function zd(n,e){switch(Re(zi,e),Re(Ki,n),Re(bn,mo),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:oc(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=oc(e,n)}we(bn),Re(bn,e)}function Us(){we(bn),we(Ki),we(zi)}function x0(n){jr(zi.current);var e=jr(bn.current),t=oc(e,n.type);e!==t&&(Re(Ki,n),Re(bn,t))}function Wd(n){Ki.current===n&&(we(bn),we(Ki))}var Pe=Cr(0);function Ha(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var uu=[];function Yd(){for(var n=0;n<uu.length;n++)uu[n]._workInProgressVersionPrimary=null;uu.length=0}var da=Qn.ReactCurrentDispatcher,cu=Qn.ReactCurrentBatchConfig,Xr=0,Ne=null,ze=null,Je=null,Ka=!1,_i=!1,Wi=0,CS=0;function at(){throw Error($(321))}function qd(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!fn(n[t],e[t]))return!1;return!0}function Xd(n,e,t,r,s,i){if(Xr=i,Ne=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,da.current=n===null||n.memoizedState===null?OS:NS,n=t(r,s),_i){i=0;do{if(_i=!1,Wi=0,25<=i)throw Error($(301));i+=1,Je=ze=null,e.updateQueue=null,da.current=MS,n=t(r,s)}while(_i)}if(da.current=za,e=ze!==null&&ze.next!==null,Xr=0,Je=ze=Ne=null,Ka=!1,e)throw Error($(300));return n}function Qd(){var n=Wi!==0;return Wi=0,n}function Tn(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Je===null?Ne.memoizedState=Je=n:Je=Je.next=n,Je}function Jt(){if(ze===null){var n=Ne.alternate;n=n!==null?n.memoizedState:null}else n=ze.next;var e=Je===null?Ne.memoizedState:Je.next;if(e!==null)Je=e,ze=n;else{if(n===null)throw Error($(310));ze=n,n={memoizedState:ze.memoizedState,baseState:ze.baseState,baseQueue:ze.baseQueue,queue:ze.queue,next:null},Je===null?Ne.memoizedState=Je=n:Je=Je.next=n}return Je}function Yi(n,e){return typeof e=="function"?e(n):e}function du(n){var e=Jt(),t=e.queue;if(t===null)throw Error($(311));t.lastRenderedReducer=n;var r=ze,s=r.baseQueue,i=t.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,t.pending=null}if(s!==null){i=s.next,r=r.baseState;var a=o=null,l=null,u=i;do{var c=u.lane;if((Xr&c)===c)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:n(r,u.action);else{var d={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=d,o=r):l=l.next=d,Ne.lanes|=c,Qr|=c}u=u.next}while(u!==null&&u!==i);l===null?o=r:l.next=a,fn(r,e.memoizedState)||(wt=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,t.lastRenderedState=r}if(n=t.interleaved,n!==null){s=n;do i=s.lane,Ne.lanes|=i,Qr|=i,s=s.next;while(s!==n)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function fu(n){var e=Jt(),t=e.queue;if(t===null)throw Error($(311));t.lastRenderedReducer=n;var r=t.dispatch,s=t.pending,i=e.memoizedState;if(s!==null){t.pending=null;var o=s=s.next;do i=n(i,o.action),o=o.next;while(o!==s);fn(i,e.memoizedState)||(wt=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),t.lastRenderedState=i}return[i,r]}function S0(){}function T0(n,e){var t=Ne,r=Jt(),s=e(),i=!fn(r.memoizedState,s);if(i&&(r.memoizedState=s,wt=!0),r=r.queue,Jd(I0.bind(null,t,r,n),[n]),r.getSnapshot!==e||i||Je!==null&&Je.memoizedState.tag&1){if(t.flags|=2048,qi(9,L0.bind(null,t,r,s,e),void 0,null),et===null)throw Error($(349));Xr&30||A0(t,e,s)}return s}function A0(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=Ne.updateQueue,e===null?(e={lastEffect:null,stores:null},Ne.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function L0(n,e,t,r){e.value=t,e.getSnapshot=r,R0(e)&&_0(n)}function I0(n,e,t){return t(function(){R0(e)&&_0(n)})}function R0(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!fn(n,t)}catch{return!0}}function _0(n){var e=qn(n,1);e!==null&&dn(e,n,1,-1)}function jh(n){var e=Tn();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Yi,lastRenderedState:n},e.queue=n,n=n.dispatch=PS.bind(null,Ne,n),[e.memoizedState,n]}function qi(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=Ne.updateQueue,e===null?(e={lastEffect:null,stores:null},Ne.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function w0(){return Jt().memoizedState}function fa(n,e,t,r){var s=Tn();Ne.flags|=n,s.memoizedState=qi(1|e,t,void 0,r===void 0?null:r)}function Sl(n,e,t,r){var s=Jt();r=r===void 0?null:r;var i=void 0;if(ze!==null){var o=ze.memoizedState;if(i=o.destroy,r!==null&&qd(r,o.deps)){s.memoizedState=qi(e,t,i,r);return}}Ne.flags|=n,s.memoizedState=qi(1|e,t,i,r)}function Gh(n,e){return fa(8390656,8,n,e)}function Jd(n,e){return Sl(2048,8,n,e)}function k0(n,e){return Sl(4,2,n,e)}function C0(n,e){return Sl(4,4,n,e)}function b0(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function D0(n,e,t){return t=t!=null?t.concat([n]):null,Sl(4,4,b0.bind(null,e,n),t)}function Zd(){}function P0(n,e){var t=Jt();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&qd(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function O0(n,e){var t=Jt();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&qd(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function N0(n,e,t){return Xr&21?(fn(t,e)||(t=$p(),Ne.lanes|=t,Qr|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,wt=!0),n.memoizedState=t)}function bS(n,e){var t=Ae;Ae=t!==0&&4>t?t:4,n(!0);var r=cu.transition;cu.transition={};try{n(!1),e()}finally{Ae=t,cu.transition=r}}function M0(){return Jt().memoizedState}function DS(n,e,t){var r=Tr(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},F0(n))U0(e,t);else if(t=v0(n,e,t,r),t!==null){var s=yt();dn(t,n,r,s),B0(t,e,r)}}function PS(n,e,t){var r=Tr(n),s={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(F0(n))U0(e,s);else{var i=n.alternate;if(n.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,t);if(s.hasEagerState=!0,s.eagerState=a,fn(a,o)){var l=e.interleaved;l===null?(s.next=s,Hd(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}t=v0(n,e,s,r),t!==null&&(s=yt(),dn(t,n,r,s),B0(t,e,r))}}function F0(n){var e=n.alternate;return n===Ne||e!==null&&e===Ne}function U0(n,e){_i=Ka=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function B0(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,Cd(n,t)}}var za={readContext:Qt,useCallback:at,useContext:at,useEffect:at,useImperativeHandle:at,useInsertionEffect:at,useLayoutEffect:at,useMemo:at,useReducer:at,useRef:at,useState:at,useDebugValue:at,useDeferredValue:at,useTransition:at,useMutableSource:at,useSyncExternalStore:at,useId:at,unstable_isNewReconciler:!1},OS={readContext:Qt,useCallback:function(n,e){return Tn().memoizedState=[n,e===void 0?null:e],n},useContext:Qt,useEffect:Gh,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,fa(4194308,4,b0.bind(null,e,n),t)},useLayoutEffect:function(n,e){return fa(4194308,4,n,e)},useInsertionEffect:function(n,e){return fa(4,2,n,e)},useMemo:function(n,e){var t=Tn();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=Tn();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=DS.bind(null,Ne,n),[r.memoizedState,n]},useRef:function(n){var e=Tn();return n={current:n},e.memoizedState=n},useState:jh,useDebugValue:Zd,useDeferredValue:function(n){return Tn().memoizedState=n},useTransition:function(){var n=jh(!1),e=n[0];return n=bS.bind(null,n[1]),Tn().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=Ne,s=Tn();if(Ce){if(t===void 0)throw Error($(407));t=t()}else{if(t=e(),et===null)throw Error($(349));Xr&30||A0(r,e,t)}s.memoizedState=t;var i={value:t,getSnapshot:e};return s.queue=i,Gh(I0.bind(null,r,i,n),[n]),r.flags|=2048,qi(9,L0.bind(null,r,i,t,e),void 0,null),t},useId:function(){var n=Tn(),e=et.identifierPrefix;if(Ce){var t=Hn,r=Vn;t=(r&~(1<<32-cn(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=Wi++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=CS++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},NS={readContext:Qt,useCallback:P0,useContext:Qt,useEffect:Jd,useImperativeHandle:D0,useInsertionEffect:k0,useLayoutEffect:C0,useMemo:O0,useReducer:du,useRef:w0,useState:function(){return du(Yi)},useDebugValue:Zd,useDeferredValue:function(n){var e=Jt();return N0(e,ze.memoizedState,n)},useTransition:function(){var n=du(Yi)[0],e=Jt().memoizedState;return[n,e]},useMutableSource:S0,useSyncExternalStore:T0,useId:M0,unstable_isNewReconciler:!1},MS={readContext:Qt,useCallback:P0,useContext:Qt,useEffect:Jd,useImperativeHandle:D0,useInsertionEffect:k0,useLayoutEffect:C0,useMemo:O0,useReducer:fu,useRef:w0,useState:function(){return fu(Yi)},useDebugValue:Zd,useDeferredValue:function(n){var e=Jt();return ze===null?e.memoizedState=n:N0(e,ze.memoizedState,n)},useTransition:function(){var n=fu(Yi)[0],e=Jt().memoizedState;return[n,e]},useMutableSource:S0,useSyncExternalStore:T0,useId:M0,unstable_isNewReconciler:!1};function sn(n,e){if(n&&n.defaultProps){e=Me({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function _c(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:Me({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var Tl={isMounted:function(n){return(n=n._reactInternals)?ns(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=yt(),s=Tr(n),i=zn(r,s);i.payload=e,t!=null&&(i.callback=t),e=xr(n,i,s),e!==null&&(dn(e,n,s,r),ca(e,n,s))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=yt(),s=Tr(n),i=zn(r,s);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=xr(n,i,s),e!==null&&(dn(e,n,s,r),ca(e,n,s))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=yt(),r=Tr(n),s=zn(t,r);s.tag=2,e!=null&&(s.callback=e),e=xr(n,s,r),e!==null&&(dn(e,n,r,t),ca(e,n,r))}};function Vh(n,e,t,r,s,i,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!ji(t,r)||!ji(s,i):!0}function $0(n,e,t){var r=!1,s=Rr,i=e.contextType;return typeof i=="object"&&i!==null?i=Qt(i):(s=Ct(e)?Yr:ft.current,r=e.contextTypes,i=(r=r!=null)?Ns(n,s):Rr),e=new e(t,i),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Tl,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=s,n.__reactInternalMemoizedMaskedChildContext=i),e}function Hh(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&Tl.enqueueReplaceState(e,e.state,null)}function wc(n,e,t,r){var s=n.stateNode;s.props=t,s.state=n.memoizedState,s.refs={},Kd(n);var i=e.contextType;typeof i=="object"&&i!==null?s.context=Qt(i):(i=Ct(e)?Yr:ft.current,s.context=Ns(n,i)),s.state=n.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(_c(n,e,i,t),s.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&Tl.enqueueReplaceState(s,s.state,null),Va(n,t,s,r),s.state=n.memoizedState),typeof s.componentDidMount=="function"&&(n.flags|=4194308)}function Bs(n,e){try{var t="",r=e;do t+=cx(r),r=r.return;while(r);var s=t}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:n,source:e,stack:s,digest:null}}function hu(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function kc(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var FS=typeof WeakMap=="function"?WeakMap:Map;function j0(n,e,t){t=zn(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){Ya||(Ya=!0,Bc=r),kc(n,e)},t}function G0(n,e,t){t=zn(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;t.payload=function(){return r(s)},t.callback=function(){kc(n,e)}}var i=n.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(t.callback=function(){kc(n,e),typeof r!="function"&&(Sr===null?Sr=new Set([this]):Sr.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function Kh(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new FS;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(t)||(s.add(t),n=QS.bind(null,n,e,t),e.then(n,n))}function zh(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function Wh(n,e,t,r,s){return n.mode&1?(n.flags|=65536,n.lanes=s,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=zn(-1,1),e.tag=2,xr(t,e,1))),t.lanes|=1),n)}var US=Qn.ReactCurrentOwner,wt=!1;function pt(n,e,t,r){e.child=n===null?y0(e,null,t,r):Fs(e,n.child,t,r)}function Yh(n,e,t,r,s){t=t.render;var i=e.ref;return ks(e,s),r=Xd(n,e,t,r,i,s),t=Qd(),n!==null&&!wt?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,Xn(n,e,s)):(Ce&&t&&Ud(e),e.flags|=1,pt(n,e,r,s),e.child)}function qh(n,e,t,r,s){if(n===null){var i=t.type;return typeof i=="function"&&!lf(i)&&i.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=i,V0(n,e,i,r,s)):(n=pa(t.type,null,r,e,e.mode,s),n.ref=e.ref,n.return=e,e.child=n)}if(i=n.child,!(n.lanes&s)){var o=i.memoizedProps;if(t=t.compare,t=t!==null?t:ji,t(o,r)&&n.ref===e.ref)return Xn(n,e,s)}return e.flags|=1,n=Ar(i,r),n.ref=e.ref,n.return=e,e.child=n}function V0(n,e,t,r,s){if(n!==null){var i=n.memoizedProps;if(ji(i,r)&&n.ref===e.ref)if(wt=!1,e.pendingProps=r=i,(n.lanes&s)!==0)n.flags&131072&&(wt=!0);else return e.lanes=n.lanes,Xn(n,e,s)}return Cc(n,e,t,r,s)}function H0(n,e,t){var r=e.pendingProps,s=r.children,i=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Re(As,Nt),Nt|=t;else{if(!(t&1073741824))return n=i!==null?i.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,Re(As,Nt),Nt|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:t,Re(As,Nt),Nt|=r}else i!==null?(r=i.baseLanes|t,e.memoizedState=null):r=t,Re(As,Nt),Nt|=r;return pt(n,e,s,t),e.child}function K0(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function Cc(n,e,t,r,s){var i=Ct(t)?Yr:ft.current;return i=Ns(e,i),ks(e,s),t=Xd(n,e,t,r,i,s),r=Qd(),n!==null&&!wt?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,Xn(n,e,s)):(Ce&&r&&Ud(e),e.flags|=1,pt(n,e,t,s),e.child)}function Xh(n,e,t,r,s){if(Ct(t)){var i=!0;Ua(e)}else i=!1;if(ks(e,s),e.stateNode===null)ha(n,e),$0(e,t,r),wc(e,t,r,s),r=!0;else if(n===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,u=t.contextType;typeof u=="object"&&u!==null?u=Qt(u):(u=Ct(t)?Yr:ft.current,u=Ns(e,u));var c=t.getDerivedStateFromProps,d=typeof c=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==u)&&Hh(e,o,r,u),ar=!1;var f=e.memoizedState;o.state=f,Va(e,r,o,s),l=e.memoizedState,a!==r||f!==l||kt.current||ar?(typeof c=="function"&&(_c(e,t,c,r),l=e.memoizedState),(a=ar||Vh(e,t,a,r,f,l,u))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=u,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,E0(n,e),a=e.memoizedProps,u=e.type===e.elementType?a:sn(e.type,a),o.props=u,d=e.pendingProps,f=o.context,l=t.contextType,typeof l=="object"&&l!==null?l=Qt(l):(l=Ct(t)?Yr:ft.current,l=Ns(e,l));var h=t.getDerivedStateFromProps;(c=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||f!==l)&&Hh(e,o,r,l),ar=!1,f=e.memoizedState,o.state=f,Va(e,r,o,s);var m=e.memoizedState;a!==d||f!==m||kt.current||ar?(typeof h=="function"&&(_c(e,t,h,r),m=e.memoizedState),(u=ar||Vh(e,t,u,r,f,m,l)||!1)?(c||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,m,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,m,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=m),o.props=r,o.state=m,o.context=l,r=u):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),r=!1)}return bc(n,e,t,r,i,s)}function bc(n,e,t,r,s,i){K0(n,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&Nh(e,t,!1),Xn(n,e,i);r=e.stateNode,US.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&o?(e.child=Fs(e,n.child,null,i),e.child=Fs(e,null,a,i)):pt(n,e,a,i),e.memoizedState=r.state,s&&Nh(e,t,!0),e.child}function z0(n){var e=n.stateNode;e.pendingContext?Oh(n,e.pendingContext,e.pendingContext!==e.context):e.context&&Oh(n,e.context,!1),zd(n,e.containerInfo)}function Qh(n,e,t,r,s){return Ms(),$d(s),e.flags|=256,pt(n,e,t,r),e.child}var Dc={dehydrated:null,treeContext:null,retryLane:0};function Pc(n){return{baseLanes:n,cachePool:null,transitions:null}}function W0(n,e,t){var r=e.pendingProps,s=Pe.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=n!==null&&n.memoizedState===null?!1:(s&2)!==0),a?(i=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(s|=1),Re(Pe,s&1),n===null)return Ic(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,n=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=Il(o,r,0,null),n=Hr(n,r,t,null),i.return=e,n.return=e,i.sibling=n,e.child=i,e.child.memoizedState=Pc(t),e.memoizedState=Dc,n):ef(e,o));if(s=n.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return BS(n,e,o,r,a,s,t);if(i){i=r.fallback,o=e.mode,s=n.child,a=s.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=Ar(s,l),r.subtreeFlags=s.subtreeFlags&14680064),a!==null?i=Ar(a,i):(i=Hr(i,o,t,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=n.child.memoizedState,o=o===null?Pc(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=n.childLanes&~t,e.memoizedState=Dc,r}return i=n.child,n=i.sibling,r=Ar(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function ef(n,e){return e=Il({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function Fo(n,e,t,r){return r!==null&&$d(r),Fs(e,n.child,null,t),n=ef(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function BS(n,e,t,r,s,i,o){if(t)return e.flags&256?(e.flags&=-257,r=hu(Error($(422))),Fo(n,e,o,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=Il({mode:"visible",children:r.children},s,0,null),i=Hr(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&Fs(e,n.child,null,o),e.child.memoizedState=Pc(o),e.memoizedState=Dc,i);if(!(e.mode&1))return Fo(n,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var a=r.dgst;return r=a,i=Error($(419)),r=hu(i,r,void 0),Fo(n,e,o,r)}if(a=(o&n.childLanes)!==0,wt||a){if(r=et,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,qn(n,s),dn(r,n,s,-1))}return af(),r=hu(Error($(421))),Fo(n,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=n.child,e=JS.bind(null,n),s._reactRetry=e,null):(n=i.treeContext,Ft=Er(s.nextSibling),Ut=e,Ce=!0,ln=null,n!==null&&(Wt[Yt++]=Vn,Wt[Yt++]=Hn,Wt[Yt++]=qr,Vn=n.id,Hn=n.overflow,qr=e),e=ef(e,r.children),e.flags|=4096,e)}function Jh(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),Rc(n.return,e,t)}function mu(n,e,t,r,s){var i=n.memoizedState;i===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=t,i.tailMode=s)}function Y0(n,e,t){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(pt(n,e,r.children,t),r=Pe.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&Jh(n,t,e);else if(n.tag===19)Jh(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(Re(Pe,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)n=t.alternate,n!==null&&Ha(n)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),mu(e,!1,s,t,i);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(n=s.alternate,n!==null&&Ha(n)===null){e.child=s;break}n=s.sibling,s.sibling=t,t=s,s=n}mu(e,!0,t,null,i);break;case"together":mu(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function ha(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function Xn(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),Qr|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error($(153));if(e.child!==null){for(n=e.child,t=Ar(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=Ar(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function $S(n,e,t){switch(e.tag){case 3:z0(e),Ms();break;case 5:x0(e);break;case 1:Ct(e.type)&&Ua(e);break;case 4:zd(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;Re(ja,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Re(Pe,Pe.current&1),e.flags|=128,null):t&e.child.childLanes?W0(n,e,t):(Re(Pe,Pe.current&1),n=Xn(n,e,t),n!==null?n.sibling:null);Re(Pe,Pe.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return Y0(n,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Re(Pe,Pe.current),r)break;return null;case 22:case 23:return e.lanes=0,H0(n,e,t)}return Xn(n,e,t)}var q0,Oc,X0,Q0;q0=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};Oc=function(){};X0=function(n,e,t,r){var s=n.memoizedProps;if(s!==r){n=e.stateNode,jr(bn.current);var i=null;switch(t){case"input":s=nc(n,s),r=nc(n,r),i=[];break;case"select":s=Me({},s,{value:void 0}),r=Me({},r,{value:void 0}),i=[];break;case"textarea":s=ic(n,s),r=ic(n,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=Ma)}ac(t,r);var o;t=null;for(u in s)if(!r.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var a=s[u];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Oi.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var l=r[u];if(a=s!=null?s[u]:void 0,r.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(t||(t={}),t[o]=l[o])}else t||(i||(i=[]),i.push(u,t)),t=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(i=i||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Oi.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&_e("scroll",n),i||a===l||(i=[])):(i=i||[]).push(u,l))}t&&(i=i||[]).push("style",t);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};Q0=function(n,e,t,r){t!==r&&(e.flags|=4)};function oi(n,e){if(!Ce)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function lt(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=n,s=s.sibling;else for(s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=n,s=s.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function jS(n,e,t){var r=e.pendingProps;switch(Bd(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return lt(e),null;case 1:return Ct(e.type)&&Fa(),lt(e),null;case 3:return r=e.stateNode,Us(),we(kt),we(ft),Yd(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(No(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,ln!==null&&(Gc(ln),ln=null))),Oc(n,e),lt(e),null;case 5:Wd(e);var s=jr(zi.current);if(t=e.type,n!==null&&e.stateNode!=null)X0(n,e,t,r,s),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error($(166));return lt(e),null}if(n=jr(bn.current),No(e)){r=e.stateNode,t=e.type;var i=e.memoizedProps;switch(r[Rn]=e,r[Hi]=i,n=(e.mode&1)!==0,t){case"dialog":_e("cancel",r),_e("close",r);break;case"iframe":case"object":case"embed":_e("load",r);break;case"video":case"audio":for(s=0;s<xi.length;s++)_e(xi[s],r);break;case"source":_e("error",r);break;case"img":case"image":case"link":_e("error",r),_e("load",r);break;case"details":_e("toggle",r);break;case"input":ah(r,i),_e("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},_e("invalid",r);break;case"textarea":uh(r,i),_e("invalid",r)}ac(t,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?r.textContent!==a&&(i.suppressHydrationWarning!==!0&&Oo(r.textContent,a,n),s=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&Oo(r.textContent,a,n),s=["children",""+a]):Oi.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&_e("scroll",r)}switch(t){case"input":Ro(r),lh(r,i,!0);break;case"textarea":Ro(r),ch(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=Ma)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=Ip(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=o.createElement(t,{is:r.is}):(n=o.createElement(t),t==="select"&&(o=n,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):n=o.createElementNS(n,t),n[Rn]=e,n[Hi]=r,q0(n,e,!1,!1),e.stateNode=n;e:{switch(o=lc(t,r),t){case"dialog":_e("cancel",n),_e("close",n),s=r;break;case"iframe":case"object":case"embed":_e("load",n),s=r;break;case"video":case"audio":for(s=0;s<xi.length;s++)_e(xi[s],n);s=r;break;case"source":_e("error",n),s=r;break;case"img":case"image":case"link":_e("error",n),_e("load",n),s=r;break;case"details":_e("toggle",n),s=r;break;case"input":ah(n,r),s=nc(n,r),_e("invalid",n);break;case"option":s=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},s=Me({},r,{value:void 0}),_e("invalid",n);break;case"textarea":uh(n,r),s=ic(n,r),_e("invalid",n);break;default:s=r}ac(t,s),a=s;for(i in a)if(a.hasOwnProperty(i)){var l=a[i];i==="style"?wp(n,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&Rp(n,l)):i==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&Ni(n,l):typeof l=="number"&&Ni(n,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Oi.hasOwnProperty(i)?l!=null&&i==="onScroll"&&_e("scroll",n):l!=null&&Ld(n,i,l,o))}switch(t){case"input":Ro(n),lh(n,r,!1);break;case"textarea":Ro(n),ch(n);break;case"option":r.value!=null&&n.setAttribute("value",""+Ir(r.value));break;case"select":n.multiple=!!r.multiple,i=r.value,i!=null?Is(n,!!r.multiple,i,!1):r.defaultValue!=null&&Is(n,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(n.onclick=Ma)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return lt(e),null;case 6:if(n&&e.stateNode!=null)Q0(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error($(166));if(t=jr(zi.current),jr(bn.current),No(e)){if(r=e.stateNode,t=e.memoizedProps,r[Rn]=e,(i=r.nodeValue!==t)&&(n=Ut,n!==null))switch(n.tag){case 3:Oo(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&Oo(r.nodeValue,t,(n.mode&1)!==0)}i&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[Rn]=e,e.stateNode=r}return lt(e),null;case 13:if(we(Pe),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Ce&&Ft!==null&&e.mode&1&&!(e.flags&128))g0(),Ms(),e.flags|=98560,i=!1;else if(i=No(e),r!==null&&r.dehydrated!==null){if(n===null){if(!i)throw Error($(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error($(317));i[Rn]=e}else Ms(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;lt(e),i=!1}else ln!==null&&(Gc(ln),ln=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||Pe.current&1?Ye===0&&(Ye=3):af())),e.updateQueue!==null&&(e.flags|=4),lt(e),null);case 4:return Us(),Oc(n,e),n===null&&Gi(e.stateNode.containerInfo),lt(e),null;case 10:return Vd(e.type._context),lt(e),null;case 17:return Ct(e.type)&&Fa(),lt(e),null;case 19:if(we(Pe),i=e.memoizedState,i===null)return lt(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)oi(i,!1);else{if(Ye!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=Ha(n),o!==null){for(e.flags|=128,oi(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)i=t,n=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=n,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,n=o.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return Re(Pe,Pe.current&1|2),e.child}n=n.sibling}i.tail!==null&&$e()>$s&&(e.flags|=128,r=!0,oi(i,!1),e.lanes=4194304)}else{if(!r)if(n=Ha(o),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),oi(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!Ce)return lt(e),null}else 2*$e()-i.renderingStartTime>$s&&t!==1073741824&&(e.flags|=128,r=!0,oi(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(t=i.last,t!==null?t.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=$e(),e.sibling=null,t=Pe.current,Re(Pe,r?t&1|2:t&1),e):(lt(e),null);case 22:case 23:return of(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Nt&1073741824&&(lt(e),e.subtreeFlags&6&&(e.flags|=8192)):lt(e),null;case 24:return null;case 25:return null}throw Error($(156,e.tag))}function GS(n,e){switch(Bd(e),e.tag){case 1:return Ct(e.type)&&Fa(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return Us(),we(kt),we(ft),Yd(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return Wd(e),null;case 13:if(we(Pe),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error($(340));Ms()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return we(Pe),null;case 4:return Us(),null;case 10:return Vd(e.type._context),null;case 22:case 23:return of(),null;case 24:return null;default:return null}}var Uo=!1,ct=!1,VS=typeof WeakSet=="function"?WeakSet:Set,q=null;function Ts(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){Fe(n,e,r)}else t.current=null}function Nc(n,e,t){try{t()}catch(r){Fe(n,e,r)}}var Zh=!1;function HS(n,e){if(vc=Pa,n=n0(),Fd(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{t.nodeType,i.nodeType}catch{t=null;break e}var o=0,a=-1,l=-1,u=0,c=0,d=n,f=null;t:for(;;){for(var h;d!==t||s!==0&&d.nodeType!==3||(a=o+s),d!==i||r!==0&&d.nodeType!==3||(l=o+r),d.nodeType===3&&(o+=d.nodeValue.length),(h=d.firstChild)!==null;)f=d,d=h;for(;;){if(d===n)break t;if(f===t&&++u===s&&(a=o),f===i&&++c===r&&(l=o),(h=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=h}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(Ec={focusedElem:n,selectionRange:t},Pa=!1,q=e;q!==null;)if(e=q,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,q=n;else for(;q!==null;){e=q;try{var m=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var g=m.memoizedProps,p=m.memoizedState,y=e.stateNode,v=y.getSnapshotBeforeUpdate(e.elementType===e.type?g:sn(e.type,g),p);y.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var E=e.stateNode.containerInfo;E.nodeType===1?E.textContent="":E.nodeType===9&&E.documentElement&&E.removeChild(E.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error($(163))}}catch(T){Fe(e,e.return,T)}if(n=e.sibling,n!==null){n.return=e.return,q=n;break}q=e.return}return m=Zh,Zh=!1,m}function wi(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&n)===n){var i=s.destroy;s.destroy=void 0,i!==void 0&&Nc(e,t,i)}s=s.next}while(s!==r)}}function Al(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function Mc(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function J0(n){var e=n.alternate;e!==null&&(n.alternate=null,J0(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[Rn],delete e[Hi],delete e[Tc],delete e[RS],delete e[_S])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function Z0(n){return n.tag===5||n.tag===3||n.tag===4}function em(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||Z0(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Fc(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=Ma));else if(r!==4&&(n=n.child,n!==null))for(Fc(n,e,t),n=n.sibling;n!==null;)Fc(n,e,t),n=n.sibling}function Uc(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(Uc(n,e,t),n=n.sibling;n!==null;)Uc(n,e,t),n=n.sibling}var rt=null,an=!1;function rr(n,e,t){for(t=t.child;t!==null;)ey(n,e,t),t=t.sibling}function ey(n,e,t){if(Cn&&typeof Cn.onCommitFiberUnmount=="function")try{Cn.onCommitFiberUnmount(gl,t)}catch{}switch(t.tag){case 5:ct||Ts(t,e);case 6:var r=rt,s=an;rt=null,rr(n,e,t),rt=r,an=s,rt!==null&&(an?(n=rt,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):rt.removeChild(t.stateNode));break;case 18:rt!==null&&(an?(n=rt,t=t.stateNode,n.nodeType===8?au(n.parentNode,t):n.nodeType===1&&au(n,t),Bi(n)):au(rt,t.stateNode));break;case 4:r=rt,s=an,rt=t.stateNode.containerInfo,an=!0,rr(n,e,t),rt=r,an=s;break;case 0:case 11:case 14:case 15:if(!ct&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&Nc(t,e,o),s=s.next}while(s!==r)}rr(n,e,t);break;case 1:if(!ct&&(Ts(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(a){Fe(t,e,a)}rr(n,e,t);break;case 21:rr(n,e,t);break;case 22:t.mode&1?(ct=(r=ct)||t.memoizedState!==null,rr(n,e,t),ct=r):rr(n,e,t);break;default:rr(n,e,t)}}function tm(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new VS),e.forEach(function(r){var s=ZS.bind(null,n,r);t.has(r)||(t.add(r),r.then(s,s))})}}function tn(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var s=t[r];try{var i=n,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:rt=a.stateNode,an=!1;break e;case 3:rt=a.stateNode.containerInfo,an=!0;break e;case 4:rt=a.stateNode.containerInfo,an=!0;break e}a=a.return}if(rt===null)throw Error($(160));ey(i,o,s),rt=null,an=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(u){Fe(s,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)ty(e,n),e=e.sibling}function ty(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(tn(e,n),vn(n),r&4){try{wi(3,n,n.return),Al(3,n)}catch(g){Fe(n,n.return,g)}try{wi(5,n,n.return)}catch(g){Fe(n,n.return,g)}}break;case 1:tn(e,n),vn(n),r&512&&t!==null&&Ts(t,t.return);break;case 5:if(tn(e,n),vn(n),r&512&&t!==null&&Ts(t,t.return),n.flags&32){var s=n.stateNode;try{Ni(s,"")}catch(g){Fe(n,n.return,g)}}if(r&4&&(s=n.stateNode,s!=null)){var i=n.memoizedProps,o=t!==null?t.memoizedProps:i,a=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&Ap(s,i),lc(a,o);var u=lc(a,i);for(o=0;o<l.length;o+=2){var c=l[o],d=l[o+1];c==="style"?wp(s,d):c==="dangerouslySetInnerHTML"?Rp(s,d):c==="children"?Ni(s,d):Ld(s,c,d,u)}switch(a){case"input":rc(s,i);break;case"textarea":Lp(s,i);break;case"select":var f=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var h=i.value;h!=null?Is(s,!!i.multiple,h,!1):f!==!!i.multiple&&(i.defaultValue!=null?Is(s,!!i.multiple,i.defaultValue,!0):Is(s,!!i.multiple,i.multiple?[]:"",!1))}s[Hi]=i}catch(g){Fe(n,n.return,g)}}break;case 6:if(tn(e,n),vn(n),r&4){if(n.stateNode===null)throw Error($(162));s=n.stateNode,i=n.memoizedProps;try{s.nodeValue=i}catch(g){Fe(n,n.return,g)}}break;case 3:if(tn(e,n),vn(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{Bi(e.containerInfo)}catch(g){Fe(n,n.return,g)}break;case 4:tn(e,n),vn(n);break;case 13:tn(e,n),vn(n),s=n.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(rf=$e())),r&4&&tm(n);break;case 22:if(c=t!==null&&t.memoizedState!==null,n.mode&1?(ct=(u=ct)||c,tn(e,n),ct=u):tn(e,n),vn(n),r&8192){if(u=n.memoizedState!==null,(n.stateNode.isHidden=u)&&!c&&n.mode&1)for(q=n,c=n.child;c!==null;){for(d=q=c;q!==null;){switch(f=q,h=f.child,f.tag){case 0:case 11:case 14:case 15:wi(4,f,f.return);break;case 1:Ts(f,f.return);var m=f.stateNode;if(typeof m.componentWillUnmount=="function"){r=f,t=f.return;try{e=r,m.props=e.memoizedProps,m.state=e.memoizedState,m.componentWillUnmount()}catch(g){Fe(r,t,g)}}break;case 5:Ts(f,f.return);break;case 22:if(f.memoizedState!==null){rm(d);continue}}h!==null?(h.return=f,q=h):rm(d)}c=c.sibling}e:for(c=null,d=n;;){if(d.tag===5){if(c===null){c=d;try{s=d.stateNode,u?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=d.stateNode,l=d.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=_p("display",o))}catch(g){Fe(n,n.return,g)}}}else if(d.tag===6){if(c===null)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(g){Fe(n,n.return,g)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===n)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===n)break e;for(;d.sibling===null;){if(d.return===null||d.return===n)break e;c===d&&(c=null),d=d.return}c===d&&(c=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:tn(e,n),vn(n),r&4&&tm(n);break;case 21:break;default:tn(e,n),vn(n)}}function vn(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(Z0(t)){var r=t;break e}t=t.return}throw Error($(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(Ni(s,""),r.flags&=-33);var i=em(n);Uc(n,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,a=em(n);Fc(n,a,o);break;default:throw Error($(161))}}catch(l){Fe(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function KS(n,e,t){q=n,ny(n)}function ny(n,e,t){for(var r=(n.mode&1)!==0;q!==null;){var s=q,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||Uo;if(!o){var a=s.alternate,l=a!==null&&a.memoizedState!==null||ct;a=Uo;var u=ct;if(Uo=o,(ct=l)&&!u)for(q=s;q!==null;)o=q,l=o.child,o.tag===22&&o.memoizedState!==null?sm(s):l!==null?(l.return=o,q=l):sm(s);for(;i!==null;)q=i,ny(i),i=i.sibling;q=s,Uo=a,ct=u}nm(n)}else s.subtreeFlags&8772&&i!==null?(i.return=s,q=i):nm(n)}}function nm(n){for(;q!==null;){var e=q;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:ct||Al(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!ct)if(t===null)r.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:sn(e.type,t.memoizedProps);r.componentDidUpdate(s,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&$h(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}$h(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var d=c.dehydrated;d!==null&&Bi(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error($(163))}ct||e.flags&512&&Mc(e)}catch(f){Fe(e,e.return,f)}}if(e===n){q=null;break}if(t=e.sibling,t!==null){t.return=e.return,q=t;break}q=e.return}}function rm(n){for(;q!==null;){var e=q;if(e===n){q=null;break}var t=e.sibling;if(t!==null){t.return=e.return,q=t;break}q=e.return}}function sm(n){for(;q!==null;){var e=q;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{Al(4,e)}catch(l){Fe(e,t,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(l){Fe(e,s,l)}}var i=e.return;try{Mc(e)}catch(l){Fe(e,i,l)}break;case 5:var o=e.return;try{Mc(e)}catch(l){Fe(e,o,l)}}}catch(l){Fe(e,e.return,l)}if(e===n){q=null;break}var a=e.sibling;if(a!==null){a.return=e.return,q=a;break}q=e.return}}var zS=Math.ceil,Wa=Qn.ReactCurrentDispatcher,tf=Qn.ReactCurrentOwner,Xt=Qn.ReactCurrentBatchConfig,ve=0,et=null,Ve=null,st=0,Nt=0,As=Cr(0),Ye=0,Xi=null,Qr=0,Ll=0,nf=0,ki=null,Rt=null,rf=0,$s=1/0,Bn=null,Ya=!1,Bc=null,Sr=null,Bo=!1,mr=null,qa=0,Ci=0,$c=null,ma=-1,ga=0;function yt(){return ve&6?$e():ma!==-1?ma:ma=$e()}function Tr(n){return n.mode&1?ve&2&&st!==0?st&-st:kS.transition!==null?(ga===0&&(ga=$p()),ga):(n=Ae,n!==0||(n=window.event,n=n===void 0?16:Wp(n.type)),n):1}function dn(n,e,t,r){if(50<Ci)throw Ci=0,$c=null,Error($(185));co(n,t,r),(!(ve&2)||n!==et)&&(n===et&&(!(ve&2)&&(Ll|=t),Ye===4&&fr(n,st)),bt(n,r),t===1&&ve===0&&!(e.mode&1)&&($s=$e()+500,xl&&br()))}function bt(n,e){var t=n.callbackNode;kx(n,e);var r=Da(n,n===et?st:0);if(r===0)t!==null&&hh(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&hh(t),e===1)n.tag===0?wS(im.bind(null,n)):f0(im.bind(null,n)),LS(function(){!(ve&6)&&br()}),t=null;else{switch(jp(r)){case 1:t=kd;break;case 4:t=Up;break;case 16:t=ba;break;case 536870912:t=Bp;break;default:t=ba}t=cy(t,ry.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function ry(n,e){if(ma=-1,ga=0,ve&6)throw Error($(327));var t=n.callbackNode;if(Cs()&&n.callbackNode!==t)return null;var r=Da(n,n===et?st:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=Xa(n,r);else{e=r;var s=ve;ve|=2;var i=iy();(et!==n||st!==e)&&(Bn=null,$s=$e()+500,Vr(n,e));do try{qS();break}catch(a){sy(n,a)}while(!0);Gd(),Wa.current=i,ve=s,Ve!==null?e=0:(et=null,st=0,e=Ye)}if(e!==0){if(e===2&&(s=hc(n),s!==0&&(r=s,e=jc(n,s))),e===1)throw t=Xi,Vr(n,0),fr(n,r),bt(n,$e()),t;if(e===6)fr(n,r);else{if(s=n.current.alternate,!(r&30)&&!WS(s)&&(e=Xa(n,r),e===2&&(i=hc(n),i!==0&&(r=i,e=jc(n,i))),e===1))throw t=Xi,Vr(n,0),fr(n,r),bt(n,$e()),t;switch(n.finishedWork=s,n.finishedLanes=r,e){case 0:case 1:throw Error($(345));case 2:Mr(n,Rt,Bn);break;case 3:if(fr(n,r),(r&130023424)===r&&(e=rf+500-$e(),10<e)){if(Da(n,0)!==0)break;if(s=n.suspendedLanes,(s&r)!==r){yt(),n.pingedLanes|=n.suspendedLanes&s;break}n.timeoutHandle=Sc(Mr.bind(null,n,Rt,Bn),e);break}Mr(n,Rt,Bn);break;case 4:if(fr(n,r),(r&4194240)===r)break;for(e=n.eventTimes,s=-1;0<r;){var o=31-cn(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=$e()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*zS(r/1960))-r,10<r){n.timeoutHandle=Sc(Mr.bind(null,n,Rt,Bn),r);break}Mr(n,Rt,Bn);break;case 5:Mr(n,Rt,Bn);break;default:throw Error($(329))}}}return bt(n,$e()),n.callbackNode===t?ry.bind(null,n):null}function jc(n,e){var t=ki;return n.current.memoizedState.isDehydrated&&(Vr(n,e).flags|=256),n=Xa(n,e),n!==2&&(e=Rt,Rt=t,e!==null&&Gc(e)),n}function Gc(n){Rt===null?Rt=n:Rt.push.apply(Rt,n)}function WS(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var s=t[r],i=s.getSnapshot;s=s.value;try{if(!fn(i(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function fr(n,e){for(e&=~nf,e&=~Ll,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-cn(e),r=1<<t;n[t]=-1,e&=~r}}function im(n){if(ve&6)throw Error($(327));Cs();var e=Da(n,0);if(!(e&1))return bt(n,$e()),null;var t=Xa(n,e);if(n.tag!==0&&t===2){var r=hc(n);r!==0&&(e=r,t=jc(n,r))}if(t===1)throw t=Xi,Vr(n,0),fr(n,e),bt(n,$e()),t;if(t===6)throw Error($(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,Mr(n,Rt,Bn),bt(n,$e()),null}function sf(n,e){var t=ve;ve|=1;try{return n(e)}finally{ve=t,ve===0&&($s=$e()+500,xl&&br())}}function Jr(n){mr!==null&&mr.tag===0&&!(ve&6)&&Cs();var e=ve;ve|=1;var t=Xt.transition,r=Ae;try{if(Xt.transition=null,Ae=1,n)return n()}finally{Ae=r,Xt.transition=t,ve=e,!(ve&6)&&br()}}function of(){Nt=As.current,we(As)}function Vr(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,AS(t)),Ve!==null)for(t=Ve.return;t!==null;){var r=t;switch(Bd(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Fa();break;case 3:Us(),we(kt),we(ft),Yd();break;case 5:Wd(r);break;case 4:Us();break;case 13:we(Pe);break;case 19:we(Pe);break;case 10:Vd(r.type._context);break;case 22:case 23:of()}t=t.return}if(et=n,Ve=n=Ar(n.current,null),st=Nt=e,Ye=0,Xi=null,nf=Ll=Qr=0,Rt=ki=null,$r!==null){for(e=0;e<$r.length;e++)if(t=$r[e],r=t.interleaved,r!==null){t.interleaved=null;var s=r.next,i=t.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}t.pending=r}$r=null}return n}function sy(n,e){do{var t=Ve;try{if(Gd(),da.current=za,Ka){for(var r=Ne.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Ka=!1}if(Xr=0,Je=ze=Ne=null,_i=!1,Wi=0,tf.current=null,t===null||t.return===null){Ye=1,Xi=e,Ve=null;break}e:{var i=n,o=t.return,a=t,l=e;if(e=st,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,c=a,d=c.tag;if(!(c.mode&1)&&(d===0||d===11||d===15)){var f=c.alternate;f?(c.updateQueue=f.updateQueue,c.memoizedState=f.memoizedState,c.lanes=f.lanes):(c.updateQueue=null,c.memoizedState=null)}var h=zh(o);if(h!==null){h.flags&=-257,Wh(h,o,a,i,e),h.mode&1&&Kh(i,u,e),e=h,l=u;var m=e.updateQueue;if(m===null){var g=new Set;g.add(l),e.updateQueue=g}else m.add(l);break e}else{if(!(e&1)){Kh(i,u,e),af();break e}l=Error($(426))}}else if(Ce&&a.mode&1){var p=zh(o);if(p!==null){!(p.flags&65536)&&(p.flags|=256),Wh(p,o,a,i,e),$d(Bs(l,a));break e}}i=l=Bs(l,a),Ye!==4&&(Ye=2),ki===null?ki=[i]:ki.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var y=j0(i,l,e);Bh(i,y);break e;case 1:a=l;var v=i.type,E=i.stateNode;if(!(i.flags&128)&&(typeof v.getDerivedStateFromError=="function"||E!==null&&typeof E.componentDidCatch=="function"&&(Sr===null||!Sr.has(E)))){i.flags|=65536,e&=-e,i.lanes|=e;var T=G0(i,a,e);Bh(i,T);break e}}i=i.return}while(i!==null)}ay(t)}catch(A){e=A,Ve===t&&t!==null&&(Ve=t=t.return);continue}break}while(!0)}function iy(){var n=Wa.current;return Wa.current=za,n===null?za:n}function af(){(Ye===0||Ye===3||Ye===2)&&(Ye=4),et===null||!(Qr&268435455)&&!(Ll&268435455)||fr(et,st)}function Xa(n,e){var t=ve;ve|=2;var r=iy();(et!==n||st!==e)&&(Bn=null,Vr(n,e));do try{YS();break}catch(s){sy(n,s)}while(!0);if(Gd(),ve=t,Wa.current=r,Ve!==null)throw Error($(261));return et=null,st=0,Ye}function YS(){for(;Ve!==null;)oy(Ve)}function qS(){for(;Ve!==null&&!xx();)oy(Ve)}function oy(n){var e=uy(n.alternate,n,Nt);n.memoizedProps=n.pendingProps,e===null?ay(n):Ve=e,tf.current=null}function ay(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=GS(t,e),t!==null){t.flags&=32767,Ve=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Ye=6,Ve=null;return}}else if(t=jS(t,e,Nt),t!==null){Ve=t;return}if(e=e.sibling,e!==null){Ve=e;return}Ve=e=n}while(e!==null);Ye===0&&(Ye=5)}function Mr(n,e,t){var r=Ae,s=Xt.transition;try{Xt.transition=null,Ae=1,XS(n,e,t,r)}finally{Xt.transition=s,Ae=r}return null}function XS(n,e,t,r){do Cs();while(mr!==null);if(ve&6)throw Error($(327));t=n.finishedWork;var s=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error($(177));n.callbackNode=null,n.callbackPriority=0;var i=t.lanes|t.childLanes;if(Cx(n,i),n===et&&(Ve=et=null,st=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||Bo||(Bo=!0,cy(ba,function(){return Cs(),null})),i=(t.flags&15990)!==0,t.subtreeFlags&15990||i){i=Xt.transition,Xt.transition=null;var o=Ae;Ae=1;var a=ve;ve|=4,tf.current=null,HS(n,t),ty(t,n),pS(Ec),Pa=!!vc,Ec=vc=null,n.current=t,KS(t),Sx(),ve=a,Ae=o,Xt.transition=i}else n.current=t;if(Bo&&(Bo=!1,mr=n,qa=s),i=n.pendingLanes,i===0&&(Sr=null),Lx(t.stateNode),bt(n,$e()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)s=e[t],r(s.value,{componentStack:s.stack,digest:s.digest});if(Ya)throw Ya=!1,n=Bc,Bc=null,n;return qa&1&&n.tag!==0&&Cs(),i=n.pendingLanes,i&1?n===$c?Ci++:(Ci=0,$c=n):Ci=0,br(),null}function Cs(){if(mr!==null){var n=jp(qa),e=Xt.transition,t=Ae;try{if(Xt.transition=null,Ae=16>n?16:n,mr===null)var r=!1;else{if(n=mr,mr=null,qa=0,ve&6)throw Error($(331));var s=ve;for(ve|=4,q=n.current;q!==null;){var i=q,o=i.child;if(q.flags&16){var a=i.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(q=u;q!==null;){var c=q;switch(c.tag){case 0:case 11:case 15:wi(8,c,i)}var d=c.child;if(d!==null)d.return=c,q=d;else for(;q!==null;){c=q;var f=c.sibling,h=c.return;if(J0(c),c===u){q=null;break}if(f!==null){f.return=h,q=f;break}q=h}}}var m=i.alternate;if(m!==null){var g=m.child;if(g!==null){m.child=null;do{var p=g.sibling;g.sibling=null,g=p}while(g!==null)}}q=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,q=o;else e:for(;q!==null;){if(i=q,i.flags&2048)switch(i.tag){case 0:case 11:case 15:wi(9,i,i.return)}var y=i.sibling;if(y!==null){y.return=i.return,q=y;break e}q=i.return}}var v=n.current;for(q=v;q!==null;){o=q;var E=o.child;if(o.subtreeFlags&2064&&E!==null)E.return=o,q=E;else e:for(o=v;q!==null;){if(a=q,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Al(9,a)}}catch(A){Fe(a,a.return,A)}if(a===o){q=null;break e}var T=a.sibling;if(T!==null){T.return=a.return,q=T;break e}q=a.return}}if(ve=s,br(),Cn&&typeof Cn.onPostCommitFiberRoot=="function")try{Cn.onPostCommitFiberRoot(gl,n)}catch{}r=!0}return r}finally{Ae=t,Xt.transition=e}}return!1}function om(n,e,t){e=Bs(t,e),e=j0(n,e,1),n=xr(n,e,1),e=yt(),n!==null&&(co(n,1,e),bt(n,e))}function Fe(n,e,t){if(n.tag===3)om(n,n,t);else for(;e!==null;){if(e.tag===3){om(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Sr===null||!Sr.has(r))){n=Bs(t,n),n=G0(e,n,1),e=xr(e,n,1),n=yt(),e!==null&&(co(e,1,n),bt(e,n));break}}e=e.return}}function QS(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=yt(),n.pingedLanes|=n.suspendedLanes&t,et===n&&(st&t)===t&&(Ye===4||Ye===3&&(st&130023424)===st&&500>$e()-rf?Vr(n,0):nf|=t),bt(n,e)}function ly(n,e){e===0&&(n.mode&1?(e=ko,ko<<=1,!(ko&130023424)&&(ko=4194304)):e=1);var t=yt();n=qn(n,e),n!==null&&(co(n,e,t),bt(n,t))}function JS(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),ly(n,t)}function ZS(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,s=n.memoizedState;s!==null&&(t=s.retryLane);break;case 19:r=n.stateNode;break;default:throw Error($(314))}r!==null&&r.delete(e),ly(n,t)}var uy;uy=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||kt.current)wt=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return wt=!1,$S(n,e,t);wt=!!(n.flags&131072)}else wt=!1,Ce&&e.flags&1048576&&h0(e,$a,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;ha(n,e),n=e.pendingProps;var s=Ns(e,ft.current);ks(e,t),s=Xd(null,e,r,n,s,t);var i=Qd();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Ct(r)?(i=!0,Ua(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Kd(e),s.updater=Tl,e.stateNode=s,s._reactInternals=e,wc(e,r,n,t),e=bc(null,e,r,!0,i,t)):(e.tag=0,Ce&&i&&Ud(e),pt(null,e,s,t),e=e.child),e;case 16:r=e.elementType;e:{switch(ha(n,e),n=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=tT(r),n=sn(r,n),s){case 0:e=Cc(null,e,r,n,t);break e;case 1:e=Xh(null,e,r,n,t);break e;case 11:e=Yh(null,e,r,n,t);break e;case 14:e=qh(null,e,r,sn(r.type,n),t);break e}throw Error($(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:sn(r,s),Cc(n,e,r,s,t);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:sn(r,s),Xh(n,e,r,s,t);case 3:e:{if(z0(e),n===null)throw Error($(387));r=e.pendingProps,i=e.memoizedState,s=i.element,E0(n,e),Va(e,r,null,t);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=Bs(Error($(423)),e),e=Qh(n,e,r,t,s);break e}else if(r!==s){s=Bs(Error($(424)),e),e=Qh(n,e,r,t,s);break e}else for(Ft=Er(e.stateNode.containerInfo.firstChild),Ut=e,Ce=!0,ln=null,t=y0(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Ms(),r===s){e=Xn(n,e,t);break e}pt(n,e,r,t)}e=e.child}return e;case 5:return x0(e),n===null&&Ic(e),r=e.type,s=e.pendingProps,i=n!==null?n.memoizedProps:null,o=s.children,xc(r,s)?o=null:i!==null&&xc(r,i)&&(e.flags|=32),K0(n,e),pt(n,e,o,t),e.child;case 6:return n===null&&Ic(e),null;case 13:return W0(n,e,t);case 4:return zd(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=Fs(e,null,r,t):pt(n,e,r,t),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:sn(r,s),Yh(n,e,r,s,t);case 7:return pt(n,e,e.pendingProps,t),e.child;case 8:return pt(n,e,e.pendingProps.children,t),e.child;case 12:return pt(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,Re(ja,r._currentValue),r._currentValue=o,i!==null)if(fn(i.value,o)){if(i.children===s.children&&!kt.current){e=Xn(n,e,t);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(i.tag===1){l=zn(-1,t&-t),l.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}i.lanes|=t,l=i.alternate,l!==null&&(l.lanes|=t),Rc(i.return,t,e),a.lanes|=t;break}l=l.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error($(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),Rc(o,t,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}pt(n,e,s.children,t),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,ks(e,t),s=Qt(s),r=r(s),e.flags|=1,pt(n,e,r,t),e.child;case 14:return r=e.type,s=sn(r,e.pendingProps),s=sn(r.type,s),qh(n,e,r,s,t);case 15:return V0(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:sn(r,s),ha(n,e),e.tag=1,Ct(r)?(n=!0,Ua(e)):n=!1,ks(e,t),$0(e,r,s),wc(e,r,s,t),bc(null,e,r,!0,n,t);case 19:return Y0(n,e,t);case 22:return H0(n,e,t)}throw Error($(156,e.tag))};function cy(n,e){return Fp(n,e)}function eT(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function qt(n,e,t,r){return new eT(n,e,t,r)}function lf(n){return n=n.prototype,!(!n||!n.isReactComponent)}function tT(n){if(typeof n=="function")return lf(n)?1:0;if(n!=null){if(n=n.$$typeof,n===Rd)return 11;if(n===_d)return 14}return 2}function Ar(n,e){var t=n.alternate;return t===null?(t=qt(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function pa(n,e,t,r,s,i){var o=2;if(r=n,typeof n=="function")lf(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case hs:return Hr(t.children,s,i,e);case Id:o=8,s|=8;break;case Ju:return n=qt(12,t,e,s|2),n.elementType=Ju,n.lanes=i,n;case Zu:return n=qt(13,t,e,s),n.elementType=Zu,n.lanes=i,n;case ec:return n=qt(19,t,e,s),n.elementType=ec,n.lanes=i,n;case xp:return Il(t,s,i,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case vp:o=10;break e;case Ep:o=9;break e;case Rd:o=11;break e;case _d:o=14;break e;case or:o=16,r=null;break e}throw Error($(130,n==null?n:typeof n,""))}return e=qt(o,t,e,s),e.elementType=n,e.type=r,e.lanes=i,e}function Hr(n,e,t,r){return n=qt(7,n,r,e),n.lanes=t,n}function Il(n,e,t,r){return n=qt(22,n,r,e),n.elementType=xp,n.lanes=t,n.stateNode={isHidden:!1},n}function gu(n,e,t){return n=qt(6,n,null,e),n.lanes=t,n}function pu(n,e,t){return e=qt(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function nT(n,e,t,r,s){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Xl(0),this.expirationTimes=Xl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Xl(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function uf(n,e,t,r,s,i,o,a,l){return n=new nT(n,e,t,a,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=qt(3,null,null,e),n.current=i,i.stateNode=n,i.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Kd(i),n}function rT(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:fs,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function dy(n){if(!n)return Rr;n=n._reactInternals;e:{if(ns(n)!==n||n.tag!==1)throw Error($(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Ct(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error($(171))}if(n.tag===1){var t=n.type;if(Ct(t))return d0(n,t,e)}return e}function fy(n,e,t,r,s,i,o,a,l){return n=uf(t,r,!0,n,s,i,o,a,l),n.context=dy(null),t=n.current,r=yt(),s=Tr(t),i=zn(r,s),i.callback=e??null,xr(t,i,s),n.current.lanes=s,co(n,s,r),bt(n,r),n}function Rl(n,e,t,r){var s=e.current,i=yt(),o=Tr(s);return t=dy(t),e.context===null?e.context=t:e.pendingContext=t,e=zn(i,o),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=xr(s,e,o),n!==null&&(dn(n,s,o,i),ca(n,s,o)),o}function Qa(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function am(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function cf(n,e){am(n,e),(n=n.alternate)&&am(n,e)}function sT(){return null}var hy=typeof reportError=="function"?reportError:function(n){console.error(n)};function df(n){this._internalRoot=n}_l.prototype.render=df.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error($(409));Rl(n,e,null,null)};_l.prototype.unmount=df.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Jr(function(){Rl(null,n,null,null)}),e[Yn]=null}};function _l(n){this._internalRoot=n}_l.prototype.unstable_scheduleHydration=function(n){if(n){var e=Hp();n={blockedOn:null,target:n,priority:e};for(var t=0;t<dr.length&&e!==0&&e<dr[t].priority;t++);dr.splice(t,0,n),t===0&&zp(n)}};function ff(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function wl(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function lm(){}function iT(n,e,t,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var u=Qa(o);i.call(u)}}var o=fy(e,r,n,0,null,!1,!1,"",lm);return n._reactRootContainer=o,n[Yn]=o.current,Gi(n.nodeType===8?n.parentNode:n),Jr(),o}for(;s=n.lastChild;)n.removeChild(s);if(typeof r=="function"){var a=r;r=function(){var u=Qa(l);a.call(u)}}var l=uf(n,0,!1,null,null,!1,!1,"",lm);return n._reactRootContainer=l,n[Yn]=l.current,Gi(n.nodeType===8?n.parentNode:n),Jr(function(){Rl(e,l,t,r)}),l}function kl(n,e,t,r,s){var i=t._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var a=s;s=function(){var l=Qa(o);a.call(l)}}Rl(e,o,n,s)}else o=iT(t,e,n,s,r);return Qa(o)}Gp=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=Ei(e.pendingLanes);t!==0&&(Cd(e,t|1),bt(e,$e()),!(ve&6)&&($s=$e()+500,br()))}break;case 13:Jr(function(){var r=qn(n,1);if(r!==null){var s=yt();dn(r,n,1,s)}}),cf(n,1)}};bd=function(n){if(n.tag===13){var e=qn(n,134217728);if(e!==null){var t=yt();dn(e,n,134217728,t)}cf(n,134217728)}};Vp=function(n){if(n.tag===13){var e=Tr(n),t=qn(n,e);if(t!==null){var r=yt();dn(t,n,e,r)}cf(n,e)}};Hp=function(){return Ae};Kp=function(n,e){var t=Ae;try{return Ae=n,e()}finally{Ae=t}};cc=function(n,e,t){switch(e){case"input":if(rc(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var s=El(r);if(!s)throw Error($(90));Tp(r),rc(r,s)}}}break;case"textarea":Lp(n,t);break;case"select":e=t.value,e!=null&&Is(n,!!t.multiple,e,!1)}};bp=sf;Dp=Jr;var oT={usingClientEntryPoint:!1,Events:[ho,ys,El,kp,Cp,sf]},ai={findFiberByHostInstance:Br,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},aT={bundleType:ai.bundleType,version:ai.version,rendererPackageName:ai.rendererPackageName,rendererConfig:ai.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Qn.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=Np(n),n===null?null:n.stateNode},findFiberByHostInstance:ai.findFiberByHostInstance||sT,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var $o=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!$o.isDisabled&&$o.supportsFiber)try{gl=$o.inject(aT),Cn=$o}catch{}}jt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=oT;jt.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ff(e))throw Error($(200));return rT(n,e,null,t)};jt.createRoot=function(n,e){if(!ff(n))throw Error($(299));var t=!1,r="",s=hy;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=uf(n,1,!1,null,null,t,!1,r,s),n[Yn]=e.current,Gi(n.nodeType===8?n.parentNode:n),new df(e)};jt.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error($(188)):(n=Object.keys(n).join(","),Error($(268,n)));return n=Np(e),n=n===null?null:n.stateNode,n};jt.flushSync=function(n){return Jr(n)};jt.hydrate=function(n,e,t){if(!wl(e))throw Error($(200));return kl(null,n,e,!0,t)};jt.hydrateRoot=function(n,e,t){if(!ff(n))throw Error($(405));var r=t!=null&&t.hydratedSources||null,s=!1,i="",o=hy;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=fy(e,null,n,1,t??null,s,!1,i,o),n[Yn]=e.current,Gi(n),r)for(n=0;n<r.length;n++)t=r[n],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new _l(e)};jt.render=function(n,e,t){if(!wl(e))throw Error($(200));return kl(null,n,e,!1,t)};jt.unmountComponentAtNode=function(n){if(!wl(n))throw Error($(40));return n._reactRootContainer?(Jr(function(){kl(null,null,n,!1,function(){n._reactRootContainer=null,n[Yn]=null})}),!0):!1};jt.unstable_batchedUpdates=sf;jt.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!wl(t))throw Error($(200));if(n==null||n._reactInternals===void 0)throw Error($(38));return kl(n,e,t,!1,r)};jt.version="18.3.1-next-f1338f8080-20240426";function my(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(my)}catch(n){console.error(n)}}my(),mp.exports=jt;var lT=mp.exports,gy,um=lT;gy=um.createRoot,um.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Qi(){return Qi=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Qi.apply(this,arguments)}var gr;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(gr||(gr={}));const cm="popstate";function uT(n){n===void 0&&(n={});function e(r,s){let{pathname:i,search:o,hash:a}=r.location;return Vc("",{pathname:i,search:o,hash:a},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function t(r,s){return typeof s=="string"?s:Ja(s)}return dT(e,t,null,n)}function je(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function py(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function cT(){return Math.random().toString(36).substr(2,8)}function dm(n,e){return{usr:n.state,key:n.key,idx:e}}function Vc(n,e,t,r){return t===void 0&&(t=null),Qi({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof e=="string"?Ws(e):e,{state:t,key:e&&e.key||r||cT()})}function Ja(n){let{pathname:e="/",search:t="",hash:r=""}=n;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function Ws(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));let r=n.indexOf("?");r>=0&&(e.search=n.substr(r),n=n.substr(0,r)),n&&(e.pathname=n)}return e}function dT(n,e,t,r){r===void 0&&(r={});let{window:s=document.defaultView,v5Compat:i=!1}=r,o=s.history,a=gr.Pop,l=null,u=c();u==null&&(u=0,o.replaceState(Qi({},o.state,{idx:u}),""));function c(){return(o.state||{idx:null}).idx}function d(){a=gr.Pop;let p=c(),y=p==null?null:p-u;u=p,l&&l({action:a,location:g.location,delta:y})}function f(p,y){a=gr.Push;let v=Vc(g.location,p,y);u=c()+1;let E=dm(v,u),T=g.createHref(v);try{o.pushState(E,"",T)}catch(A){if(A instanceof DOMException&&A.name==="DataCloneError")throw A;s.location.assign(T)}i&&l&&l({action:a,location:g.location,delta:1})}function h(p,y){a=gr.Replace;let v=Vc(g.location,p,y);u=c();let E=dm(v,u),T=g.createHref(v);o.replaceState(E,"",T),i&&l&&l({action:a,location:g.location,delta:0})}function m(p){let y=s.location.origin!=="null"?s.location.origin:s.location.href,v=typeof p=="string"?p:Ja(p);return v=v.replace(/ $/,"%20"),je(y,"No window.location.(origin|href) available to create URL for href: "+v),new URL(v,y)}let g={get action(){return a},get location(){return n(s,o)},listen(p){if(l)throw new Error("A history only accepts one active listener");return s.addEventListener(cm,d),l=p,()=>{s.removeEventListener(cm,d),l=null}},createHref(p){return e(s,p)},createURL:m,encodeLocation(p){let y=m(p);return{pathname:y.pathname,search:y.search,hash:y.hash}},push:f,replace:h,go(p){return o.go(p)}};return g}var fm;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(fm||(fm={}));function fT(n,e,t){return t===void 0&&(t="/"),hT(n,e,t,!1)}function hT(n,e,t,r){let s=typeof e=="string"?Ws(e):e,i=hf(s.pathname||"/",t);if(i==null)return null;let o=yy(n);mT(o);let a=null;for(let l=0;a==null&&l<o.length;++l){let u=IT(i);a=AT(o[l],u,r)}return a}function yy(n,e,t,r){e===void 0&&(e=[]),t===void 0&&(t=[]),r===void 0&&(r="");let s=(i,o,a)=>{let l={relativePath:a===void 0?i.path||"":a,caseSensitive:i.caseSensitive===!0,childrenIndex:o,route:i};l.relativePath.startsWith("/")&&(je(l.relativePath.startsWith(r),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(r.length));let u=Lr([r,l.relativePath]),c=t.concat(l);i.children&&i.children.length>0&&(je(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+u+'".')),yy(i.children,e,c,u)),!(i.path==null&&!i.index)&&e.push({path:u,score:ST(u,i.index),routesMeta:c})};return n.forEach((i,o)=>{var a;if(i.path===""||!((a=i.path)!=null&&a.includes("?")))s(i,o);else for(let l of vy(i.path))s(i,o,l)}),e}function vy(n){let e=n.split("/");if(e.length===0)return[];let[t,...r]=e,s=t.endsWith("?"),i=t.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let o=vy(r.join("/")),a=[];return a.push(...o.map(l=>l===""?i:[i,l].join("/"))),s&&a.push(...o),a.map(l=>n.startsWith("/")&&l===""?"/":l)}function mT(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:TT(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}const gT=/^:[\w-]+$/,pT=3,yT=2,vT=1,ET=10,xT=-2,hm=n=>n==="*";function ST(n,e){let t=n.split("/"),r=t.length;return t.some(hm)&&(r+=xT),e&&(r+=yT),t.filter(s=>!hm(s)).reduce((s,i)=>s+(gT.test(i)?pT:i===""?vT:ET),r)}function TT(n,e){return n.length===e.length&&n.slice(0,-1).every((r,s)=>r===e[s])?n[n.length-1]-e[e.length-1]:0}function AT(n,e,t){let{routesMeta:r}=n,s={},i="/",o=[];for(let a=0;a<r.length;++a){let l=r[a],u=a===r.length-1,c=i==="/"?e:e.slice(i.length)||"/",d=mm({path:l.relativePath,caseSensitive:l.caseSensitive,end:u},c),f=l.route;if(!d&&u&&t&&!r[r.length-1].route.index&&(d=mm({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},c)),!d)return null;Object.assign(s,d.params),o.push({params:s,pathname:Lr([i,d.pathname]),pathnameBase:kT(Lr([i,d.pathnameBase])),route:f}),d.pathnameBase!=="/"&&(i=Lr([i,d.pathnameBase]))}return o}function mm(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,r]=LT(n.path,n.caseSensitive,n.end),s=e.match(t);if(!s)return null;let i=s[0],o=i.replace(/(.)\/+$/,"$1"),a=s.slice(1);return{params:r.reduce((u,c,d)=>{let{paramName:f,isOptional:h}=c;if(f==="*"){let g=a[d]||"";o=i.slice(0,i.length-g.length).replace(/(.)\/+$/,"$1")}const m=a[d];return h&&!m?u[f]=void 0:u[f]=(m||"").replace(/%2F/g,"/"),u},{}),pathname:i,pathnameBase:o,pattern:n}}function LT(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),py(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let r=[],s="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,l)=>(r.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(r.push({paramName:"*"}),s+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?s+="\\/*$":n!==""&&n!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function IT(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return py(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),n}}function hf(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=n.charAt(t);return r&&r!=="/"?null:n.slice(t)||"/"}function RT(n,e){e===void 0&&(e="/");let{pathname:t,search:r="",hash:s=""}=typeof n=="string"?Ws(n):n;return{pathname:t?t.startsWith("/")?t:_T(t,e):e,search:CT(r),hash:bT(s)}}function _T(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(s=>{s===".."?t.length>1&&t.pop():s!=="."&&t.push(s)}),t.length>1?t.join("/"):"/"}function yu(n,e,t,r){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function wT(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function mf(n,e){let t=wT(n);return e?t.map((r,s)=>s===t.length-1?r.pathname:r.pathnameBase):t.map(r=>r.pathnameBase)}function gf(n,e,t,r){r===void 0&&(r=!1);let s;typeof n=="string"?s=Ws(n):(s=Qi({},n),je(!s.pathname||!s.pathname.includes("?"),yu("?","pathname","search",s)),je(!s.pathname||!s.pathname.includes("#"),yu("#","pathname","hash",s)),je(!s.search||!s.search.includes("#"),yu("#","search","hash",s)));let i=n===""||s.pathname==="",o=i?"/":s.pathname,a;if(o==null)a=t;else{let d=e.length-1;if(!r&&o.startsWith("..")){let f=o.split("/");for(;f[0]==="..";)f.shift(),d-=1;s.pathname=f.join("/")}a=d>=0?e[d]:"/"}let l=RT(s,a),u=o&&o!=="/"&&o.endsWith("/"),c=(i||o===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(u||c)&&(l.pathname+="/"),l}const Lr=n=>n.join("/").replace(/\/\/+/g,"/"),kT=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),CT=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,bT=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function DT(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const Ey=["post","put","patch","delete"];new Set(Ey);const PT=["get",...Ey];new Set(PT);/**
 * React Router v6.30.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ji(){return Ji=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Ji.apply(this,arguments)}const pf=D.createContext(null),OT=D.createContext(null),Dr=D.createContext(null),Cl=D.createContext(null),Jn=D.createContext({outlet:null,matches:[],isDataRoute:!1}),xy=D.createContext(null);function NT(n,e){let{relative:t}=e===void 0?{}:e;Ys()||je(!1);let{basename:r,navigator:s}=D.useContext(Dr),{hash:i,pathname:o,search:a}=Ay(n,{relative:t}),l=o;return r!=="/"&&(l=o==="/"?r:Lr([r,o])),s.createHref({pathname:l,search:a,hash:i})}function Ys(){return D.useContext(Cl)!=null}function rs(){return Ys()||je(!1),D.useContext(Cl).location}function Sy(n){D.useContext(Dr).static||D.useLayoutEffect(n)}function go(){let{isDataRoute:n}=D.useContext(Jn);return n?YT():MT()}function MT(){Ys()||je(!1);let n=D.useContext(pf),{basename:e,future:t,navigator:r}=D.useContext(Dr),{matches:s}=D.useContext(Jn),{pathname:i}=rs(),o=JSON.stringify(mf(s,t.v7_relativeSplatPath)),a=D.useRef(!1);return Sy(()=>{a.current=!0}),D.useCallback(function(u,c){if(c===void 0&&(c={}),!a.current)return;if(typeof u=="number"){r.go(u);return}let d=gf(u,JSON.parse(o),i,c.relative==="path");n==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:Lr([e,d.pathname])),(c.replace?r.replace:r.push)(d,c.state,c)},[e,r,o,i,n])}function Ty(){let{matches:n}=D.useContext(Jn),e=n[n.length-1];return e?e.params:{}}function Ay(n,e){let{relative:t}=e===void 0?{}:e,{future:r}=D.useContext(Dr),{matches:s}=D.useContext(Jn),{pathname:i}=rs(),o=JSON.stringify(mf(s,r.v7_relativeSplatPath));return D.useMemo(()=>gf(n,JSON.parse(o),i,t==="path"),[n,o,i,t])}function FT(n,e){return UT(n,e)}function UT(n,e,t,r){Ys()||je(!1);let{navigator:s,static:i}=D.useContext(Dr),{matches:o}=D.useContext(Jn),a=o[o.length-1],l=a?a.params:{};a&&a.pathname;let u=a?a.pathnameBase:"/";a&&a.route;let c=rs(),d;if(e){var f;let y=typeof e=="string"?Ws(e):e;u==="/"||(f=y.pathname)!=null&&f.startsWith(u)||je(!1),d=y}else d=c;let h=d.pathname||"/",m=h;if(u!=="/"){let y=u.replace(/^\//,"").split("/");m="/"+h.replace(/^\//,"").split("/").slice(y.length).join("/")}let g=!i&&t&&t.matches&&t.matches.length>0?t.matches:fT(n,{pathname:m}),p=VT(g&&g.map(y=>Object.assign({},y,{params:Object.assign({},l,y.params),pathname:Lr([u,s.encodeLocation?s.encodeLocation(y.pathname).pathname:y.pathname]),pathnameBase:y.pathnameBase==="/"?u:Lr([u,s.encodeLocation?s.encodeLocation(y.pathnameBase).pathname:y.pathnameBase])})),o,t,r);return e&&p?D.createElement(Cl.Provider,{value:{location:Ji({pathname:"/",search:"",hash:"",state:null,key:"default"},d),navigationType:gr.Pop}},p):p}function BT(){let n=WT(),e=DT(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return D.createElement(D.Fragment,null,D.createElement("h2",null,"Unexpected Application Error!"),D.createElement("h3",{style:{fontStyle:"italic"}},e),t?D.createElement("pre",{style:s},t):null,null)}const $T=D.createElement(BT,null);class jT extends D.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?D.createElement(Jn.Provider,{value:this.props.routeContext},D.createElement(xy.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function GT(n){let{routeContext:e,match:t,children:r}=n,s=D.useContext(pf);return s&&s.static&&s.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=t.route.id),D.createElement(Jn.Provider,{value:e},r)}function VT(n,e,t,r){var s;if(e===void 0&&(e=[]),t===void 0&&(t=null),r===void 0&&(r=null),n==null){var i;if(!t)return null;if(t.errors)n=t.matches;else if((i=r)!=null&&i.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let o=n,a=(s=t)==null?void 0:s.errors;if(a!=null){let c=o.findIndex(d=>d.route.id&&(a==null?void 0:a[d.route.id])!==void 0);c>=0||je(!1),o=o.slice(0,Math.min(o.length,c+1))}let l=!1,u=-1;if(t&&r&&r.v7_partialHydration)for(let c=0;c<o.length;c++){let d=o[c];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(u=c),d.route.id){let{loaderData:f,errors:h}=t,m=d.route.loader&&f[d.route.id]===void 0&&(!h||h[d.route.id]===void 0);if(d.route.lazy||m){l=!0,u>=0?o=o.slice(0,u+1):o=[o[0]];break}}}return o.reduceRight((c,d,f)=>{let h,m=!1,g=null,p=null;t&&(h=a&&d.route.id?a[d.route.id]:void 0,g=d.route.errorElement||$T,l&&(u<0&&f===0?(m=!0,p=null):u===f&&(m=!0,p=d.route.hydrateFallbackElement||null)));let y=e.concat(o.slice(0,f+1)),v=()=>{let E;return h?E=g:m?E=p:d.route.Component?E=D.createElement(d.route.Component,null):d.route.element?E=d.route.element:E=c,D.createElement(GT,{match:d,routeContext:{outlet:c,matches:y,isDataRoute:t!=null},children:E})};return t&&(d.route.ErrorBoundary||d.route.errorElement||f===0)?D.createElement(jT,{location:t.location,revalidation:t.revalidation,component:g,error:h,children:v(),routeContext:{outlet:null,matches:y,isDataRoute:!0}}):v()},null)}var Ly=function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n}(Ly||{}),Za=function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n}(Za||{});function HT(n){let e=D.useContext(pf);return e||je(!1),e}function KT(n){let e=D.useContext(OT);return e||je(!1),e}function zT(n){let e=D.useContext(Jn);return e||je(!1),e}function Iy(n){let e=zT(),t=e.matches[e.matches.length-1];return t.route.id||je(!1),t.route.id}function WT(){var n;let e=D.useContext(xy),t=KT(Za.UseRouteError),r=Iy(Za.UseRouteError);return e!==void 0?e:(n=t.errors)==null?void 0:n[r]}function YT(){let{router:n}=HT(Ly.UseNavigateStable),e=Iy(Za.UseNavigateStable),t=D.useRef(!1);return Sy(()=>{t.current=!0}),D.useCallback(function(s,i){i===void 0&&(i={}),t.current&&(typeof s=="number"?n.navigate(s):n.navigate(s,Ji({fromRouteId:e},i)))},[n,e])}function qT(n,e){n==null||n.v7_startTransition,n==null||n.v7_relativeSplatPath}function Ry(n){let{to:e,replace:t,state:r,relative:s}=n;Ys()||je(!1);let{future:i,static:o}=D.useContext(Dr),{matches:a}=D.useContext(Jn),{pathname:l}=rs(),u=go(),c=gf(e,mf(a,i.v7_relativeSplatPath),l,s==="path"),d=JSON.stringify(c);return D.useEffect(()=>u(JSON.parse(d),{replace:t,state:r,relative:s}),[u,d,s,t,r]),null}function Sn(n){je(!1)}function XT(n){let{basename:e="/",children:t=null,location:r,navigationType:s=gr.Pop,navigator:i,static:o=!1,future:a}=n;Ys()&&je(!1);let l=e.replace(/^\/*/,"/"),u=D.useMemo(()=>({basename:l,navigator:i,static:o,future:Ji({v7_relativeSplatPath:!1},a)}),[l,a,i,o]);typeof r=="string"&&(r=Ws(r));let{pathname:c="/",search:d="",hash:f="",state:h=null,key:m="default"}=r,g=D.useMemo(()=>{let p=hf(c,l);return p==null?null:{location:{pathname:p,search:d,hash:f,state:h,key:m},navigationType:s}},[l,c,d,f,h,m,s]);return g==null?null:D.createElement(Dr.Provider,{value:u},D.createElement(Cl.Provider,{children:t,value:g}))}function QT(n){let{children:e,location:t}=n;return FT(Hc(e),t)}new Promise(()=>{});function Hc(n,e){e===void 0&&(e=[]);let t=[];return D.Children.forEach(n,(r,s)=>{if(!D.isValidElement(r))return;let i=[...e,s];if(r.type===D.Fragment){t.push.apply(t,Hc(r.props.children,i));return}r.type!==Sn&&je(!1),!r.props.index||!r.props.children||je(!1);let o={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=Hc(r.props.children,i)),t.push(o)}),t}/**
 * React Router DOM v6.30.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Kc(){return Kc=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Kc.apply(this,arguments)}function JT(n,e){if(n==null)return{};var t={},r=Object.keys(n),s,i;for(i=0;i<r.length;i++)s=r[i],!(e.indexOf(s)>=0)&&(t[s]=n[s]);return t}function ZT(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function eA(n,e){return n.button===0&&(!e||e==="_self")&&!ZT(n)}const tA=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],nA="6";try{window.__reactRouterVersion=nA}catch{}const rA="startTransition",gm=QE[rA];function sA(n){let{basename:e,children:t,future:r,window:s}=n,i=D.useRef();i.current==null&&(i.current=uT({window:s,v5Compat:!0}));let o=i.current,[a,l]=D.useState({action:o.action,location:o.location}),{v7_startTransition:u}=r||{},c=D.useCallback(d=>{u&&gm?gm(()=>l(d)):l(d)},[l,u]);return D.useLayoutEffect(()=>o.listen(c),[o,c]),D.useEffect(()=>qT(r),[r]),D.createElement(XT,{basename:e,children:t,location:a.location,navigationType:a.action,navigator:o,future:r})}const iA=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",oA=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,It=D.forwardRef(function(e,t){let{onClick:r,relative:s,reloadDocument:i,replace:o,state:a,target:l,to:u,preventScrollReset:c,viewTransition:d}=e,f=JT(e,tA),{basename:h}=D.useContext(Dr),m,g=!1;if(typeof u=="string"&&oA.test(u)&&(m=u,iA))try{let E=new URL(window.location.href),T=u.startsWith("//")?new URL(E.protocol+u):new URL(u),A=hf(T.pathname,h);T.origin===E.origin&&A!=null?u=A+T.search+T.hash:g=!0}catch{}let p=NT(u,{relative:s}),y=aA(u,{replace:o,state:a,target:l,preventScrollReset:c,relative:s,viewTransition:d});function v(E){r&&r(E),E.defaultPrevented||y(E)}return D.createElement("a",Kc({},f,{href:m||p,onClick:g||i?r:v,ref:t,target:l}))});var pm;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(pm||(pm={}));var ym;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(ym||(ym={}));function aA(n,e){let{target:t,replace:r,state:s,preventScrollReset:i,relative:o,viewTransition:a}=e===void 0?{}:e,l=go(),u=rs(),c=Ay(n,{relative:o});return D.useCallback(d=>{if(eA(d,t)){d.preventDefault();let f=r!==void 0?r:Ja(u)===Ja(c);l(n,{replace:f,state:s,preventScrollReset:i,relative:o,viewTransition:a})}},[u,l,c,r,s,t,n,i,o,a])}function _y(n,e){return function(){return n.apply(e,arguments)}}const{toString:lA}=Object.prototype,{getPrototypeOf:yf}=Object,{iterator:bl,toStringTag:wy}=Symbol,Dl=(n=>e=>{const t=lA.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),hn=n=>(n=n.toLowerCase(),e=>Dl(e)===n),Pl=n=>e=>typeof e===n,{isArray:qs}=Array,Zi=Pl("undefined");function uA(n){return n!==null&&!Zi(n)&&n.constructor!==null&&!Zi(n.constructor)&&Dt(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const ky=hn("ArrayBuffer");function cA(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&ky(n.buffer),e}const dA=Pl("string"),Dt=Pl("function"),Cy=Pl("number"),Ol=n=>n!==null&&typeof n=="object",fA=n=>n===!0||n===!1,ya=n=>{if(Dl(n)!=="object")return!1;const e=yf(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(wy in n)&&!(bl in n)},hA=hn("Date"),mA=hn("File"),gA=hn("Blob"),pA=hn("FileList"),yA=n=>Ol(n)&&Dt(n.pipe),vA=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||Dt(n.append)&&((e=Dl(n))==="formdata"||e==="object"&&Dt(n.toString)&&n.toString()==="[object FormData]"))},EA=hn("URLSearchParams"),[xA,SA,TA,AA]=["ReadableStream","Request","Response","Headers"].map(hn),LA=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function po(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n>"u")return;let r,s;if(typeof n!="object"&&(n=[n]),qs(n))for(r=0,s=n.length;r<s;r++)e.call(null,n[r],r,n);else{const i=t?Object.getOwnPropertyNames(n):Object.keys(n),o=i.length;let a;for(r=0;r<o;r++)a=i[r],e.call(null,n[a],a,n)}}function by(n,e){e=e.toLowerCase();const t=Object.keys(n);let r=t.length,s;for(;r-- >0;)if(s=t[r],e===s.toLowerCase())return s;return null}const Gr=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Dy=n=>!Zi(n)&&n!==Gr;function zc(){const{caseless:n}=Dy(this)&&this||{},e={},t=(r,s)=>{const i=n&&by(e,s)||s;ya(e[i])&&ya(r)?e[i]=zc(e[i],r):ya(r)?e[i]=zc({},r):qs(r)?e[i]=r.slice():e[i]=r};for(let r=0,s=arguments.length;r<s;r++)arguments[r]&&po(arguments[r],t);return e}const IA=(n,e,t,{allOwnKeys:r}={})=>(po(e,(s,i)=>{t&&Dt(s)?n[i]=_y(s,t):n[i]=s},{allOwnKeys:r}),n),RA=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),_A=(n,e,t,r)=>{n.prototype=Object.create(e.prototype,r),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},wA=(n,e,t,r)=>{let s,i,o;const a={};if(e=e||{},n==null)return e;do{for(s=Object.getOwnPropertyNames(n),i=s.length;i-- >0;)o=s[i],(!r||r(o,n,e))&&!a[o]&&(e[o]=n[o],a[o]=!0);n=t!==!1&&yf(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},kA=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const r=n.indexOf(e,t);return r!==-1&&r===t},CA=n=>{if(!n)return null;if(qs(n))return n;let e=n.length;if(!Cy(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},bA=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&yf(Uint8Array)),DA=(n,e)=>{const r=(n&&n[bl]).call(n);let s;for(;(s=r.next())&&!s.done;){const i=s.value;e.call(n,i[0],i[1])}},PA=(n,e)=>{let t;const r=[];for(;(t=n.exec(e))!==null;)r.push(t);return r},OA=hn("HTMLFormElement"),NA=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,r,s){return r.toUpperCase()+s}),vm=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),MA=hn("RegExp"),Py=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),r={};po(t,(s,i)=>{let o;(o=e(s,i,n))!==!1&&(r[i]=o||s)}),Object.defineProperties(n,r)},FA=n=>{Py(n,(e,t)=>{if(Dt(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const r=n[t];if(Dt(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},UA=(n,e)=>{const t={},r=s=>{s.forEach(i=>{t[i]=!0})};return qs(n)?r(n):r(String(n).split(e)),t},BA=()=>{},$A=(n,e)=>n!=null&&Number.isFinite(n=+n)?n:e;function jA(n){return!!(n&&Dt(n.append)&&n[wy]==="FormData"&&n[bl])}const GA=n=>{const e=new Array(10),t=(r,s)=>{if(Ol(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[s]=r;const i=qs(r)?[]:{};return po(r,(o,a)=>{const l=t(o,s+1);!Zi(l)&&(i[a]=l)}),e[s]=void 0,i}}return r};return t(n,0)},VA=hn("AsyncFunction"),HA=n=>n&&(Ol(n)||Dt(n))&&Dt(n.then)&&Dt(n.catch),Oy=((n,e)=>n?setImmediate:e?((t,r)=>(Gr.addEventListener("message",({source:s,data:i})=>{s===Gr&&i===t&&r.length&&r.shift()()},!1),s=>{r.push(s),Gr.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",Dt(Gr.postMessage)),KA=typeof queueMicrotask<"u"?queueMicrotask.bind(Gr):typeof process<"u"&&process.nextTick||Oy,zA=n=>n!=null&&Dt(n[bl]),O={isArray:qs,isArrayBuffer:ky,isBuffer:uA,isFormData:vA,isArrayBufferView:cA,isString:dA,isNumber:Cy,isBoolean:fA,isObject:Ol,isPlainObject:ya,isReadableStream:xA,isRequest:SA,isResponse:TA,isHeaders:AA,isUndefined:Zi,isDate:hA,isFile:mA,isBlob:gA,isRegExp:MA,isFunction:Dt,isStream:yA,isURLSearchParams:EA,isTypedArray:bA,isFileList:pA,forEach:po,merge:zc,extend:IA,trim:LA,stripBOM:RA,inherits:_A,toFlatObject:wA,kindOf:Dl,kindOfTest:hn,endsWith:kA,toArray:CA,forEachEntry:DA,matchAll:PA,isHTMLForm:OA,hasOwnProperty:vm,hasOwnProp:vm,reduceDescriptors:Py,freezeMethods:FA,toObjectSet:UA,toCamelCase:NA,noop:BA,toFiniteNumber:$A,findKey:by,global:Gr,isContextDefined:Dy,isSpecCompliantForm:jA,toJSONObject:GA,isAsyncFn:VA,isThenable:HA,setImmediate:Oy,asap:KA,isIterable:zA};function ce(n,e,t,r,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),r&&(this.request=r),s&&(this.response=s,this.status=s.status?s.status:null)}O.inherits(ce,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:O.toJSONObject(this.config),code:this.code,status:this.status}}});const Ny=ce.prototype,My={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{My[n]={value:n}});Object.defineProperties(ce,My);Object.defineProperty(Ny,"isAxiosError",{value:!0});ce.from=(n,e,t,r,s,i)=>{const o=Object.create(Ny);return O.toFlatObject(n,o,function(l){return l!==Error.prototype},a=>a!=="isAxiosError"),ce.call(o,n.message,e,t,r,s),o.cause=n,o.name=n.name,i&&Object.assign(o,i),o};const WA=null;function Wc(n){return O.isPlainObject(n)||O.isArray(n)}function Fy(n){return O.endsWith(n,"[]")?n.slice(0,-2):n}function Em(n,e,t){return n?n.concat(e).map(function(s,i){return s=Fy(s),!t&&i?"["+s+"]":s}).join(t?".":""):e}function YA(n){return O.isArray(n)&&!n.some(Wc)}const qA=O.toFlatObject(O,{},null,function(e){return/^is[A-Z]/.test(e)});function Nl(n,e,t){if(!O.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=O.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(g,p){return!O.isUndefined(p[g])});const r=t.metaTokens,s=t.visitor||c,i=t.dots,o=t.indexes,l=(t.Blob||typeof Blob<"u"&&Blob)&&O.isSpecCompliantForm(e);if(!O.isFunction(s))throw new TypeError("visitor must be a function");function u(m){if(m===null)return"";if(O.isDate(m))return m.toISOString();if(!l&&O.isBlob(m))throw new ce("Blob is not supported. Use a Buffer instead.");return O.isArrayBuffer(m)||O.isTypedArray(m)?l&&typeof Blob=="function"?new Blob([m]):Buffer.from(m):m}function c(m,g,p){let y=m;if(m&&!p&&typeof m=="object"){if(O.endsWith(g,"{}"))g=r?g:g.slice(0,-2),m=JSON.stringify(m);else if(O.isArray(m)&&YA(m)||(O.isFileList(m)||O.endsWith(g,"[]"))&&(y=O.toArray(m)))return g=Fy(g),y.forEach(function(E,T){!(O.isUndefined(E)||E===null)&&e.append(o===!0?Em([g],T,i):o===null?g:g+"[]",u(E))}),!1}return Wc(m)?!0:(e.append(Em(p,g,i),u(m)),!1)}const d=[],f=Object.assign(qA,{defaultVisitor:c,convertValue:u,isVisitable:Wc});function h(m,g){if(!O.isUndefined(m)){if(d.indexOf(m)!==-1)throw Error("Circular reference detected in "+g.join("."));d.push(m),O.forEach(m,function(y,v){(!(O.isUndefined(y)||y===null)&&s.call(e,y,O.isString(v)?v.trim():v,g,f))===!0&&h(y,g?g.concat(v):[v])}),d.pop()}}if(!O.isObject(n))throw new TypeError("data must be an object");return h(n),e}function xm(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function vf(n,e){this._pairs=[],n&&Nl(n,this,e)}const Uy=vf.prototype;Uy.append=function(e,t){this._pairs.push([e,t])};Uy.toString=function(e){const t=e?function(r){return e.call(this,r,xm)}:xm;return this._pairs.map(function(s){return t(s[0])+"="+t(s[1])},"").join("&")};function XA(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function By(n,e,t){if(!e)return n;const r=t&&t.encode||XA;O.isFunction(t)&&(t={serialize:t});const s=t&&t.serialize;let i;if(s?i=s(e,t):i=O.isURLSearchParams(e)?e.toString():new vf(e,t).toString(r),i){const o=n.indexOf("#");o!==-1&&(n=n.slice(0,o)),n+=(n.indexOf("?")===-1?"?":"&")+i}return n}class Sm{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){O.forEach(this.handlers,function(r){r!==null&&e(r)})}}const $y={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},QA=typeof URLSearchParams<"u"?URLSearchParams:vf,JA=typeof FormData<"u"?FormData:null,ZA=typeof Blob<"u"?Blob:null,eL={isBrowser:!0,classes:{URLSearchParams:QA,FormData:JA,Blob:ZA},protocols:["http","https","file","blob","url","data"]},Ef=typeof window<"u"&&typeof document<"u",Yc=typeof navigator=="object"&&navigator||void 0,tL=Ef&&(!Yc||["ReactNative","NativeScript","NS"].indexOf(Yc.product)<0),nL=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",rL=Ef&&window.location.href||"http://localhost",sL=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Ef,hasStandardBrowserEnv:tL,hasStandardBrowserWebWorkerEnv:nL,navigator:Yc,origin:rL},Symbol.toStringTag,{value:"Module"})),dt={...sL,...eL};function iL(n,e){return Nl(n,new dt.classes.URLSearchParams,Object.assign({visitor:function(t,r,s,i){return dt.isNode&&O.isBuffer(t)?(this.append(r,t.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)}},e))}function oL(n){return O.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function aL(n){const e={},t=Object.keys(n);let r;const s=t.length;let i;for(r=0;r<s;r++)i=t[r],e[i]=n[i];return e}function jy(n){function e(t,r,s,i){let o=t[i++];if(o==="__proto__")return!0;const a=Number.isFinite(+o),l=i>=t.length;return o=!o&&O.isArray(s)?s.length:o,l?(O.hasOwnProp(s,o)?s[o]=[s[o],r]:s[o]=r,!a):((!s[o]||!O.isObject(s[o]))&&(s[o]=[]),e(t,r,s[o],i)&&O.isArray(s[o])&&(s[o]=aL(s[o])),!a)}if(O.isFormData(n)&&O.isFunction(n.entries)){const t={};return O.forEachEntry(n,(r,s)=>{e(oL(r),s,t,0)}),t}return null}function lL(n,e,t){if(O.isString(n))try{return(e||JSON.parse)(n),O.trim(n)}catch(r){if(r.name!=="SyntaxError")throw r}return(0,JSON.stringify)(n)}const yo={transitional:$y,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const r=t.getContentType()||"",s=r.indexOf("application/json")>-1,i=O.isObject(e);if(i&&O.isHTMLForm(e)&&(e=new FormData(e)),O.isFormData(e))return s?JSON.stringify(jy(e)):e;if(O.isArrayBuffer(e)||O.isBuffer(e)||O.isStream(e)||O.isFile(e)||O.isBlob(e)||O.isReadableStream(e))return e;if(O.isArrayBufferView(e))return e.buffer;if(O.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(i){if(r.indexOf("application/x-www-form-urlencoded")>-1)return iL(e,this.formSerializer).toString();if((a=O.isFileList(e))||r.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return Nl(a?{"files[]":e}:e,l&&new l,this.formSerializer)}}return i||s?(t.setContentType("application/json",!1),lL(e)):e}],transformResponse:[function(e){const t=this.transitional||yo.transitional,r=t&&t.forcedJSONParsing,s=this.responseType==="json";if(O.isResponse(e)||O.isReadableStream(e))return e;if(e&&O.isString(e)&&(r&&!this.responseType||s)){const o=!(t&&t.silentJSONParsing)&&s;try{return JSON.parse(e)}catch(a){if(o)throw a.name==="SyntaxError"?ce.from(a,ce.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:dt.classes.FormData,Blob:dt.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};O.forEach(["delete","get","head","post","put","patch"],n=>{yo.headers[n]={}});const uL=O.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),cL=n=>{const e={};let t,r,s;return n&&n.split(`
`).forEach(function(o){s=o.indexOf(":"),t=o.substring(0,s).trim().toLowerCase(),r=o.substring(s+1).trim(),!(!t||e[t]&&uL[t])&&(t==="set-cookie"?e[t]?e[t].push(r):e[t]=[r]:e[t]=e[t]?e[t]+", "+r:r)}),e},Tm=Symbol("internals");function li(n){return n&&String(n).trim().toLowerCase()}function va(n){return n===!1||n==null?n:O.isArray(n)?n.map(va):String(n)}function dL(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=t.exec(n);)e[r[1]]=r[2];return e}const fL=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function vu(n,e,t,r,s){if(O.isFunction(r))return r.call(this,e,t);if(s&&(e=t),!!O.isString(e)){if(O.isString(r))return e.indexOf(r)!==-1;if(O.isRegExp(r))return r.test(e)}}function hL(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}function mL(n,e){const t=O.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(n,r+t,{value:function(s,i,o){return this[r].call(this,e,s,i,o)},configurable:!0})})}class Pt{constructor(e){e&&this.set(e)}set(e,t,r){const s=this;function i(a,l,u){const c=li(l);if(!c)throw new Error("header name must be a non-empty string");const d=O.findKey(s,c);(!d||s[d]===void 0||u===!0||u===void 0&&s[d]!==!1)&&(s[d||l]=va(a))}const o=(a,l)=>O.forEach(a,(u,c)=>i(u,c,l));if(O.isPlainObject(e)||e instanceof this.constructor)o(e,t);else if(O.isString(e)&&(e=e.trim())&&!fL(e))o(cL(e),t);else if(O.isObject(e)&&O.isIterable(e)){let a={},l,u;for(const c of e){if(!O.isArray(c))throw TypeError("Object iterator must return a key-value pair");a[u=c[0]]=(l=a[u])?O.isArray(l)?[...l,c[1]]:[l,c[1]]:c[1]}o(a,t)}else e!=null&&i(t,e,r);return this}get(e,t){if(e=li(e),e){const r=O.findKey(this,e);if(r){const s=this[r];if(!t)return s;if(t===!0)return dL(s);if(O.isFunction(t))return t.call(this,s,r);if(O.isRegExp(t))return t.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=li(e),e){const r=O.findKey(this,e);return!!(r&&this[r]!==void 0&&(!t||vu(this,this[r],r,t)))}return!1}delete(e,t){const r=this;let s=!1;function i(o){if(o=li(o),o){const a=O.findKey(r,o);a&&(!t||vu(r,r[a],a,t))&&(delete r[a],s=!0)}}return O.isArray(e)?e.forEach(i):i(e),s}clear(e){const t=Object.keys(this);let r=t.length,s=!1;for(;r--;){const i=t[r];(!e||vu(this,this[i],i,e,!0))&&(delete this[i],s=!0)}return s}normalize(e){const t=this,r={};return O.forEach(this,(s,i)=>{const o=O.findKey(r,i);if(o){t[o]=va(s),delete t[i];return}const a=e?hL(i):String(i).trim();a!==i&&delete t[i],t[a]=va(s),r[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return O.forEach(this,(r,s)=>{r!=null&&r!==!1&&(t[s]=e&&O.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach(s=>r.set(s)),r}static accessor(e){const r=(this[Tm]=this[Tm]={accessors:{}}).accessors,s=this.prototype;function i(o){const a=li(o);r[a]||(mL(s,o),r[a]=!0)}return O.isArray(e)?e.forEach(i):i(e),this}}Pt.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);O.reduceDescriptors(Pt.prototype,({value:n},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(r){this[t]=r}}});O.freezeMethods(Pt);function Eu(n,e){const t=this||yo,r=e||t,s=Pt.from(r.headers);let i=r.data;return O.forEach(n,function(a){i=a.call(t,i,s.normalize(),e?e.status:void 0)}),s.normalize(),i}function Gy(n){return!!(n&&n.__CANCEL__)}function Xs(n,e,t){ce.call(this,n??"canceled",ce.ERR_CANCELED,e,t),this.name="CanceledError"}O.inherits(Xs,ce,{__CANCEL__:!0});function Vy(n,e,t){const r=t.config.validateStatus;!t.status||!r||r(t.status)?n(t):e(new ce("Request failed with status code "+t.status,[ce.ERR_BAD_REQUEST,ce.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function gL(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function pL(n,e){n=n||10;const t=new Array(n),r=new Array(n);let s=0,i=0,o;return e=e!==void 0?e:1e3,function(l){const u=Date.now(),c=r[i];o||(o=u),t[s]=l,r[s]=u;let d=i,f=0;for(;d!==s;)f+=t[d++],d=d%n;if(s=(s+1)%n,s===i&&(i=(i+1)%n),u-o<e)return;const h=c&&u-c;return h?Math.round(f*1e3/h):void 0}}function yL(n,e){let t=0,r=1e3/e,s,i;const o=(u,c=Date.now())=>{t=c,s=null,i&&(clearTimeout(i),i=null),n.apply(null,u)};return[(...u)=>{const c=Date.now(),d=c-t;d>=r?o(u,c):(s=u,i||(i=setTimeout(()=>{i=null,o(s)},r-d)))},()=>s&&o(s)]}const el=(n,e,t=3)=>{let r=0;const s=pL(50,250);return yL(i=>{const o=i.loaded,a=i.lengthComputable?i.total:void 0,l=o-r,u=s(l),c=o<=a;r=o;const d={loaded:o,total:a,progress:a?o/a:void 0,bytes:l,rate:u||void 0,estimated:u&&a&&c?(a-o)/u:void 0,event:i,lengthComputable:a!=null,[e?"download":"upload"]:!0};n(d)},t)},Am=(n,e)=>{const t=n!=null;return[r=>e[0]({lengthComputable:t,total:n,loaded:r}),e[1]]},Lm=n=>(...e)=>O.asap(()=>n(...e)),vL=dt.hasStandardBrowserEnv?((n,e)=>t=>(t=new URL(t,dt.origin),n.protocol===t.protocol&&n.host===t.host&&(e||n.port===t.port)))(new URL(dt.origin),dt.navigator&&/(msie|trident)/i.test(dt.navigator.userAgent)):()=>!0,EL=dt.hasStandardBrowserEnv?{write(n,e,t,r,s,i){const o=[n+"="+encodeURIComponent(e)];O.isNumber(t)&&o.push("expires="+new Date(t).toGMTString()),O.isString(r)&&o.push("path="+r),O.isString(s)&&o.push("domain="+s),i===!0&&o.push("secure"),document.cookie=o.join("; ")},read(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function xL(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function SL(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function Hy(n,e,t){let r=!xL(e);return n&&(r||t==!1)?SL(n,e):e}const Im=n=>n instanceof Pt?{...n}:n;function Zr(n,e){e=e||{};const t={};function r(u,c,d,f){return O.isPlainObject(u)&&O.isPlainObject(c)?O.merge.call({caseless:f},u,c):O.isPlainObject(c)?O.merge({},c):O.isArray(c)?c.slice():c}function s(u,c,d,f){if(O.isUndefined(c)){if(!O.isUndefined(u))return r(void 0,u,d,f)}else return r(u,c,d,f)}function i(u,c){if(!O.isUndefined(c))return r(void 0,c)}function o(u,c){if(O.isUndefined(c)){if(!O.isUndefined(u))return r(void 0,u)}else return r(void 0,c)}function a(u,c,d){if(d in e)return r(u,c);if(d in n)return r(void 0,u)}const l={url:i,method:i,data:i,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(u,c,d)=>s(Im(u),Im(c),d,!0)};return O.forEach(Object.keys(Object.assign({},n,e)),function(c){const d=l[c]||s,f=d(n[c],e[c],c);O.isUndefined(f)&&d!==a||(t[c]=f)}),t}const Ky=n=>{const e=Zr({},n);let{data:t,withXSRFToken:r,xsrfHeaderName:s,xsrfCookieName:i,headers:o,auth:a}=e;e.headers=o=Pt.from(o),e.url=By(Hy(e.baseURL,e.url,e.allowAbsoluteUrls),n.params,n.paramsSerializer),a&&o.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):"")));let l;if(O.isFormData(t)){if(dt.hasStandardBrowserEnv||dt.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if((l=o.getContentType())!==!1){const[u,...c]=l?l.split(";").map(d=>d.trim()).filter(Boolean):[];o.setContentType([u||"multipart/form-data",...c].join("; "))}}if(dt.hasStandardBrowserEnv&&(r&&O.isFunction(r)&&(r=r(e)),r||r!==!1&&vL(e.url))){const u=s&&i&&EL.read(i);u&&o.set(s,u)}return e},TL=typeof XMLHttpRequest<"u",AL=TL&&function(n){return new Promise(function(t,r){const s=Ky(n);let i=s.data;const o=Pt.from(s.headers).normalize();let{responseType:a,onUploadProgress:l,onDownloadProgress:u}=s,c,d,f,h,m;function g(){h&&h(),m&&m(),s.cancelToken&&s.cancelToken.unsubscribe(c),s.signal&&s.signal.removeEventListener("abort",c)}let p=new XMLHttpRequest;p.open(s.method.toUpperCase(),s.url,!0),p.timeout=s.timeout;function y(){if(!p)return;const E=Pt.from("getAllResponseHeaders"in p&&p.getAllResponseHeaders()),A={data:!a||a==="text"||a==="json"?p.responseText:p.response,status:p.status,statusText:p.statusText,headers:E,config:n,request:p};Vy(function(L){t(L),g()},function(L){r(L),g()},A),p=null}"onloadend"in p?p.onloadend=y:p.onreadystatechange=function(){!p||p.readyState!==4||p.status===0&&!(p.responseURL&&p.responseURL.indexOf("file:")===0)||setTimeout(y)},p.onabort=function(){p&&(r(new ce("Request aborted",ce.ECONNABORTED,n,p)),p=null)},p.onerror=function(){r(new ce("Network Error",ce.ERR_NETWORK,n,p)),p=null},p.ontimeout=function(){let T=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const A=s.transitional||$y;s.timeoutErrorMessage&&(T=s.timeoutErrorMessage),r(new ce(T,A.clarifyTimeoutError?ce.ETIMEDOUT:ce.ECONNABORTED,n,p)),p=null},i===void 0&&o.setContentType(null),"setRequestHeader"in p&&O.forEach(o.toJSON(),function(T,A){p.setRequestHeader(A,T)}),O.isUndefined(s.withCredentials)||(p.withCredentials=!!s.withCredentials),a&&a!=="json"&&(p.responseType=s.responseType),u&&([f,m]=el(u,!0),p.addEventListener("progress",f)),l&&p.upload&&([d,h]=el(l),p.upload.addEventListener("progress",d),p.upload.addEventListener("loadend",h)),(s.cancelToken||s.signal)&&(c=E=>{p&&(r(!E||E.type?new Xs(null,n,p):E),p.abort(),p=null)},s.cancelToken&&s.cancelToken.subscribe(c),s.signal&&(s.signal.aborted?c():s.signal.addEventListener("abort",c)));const v=gL(s.url);if(v&&dt.protocols.indexOf(v)===-1){r(new ce("Unsupported protocol "+v+":",ce.ERR_BAD_REQUEST,n));return}p.send(i||null)})},LL=(n,e)=>{const{length:t}=n=n?n.filter(Boolean):[];if(e||t){let r=new AbortController,s;const i=function(u){if(!s){s=!0,a();const c=u instanceof Error?u:this.reason;r.abort(c instanceof ce?c:new Xs(c instanceof Error?c.message:c))}};let o=e&&setTimeout(()=>{o=null,i(new ce(`timeout ${e} of ms exceeded`,ce.ETIMEDOUT))},e);const a=()=>{n&&(o&&clearTimeout(o),o=null,n.forEach(u=>{u.unsubscribe?u.unsubscribe(i):u.removeEventListener("abort",i)}),n=null)};n.forEach(u=>u.addEventListener("abort",i));const{signal:l}=r;return l.unsubscribe=()=>O.asap(a),l}},IL=function*(n,e){let t=n.byteLength;if(t<e){yield n;return}let r=0,s;for(;r<t;)s=r+e,yield n.slice(r,s),r=s},RL=async function*(n,e){for await(const t of _L(n))yield*IL(t,e)},_L=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const e=n.getReader();try{for(;;){const{done:t,value:r}=await e.read();if(t)break;yield r}}finally{await e.cancel()}},Rm=(n,e,t,r)=>{const s=RL(n,e);let i=0,o,a=l=>{o||(o=!0,r&&r(l))};return new ReadableStream({async pull(l){try{const{done:u,value:c}=await s.next();if(u){a(),l.close();return}let d=c.byteLength;if(t){let f=i+=d;t(f)}l.enqueue(new Uint8Array(c))}catch(u){throw a(u),u}},cancel(l){return a(l),s.return()}},{highWaterMark:2})},Ml=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",zy=Ml&&typeof ReadableStream=="function",wL=Ml&&(typeof TextEncoder=="function"?(n=>e=>n.encode(e))(new TextEncoder):async n=>new Uint8Array(await new Response(n).arrayBuffer())),Wy=(n,...e)=>{try{return!!n(...e)}catch{return!1}},kL=zy&&Wy(()=>{let n=!1;const e=new Request(dt.origin,{body:new ReadableStream,method:"POST",get duplex(){return n=!0,"half"}}).headers.has("Content-Type");return n&&!e}),_m=64*1024,qc=zy&&Wy(()=>O.isReadableStream(new Response("").body)),tl={stream:qc&&(n=>n.body)};Ml&&(n=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!tl[e]&&(tl[e]=O.isFunction(n[e])?t=>t[e]():(t,r)=>{throw new ce(`Response type '${e}' is not supported`,ce.ERR_NOT_SUPPORT,r)})})})(new Response);const CL=async n=>{if(n==null)return 0;if(O.isBlob(n))return n.size;if(O.isSpecCompliantForm(n))return(await new Request(dt.origin,{method:"POST",body:n}).arrayBuffer()).byteLength;if(O.isArrayBufferView(n)||O.isArrayBuffer(n))return n.byteLength;if(O.isURLSearchParams(n)&&(n=n+""),O.isString(n))return(await wL(n)).byteLength},bL=async(n,e)=>{const t=O.toFiniteNumber(n.getContentLength());return t??CL(e)},DL=Ml&&(async n=>{let{url:e,method:t,data:r,signal:s,cancelToken:i,timeout:o,onDownloadProgress:a,onUploadProgress:l,responseType:u,headers:c,withCredentials:d="same-origin",fetchOptions:f}=Ky(n);u=u?(u+"").toLowerCase():"text";let h=LL([s,i&&i.toAbortSignal()],o),m;const g=h&&h.unsubscribe&&(()=>{h.unsubscribe()});let p;try{if(l&&kL&&t!=="get"&&t!=="head"&&(p=await bL(c,r))!==0){let A=new Request(e,{method:"POST",body:r,duplex:"half"}),R;if(O.isFormData(r)&&(R=A.headers.get("content-type"))&&c.setContentType(R),A.body){const[L,I]=Am(p,el(Lm(l)));r=Rm(A.body,_m,L,I)}}O.isString(d)||(d=d?"include":"omit");const y="credentials"in Request.prototype;m=new Request(e,{...f,signal:h,method:t.toUpperCase(),headers:c.normalize().toJSON(),body:r,duplex:"half",credentials:y?d:void 0});let v=await fetch(m);const E=qc&&(u==="stream"||u==="response");if(qc&&(a||E&&g)){const A={};["status","statusText","headers"].forEach(C=>{A[C]=v[C]});const R=O.toFiniteNumber(v.headers.get("content-length")),[L,I]=a&&Am(R,el(Lm(a),!0))||[];v=new Response(Rm(v.body,_m,L,()=>{I&&I(),g&&g()}),A)}u=u||"text";let T=await tl[O.findKey(tl,u)||"text"](v,n);return!E&&g&&g(),await new Promise((A,R)=>{Vy(A,R,{data:T,headers:Pt.from(v.headers),status:v.status,statusText:v.statusText,config:n,request:m})})}catch(y){throw g&&g(),y&&y.name==="TypeError"&&/Load failed|fetch/i.test(y.message)?Object.assign(new ce("Network Error",ce.ERR_NETWORK,n,m),{cause:y.cause||y}):ce.from(y,y&&y.code,n,m)}}),Xc={http:WA,xhr:AL,fetch:DL};O.forEach(Xc,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const wm=n=>`- ${n}`,PL=n=>O.isFunction(n)||n===null||n===!1,Yy={getAdapter:n=>{n=O.isArray(n)?n:[n];const{length:e}=n;let t,r;const s={};for(let i=0;i<e;i++){t=n[i];let o;if(r=t,!PL(t)&&(r=Xc[(o=String(t)).toLowerCase()],r===void 0))throw new ce(`Unknown adapter '${o}'`);if(r)break;s[o||"#"+i]=r}if(!r){const i=Object.entries(s).map(([a,l])=>`adapter ${a} `+(l===!1?"is not supported by the environment":"is not available in the build"));let o=e?i.length>1?`since :
`+i.map(wm).join(`
`):" "+wm(i[0]):"as no adapter specified";throw new ce("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return r},adapters:Xc};function xu(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new Xs(null,n)}function km(n){return xu(n),n.headers=Pt.from(n.headers),n.data=Eu.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),Yy.getAdapter(n.adapter||yo.adapter)(n).then(function(r){return xu(n),r.data=Eu.call(n,n.transformResponse,r),r.headers=Pt.from(r.headers),r},function(r){return Gy(r)||(xu(n),r&&r.response&&(r.response.data=Eu.call(n,n.transformResponse,r.response),r.response.headers=Pt.from(r.response.headers))),Promise.reject(r)})}const qy="1.9.0",Fl={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{Fl[n]=function(r){return typeof r===n||"a"+(e<1?"n ":" ")+n}});const Cm={};Fl.transitional=function(e,t,r){function s(i,o){return"[Axios v"+qy+"] Transitional option '"+i+"'"+o+(r?". "+r:"")}return(i,o,a)=>{if(e===!1)throw new ce(s(o," has been removed"+(t?" in "+t:"")),ce.ERR_DEPRECATED);return t&&!Cm[o]&&(Cm[o]=!0,console.warn(s(o," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(i,o,a):!0}};Fl.spelling=function(e){return(t,r)=>(console.warn(`${r} is likely a misspelling of ${e}`),!0)};function OL(n,e,t){if(typeof n!="object")throw new ce("options must be an object",ce.ERR_BAD_OPTION_VALUE);const r=Object.keys(n);let s=r.length;for(;s-- >0;){const i=r[s],o=e[i];if(o){const a=n[i],l=a===void 0||o(a,i,n);if(l!==!0)throw new ce("option "+i+" must be "+l,ce.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new ce("Unknown option "+i,ce.ERR_BAD_OPTION)}}const Ea={assertOptions:OL,validators:Fl},En=Ea.validators;class Kr{constructor(e){this.defaults=e||{},this.interceptors={request:new Sm,response:new Sm}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let s={};Error.captureStackTrace?Error.captureStackTrace(s):s=new Error;const i=s.stack?s.stack.replace(/^.+\n/,""):"";try{r.stack?i&&!String(r.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+i):r.stack=i}catch{}}throw r}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Zr(this.defaults,t);const{transitional:r,paramsSerializer:s,headers:i}=t;r!==void 0&&Ea.assertOptions(r,{silentJSONParsing:En.transitional(En.boolean),forcedJSONParsing:En.transitional(En.boolean),clarifyTimeoutError:En.transitional(En.boolean)},!1),s!=null&&(O.isFunction(s)?t.paramsSerializer={serialize:s}:Ea.assertOptions(s,{encode:En.function,serialize:En.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),Ea.assertOptions(t,{baseUrl:En.spelling("baseURL"),withXsrfToken:En.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=i&&O.merge(i.common,i[t.method]);i&&O.forEach(["delete","get","head","post","put","patch","common"],m=>{delete i[m]}),t.headers=Pt.concat(o,i);const a=[];let l=!0;this.interceptors.request.forEach(function(g){typeof g.runWhen=="function"&&g.runWhen(t)===!1||(l=l&&g.synchronous,a.unshift(g.fulfilled,g.rejected))});const u=[];this.interceptors.response.forEach(function(g){u.push(g.fulfilled,g.rejected)});let c,d=0,f;if(!l){const m=[km.bind(this),void 0];for(m.unshift.apply(m,a),m.push.apply(m,u),f=m.length,c=Promise.resolve(t);d<f;)c=c.then(m[d++],m[d++]);return c}f=a.length;let h=t;for(d=0;d<f;){const m=a[d++],g=a[d++];try{h=m(h)}catch(p){g.call(this,p);break}}try{c=km.call(this,h)}catch(m){return Promise.reject(m)}for(d=0,f=u.length;d<f;)c=c.then(u[d++],u[d++]);return c}getUri(e){e=Zr(this.defaults,e);const t=Hy(e.baseURL,e.url,e.allowAbsoluteUrls);return By(t,e.params,e.paramsSerializer)}}O.forEach(["delete","get","head","options"],function(e){Kr.prototype[e]=function(t,r){return this.request(Zr(r||{},{method:e,url:t,data:(r||{}).data}))}});O.forEach(["post","put","patch"],function(e){function t(r){return function(i,o,a){return this.request(Zr(a||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:i,data:o}))}}Kr.prototype[e]=t(),Kr.prototype[e+"Form"]=t(!0)});class xf{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(i){t=i});const r=this;this.promise.then(s=>{if(!r._listeners)return;let i=r._listeners.length;for(;i-- >0;)r._listeners[i](s);r._listeners=null}),this.promise.then=s=>{let i;const o=new Promise(a=>{r.subscribe(a),i=a}).then(s);return o.cancel=function(){r.unsubscribe(i)},o},e(function(i,o,a){r.reason||(r.reason=new Xs(i,o,a),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=r=>{e.abort(r)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new xf(function(s){e=s}),cancel:e}}}function NL(n){return function(t){return n.apply(null,t)}}function ML(n){return O.isObject(n)&&n.isAxiosError===!0}const Qc={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Qc).forEach(([n,e])=>{Qc[e]=n});function Xy(n){const e=new Kr(n),t=_y(Kr.prototype.request,e);return O.extend(t,Kr.prototype,e,{allOwnKeys:!0}),O.extend(t,e,null,{allOwnKeys:!0}),t.create=function(s){return Xy(Zr(n,s))},t}const Oe=Xy(yo);Oe.Axios=Kr;Oe.CanceledError=Xs;Oe.CancelToken=xf;Oe.isCancel=Gy;Oe.VERSION=qy;Oe.toFormData=Nl;Oe.AxiosError=ce;Oe.Cancel=Oe.CanceledError;Oe.all=function(e){return Promise.all(e)};Oe.spread=NL;Oe.isAxiosError=ML;Oe.mergeConfig=Zr;Oe.AxiosHeaders=Pt;Oe.formToJSON=n=>jy(O.isHTMLForm(n)?new FormData(n):n);Oe.getAdapter=Yy.getAdapter;Oe.HttpStatusCode=Qc;Oe.default=Oe;class FL{constructor(e){this.serverUrl=this.normalizeServerUrl(e.serverUrl)||"http://192.168.0.140:8096",this.apiKey=e.apiKey,this.userId=e.userId,this.deviceId=localStorage.getItem("jellyfin_device_id")??this.generateDeviceId(),localStorage.setItem("jellyfin_device_id",this.deviceId),this.deviceName="Jellyfin Web Client",this.clientName="Jellyfin Web Client",this.clientVersion="1.0.0";const t=localStorage.getItem("jellyfin_access_token"),r=localStorage.getItem("jellyfin_user_id");t&&r&&(this.accessToken=t,this.userId=r),Oe.defaults.timeout=1e4,Oe.defaults.validateStatus=s=>s>=200&&s<300}normalizeServerUrl(e){let t=e.trim().replace(/\/+$/,"");return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`http://${t}`),localStorage.setItem("jellyfin_server_url",t),t}generateDeviceId(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}getHeaders(){const e={"Content-Type":"application/json","X-Emby-Authorization":`MediaBrowser Client="${this.clientName}", Device="${this.deviceName}", DeviceId="${this.deviceId}", Version="${this.clientVersion}"`};return this.accessToken?e["X-Emby-Token"]=this.accessToken:this.apiKey&&(e["X-Emby-Authorization"]+=`, Token="${this.apiKey}"`),e}async makeRequest(e,t,r,s){var i;try{const o=`${this.serverUrl}/emby${t}`,a={method:e,url:o,headers:this.getHeaders(),data:r,params:s};return(await Oe(a)).data}catch(o){throw Oe.isAxiosError(o)?o.code==="ECONNABORTED"?new Error("Connection timeout. Please check if the Jellyfin server is accessible."):o.response?o.response.status===401?(this.logout(),new Error("Authentication failed. Please log in again.")):new Error(`Server error: ${((i=o.response.data)==null?void 0:i.Message)??o.message}`):new Error(`Network error: Unable to connect to Jellyfin server at ${this.serverUrl}. Please verify the server URL and ensure the server is running.`):o}}async login(e){try{const t=await this.makeRequest("post","/Users/AuthenticateByName",{Username:e.username,Pw:e.password});return this.accessToken=t.AccessToken,this.userId=t.User.Id,localStorage.setItem("jellyfin_access_token",t.AccessToken),localStorage.setItem("jellyfin_user_id",t.User.Id),t}catch(t){throw console.error("Login failed:",t),t}}async logout(){if(this.accessToken)try{await this.makeRequest("post","/Sessions/Logout")}catch(e){console.error("Logout failed:",e)}finally{this.accessToken=void 0,this.userId=void 0,localStorage.removeItem("jellyfin_access_token"),localStorage.removeItem("jellyfin_user_id")}}isAuthenticated(){return!!this.accessToken&&!!this.userId}async getResumeItems(e=20){return this.makeRequest("get",`/Users/${this.userId}/Items/Resume`,void 0,{Limit:e,Fields:"Overview,Genres,PrimaryImageTag,BackdropImageTags,UserData"}).then(t=>t.Items)}async getNextUpItems(e=20){const t=new Date;return t.setFullYear(t.getFullYear()-1),this.makeRequest("get","/Shows/NextUp",void 0,{Limit:e,Fields:"PrimaryImageAspectRatio,DateCreated,Path,MediaSourceCount",UserId:this.userId,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",EnableTotalRecordCount:!1,DisableFirstEpisode:!1,NextUpDateCutoff:t.toISOString(),EnableResumable:!1,EnableRewatching:!1}).then(r=>r.Items)}async getLatestMedia(e="",t=20){return this.makeRequest("get",`/Users/${this.userId}/Items/Latest`,void 0,{IncludeItemTypes:e,Limit:t,Fields:"Overview,Genres,PrimaryImageTag,BackdropImageTags"})}async getRecommended(e=10){return this.makeRequest("get",`/Users/${this.userId}/Items/Latest`,void 0,{Limit:e,Fields:"Overview,Genres,PrimaryImageTag,BackdropImageTags"})}async getMediaByType(e,t=20,r=0){return this.makeRequest("get",`/Users/${this.userId}/Items`,void 0,{IncludeItemTypes:e,Recursive:!0,Limit:t,StartIndex:r,SortBy:"SortName",SortOrder:"Ascending",Fields:"Overview,Genres,PrimaryImageTag,BackdropImageTags"})}async getMediaItem(e){return this.makeRequest("get",`/Users/${this.userId}/Items/${e}`,void 0,{Fields:"Overview,Genres,PrimaryImageTag,BackdropImageTags,MediaStreams"})}async getMediaByGenre(e,t="",r=20){return this.makeRequest("get",`/Users/${this.userId}/Items`,void 0,{GenreIds:e,IncludeItemTypes:t,Recursive:!0,Limit:r,Fields:"Overview,Genres,PrimaryImageTag,BackdropImageTags"})}async getGenres(e=""){return this.makeRequest("get","/Genres",void 0,{UserId:this.userId,IncludeItemTypes:e,SortBy:"SortName"})}async search(e,t=20){return this.makeRequest("get",`/Users/${this.userId}/Items`,void 0,{SearchTerm:e,Recursive:!0,Limit:t,Fields:"Overview,Genres,PrimaryImageTag,BackdropImageTags",IncludeItemTypes:"Movie,Series,Episode"})}getImageUrl(e,t="Primary",r,s){let i=`${this.serverUrl}/emby/Items/${e}/Images/${t}`;const o=new URLSearchParams;r&&o.append("maxWidth",r.toString()),s&&o.append("maxHeight",s.toString()),this.userId&&o.append("tag",this.userId);const a=o.toString();return a&&(i+=`?${a}`),i}getPlaybackUrl(e,t=0){const r=new URLSearchParams({DeviceId:this.deviceId,MediaSourceId:e,api_key:this.accessToken??"",VideoCodec:"av1,hevc,h264,vp9",AudioCodec:"aac",AudioStreamIndex:t.toString(),VideoBitrate:"139616000",AudioBitrate:"384000",MaxFramerate:"23.976025",PlaySessionId:`${this.deviceId}-${Date.now()}`,TranscodingMaxAudioChannels:"2",RequireAvc:"false",EnableAudioVbrEncoding:"true",SegmentContainer:"mp4",MinSegments:"1",BreakOnNonKeyFrames:"true","h264-level":"40","h264-videobitdepth":"8","h264-profile":"high","av1-profile":"main","av1-rangetype":"SDR,HDR10,HLG","av1-level":"19","vp9-rangetype":"SDR,HDR10,HLG","hevc-profile":"main,main10","hevc-rangetype":"SDR,HDR10,HLG","hevc-level":"183","hevc-deinterlace":"true","h264-rangetype":"SDR","h264-deinterlace":"true",TranscodeReasons:"ContainerNotSupported, AudioCodecNotSupported",TranscodingProtocol:"hls",TranscodingContainer:"ts"});return`${this.serverUrl}/videos/${e}/main.m3u8?${r.toString()}`}async fetchSubtitleTracks(e){var s,i,o;const t=await this.makeRequest("post",`/Items/${e.Id}/PlaybackInfo?api_key=${this.accessToken}`,JSON.stringify({MediaSourceId:e.Id,DeviceId:this.deviceId}));return(o=(i=(s=t==null?void 0:t.MediaSources)==null?void 0:s[0])==null?void 0:i.MediaStreams)==null?void 0:o.filter(a=>a.Type==="Subtitle")}async fetchSelectedSubtitle(e,t){const r=`/Videos/${e}/${e}/Subtitles/${t}/0/Stream.js`;return(await this.makeRequest("get",r,void 0,{api_key:this.accessToken})).TrackEvents}async reportPlaybackProgress(e,t,r,s){if(!(!this.userId||!this.accessToken))try{await this.makeRequest("post","/Sessions/Playing/Progress",{ItemId:e,MediaSourceId:e,PositionTicks:Math.floor(t*1e7),PlaybackStartTimeTicks:0,IsPaused:!1,IsMuted:!1,VolumeLevel:100,PlayMethod:"Transcode",RepeatMode:"RepeatNone",PlaylistItemId:null,LiveStreamId:null,PlaySessionId:this.deviceId,AudioStreamIndex:typeof r=="number"?r:0,SubtitleStreamIndex:typeof s=="number"?s:0})}catch(i){console.log(i)}}async reportPlaying({itemId:e,mediaSourceId:t,playSessionId:r,audioStreamIndex:s=0,subtitleStreamIndex:i=0,positionTicks:o=0,volumeLevel:a=100,isMuted:l=!1,isPaused:u=!1,repeatMode:c="RepeatNone",shuffleMode:d="Sorted",maxStreamingBitrate:f=14e7,playbackStartTimeTicks:h=0,playbackRate:m=1,secondarySubtitleStreamIndex:g=-1,bufferedRanges:p=[],playMethod:y="DirectPlay",nowPlayingQueue:v=[],canSeek:E=!0}){var T;await this.makeRequest("post","/Sessions/Playing",{VolumeLevel:a,IsMuted:l,IsPaused:u,RepeatMode:c,ShuffleMode:d,MaxStreamingBitrate:f,PositionTicks:o,PlaybackStartTimeTicks:h,PlaybackRate:m,SubtitleStreamIndex:i,SecondarySubtitleStreamIndex:g,AudioStreamIndex:s,BufferedRanges:p,PlayMethod:y,PlaySessionId:r,PlaylistItemId:((T=v[0])==null?void 0:T.PlaylistItemId)??"playlistItem0",MediaSourceId:t,CanSeek:E,ItemId:e,NowPlayingQueue:v.length?v:[{Id:e,PlaylistItemId:"playlistItem0"}]})}}const Qy=D.createContext({isAuthenticated:!1,isLoading:!0,user:null,login:async()=>{},logout:async()=>{},api:null}),mn=()=>D.useContext(Qy),UL=({children:n,serverUrl:e})=>{const[t,r]=D.useState(!1),[s,i]=D.useState(!0),[o,a]=D.useState(null),[l,u]=D.useState(null);D.useEffect(()=>{const f=new FL({serverUrl:e});u(f),f.isAuthenticated()&&r(!0),i(!1)},[e]);const c=async f=>{if(!l)throw new Error("API not initialized");i(!0);try{const h=await l.login(f);a(h),r(!0)}catch(h){throw console.error("Login failed:",h),h}finally{i(!1)}},d=async()=>{if(l){i(!0);try{await l.logout()}finally{a(null),r(!1),i(!1)}}};return S.jsx(Qy.Provider,{value:{isAuthenticated:t,isLoading:s,user:o,login:c,logout:d,api:l},children:n})};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var BL={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $L=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),Se=(n,e)=>{const t=D.forwardRef(({color:r="currentColor",size:s=24,strokeWidth:i=2,absoluteStrokeWidth:o,className:a="",children:l,...u},c)=>D.createElement("svg",{ref:c,...BL,width:s,height:s,stroke:r,strokeWidth:o?Number(i)*24/Number(s):i,className:["lucide",`lucide-${$L(n)}`,a].join(" "),...u},[...e.map(([d,f])=>D.createElement(d,f)),...Array.isArray(l)?l:[l]]));return t.displayName=`${n}`,t};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jL=Se("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GL=Se("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VL=Se("AtSign",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HL=Se("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Su=Se("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KL=Se("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zL=Se("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WL=Se("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YL=Se("ChevronsLeft",[["path",{d:"m11 17-5-5 5-5",key:"13zhaf"}],["path",{d:"m18 17-5-5 5-5",key:"h8a8et"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qL=Se("ChevronsRight",[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XL=Se("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QL=Se("Film",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7 3v18",key:"bbkbws"}],["path",{d:"M3 7.5h4",key:"zfgn84"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 16.5h4",key:"1230mu"}],["path",{d:"M17 3v18",key:"in4fa5"}],["path",{d:"M17 7.5h4",key:"myr1c1"}],["path",{d:"M17 16.5h4",key:"go4c1d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jy=Se("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JL=Se("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bm=Se("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZL=Se("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e1=Se("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t1=Se("Minimize",[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3",key:"hohbtr"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3",key:"5jw1f3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3",key:"198tvr"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3",key:"ph8mxp"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dm=Se("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eo=Se("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nl=Se("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n1=Se("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r1=Se("SkipBack",[["polygon",{points:"19 20 9 12 19 4 19 20",key:"o2sva"}],["line",{x1:"5",x2:"5",y1:"19",y2:"5",key:"1ocqjk"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s1=Se("SkipForward",[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i1=Se("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o1=Se("Tv",[["rect",{width:"20",height:"15",x:"2",y:"7",rx:"2",ry:"2",key:"10ag99"}],["polyline",{points:"17 2 12 7 7 2",key:"11pgbg"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const a1=Se("Volume1",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l1=Se("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u1=Se("VolumeX",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c1=Se("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);function Zy(n){var e,t,r="";if(typeof n=="string"||typeof n=="number")r+=n;else if(typeof n=="object")if(Array.isArray(n)){var s=n.length;for(e=0;e<s;e++)n[e]&&(t=Zy(n[e]))&&(r&&(r+=" "),r+=t)}else for(t in n)n[t]&&(r&&(r+=" "),r+=t);return r}function Be(){for(var n,e,t=0,r="",s=arguments.length;t<s;t++)(n=arguments[t])&&(e=Zy(n))&&(r&&(r+=" "),r+=e);return r}const zr=()=>{var v;const{isAuthenticated:n,logout:e,user:t}=mn(),[r,s]=D.useState(!1),[i,o]=D.useState(!1),[a,l]=D.useState(!1),[u,c]=D.useState(""),d=rs(),f=go(),[h,m]=D.useState(!1);D.useEffect(()=>{const E=()=>{s(window.scrollY>20)};return window.addEventListener("scroll",E),()=>{window.removeEventListener("scroll",E)}},[]),D.useEffect(()=>{o(!1),l(!1),m(!1)},[d]);const g=E=>{E.preventDefault(),u.trim()&&(f(`/search?q=${encodeURIComponent(u.trim())}`),l(!1))},p=async()=>{await e(),f("/login")},y=()=>{var E;return(E=t==null?void 0:t.User)!=null&&E.Name?t.User.Name.charAt(0).toUpperCase():"U"};return S.jsxs("header",{className:Be("fixed top-0 left-0 right-0 z-50 transition-all duration-300",r?"bg-black/90 backdrop-blur-sm":"bg-gradient-to-b from-black/80 to-transparent"),children:[S.jsx("div",{className:"container mx-auto px-4",children:S.jsxs("div",{className:"flex items-center justify-between h-16",children:[S.jsx(It,{to:"/",className:"flex items-center",children:S.jsx("span",{className:"text-red-600 font-bold text-2xl",children:"JELLYFIN"})}),S.jsxs("nav",{className:"hidden md:flex items-center space-x-6",children:[S.jsx(It,{to:"/",className:Be("text-sm font-medium hover:text-white transition-colors",d.pathname==="/"?"text-white":"text-gray-300"),children:"Home"}),S.jsx(It,{to:"/movies",className:Be("text-sm font-medium hover:text-white transition-colors",d.pathname==="/movies"?"text-white":"text-gray-300"),children:"Movies"}),S.jsx(It,{to:"/shows",className:Be("text-sm font-medium hover:text-white transition-colors",d.pathname==="/shows"?"text-white":"text-gray-300"),children:"TV Shows"}),S.jsx(It,{to:"/latest",className:Be("text-sm font-medium hover:text-white transition-colors",d.pathname==="/latest"?"text-white":"text-gray-300"),children:"New & Popular"})]}),S.jsxs("div",{className:"flex items-center space-x-4",children:[S.jsxs("div",{className:"relative",children:[S.jsx("button",{onClick:()=>l(!a),className:"p-2 text-gray-300 hover:text-white transition-colors","aria-label":"Search",children:S.jsx(nl,{size:20})}),a&&S.jsx("div",{className:"absolute right-0 top-12 w-64 bg-gray-900 rounded-md shadow-lg overflow-hidden",children:S.jsxs("form",{onSubmit:g,className:"flex items-center p-2",children:[S.jsx("input",{type:"text",placeholder:"Titles, people, genres",value:u,onChange:E=>c(E.target.value),className:"w-full bg-gray-800 text-white px-3 py-2 rounded-l-md focus:outline-none focus:ring-1 focus:ring-red-600",autoFocus:!0}),S.jsx("button",{type:"submit",className:"bg-red-600 text-white px-3 py-2 rounded-r-md",children:S.jsx(nl,{size:16})})]})})]}),n&&S.jsxs("div",{className:"relative",children:[S.jsxs("button",{onClick:()=>m(!h),className:"flex items-center gap-1 text-gray-300 hover:text-white transition-colors",children:[S.jsx("div",{className:"w-8 h-8 rounded-full bg-red-600 flex items-center justify-center text-white font-medium",children:y()}),S.jsx(KL,{size:16})]}),h&&S.jsxs("div",{className:"absolute right-0 top-12 w-48 bg-gray-900 rounded-md shadow-lg overflow-hidden z-50",children:[S.jsx("div",{className:"p-3 border-b border-gray-800",children:S.jsx("p",{className:"text-white font-medium",children:(v=t==null?void 0:t.User)==null?void 0:v.Name})}),S.jsxs("button",{onClick:p,className:"flex items-center gap-2 w-full p-3 text-left text-gray-300 hover:bg-gray-800 transition-colors",children:[S.jsx(bm,{size:16}),S.jsx("span",{children:"Sign Out"})]})]})]}),S.jsx("button",{className:"md:hidden p-2 text-gray-300 hover:text-white transition-colors",onClick:()=>o(!i),"aria-label":"Menu",children:i?S.jsx(c1,{size:20}):S.jsx(e1,{size:20})})]})]})}),i&&S.jsx("div",{className:"md:hidden bg-black/95 backdrop-blur-sm",children:S.jsxs("nav",{className:"container mx-auto px-4 py-3 flex flex-col space-y-3",children:[S.jsx(It,{to:"/",className:"flex items-center gap-2 text-gray-300 hover:text-white p-2",children:"Home"}),S.jsxs(It,{to:"/movies",className:"flex items-center gap-2 text-gray-300 hover:text-white p-2",children:[S.jsx(QL,{size:18}),S.jsx("span",{children:"Movies"})]}),S.jsxs(It,{to:"/tv",className:"flex items-center gap-2 text-gray-300 hover:text-white p-2",children:[S.jsx(o1,{size:18}),S.jsx("span",{children:"TV Shows"})]}),S.jsx(It,{to:"/latest",className:"flex items-center gap-2 text-gray-300 hover:text-white p-2",children:S.jsx("span",{children:"New & Popular"})}),n&&S.jsxs("button",{onClick:p,className:"flex items-center gap-2 text-gray-300 hover:text-white p-2 text-left",children:[S.jsx(bm,{size:18}),S.jsx("span",{children:"Sign Out"})]})]})})]})},d1=({item:n})=>{const{api:e}=mn(),[t,r]=D.useState(!1);if(!e||!n)return null;const s=n.BackdropImageTags&&n.BackdropImageTags.length>0,i=n.Name,o=n.Overview,a=n.ProductionYear,l=n.Genres||[];let u="";return s&&(u=e.getImageUrl(n.Id,"Backdrop",1920)),D.useEffect(()=>{r(!1)},[n.Id]),S.jsxs("div",{className:"relative w-full h-[70vh] overflow-hidden",children:[u?S.jsxs(S.Fragment,{children:[S.jsx("img",{src:u,alt:i,onLoad:()=>r(!0),className:Be("absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-1000",t?"opacity-100":"opacity-0")}),S.jsx("div",{className:Be("absolute inset-0 bg-gradient-to-t from-neutral-900 via-neutral-900/80 to-neutral-900/20","transition-opacity duration-1000",t?"opacity-100":"opacity-0")}),S.jsx("div",{className:Be("absolute inset-0 bg-gradient-to-r from-neutral-900 to-transparent","transition-opacity duration-1000",t?"opacity-100":"opacity-0")})]}):S.jsx("div",{className:"absolute inset-0 bg-neutral-900"}),S.jsx("div",{className:"absolute inset-0 flex items-end md:items-center p-8",children:S.jsx("div",{className:"container mx-auto",children:S.jsxs("div",{className:"max-w-2xl space-y-4",children:[S.jsx("h1",{className:Be("text-4xl md:text-6xl font-bold text-white transition-transform duration-700",t?"translate-y-0 opacity-100":"translate-y-8 opacity-0"),children:i}),S.jsxs("div",{className:Be("flex items-center gap-3 text-sm text-gray-300 transition-transform duration-700 delay-100",t?"translate-y-0 opacity-100":"translate-y-8 opacity-0"),children:[a&&S.jsx("span",{children:a}),l.length>0&&S.jsxs(S.Fragment,{children:[S.jsx("span",{className:"w-1 h-1 rounded-full bg-gray-500"}),S.jsx("span",{children:l.slice(0,3).join(", ")})]})]}),S.jsx("p",{className:Be("text-gray-300 line-clamp-3 md:line-clamp-4 transition-transform duration-700 delay-200",t?"translate-y-0 opacity-100":"translate-y-8 opacity-0"),children:o}),S.jsxs("div",{className:Be("flex items-center gap-4 transition-transform duration-700 delay-300",t?"translate-y-0 opacity-100":"translate-y-8 opacity-0"),children:[S.jsxs(It,{to:`/play/${n.Id}`,className:"flex items-center gap-2 px-6 py-3 bg-white text-black rounded font-medium hover:bg-red-600 hover:text-white transition-colors",children:[S.jsx(eo,{size:20,className:"ml-0"}),S.jsx("span",{children:"Play"})]}),S.jsxs(It,{to:`/details/${n.Id}`,className:"flex items-center gap-2 px-6 py-3 bg-gray-700/80 text-white rounded font-medium hover:bg-gray-600 transition-colors",children:[S.jsx(Jy,{size:20}),S.jsx("span",{children:"More Info"})]})]})]})})})]})},Ul=({item:n,featured:e=!1})=>{var v;const{api:t}=mn(),[r,s]=D.useState(!1);if(!t)return null;const i=(v=n.ImageTags)==null?void 0:v.Primary,o=n.BackdropImageTags&&n.BackdropImageTags.length>0,a=n.Type==="Episode",l=n.Type==="Movie",u=n.Type==="Series",c=a?n.ParentIndexNumber:void 0,d=a?n.IndexNumber:void 0,f=a?n.SeriesName:void 0;let h="";a&&n.SeriesId?h=t.getImageUrl(n.SeriesId,"Primary",e?400:200):u&&i||i?h=t.getImageUrl(n.Id,"Primary",e?400:200):o&&(h=t.getImageUrl(n.Id,"Backdrop",e?400:200));const m=n.ProductionYear,g=n.OfficialRating,p=n.Name;let y=0;return n.UserData&&n.UserData.PlaybackPositionTicks&&n.RunTimeTicks&&n.RunTimeTicks>0&&(y=Math.min(100,n.UserData.PlaybackPositionTicks/n.RunTimeTicks*100)),S.jsxs("button",{className:Be("group relative transition-all duration-300 overflow-hidden rounded-md bg-gray-900",e?"w-full aspect-[16/9]":"w-full aspect-[2/3]",r&&"z-10 scale-110 shadow-xl"),onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),children:[h?S.jsx("img",{src:h,alt:p,className:Be("w-full h-full object-cover transition-all duration-500",r&&"brightness-30")}):S.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-800",children:S.jsx("span",{className:"text-gray-400",children:p})}),y>0&&S.jsx("div",{className:"absolute left-0 right-0 bottom-0 h-1.5 bg-black/40 z-20",children:S.jsx("div",{className:"h-full bg-[var(--accent-secondary)] transition-all",style:{width:`${y}%`}})}),S.jsxs("div",{className:Be("absolute inset-0 flex flex-col justify-end p-3 text-start","bg-gradient-to-t from-black/90 to-transparent","opacity-0 group-hover:opacity-100 transition-opacity duration-300"),children:[(()=>{let E;return a?E=S.jsxs(S.Fragment,{children:[S.jsxs("span",{children:[p,c!==void 0&&d!==void 0&&S.jsxs("span",{className:"ml-2 text-xs text-gray-300",children:["S",c,"E",d]})]}),f&&S.jsx("div",{className:"text-xs text-gray-400 truncate",children:f})]}):u?E=S.jsx(S.Fragment,{children:p}):E=p,S.jsx("h3",{className:"text-white font-medium truncate",children:E})})(),S.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-300 mt-1",children:[m&&S.jsx("span",{children:m}),g&&S.jsx("span",{className:"border border-gray-500 px-1",children:g}),(l||a)&&n.RunTimeTicks&&S.jsxs("span",{className:"bg-gray-800 px-1 rounded text-[10px] uppercase tracking-wide",children:[Math.floor(n.RunTimeTicks/6e8)," min"]})]}),S.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[S.jsx(It,{to:`/play/${n.Id}`,className:"flex items-center justify-center bg-white text-black rounded-full w-8 h-8 hover:bg-red-600 hover:text-white transition-colors",children:S.jsx(eo,{size:16,className:"ml-0.5"})}),S.jsx(It,{to:`/details/${n.Id}`,className:"flex items-center justify-center bg-gray-700 text-white rounded-full w-8 h-8 hover:bg-white hover:text-black transition-colors",children:S.jsx(Jy,{size:16})})]})]})]})},ui=({title:n,items:e,isLoading:t=!1})=>{const r=D.useRef(null),[s,i]=D.useState(!1),[o,a]=D.useState(!0),[l,u]=D.useState(!1),c=()=>{if(!r.current)return;const{scrollLeft:f,scrollWidth:h,clientWidth:m}=r.current,g=h-m;i(f>10),a(f<g-10)},d=f=>{if(!r.current)return;u(!0);const{clientWidth:h}=r.current,m=h*.9,g=f==="left"?r.current.scrollLeft-m:r.current.scrollLeft+m;r.current.scrollTo({left:g,behavior:"smooth"}),setTimeout(()=>{u(!1),c()},500)};return t?S.jsxs("div",{className:"mb-8",children:[S.jsx("h2",{className:"text-xl font-medium text-white mb-2",children:n}),S.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:Array.from({length:6}).map((f,h)=>S.jsx("div",{className:"w-full aspect-[2/3] bg-gray-800 animate-pulse rounded-md"},h))})]}):e.length===0?null:S.jsxs("div",{className:"mb-8 group/row",children:[S.jsx("h2",{className:"text-xl font-medium text-white mb-2",children:n}),S.jsxs("div",{className:"relative",children:[S.jsx("div",{ref:r,className:"flex overflow-x-scroll scrollbar-hide gap-2 pb-4",onScroll:c,children:e.map(f=>S.jsx("div",{className:"flex-none w-[160px] sm:w-[180px] md:w-[200px] transition-transform",children:S.jsx(Ul,{item:f})},f.Id))}),S.jsx("button",{onClick:()=>d("left"),className:Be("absolute top-1/2 left-0 -translate-y-1/2 -ml-4 z-20","w-12 h-12 rounded-full bg-black/50 text-white flex items-center justify-center","transition-opacity backdrop-blur-sm hover:bg-black/80","opacity-0",s&&!l&&"group-hover/row:opacity-100"),"aria-label":"Scroll left",children:S.jsx(zL,{})}),S.jsx("button",{onClick:()=>d("right"),className:Be("absolute top-1/2 right-0 -translate-y-1/2 -mr-4 z-20","w-12 h-12 rounded-full bg-black/50 text-white flex items-center justify-center","transition-opacity backdrop-blur-sm hover:bg-black/80","opacity-0",o&&!l&&"group-hover/row:opacity-100"),"aria-label":"Scroll right",children:S.jsx(WL,{})})]})]})},lr=(n,e)=>{const{api:t,isAuthenticated:r}=mn(),[s,i]=D.useState([]),[o,a]=D.useState(!0),[l,u]=D.useState(null),[c,d]=D.useState(0);return D.useEffect(()=>{if(!t||!r){a(!1);return}(async()=>{a(!0),u(null);try{let h;const m=(e==null?void 0:e.limit)??20,g=(e==null?void 0:e.startIndex)??0;switch(n){case"resume":h=await t.getResumeItems(m),i(h),d(h.length);break;case"nextup":h=await t.getNextUpItems(m),i(h),d(h.length);break;case"latest":h=await t.getLatestMedia("",m),i(h),d(h.length);break;case"recommended":h=await t.getRecommended(m),i(h),d(h.length);break;case"movies":h=await t.getMediaByType("Movie",m,g),i(h.Items),d(h.TotalRecordCount);break;case"series":h=await t.getMediaByType("Series",m,g),i(h.Items),d(h.TotalRecordCount);break;case"genre":if(!(e!=null&&e.genreId))throw new Error("Genre ID is required for genre type");h=await t.getMediaByGenre(e.genreId,"",m),i(h.Items),d(h.TotalRecordCount);break;default:throw new Error("Invalid media type")}}catch(h){u(h instanceof Error?h:new Error("An unknown error occurred")),console.error("Error fetching media data:",h)}finally{a(!1)}})()},[t,r,n,e==null?void 0:e.limit,e==null?void 0:e.genreId,e==null?void 0:e.startIndex]),{items:s,isLoading:o,error:l,totalItems:c}},ev=n=>{const{api:e,isAuthenticated:t}=mn(),[r,s]=D.useState(null),[i,o]=D.useState(!0),[a,l]=D.useState(null);return D.useEffect(()=>{if(!e||!t||!n){o(!1);return}(async()=>{o(!0),l(null);try{const c=await e.getMediaItem(n);s(c)}catch(c){l(c instanceof Error?c:new Error("An unknown error occurred")),console.error("Error fetching media item:",c)}finally{o(!1)}})()},[e,t,n]),{item:r,isLoading:i,error:a}},f1=(n,e=20)=>{const{api:t,isAuthenticated:r}=mn(),[s,i]=D.useState([]),[o,a]=D.useState(!1),[l,u]=D.useState(null),[c,d]=D.useState(0);return D.useEffect(()=>{if(!t||!r||!n.trim()){i([]),d(0);return}const f=async()=>{a(!0),u(null);try{const m=await t.search(n,e);i(m.Items),d(m.TotalRecordCount)}catch(m){u(m instanceof Error?m:new Error("An unknown error occurred")),console.error("Error searching:",m)}finally{a(!1)}},h=setTimeout(()=>{f()},500);return()=>clearTimeout(h)},[t,r,n,e]),{results:s,isLoading:o,error:l,totalResults:c}},Pm=()=>{const[n,e]=D.useState(null),{items:t,isLoading:r}=lr("resume",{limit:20}),{items:s,isLoading:i}=lr("nextup",{limit:20}),{items:o,isLoading:a}=lr("latest",{limit:20});lr("recommended",{limit:20});const{items:l,isLoading:u}=lr("movies",{limit:20}),{items:c,isLoading:d}=lr("series",{limit:20});return D.useEffect(()=>{if(o.length>0){const f=o.find(h=>h.BackdropImageTags&&h.BackdropImageTags.length>0);e(f||o[0])}else if(l.length>0){const f=l.find(h=>h.BackdropImageTags&&h.BackdropImageTags.length>0);e(f||l[0])}},[o,l]),S.jsxs("div",{className:"min-h-screen bg-neutral-900 text-white",children:[S.jsx(zr,{}),n?S.jsx(d1,{item:n}):S.jsx("div",{className:"w-full h-[70vh] bg-neutral-800 animate-pulse"}),S.jsxs("div",{className:"container mx-auto px-4 -mt-16 relative z-10",children:[S.jsx(ui,{title:"Continue Watching",items:t,isLoading:r}),S.jsx(ui,{title:"Next Up",items:s,isLoading:i}),S.jsx(ui,{title:"Latest Additions",items:o,isLoading:a}),S.jsx(ui,{title:"Movies",items:l,isLoading:u}),S.jsx(ui,{title:"TV Shows",items:c,isLoading:d})]})]})},h1=()=>{const{login:n,isLoading:e}=mn(),t=go(),[r,s]=D.useState(""),[i,o]=D.useState(""),[a,l]=D.useState(null),[u,c]=D.useState(localStorage.getItem("jellyfin_server_url")??""),d=async f=>{if(f.preventDefault(),!u){l("Please enter a Jellyfin server URL");return}localStorage.setItem("jellyfin_server_url",u);try{l(null),await n({username:r,password:i}),t("/")}catch(h){l("Invalid username or password. Please try again."),console.error("Login error:",h)}};return S.jsx("div",{className:"min-h-screen w-full bg-black flex flex-col items-center justify-center text-white p-4",style:{backgroundImage:'linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url("https://images.pexels.com/photos/7991579/pexels-photo-7991579.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=750&w=1260")',backgroundSize:"cover",backgroundPosition:"center"},children:S.jsxs("div",{className:"w-full max-w-md",children:[S.jsxs("div",{className:"mb-10 text-center",children:[S.jsx("h1",{className:"text-red-600 font-bold text-4xl mb-2",children:"JELLYFLIX"}),S.jsx("p",{className:"text-gray-400",children:"Sign in to your Jellyfin account"})]}),S.jsxs("div",{className:"bg-black/80 rounded-md p-8 backdrop-blur-sm",children:[a&&S.jsxs("div",{className:"mb-6 p-3 bg-red-900/50 border border-red-700 rounded flex items-start gap-2 text-red-100",children:[S.jsx(jL,{size:20,className:"flex-shrink-0 mt-0.5"}),S.jsx("p",{children:a})]}),S.jsxs("form",{onSubmit:d,className:"space-y-6",children:[S.jsxs("div",{className:"space-y-4",children:[S.jsxs("div",{children:[S.jsx("label",{htmlFor:"serverUrl",className:"block text-sm font-medium text-gray-400 mb-1",children:"Jellyfin Server URL"}),S.jsx("div",{className:"relative",children:S.jsx("input",{id:"serverUrl",type:"url",placeholder:"https://your-jellyfin-server.com",value:u,onChange:f=>c(f.target.value),className:"w-full bg-gray-700 border border-gray-600 rounded px-4 py-3 focus:outline-none focus:ring-2 focus:ring-red-600 focus:border-transparent",required:!0})}),S.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Enter the full URL including http:// or https://"})]}),S.jsxs("div",{children:[S.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-400 mb-1",children:"Username"}),S.jsxs("div",{className:"relative",children:[S.jsx("span",{className:"absolute left-3 top-3 text-gray-400",children:S.jsx(VL,{size:18})}),S.jsx("input",{id:"username",type:"text",placeholder:"Username",value:r,onChange:f=>s(f.target.value),className:"w-full bg-gray-700 border border-gray-600 rounded pl-10 pr-4 py-3 focus:outline-none focus:ring-2 focus:ring-red-600 focus:border-transparent",required:!0})]})]}),S.jsxs("div",{children:[S.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-400 mb-1",children:"Password"}),S.jsxs("div",{className:"relative",children:[S.jsx("span",{className:"absolute left-3 top-3 text-gray-400",children:S.jsx(JL,{size:18})}),S.jsx("input",{id:"password",type:"password",placeholder:"Password",value:i,onChange:f=>o(f.target.value),className:"w-full bg-gray-700 border border-gray-600 rounded pl-10 pr-4 py-3 focus:outline-none focus:ring-2 focus:ring-red-600 focus:border-transparent",required:!0})]})]})]}),S.jsx("button",{type:"submit",disabled:e,className:"w-full bg-red-600 hover:bg-red-700 text-white font-medium py-3 rounded transition-colors focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 focus:ring-offset-gray-900 disabled:opacity-70",children:e?"Signing In...":"Sign In"})]})]}),S.jsxs("p",{className:"mt-6 text-center text-sm text-gray-500",children:["Don't have a Jellyfin server? Set up your own personal media server at"," ",S.jsx("a",{href:"https://jellyfin.org/",target:"_blank",rel:"noopener noreferrer",className:"text-red-600 hover:underline",children:"jellyfin.org"})]})]})})},m1=()=>{const{itemId:n}=Ty(),{item:e,isLoading:t,error:r}=ev(n),{api:s}=mn(),[i,o]=D.useState(!1);if(D.useEffect(()=>{o(!1)},[n]),t)return S.jsxs("div",{className:"min-h-screen bg-neutral-900 text-white",children:[S.jsx(zr,{}),S.jsx("div",{className:"pt-16 flex items-center justify-center h-screen",children:S.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-600"})})]});if(r||!e||!s)return S.jsxs("div",{className:"min-h-screen bg-neutral-900 text-white",children:[S.jsx(zr,{}),S.jsx("div",{className:"pt-16 container mx-auto px-4 py-12",children:S.jsxs("div",{className:"bg-gray-800 p-6 rounded-lg text-center",children:[S.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Error"}),S.jsx("p",{children:"Failed to load media details. Please try again later."})]})})]});const a=e.BackdropImageTags&&e.BackdropImageTags.length>0,l=e.ImageTags&&e.ImageTags.Primary;let u="",c="";a&&(u=s.getImageUrl(e.Id,"Backdrop",1920)),l&&(c=s.getImageUrl(e.Id,"Primary",400));const d=f=>{if(!f)return"";const h=Math.floor(f/(1e4*1e3*60)),m=Math.floor(h/60),g=h%60;return m>0?`${m}h ${g}m`:`${g}m`};return S.jsxs("div",{className:"min-h-screen bg-neutral-900 text-white",children:[S.jsx(zr,{}),S.jsxs("div",{className:"relative w-full min-h-[80vh]",children:[u&&S.jsxs(S.Fragment,{children:[S.jsx("img",{src:u,alt:e.Name,onLoad:()=>o(!0),className:`absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-1000 ${i?"opacity-30":"opacity-0"}`}),S.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-neutral-900 via-neutral-900/70 to-neutral-900/30"}),S.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-neutral-900 to-transparent"})]}),S.jsx("div",{className:"absolute inset-0 flex items-center",children:S.jsx("div",{className:"container mx-auto px-4 pt-16",children:S.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[S.jsx("div",{className:"md:flex-shrink-0",children:c?S.jsx("img",{src:c,alt:e.Name,className:"w-full md:w-64 lg:w-72 rounded-md shadow-lg"}):S.jsx("div",{className:"w-full md:w-64 lg:w-72 aspect-[2/3] bg-gray-800 rounded-md flex items-center justify-center",children:S.jsx("span",{className:"text-gray-500",children:e.Name})})}),S.jsxs("div",{className:"flex-1 space-y-4",children:[S.jsx("h1",{className:"text-3xl md:text-4xl lg:text-5xl font-bold",children:e.Name}),S.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm text-gray-300",children:[e.ProductionYear&&S.jsxs("div",{className:"flex items-center gap-1",children:[S.jsx(HL,{size:16}),S.jsx("span",{children:e.ProductionYear})]}),e.RunTimeTicks&&S.jsxs("div",{className:"flex items-center gap-1",children:[S.jsx(XL,{size:16}),S.jsx("span",{children:d(e.RunTimeTicks)})]}),e.OfficialRating&&S.jsx("span",{className:"px-1.5 py-0.5 bg-gray-800 text-gray-300 text-xs rounded",children:e.OfficialRating}),e.CommunityRating&&S.jsxs("div",{className:"flex items-center gap-1",children:[S.jsx(i1,{size:16,className:"text-yellow-500 fill-yellow-500"}),S.jsx("span",{children:e.CommunityRating.toFixed(1)})]})]}),e.Genres&&e.Genres.length>0&&S.jsx("div",{className:"flex flex-wrap gap-2",children:e.Genres.map((f,h)=>S.jsx("span",{className:"px-2 py-1 bg-gray-800 text-gray-300 text-xs rounded",children:f},h))}),S.jsx("p",{className:"text-gray-300 max-w-3xl",children:e.Overview||"No overview available."}),S.jsx("div",{className:"flex items-center gap-4 pt-2",children:S.jsxs(It,{to:`/play/${e.Id}`,className:"flex items-center gap-2 px-6 py-3 bg-red-600 text-white rounded font-medium hover:bg-red-700 transition-colors",children:[S.jsx(eo,{size:20}),S.jsx("span",{children:"Play"})]})})]})]})})})]})]})},K=Number.isFinite||function(n){return typeof n=="number"&&isFinite(n)},g1=Number.isSafeInteger||function(n){return typeof n=="number"&&Math.abs(n)<=p1},p1=Number.MAX_SAFE_INTEGER||9007199254740991;let te=function(n){return n.NETWORK_ERROR="networkError",n.MEDIA_ERROR="mediaError",n.KEY_SYSTEM_ERROR="keySystemError",n.MUX_ERROR="muxError",n.OTHER_ERROR="otherError",n}({}),b=function(n){return n.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",n.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",n.KEY_SYSTEM_NO_SESSION="keySystemNoSession",n.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",n.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",n.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",n.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",n.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",n.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",n.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",n.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",n.MANIFEST_LOAD_ERROR="manifestLoadError",n.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",n.MANIFEST_PARSING_ERROR="manifestParsingError",n.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",n.LEVEL_EMPTY_ERROR="levelEmptyError",n.LEVEL_LOAD_ERROR="levelLoadError",n.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",n.LEVEL_PARSING_ERROR="levelParsingError",n.LEVEL_SWITCH_ERROR="levelSwitchError",n.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",n.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",n.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",n.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",n.FRAG_LOAD_ERROR="fragLoadError",n.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",n.FRAG_DECRYPT_ERROR="fragDecryptError",n.FRAG_PARSING_ERROR="fragParsingError",n.FRAG_GAP="fragGap",n.REMUX_ALLOC_ERROR="remuxAllocError",n.KEY_LOAD_ERROR="keyLoadError",n.KEY_LOAD_TIMEOUT="keyLoadTimeOut",n.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",n.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",n.BUFFER_APPEND_ERROR="bufferAppendError",n.BUFFER_APPENDING_ERROR="bufferAppendingError",n.BUFFER_STALLED_ERROR="bufferStalledError",n.BUFFER_FULL_ERROR="bufferFullError",n.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",n.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",n.ASSET_LIST_LOAD_ERROR="assetListLoadError",n.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",n.ASSET_LIST_PARSING_ERROR="assetListParsingError",n.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",n.INTERNAL_EXCEPTION="internalException",n.INTERNAL_ABORTED="aborted",n.ATTACH_MEDIA_ERROR="attachMediaError",n.UNKNOWN="unknown",n}({}),x=function(n){return n.MEDIA_ATTACHING="hlsMediaAttaching",n.MEDIA_ATTACHED="hlsMediaAttached",n.MEDIA_DETACHING="hlsMediaDetaching",n.MEDIA_DETACHED="hlsMediaDetached",n.MEDIA_ENDED="hlsMediaEnded",n.STALL_RESOLVED="hlsStallResolved",n.BUFFER_RESET="hlsBufferReset",n.BUFFER_CODECS="hlsBufferCodecs",n.BUFFER_CREATED="hlsBufferCreated",n.BUFFER_APPENDING="hlsBufferAppending",n.BUFFER_APPENDED="hlsBufferAppended",n.BUFFER_EOS="hlsBufferEos",n.BUFFERED_TO_END="hlsBufferedToEnd",n.BUFFER_FLUSHING="hlsBufferFlushing",n.BUFFER_FLUSHED="hlsBufferFlushed",n.MANIFEST_LOADING="hlsManifestLoading",n.MANIFEST_LOADED="hlsManifestLoaded",n.MANIFEST_PARSED="hlsManifestParsed",n.LEVEL_SWITCHING="hlsLevelSwitching",n.LEVEL_SWITCHED="hlsLevelSwitched",n.LEVEL_LOADING="hlsLevelLoading",n.LEVEL_LOADED="hlsLevelLoaded",n.LEVEL_UPDATED="hlsLevelUpdated",n.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",n.LEVELS_UPDATED="hlsLevelsUpdated",n.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",n.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",n.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",n.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",n.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",n.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",n.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",n.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",n.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",n.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",n.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",n.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",n.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",n.CUES_PARSED="hlsCuesParsed",n.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",n.INIT_PTS_FOUND="hlsInitPtsFound",n.FRAG_LOADING="hlsFragLoading",n.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",n.FRAG_LOADED="hlsFragLoaded",n.FRAG_DECRYPTED="hlsFragDecrypted",n.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",n.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",n.FRAG_PARSING_METADATA="hlsFragParsingMetadata",n.FRAG_PARSED="hlsFragParsed",n.FRAG_BUFFERED="hlsFragBuffered",n.FRAG_CHANGED="hlsFragChanged",n.FPS_DROP="hlsFpsDrop",n.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",n.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",n.ERROR="hlsError",n.DESTROYING="hlsDestroying",n.KEY_LOADING="hlsKeyLoading",n.KEY_LOADED="hlsKeyLoaded",n.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",n.BACK_BUFFER_REACHED="hlsBackBufferReached",n.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",n.ASSET_LIST_LOADING="hlsAssetListLoading",n.ASSET_LIST_LOADED="hlsAssetListLoaded",n.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",n.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",n.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",n.INTERSTITIAL_STARTED="hlsInterstitialStarted",n.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",n.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",n.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",n.INTERSTITIAL_ENDED="hlsInterstitialEnded",n.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",n.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",n.EVENT_CUE_ENTER="hlsEventCueEnter",n}({});var he={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},Z={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class ls{constructor(e,t=0,r=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}sample(e,t){const r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class y1{constructor(e,t,r,s=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new ls(e),this.fast_=new ls(t),this.defaultTTFB_=s,this.ttfb_=new ls(e)}update(e,t){const{slow_:r,fast_:s,ttfb_:i}=this;r.halfLife!==e&&(this.slow_=new ls(e,r.getEstimate(),r.getTotalWeight())),s.halfLife!==t&&(this.fast_=new ls(t,s.getEstimate(),s.getTotalWeight())),i.halfLife!==e&&(this.ttfb_=new ls(e,i.getEstimate(),i.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const r=8*t,s=e/1e3,i=r/s;this.fast_.sample(s,i),this.slow_.sample(s,i)}sampleTTFB(e){const t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function v1(n,e,t){return(e=x1(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Le(){return Le=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Le.apply(null,arguments)}function Om(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function Ee(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Om(Object(t),!0).forEach(function(r){v1(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Om(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function E1(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function x1(n){var e=E1(n,"string");return typeof e=="symbol"?e:e+""}class Zn{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const r=`[${e}]:`;this.trace=ur,this.debug=t.debug.bind(null,r),this.log=t.log.bind(null,r),this.warn=t.warn.bind(null,r),this.info=t.info.bind(null,r),this.error=t.error.bind(null,r)}}const ur=function(){},S1={trace:ur,debug:ur,log:ur,warn:ur,info:ur,error:ur};function Jc(){return Le({},S1)}function T1(n,e){const t=self.console[n];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${n}] >`):ur}function Nm(n,e,t){return e[n]?e[n].bind(e):T1(n,t)}const Zc=Jc();function A1(n,e,t){const r=Jc();if(typeof console=="object"&&n===!0||typeof n=="object"){const s=["debug","log","info","warn","error"];s.forEach(i=>{r[i]=Nm(i,n,t)});try{r.log(`Debug logs enabled for "${e}" in hls.js version 1.6.2`)}catch{return Jc()}s.forEach(i=>{Zc[i]=Nm(i,n)})}else Le(Zc,r);return r}const pe=Zc;function _r(n=!0){return typeof self>"u"?void 0:(n||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function L1(n){return typeof self<"u"&&n===self.ManagedMediaSource}function tv(n,e){const t=Object.keys(n),r=Object.keys(e),s=t.length,i=r.length;return!s||!i||s===i&&!t.some(o=>r.indexOf(o)===-1)}function Bt(n,e=!1){if(typeof TextDecoder<"u"){const u=new TextDecoder("utf-8").decode(n);if(e){const c=u.indexOf("\0");return c!==-1?u.substring(0,c):u}return u.replace(/\0/g,"")}const t=n.length;let r,s,i,o="",a=0;for(;a<t;){if(r=n[a++],r===0&&e)return o;if(r===0||r===3)continue;switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(r);break;case 12:case 13:s=n[a++],o+=String.fromCharCode((r&31)<<6|s&63);break;case 14:s=n[a++],i=n[a++],o+=String.fromCharCode((r&15)<<12|(s&63)<<6|(i&63)<<0);break}}return o}const Ln={hexDump:function(n){let e="";for(let t=0;t<n.length;t++){let r=n[t].toString(16);r.length<2&&(r="0"+r),e+=r}return e}};function I1(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Tu={exports:{}},Mm;function R1(){return Mm||(Mm=1,function(n,e){(function(t){var r=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,s=/^(?=([^\/?#]*))\1([^]*)$/,i=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(l,u,c){if(c=c||{},l=l.trim(),u=u.trim(),!u){if(!c.alwaysNormalize)return l;var d=a.parseURL(l);if(!d)throw new Error("Error trying to parse base URL.");return d.path=a.normalizePath(d.path),a.buildURLFromParts(d)}var f=a.parseURL(u);if(!f)throw new Error("Error trying to parse relative URL.");if(f.scheme)return c.alwaysNormalize?(f.path=a.normalizePath(f.path),a.buildURLFromParts(f)):u;var h=a.parseURL(l);if(!h)throw new Error("Error trying to parse base URL.");if(!h.netLoc&&h.path&&h.path[0]!=="/"){var m=s.exec(h.path);h.netLoc=m[1],h.path=m[2]}h.netLoc&&!h.path&&(h.path="/");var g={scheme:h.scheme,netLoc:f.netLoc,path:null,params:f.params,query:f.query,fragment:f.fragment};if(!f.netLoc&&(g.netLoc=h.netLoc,f.path[0]!=="/"))if(!f.path)g.path=h.path,f.params||(g.params=h.params,f.query||(g.query=h.query));else{var p=h.path,y=p.substring(0,p.lastIndexOf("/")+1)+f.path;g.path=a.normalizePath(y)}return g.path===null&&(g.path=c.alwaysNormalize?a.normalizePath(f.path):f.path),a.buildURLFromParts(g)},parseURL:function(l){var u=r.exec(l);return u?{scheme:u[1]||"",netLoc:u[2]||"",path:u[3]||"",params:u[4]||"",query:u[5]||"",fragment:u[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(i,"");l.length!==(l=l.replace(o,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};n.exports=a})()}(Tu)),Tu.exports}var Sf=R1();class Tf{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Te={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class nv{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,w1(this,"stats")}setByteRange(e,t){const r=e.split("@",2);let s;r.length===1?s=(t==null?void 0:t.byteRangeEndOffset)||0:s=parseInt(r[1]),this._byteRange=[s,parseInt(r[0])+s]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[Te.AUDIO]:null,[Te.VIDEO]:null,[Te.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new Tf),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Sf.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[Te.AUDIO]=null,e[Te.VIDEO]=null,e[Te.AUDIOVIDEO]=null}}function Ze(n){return n.sn!=="initSegment"}class Au extends nv{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange){const e=this.byteRange[0],t=this.byteRange[1];if(K(e)&&K(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{const r=Object.keys(this.levelkeys);if(r.length===1)return this._decryptdata=this.levelkeys[r[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=K(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){const t=Object.keys(this.levelkeys),r=t.length;if(r>1||r===1&&this.levelkeys[t[0]].encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!K(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return Ze(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,r,s,i,o=!1){const{elementaryStreams:a}=this,l=a[e];if(!l){a[e]={startPTS:t,endPTS:r,startDTS:s,endDTS:i,partial:o};return}l.startPTS=Math.min(l.startPTS,t),l.endPTS=Math.max(l.endPTS,r),l.startDTS=Math.min(l.startDTS,s),l.endDTS=Math.max(l.endDTS,i)}}class _1 extends nv{constructor(e,t,r,s,i){super(r),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=s;const o=e.enumeratedString("BYTERANGE");o&&this.setByteRange(o,i),i&&(this.fragOffset=i.fragOffset+i.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function rv(n,e){const t=Object.getPrototypeOf(n);if(t){const r=Object.getOwnPropertyDescriptor(t,e);return r||rv(t,e)}}function w1(n,e){const t=rv(n,e);t&&(t.enumerable=!0,Object.defineProperty(n,e,t))}const rl=Math.pow(2,32)-1,k1=[].push,sv={video:1,audio:2,id3:3,text:4};function Ke(n){return String.fromCharCode.apply(null,n)}function iv(n,e){const t=n[e]<<8|n[e+1];return t<0?65536+t:t}function oe(n,e){const t=ov(n,e);return t<0?4294967296+t:t}function Fm(n,e){let t=oe(n,e);return t*=Math.pow(2,32),t+=oe(n,e+4),t}function ov(n,e){return n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3]}function Lu(n,e,t){n[e]=t>>24,n[e+1]=t>>16&255,n[e+2]=t>>8&255,n[e+3]=t&255}function C1(n){const e=n.byteLength;for(let t=0;t<e;){const r=oe(n,t);if(r>8&&n[t+4]===109&&n[t+5]===111&&n[t+6]===111&&n[t+7]===102)return!0;t=r>1?t+r:e}return!1}function le(n,e){const t=[];if(!e.length)return t;const r=n.byteLength;for(let s=0;s<r;){const i=oe(n,s),o=Ke(n.subarray(s+4,s+8)),a=i>1?s+i:r;if(o===e[0])if(e.length===1)t.push(n.subarray(s+8,a));else{const l=le(n.subarray(s+8,a),e.slice(1));l.length&&k1.apply(t,l)}s=a}return t}function b1(n){const e=[],t=n[0];let r=8;const s=oe(n,r);r+=4;let i=0,o=0;t===0?(i=oe(n,r),o=oe(n,r+4),r+=8):(i=Fm(n,r),o=Fm(n,r+8),r+=16),r+=2;let a=n.length+o;const l=iv(n,r);r+=2;for(let u=0;u<l;u++){let c=r;const d=oe(n,c);c+=4;const f=d&2147483647;if((d&2147483648)>>>31===1)return pe.warn("SIDX has hierarchical references (not supported)"),null;const m=oe(n,c);c+=4,e.push({referenceSize:f,subsegmentDuration:m,info:{duration:m/s,start:a,end:a+f-1}}),a+=f,c+=4,r=c}return{earliestPresentationTime:i,timescale:s,version:t,referencesCount:l,references:e}}function av(n){const e=[],t=le(n,["moov","trak"]);for(let s=0;s<t.length;s++){const i=t[s],o=le(i,["tkhd"])[0];if(o){let a=o[0];const l=oe(o,a===0?12:20),u=le(i,["mdia","mdhd"])[0];if(u){a=u[0];const c=oe(u,a===0?12:20),d=le(i,["mdia","hdlr"])[0];if(d){const f=Ke(d.subarray(8,12)),h={soun:Te.AUDIO,vide:Te.VIDEO}[f],m=le(i,["mdia","minf","stbl","stsd"])[0],g=D1(m);h?(e[l]={timescale:c,type:h,stsd:g},e[h]=Ee({timescale:c,id:l},g)):e[l]={timescale:c,type:f,stsd:g}}}}}return le(n,["moov","mvex","trex"]).forEach(s=>{const i=oe(s,4),o=e[i];o&&(o.default={duration:oe(s,12),flags:oe(s,20)})}),e}function D1(n){const e=n.subarray(8),t=e.subarray(86),r=Ke(e.subarray(4,8));let s=r,i;const o=r==="enca"||r==="encv";if(o){const u=le(e,[r])[0].subarray(r==="enca"?28:78);le(u,["sinf"]).forEach(d=>{const f=le(d,["schm"])[0];if(f){const h=Ke(f.subarray(4,8));if(h==="cbcs"||h==="cenc"){const m=le(d,["frma"])[0];m&&(s=Ke(m))}}})}const a=s;switch(s){case"avc1":case"avc2":case"avc3":case"avc4":{const l=le(t,["avcC"])[0];l&&l.length>3&&(s+="."+Go(l[1])+Go(l[2])+Go(l[3]),i=jo(a==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const l=le(e,[r])[0],u=le(l.subarray(28),["esds"])[0];if(u&&u.length>7){let c=4;if(u[c++]!==3)break;c=Iu(u,c),c+=2;const d=u[c++];if(d&128&&(c+=2),d&64&&(c+=u[c++]),u[c++]!==4)break;c=Iu(u,c);const f=u[c++];if(f===64)s+="."+Go(f);else break;if(c+=12,u[c++]!==5)break;c=Iu(u,c);const h=u[c++];let m=(h&248)>>3;m===31&&(m+=1+((h&7)<<3)+((u[c]&224)>>5)),s+="."+m}break}case"hvc1":case"hev1":{const l=le(t,["hvcC"])[0];if(l&&l.length>12){const u=l[1],c=["","A","B","C"][u>>6],d=u&31,f=oe(l,2),h=(u&32)>>5?"H":"L",m=l[12],g=l.subarray(6,12);s+="."+c+d,s+="."+f.toString(16).toUpperCase(),s+="."+h+m;let p="";for(let y=g.length;y--;){const v=g[y];(v||p)&&(p="."+v.toString(16).toUpperCase()+p)}s+=p}i=jo(a=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{s=jo(s,t)||s;break}case"vp09":{const l=le(t,["vpcC"])[0];if(l&&l.length>6){const u=l[4],c=l[5],d=l[6]>>4&15;s+="."+An(u)+"."+An(c)+"."+An(d)}break}case"av01":{const l=le(t,["av1C"])[0];if(l&&l.length>2){const u=l[1]>>>5,c=l[1]&31,d=l[2]>>>7?"H":"M",f=(l[2]&64)>>6,h=(l[2]&32)>>5,m=u===2&&f?h?12:10:f?10:8,g=(l[2]&16)>>4,p=(l[2]&8)>>3,y=(l[2]&4)>>2,v=l[2]&3;s+="."+u+"."+An(c)+d+"."+An(m)+"."+g+"."+p+y+v+"."+An(1)+"."+An(1)+"."+An(1)+"."+0,i=jo("dav1",t)}break}}return{codec:s,encrypted:o,supplemental:i}}function jo(n,e){const t=le(e,["dvvC"]),r=t.length?t[0]:le(e,["dvcC"])[0];if(r){const s=r[2]>>1&127,i=r[2]<<5&32|r[3]>>3&31;return n+"."+An(s)+"."+An(i)}}function Iu(n,e){const t=e+5;for(;n[e++]&128&&e<t;);return e}function Go(n){return("0"+n.toString(16).toUpperCase()).slice(-2)}function An(n){return(n<10?"0":"")+n}function P1(n,e){if(!n||!e)return n;const t=e.keyId;return t&&e.isCommonEncryption&&le(n,["moov","trak"]).forEach(s=>{const o=le(s,["mdia","minf","stbl","stsd"])[0].subarray(8);let a=le(o,["enca"]);const l=a.length>0;l||(a=le(o,["encv"])),a.forEach(u=>{const c=l?u.subarray(28):u.subarray(78);le(c,["sinf"]).forEach(f=>{const h=lv(f);if(h){const m=h.subarray(8,24);m.some(g=>g!==0)||(pe.log(`[eme] Patching keyId in 'enc${l?"a":"v"}>sinf>>tenc' box: ${Ln.hexDump(m)} -> ${Ln.hexDump(t)}`),h.set(t,8))}})})}),n}function lv(n){const e=le(n,["schm"])[0];if(e){const t=Ke(e.subarray(4,8));if(t==="cbcs"||t==="cenc")return le(n,["schi","tenc"])[0]}return null}function O1(n,e){return le(e,["moof","traf"]).reduce((t,r)=>{const s=le(r,["tfdt"])[0],i=s[0],o=le(r,["tfhd"]).reduce((a,l)=>{const u=oe(l,4),c=n[u];if(c){let d=oe(s,4);if(i===1){if(d===rl)return pe.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),a;d*=rl+1,d+=oe(s,8)}const f=c.timescale||9e4,h=d/f;if(K(h)&&(a===null||h<a))return h}return a},null);return o!==null&&K(o)&&(t===null||o<t)?o:t},null)}function N1(n,e){let t=0,r=0,s=0;const i=le(n,["moof","traf"]);for(let o=0;o<i.length;o++){const a=i[o],l=le(a,["tfhd"])[0],u=oe(l,4),c=e[u];if(!c)continue;const d=c.default,f=oe(l,0)|(d==null?void 0:d.flags);let h=d==null?void 0:d.duration;f&8&&(f&2?h=oe(l,12):h=oe(l,8));const m=c.timescale||9e4,g=le(a,["trun"]);for(let p=0;p<g.length;p++){if(t=M1(g[p]),!t&&h){const y=oe(g[p],4);t=h*y}c.type===Te.VIDEO?r+=t/m:c.type===Te.AUDIO&&(s+=t/m)}}if(r===0&&s===0){let o=1/0,a=0,l=0;const u=le(n,["sidx"]);for(let c=0;c<u.length;c++){const d=b1(u[c]);if(d!=null&&d.references){o=Math.min(o,d.earliestPresentationTime/d.timescale);const f=d.references.reduce((h,m)=>h+m.info.duration||0,0);a=Math.max(a,f+d.earliestPresentationTime/d.timescale),l=a-o}}if(l&&K(l))return l}return r||s}function M1(n){const e=oe(n,0);let t=8;e&1&&(t+=4),e&4&&(t+=4);let r=0;const s=oe(n,4);for(let i=0;i<s;i++){if(e&256){const o=oe(n,t);r+=o,t+=4}e&512&&(t+=4),e&1024&&(t+=4),e&2048&&(t+=4)}return r}function F1(n,e,t){le(e,["moof","traf"]).forEach(r=>{le(r,["tfhd"]).forEach(s=>{const i=oe(s,4),o=n[i];if(!o)return;const a=o.timescale||9e4;le(r,["tfdt"]).forEach(l=>{const u=l[0],c=t*a;if(c){let d=oe(l,4);if(u===0)d-=c,d=Math.max(d,0),Lu(l,4,d);else{d*=Math.pow(2,32),d+=oe(l,8),d-=c,d=Math.max(d,0);const f=Math.floor(d/(rl+1)),h=Math.floor(d%(rl+1));Lu(l,4,f),Lu(l,8,h)}}})})})}function U1(n){const e={valid:null,remainder:null},t=le(n,["moof"]);if(t.length<2)return e.remainder=n,e;const r=t[t.length-1];return e.valid=n.slice(0,r.byteOffset-8),e.remainder=n.slice(r.byteOffset-8),e}function Zt(n,e){const t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function Um(n,e){const t=[],r=e.samples,s=e.timescale,i=e.id;let o=!1;return le(r,["moof"]).map(l=>{const u=l.byteOffset-8;le(l,["traf"]).map(d=>{const f=le(d,["tfdt"]).map(h=>{const m=h[0];let g=oe(h,4);return m===1&&(g*=Math.pow(2,32),g+=oe(h,8)),g/s})[0];return f!==void 0&&(n=f),le(d,["tfhd"]).map(h=>{const m=oe(h,4),g=oe(h,0)&16777215,p=(g&1)!==0,y=(g&2)!==0,v=(g&8)!==0;let E=0;const T=(g&16)!==0;let A=0;const R=(g&32)!==0;let L=8;m===i&&(p&&(L+=8),y&&(L+=4),v&&(E=oe(h,L),L+=4),T&&(A=oe(h,L),L+=4),R&&(L+=4),e.type==="video"&&(o=Bl(e.codec)),le(d,["trun"]).map(I=>{const C=I[0],_=oe(I,0)&16777215,F=(_&1)!==0;let B=0;const ie=(_&4)!==0,z=(_&256)!==0;let Y=0;const V=(_&512)!==0;let W=0;const M=(_&1024)!==0,P=(_&2048)!==0;let N=0;const j=oe(I,4);let H=8;F&&(B=oe(I,H),H+=4),ie&&(H+=4);let Q=B+u;for(let ae=0;ae<j;ae++){if(z?(Y=oe(I,H),H+=4):Y=E,V?(W=oe(I,H),H+=4):W=A,M&&(H+=4),P&&(C===0?N=oe(I,H):N=ov(I,H),H+=4),e.type===Te.VIDEO){let J=0;for(;J<W;){const ue=oe(r,Q);if(Q+=4,B1(o,r[Q])){const Ie=r.subarray(Q,Q+ue);Af(Ie,o?2:1,n+N/s,t)}Q+=ue,J+=ue+4}}n+=Y/s}}))})})}),t}function Bl(n){if(!n)return!1;const e=n.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function B1(n,e){if(n){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function Af(n,e,t,r){const s=uv(n);let i=0;i+=e;let o=0,a=0,l=0;for(;i<s.length;){o=0;do{if(i>=s.length)break;l=s[i++],o+=l}while(l===255);a=0;do{if(i>=s.length)break;l=s[i++],a+=l}while(l===255);const u=s.length-i;let c=i;if(a<u)i+=a;else if(a>u){pe.error(`Malformed SEI payload. ${a} is too small, only ${u} bytes left to parse.`);break}if(o===4){if(s[c++]===181){const f=iv(s,c);if(c+=2,f===49){const h=oe(s,c);if(c+=4,h===1195456820){const m=s[c++];if(m===3){const g=s[c++],p=31&g,y=64&g,v=y?2+p*3:0,E=new Uint8Array(v);if(y){E[0]=g;for(let T=1;T<v;T++)E[T]=s[c++]}r.push({type:m,payloadType:o,pts:t,bytes:E})}}}}}else if(o===5&&a>16){const d=[];for(let m=0;m<16;m++){const g=s[c++].toString(16);d.push(g.length==1?"0"+g:g),(m===3||m===5||m===7||m===9)&&d.push("-")}const f=a-16,h=new Uint8Array(f);for(let m=0;m<f;m++)h[m]=s[c++];r.push({payloadType:o,pts:t,uuid:d.join(""),userData:Bt(h),userDataBytes:h})}}}function uv(n){const e=n.byteLength,t=[];let r=1;for(;r<e-2;)n[r]===0&&n[r+1]===0&&n[r+2]===3?(t.push(r+2),r+=2):r++;if(t.length===0)return n;const s=e-t.length,i=new Uint8Array(s);let o=0;for(r=0;r<s;o++,r++)o===t[0]&&(o++,t.shift()),i[r]=n[o];return i}function $1(n){const e=n[0];let t="",r="",s=0,i=0,o=0,a=0,l=0,u=0;if(e===0){for(;Ke(n.subarray(u,u+1))!=="\0";)t+=Ke(n.subarray(u,u+1)),u+=1;for(t+=Ke(n.subarray(u,u+1)),u+=1;Ke(n.subarray(u,u+1))!=="\0";)r+=Ke(n.subarray(u,u+1)),u+=1;r+=Ke(n.subarray(u,u+1)),u+=1,s=oe(n,12),i=oe(n,16),a=oe(n,20),l=oe(n,24),u=28}else if(e===1){u+=4,s=oe(n,u),u+=4;const d=oe(n,u);u+=4;const f=oe(n,u);for(u+=4,o=2**32*d+f,g1(o)||(o=Number.MAX_SAFE_INTEGER,pe.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),a=oe(n,u),u+=4,l=oe(n,u),u+=4;Ke(n.subarray(u,u+1))!=="\0";)t+=Ke(n.subarray(u,u+1)),u+=1;for(t+=Ke(n.subarray(u,u+1)),u+=1;Ke(n.subarray(u,u+1))!=="\0";)r+=Ke(n.subarray(u,u+1)),u+=1;r+=Ke(n.subarray(u,u+1)),u+=1}const c=n.subarray(u,n.byteLength);return{schemeIdUri:t,value:r,timeScale:s,presentationTime:o,presentationTimeDelta:i,eventDuration:a,id:l,payload:c}}function j1(n,...e){const t=e.length;let r=8,s=t;for(;s--;)r+=e[s].byteLength;const i=new Uint8Array(r);for(i[0]=r>>24&255,i[1]=r>>16&255,i[2]=r>>8&255,i[3]=r&255,i.set(n,4),s=0,r=8;s<t;s++)i.set(e[s],r),r+=e[s].byteLength;return i}function G1(n,e,t){if(n.byteLength!==16)throw new RangeError("Invalid system id");let r,s;r=0,s=new Uint8Array;let i;r>0?(i=new Uint8Array(4),e.length>0&&new DataView(i.buffer).setUint32(0,e.length,!1)):i=new Uint8Array;const o=new Uint8Array(4);return t&&t.byteLength>0&&new DataView(o.buffer).setUint32(0,t.byteLength,!1),j1([112,115,115,104],new Uint8Array([r,0,0,0]),n,i,s,o,t||new Uint8Array)}function V1(n){const e=[];if(n instanceof ArrayBuffer){const t=n.byteLength;let r=0;for(;r+32<t;){const s=new DataView(n,r),i=H1(s);e.push(i),r+=i.size}}return e}function H1(n){const e=n.getUint32(0),t=n.byteOffset,r=n.byteLength;if(r<e)return{offset:t,size:r};if(n.getUint32(4)!==1886614376)return{offset:t,size:e};const i=n.getUint32(8)>>>24;if(i!==0&&i!==1)return{offset:t,size:e};const o=n.buffer,a=Ln.hexDump(new Uint8Array(o,t+12,16)),l=n.getUint32(28);let u=null,c=null;if(i===0){if(e-32<l||l<22)return{offset:t,size:e};c=new Uint8Array(o,t+32,l)}else if(i===1){if(!l||r<t+32+l*16+16)return{offset:t,size:e};u=[];for(let d=0;d<l;d++)u.push(new Uint8Array(o,t+32+d*16,16))}return{version:i,systemId:a,kids:u,data:c,offset:t,size:e}}const cv=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),js={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function dv(n,e){const t=js[e];return!!t&&!!t[n.slice(0,4)]}function ed(n,e,t=!0){return!n.split(",").some(r=>!fv(r,e,t))}function fv(n,e,t=!0){var r;const s=_r(t);return(r=s==null?void 0:s.isTypeSupported(to(n,e)))!=null?r:!1}function to(n,e){return`${e}/mp4;codecs=${n}`}function Bm(n){if(n){const e=n.substring(0,4);return js.video[e]}return 2}function sl(n){const e=cv();return n.split(",").reduce((t,r)=>{const i=e&&Bl(r)?9:js.video[r];return i?(i*2+t)/(t?3:2):(js.audio[r]+t)/(t?2:1)},0)}const Ru={};function K1(n,e=!0){if(Ru[n])return Ru[n];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[n];for(let s=0;s<t.length;s++){var r;if(fv(t[s],"audio",e))return Ru[n]=t[s],t[s];if(t[s]==="mp3"&&(r=_r(e))!=null&&r.isTypeSupported("audio/mpeg"))return""}return n}const z1=/flac|opus|mp4a\.40\.34/i;function il(n,e=!0){return n.replace(z1,t=>K1(t.toLowerCase(),e))}function W1(n,e){const t=[];if(n){const r=n.split(",");for(let s=0;s<r.length;s++)dv(r[s],"video")||t.push(r[s])}return e&&t.push(e),t.join(",")}function xa(n,e){if(n&&(n.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(n)!==-1))return n;if(e){const t=e.split(",");if(t.length>1){if(n){for(let r=t.length;r--;)if(t[r].substring(0,4)===n.substring(0,4))return t[r]}return t[0]}}return e||n}function Y1(n){const e=n.split(",");for(let t=0;t<e.length;t++){const r=e[t].split(".");if(r.length>2){let s=r.shift()+".";s+=parseInt(r.shift()).toString(16),s+=("000"+parseInt(r.shift()).toString(16)).slice(-4),e[t]=s}}return e.join(",")}function q1(n){if(n.startsWith("av01.")){const e=n.split("."),t=["0","111","01","01","01","0"];for(let r=e.length;r>4&&r<10;r++)e[r]=t[r-4];return e.join(".")}return n}function $m(n){const e=_r(n)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function hv(n){return n.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const mv={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function gv(n,e){return{supported:!1,configurations:e,decodingInfoResults:[{supported:!1,smooth:!1,powerEfficient:!1}],error:n}}const jm={};function X1(n,e,t,r,s,i){const o=n.audioCodec?n.audioGroups:null,a=i==null?void 0:i.audioCodec,l=i==null?void 0:i.channels,u=l?parseInt(l):a?1/0:2;let c=null;if(o!=null&&o.length)try{o.length===1&&o[0]?c=e.groups[o[0]].channels:c=o.reduce((d,f)=>{if(f){const h=e.groups[f];if(!h)throw new Error(`Audio track group ${f} not found`);Object.keys(h.channels).forEach(m=>{d[m]=(d[m]||0)+h.channels[m]})}return d},{2:0})}catch{return!0}return n.videoCodec!==void 0&&(n.width>1920&&n.height>1088||n.height>1920&&n.width>1088||n.frameRate>Math.max(r,30)||n.videoRange!=="SDR"&&n.videoRange!==t||n.bitrate>Math.max(s,8e6))||!!c&&K(u)&&Object.keys(c).some(d=>parseInt(d)>u)}function pv(n,e,t){const r=n.videoCodec,s=n.audioCodec;if(!r&&!s||!t)return Promise.resolve(mv);const i=[];if(r){const o={width:n.width,height:n.height,bitrate:Math.ceil(Math.max(n.bitrate*.9,n.averageBitrate)),framerate:n.frameRate||30},a=n.videoRange;a!=="SDR"&&(o.transferFunction=a.toLowerCase());const l=r.split(","),u=navigator.userAgent;if(l.some(c=>Bl(c))&&cv())return Promise.resolve(gv(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent sting: (${u})`),i));i.push.apply(i,l.map(c=>({type:"media-source",video:Ee(Ee({},o),{},{contentType:to(q1(c),"video")})})))}return s&&n.audioGroups&&n.audioGroups.forEach(o=>{var a;o&&((a=e.groups[o])==null||a.tracks.forEach(l=>{if(l.groupId===o){const u=l.channels||"",c=parseFloat(u);K(c)&&c>2&&i.push.apply(i,s.split(",").map(d=>({type:"media-source",audio:{contentType:to(d,"audio"),channels:""+c}})))}}))}),Promise.all(i.map(o=>{const a=Q1(o);return jm[a]||(jm[a]=t.decodingInfo(o))})).then(o=>({supported:!o.some(a=>!a.supported),configurations:i,decodingInfoResults:o})).catch(o=>({supported:!1,configurations:i,decodingInfoResults:[],error:o}))}function Q1(n){const{audio:e,video:t}=n,r=t||e;if(r){const s=hv(r.contentType);if(t)return`r${t.height}x${t.width}f${Math.ceil(t.framerate)}${t.transferFunction||"sd"}_${s}_${Math.ceil(t.bitrate/1e5)}`;if(e)return`c${e.channels}${e.spatialRendering?"s":"n"}_${s}`}return""}const td=["NONE","TYPE-0","TYPE-1",null];function J1(n){return td.indexOf(n)>-1}const ol=["SDR","PQ","HLG"];function Z1(n){return!!n&&ol.indexOf(n)>-1}var Sa={No:"",Yes:"YES",v2:"v2"};function Gm(n){const{canSkipUntil:e,canSkipDateRanges:t,age:r}=n,s=r<e/2;return e&&s?t?Sa.v2:Sa.Yes:Sa.No}class Vm{constructor(e,t,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=r}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class no{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(r=>!!r).map(r=>r.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const r=(t=e.supplemental)==null?void 0:t.videoCodec;r&&r!==e.videoCodec&&(this.codecSet+=`,${r.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Hm(this._audioGroups,e)}hasSubtitleGroup(e){return Hm(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let r=this._audioGroups;r||(r=this._audioGroups=[]),r.indexOf(t)===-1&&r.push(t)}else if(e==="text"){let r=this._subtitleGroups;r||(r=this._subtitleGroups=[]),r.indexOf(t)===-1&&r.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function Hm(n,e){return!e||!n?!1:n.indexOf(e)!==-1}function eI(){if(typeof matchMedia=="function"){const n=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(n.media!==e.media)return n.matches===!0}return!1}function tI(n,e){let t=!1,r=[];if(n&&(t=n!=="SDR",r=[n]),e){r=e.allowedVideoRanges||ol.slice(0);const s=r.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:s&&eI(),t||(r=["SDR"])}return{preferHDR:t,allowedVideoRanges:r}}const nI=n=>{const e=new WeakSet;return(t,r)=>{if(n&&(r=n(t,r)),typeof r=="object"&&r!==null){if(e.has(r))return;e.add(r)}return r}},be=(n,e)=>JSON.stringify(n,nI(e));function rI(n,e,t,r,s){const i=Object.keys(n),o=r==null?void 0:r.channels,a=r==null?void 0:r.audioCodec,l=s==null?void 0:s.videoCodec,u=o&&parseInt(o)===2;let c=!1,d=!1,f=1/0,h=1/0,m=1/0,g=1/0,p=0,y=[];const{preferHDR:v,allowedVideoRanges:E}=tI(e,s);for(let I=i.length;I--;){const C=n[i[I]];c||(c=C.channels[2]>0),f=Math.min(f,C.minHeight),h=Math.min(h,C.minFramerate),m=Math.min(m,C.minBitrate),E.filter(F=>C.videoRanges[F]>0).length>0&&(d=!0)}f=K(f)?f:0,h=K(h)?h:0;const T=Math.max(1080,f),A=Math.max(30,h);m=K(m)?m:t,t=Math.max(m,t),d||(e=void 0);const R=i.length>1;return{codecSet:i.reduce((I,C)=>{const _=n[C];if(C===I)return I;if(y=d?E.filter(F=>_.videoRanges[F]>0):[],R){if(_.minBitrate>t)return xn(C,`min bitrate of ${_.minBitrate} > current estimate of ${t}`),I;if(!_.hasDefaultAudio)return xn(C,"no renditions with default or auto-select sound found"),I;if(a&&C.indexOf(a.substring(0,4))%5!==0)return xn(C,`audio codec preference "${a}" not found`),I;if(o&&!u){if(!_.channels[o])return xn(C,`no renditions with ${o} channel sound found (channels options: ${Object.keys(_.channels)})`),I}else if((!a||u)&&c&&_.channels[2]===0)return xn(C,"no renditions with stereo sound found"),I;if(_.minHeight>T)return xn(C,`min resolution of ${_.minHeight} > maximum of ${T}`),I;if(_.minFramerate>A)return xn(C,`min framerate of ${_.minFramerate} > maximum of ${A}`),I;if(!y.some(F=>_.videoRanges[F]>0))return xn(C,`no variants with VIDEO-RANGE of ${be(y)} found`),I;if(l&&C.indexOf(l.substring(0,4))%5!==0)return xn(C,`video codec preference "${l}" not found`),I;if(_.maxScore<p)return xn(C,`max score of ${_.maxScore} < selected max of ${p}`),I}return I&&(sl(C)>=sl(I)||_.fragmentError>n[I].fragmentError)?I:(g=_.minIndex,p=_.maxScore,C)},void 0),videoRanges:y,preferHDR:v,minFramerate:h,minBitrate:m,minIndex:g}}function xn(n,e){pe.log(`[abr] start candidates with "${n}" ignored because ${e}`)}function yv(n){return n.reduce((e,t)=>{let r=e.groups[t.groupId];r||(r=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),r.tracks.push(t);const s=t.channels||"2";return r.channels[s]=(r.channels[s]||0)+1,r.hasDefault=r.hasDefault||t.default,r.hasAutoSelect=r.hasAutoSelect||t.autoselect,r.hasDefault&&(e.hasDefaultAudio=!0),r.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function sI(n,e,t,r){return n.slice(t,r+1).reduce((s,i,o)=>{if(!i.codecSet)return s;const a=i.audioGroups;let l=s[i.codecSet];l||(s[i.codecSet]=l={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:o,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!a,fragmentError:0}),l.minBitrate=Math.min(l.minBitrate,i.bitrate);const u=Math.min(i.height,i.width);return l.minHeight=Math.min(l.minHeight,u),l.minFramerate=Math.min(l.minFramerate,i.frameRate),l.minIndex=Math.min(l.minIndex,o),l.maxScore=Math.max(l.maxScore,i.score),l.fragmentError+=i.fragmentError,l.videoRanges[i.videoRange]=(l.videoRanges[i.videoRange]||0)+1,a&&a.forEach(c=>{if(!c)return;const d=e.groups[c];d&&(l.hasDefaultAudio=l.hasDefaultAudio||e.hasDefaultAudio?d.hasDefault:d.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(d.channels).forEach(f=>{l.channels[f]=(l.channels[f]||0)+d.channels[f]}))}),s},{})}function Km(n){if(!n)return n;const{lang:e,assocLang:t,characteristics:r,channels:s,audioCodec:i}=n;return{lang:e,assocLang:t,characteristics:r,channels:s,audioCodec:i}}function _n(n,e,t){if("attrs"in n){const r=e.indexOf(n);if(r!==-1)return r}for(let r=0;r<e.length;r++){const s=e[r];if(Wr(n,s,t))return r}return-1}function Wr(n,e,t){const{groupId:r,name:s,lang:i,assocLang:o,default:a}=n,l=n.forced;return(r===void 0||e.groupId===r)&&(s===void 0||e.name===s)&&(i===void 0||iI(i,e.lang))&&(i===void 0||e.assocLang===o)&&(a===void 0||e.default===a)&&(l===void 0||e.forced===l)&&(!("characteristics"in n)||oI(n.characteristics||"",e.characteristics))&&(t===void 0||t(n,e))}function iI(n,e="--"){return n.length===e.length?n===e:n.startsWith(e)||e.startsWith(n)}function oI(n,e=""){const t=n.split(","),r=e.split(",");return t.length===r.length&&!t.some(s=>r.indexOf(s)===-1)}function Fr(n,e){const{audioCodec:t,channels:r}=n;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(r===void 0||r===(e.channels||"2"))}function aI(n,e,t,r,s){const i=e[r],a=e.reduce((f,h,m)=>{const g=h.uri;return(f[g]||(f[g]=[])).push(m),f},{})[i.uri];a.length>1&&(r=Math.max.apply(Math,a));const l=i.videoRange,u=i.frameRate,c=i.codecSet.substring(0,4),d=zm(e,r,f=>{if(f.videoRange!==l||f.frameRate!==u||f.codecSet.substring(0,4)!==c)return!1;const h=f.audioGroups,m=t.filter(g=>!h||h.indexOf(g.groupId)!==-1);return _n(n,m,s)>-1});return d>-1?d:zm(e,r,f=>{const h=f.audioGroups,m=t.filter(g=>!h||h.indexOf(g.groupId)!==-1);return _n(n,m,s)>-1})}function zm(n,e,t){for(let r=e;r>-1;r--)if(t(n[r]))return r;for(let r=e+1;r<n.length;r++)if(t(n[r]))return r;return-1}function al(n,e){var t;return!!n&&n!==((t=e.loadLevelObj)==null?void 0:t.uri)}class lI extends Zn{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var r;const{fragCurrent:s,partCurrent:i,hls:o}=this,{autoLevelEnabled:a,media:l}=o;if(!s||!l)return;const u=performance.now(),c=i?i.stats:s.stats,d=i?i.duration:s.duration,f=u-c.loading.start,h=o.minAutoLevel,m=s.level,g=this._nextAutoLevel;if(c.aborted||c.loaded&&c.loaded===c.total||m<=h){this.clearTimer(),this._nextAutoLevel=-1;return}if(!a)return;const p=g>-1&&g!==m,y=!!t||p;if(!y&&(l.paused||!l.playbackRate||!l.readyState))return;const v=o.mainForwardBufferInfo;if(!y&&v===null)return;const E=this.bwEstimator.getEstimateTTFB(),T=Math.abs(l.playbackRate);if(f<=Math.max(E,1e3*(d/(T*2))))return;const A=v?v.len/T:0,R=c.loading.first?c.loading.first-c.loading.start:-1,L=c.loaded&&R>-1,I=this.getBwEstimate(),C=o.levels,_=C[m],F=Math.max(c.loaded,Math.round(d*(s.bitrate||_.averageBitrate)/8));let B=L?f-R:f;B<1&&L&&(B=Math.min(f,c.loaded*8/I));const ie=L?c.loaded*1e3/B:0,z=E/1e3,Y=ie?(F-c.loaded)/ie:F*8/I+z;if(Y<=A)return;const V=ie?ie*8:I,W=((r=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:r.live)===!0,M=this.hls.config.abrBandWidthUpFactor;let P=Number.POSITIVE_INFINITY,N;for(N=m-1;N>h;N--){const ae=C[N].maxBitrate,J=!C[N].details||W;if(P=this.getTimeToLoadFrag(z,V,d*ae,J),P<Math.min(A,d+z))break}if(P>=Y||P>d*10)return;L?this.bwEstimator.sample(f-Math.min(E,R),c.loaded):this.bwEstimator.sampleTTFB(f);const j=C[N].maxBitrate;this.getBwEstimate()*M>j&&this.resetEstimator(j);const H=this.findBestLevel(j,h,N,0,A,1,1);H>-1&&(N=H),this.warn(`Fragment ${s.sn}${i?" part "+i.index:""} of level ${m} is loading too slowly;
      Fragment duration: ${s.duration.toFixed(3)}
      Time to underbuffer: ${A.toFixed(3)} s
      Estimated load time for current fragment: ${Y.toFixed(3)} s
      Estimated load time for down switch fragment: ${P.toFixed(3)} s
      TTFB estimate: ${R|0} ms
      Current BW estimate: ${K(I)?I|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${N} @ ${j|0} bps`),o.nextLoadLevel=o.nextAutoLevel=N,this.clearTimer();const Q=()=>{if(this.clearTimer(),this.fragCurrent===s&&this.hls.loadLevel===N&&N>0){const ae=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${N>0?"and switching down":""}
      Fragment duration: ${s.duration.toFixed(3)} s
      Time to underbuffer: ${ae.toFixed(3)} s`),s.abortRequests(),this.fragCurrent=this.partCurrent=null,N>h){let J=this.findBestLevel(this.hls.levels[h].bitrate,h,N,0,ae,1,1);J===-1&&(J=h),this.hls.nextLoadLevel=this.hls.nextAutoLevel=J,this.resetEstimator(this.hls.levels[J].bitrate)}}};p||Y>P*2?Q():this.timer=self.setInterval(Q,P*1e3),o.trigger(x.FRAG_LOAD_EMERGENCY_ABORTED,{frag:s,part:i,stats:c})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new y1(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.FRAG_LOADING,this.onFragLoading,this),e.on(x.FRAG_LOADED,this.onFragLoaded,this),e.on(x.FRAG_BUFFERED,this.onFragBuffered,this),e.on(x.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(x.LEVEL_LOADED,this.onLevelLoaded,this),e.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(x.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(x.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.FRAG_LOADING,this.onFragLoading,this),e.off(x.FRAG_LOADED,this.onFragLoaded,this),e.off(x.FRAG_BUFFERED,this.onFragBuffered,this),e.off(x.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(x.LEVEL_LOADED,this.onLevelLoaded,this),e.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(x.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(x.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const r=t.frag;if(!this.ignoreFragment(r)){if(!r.bitrateTest){var s;this.fragCurrent=r,this.partCurrent=(s=t.part)!=null?s:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case b.BUFFER_ADD_CODEC_ERROR:case b.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case b.FRAG_LOAD_TIMEOUT:{const r=t.frag,{fragCurrent:s,partCurrent:i}=this;if(r&&s&&r.sn===s.sn&&r.level===s.level){const o=performance.now(),a=i?i.stats:r.stats,l=o-a.loading.start,u=a.loading.first?a.loading.first-a.loading.start:-1;if(a.loaded&&u>-1){const d=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(l-Math.min(d,u),a.loaded)}else this.bwEstimator.sampleTTFB(l)}break}}}getTimeToLoadFrag(e,t,r,s){const i=e+r/t,o=s?e+this.lastLevelLoadSec:0;return i+o}onLevelLoaded(e,t){const r=this.hls.config,{loading:s}=t.stats,i=s.end-s.first;K(i)&&(this.lastLevelLoadSec=i/1e3),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:r}){const s=r?r.stats:t.stats;if(t.type===Z.MAIN&&this.bwEstimator.sampleTTFB(s.loading.first-s.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const i=r?r.duration:t.duration,o=this.hls.levels[t.level],a=(o.loaded?o.loaded.bytes:0)+s.loaded,l=(o.loaded?o.loaded.duration:0)+i;o.loaded={bytes:a,duration:l},o.realBitrate=Math.round(8*a/l)}if(t.bitrateTest){const i={stats:s,frag:t,part:r,id:t.type};this.onFragBuffered(x.FRAG_BUFFERED,i),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:r,part:s}=t,i=s!=null&&s.stats.loaded?s.stats:r.stats;if(i.aborted||this.ignoreFragment(r))return;const o=i.parsing.end-i.loading.start-Math.min(i.loading.first-i.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,i.loaded),i.bwEstimate=this.getBwEstimate(),r.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==Z.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,r=this.getBwEstimate(),s=this.hls.config.maxStarvationDelay,i=this.findBestLevel(r,t,e,0,s,1,1);if(i>-1)return i;const o=this.hls.firstLevel,a=Math.min(Math.max(o,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${o} clamped to ${a}`),a}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,r=this.bwEstimator.canEstimate(),s=this.lastLoadedFragLevel>-1;if(e!==-1&&(!r||!s||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const i=r&&s?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const o=this.hls.levels;if(o.length>Math.max(e,i)&&o[e].loadError<=o[i].loadError)return e}return this._nextAutoLevel=i,this.nextAutoLevelKey=this.getAutoLevelKey(),i}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:r}=this;if(r.levels.length<=1)return r.loadLevel;const{maxAutoLevel:s,config:i,minAutoLevel:o}=r,a=t?t.duration:e?e.duration:0,l=this.getBwEstimate(),u=this.getStarvationDelay();let c=i.abrBandWidthFactor,d=i.abrBandWidthUpFactor;if(u){const p=this.findBestLevel(l,o,s,u,0,c,d);if(p>=0)return this.rebufferNotice=-1,p}let f=a?Math.min(a,i.maxStarvationDelay):i.maxStarvationDelay;if(!u){const p=this.bitrateTestDelay;p&&(f=(a?Math.min(a,i.maxLoadingDelay):i.maxLoadingDelay)-p,this.info(`bitrate test took ${Math.round(1e3*p)}ms, set first fragment max fetchDuration to ${Math.round(1e3*f)} ms`),c=d=1)}const h=this.findBestLevel(l,o,s,u,f,c,d);if(this.rebufferNotice!==h&&(this.rebufferNotice=h,this.info(`${u?"rebuffering expected":"buffer is empty"}, optimal quality level ${h}`)),h>-1)return h;const m=r.levels[o],g=r.loadLevelObj;return g&&(m==null?void 0:m.bitrate)<g.bitrate?o:r.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const r=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,s=e.mainForwardBufferInfo;return(s?s.len:0)/r}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,r,s,i,o,a){var l;const u=s+i,c=this.lastLoadedFragLevel,d=c===-1?this.hls.firstLevel:c,{fragCurrent:f,partCurrent:h}=this,{levels:m,allAudioTracks:g,loadLevel:p,config:y}=this.hls;if(m.length===1)return 0;const v=m[d],E=!!((l=this.hls.latestLevelDetails)!=null&&l.live),T=p===-1||c===-1;let A,R="SDR",L=(v==null?void 0:v.frameRate)||0;const{audioPreference:I,videoPreference:C}=y,_=this.audioTracksByGroup||(this.audioTracksByGroup=yv(g));let F=-1;if(T){if(this.firstSelection!==-1)return this.firstSelection;const V=this.codecTiers||(this.codecTiers=sI(m,_,t,r)),W=rI(V,R,e,I,C),{codecSet:M,videoRanges:P,minFramerate:N,minBitrate:j,minIndex:H,preferHDR:Q}=W;F=H,A=M,R=Q?P[P.length-1]:P[0],L=N,e=Math.max(e,j),this.log(`picked start tier ${be(W)}`)}else A=v==null?void 0:v.codecSet,R=v==null?void 0:v.videoRange;const B=h?h.duration:f?f.duration:0,ie=this.bwEstimator.getEstimateTTFB()/1e3,z=[];for(let V=r;V>=t;V--){var Y;const W=m[V],M=V>d;if(!W)continue;if(y.useMediaCapabilities&&!W.supportedResult&&!W.supportedPromise){const J=navigator.mediaCapabilities;typeof(J==null?void 0:J.decodingInfo)=="function"&&(X1(W,_,R,L,e,I)||Bl(W.videoCodec))?(W.supportedPromise=pv(W,_,J),W.supportedPromise.then(ue=>{if(!this.hls)return;W.supportedResult=ue;const Ie=this.hls.levels,He=Ie.indexOf(W);ue.error?this.warn(`MediaCapabilities decodingInfo error: "${ue.error}" for level ${He} ${be(ue)}`):ue.supported||(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${He} ${be(ue)}`),He>-1&&Ie.length>1&&(this.log(`Removing unsupported level ${He}`),this.hls.removeLevel(He),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))})):W.supportedResult=mv}if((A&&W.codecSet!==A||R&&W.videoRange!==R||M&&L>W.frameRate||!M&&L>0&&L<W.frameRate||W.supportedResult&&!((Y=W.supportedResult.decodingInfoResults)!=null&&Y[0].smooth))&&(!T||V!==F)){z.push(V);continue}const P=W.details,N=(h?P==null?void 0:P.partTarget:P==null?void 0:P.averagetargetduration)||B;let j;M?j=a*e:j=o*e;const H=B&&s>=B*2&&i===0?W.averageBitrate:W.maxBitrate,Q=this.getTimeToLoadFrag(ie,j,H*N,P===void 0);if(j>=H&&(V===c||W.loadError===0&&W.fragmentError===0)&&(Q<=ie||!K(Q)||E&&!this.bitrateTestDelay||Q<u)){const J=this.forcedAutoLevel;return V!==p&&(J===-1||J!==p)&&(z.length&&this.trace(`Skipped level(s) ${z.join(",")} of ${r} max with CODECS and VIDEO-RANGE:"${m[z[0]].codecs}" ${m[z[0]].videoRange}; not compatible with "${A}" ${R}`),this.info(`switch candidate:${d}->${V} adjustedbw(${Math.round(j)})-bitrate=${Math.round(j-H)} ttfb:${ie.toFixed(1)} avgDuration:${N.toFixed(1)} maxFetchDuration:${u.toFixed(1)} fetchDuration:${Q.toFixed(1)} firstSelection:${T} codecSet:${W.codecSet} videoRange:${W.videoRange} hls.loadLevel:${p}`)),T&&(this.firstSelection=V),V}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:r}=this.hls;return Math.min(Math.max(e,r),t)}}const Lf={search:function(n,e){let t=0,r=n.length-1,s=null,i=null;for(;t<=r;){s=(t+r)/2|0,i=n[s];const o=e(i);if(o>0)t=s+1;else if(o<0)r=s-1;else return i}return null}};function uI(n,e,t){if(e===null||!Array.isArray(n)||!n.length||!K(e))return null;const r=n[0].programDateTime;if(e<(r||0))return null;const s=n[n.length-1].endProgramDateTime;if(e>=(s||0))return null;t=t||0;for(let i=0;i<n.length;++i){const o=n[i];if(dI(e,t,o))return o}return null}function es(n,e,t=0,r=0,s=.005){let i=null;if(n){i=e[1+n.sn-e[0].sn]||null;const a=n.endDTS-t;a>0&&a<15e-7&&(t+=15e-7),i&&n.level!==i.level&&i.end<=n.end&&(i=e[2+n.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(i=e[0]);if(i&&((!n||n.level===i.level)&&Wm(t,r,i)===0||cI(i,n,Math.min(s,r))))return i;const o=Lf.search(e,Wm.bind(null,t,r));return o&&(o!==n||!i)?o:i}function cI(n,e,t){if(e&&e.start===0&&e.level<n.level&&(e.endPTS||0)>0){const r=e.tagList.reduce((s,i)=>(i[0]==="INF"&&(s+=parseFloat(i[1])),s),t);return n.start<=r}return!1}function Wm(n=0,e=0,t){if(t.start<=n&&t.start+t.duration>n)return 0;const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-r<=n?1:t.start-r>n&&t.start?-1:0}function dI(n,e,t){const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-r>n}function vv(n,e){return Lf.search(n,t=>t.cc<e?1:t.cc>e?-1:0)}function fI(n,e,t){if(n&&n.startCC<=e&&n.endCC>=e){const r=t.start,s=t.end;let i=n.fragments;if(!t.relurl){const{fragmentHint:o}=n;o&&(i=i.concat(o))}return Lf.search(i,o=>o.cc<e||o.end<=r?1:o.cc>e||o.start>=s?-1:0)}return null}function ll(n){switch(n.details){case b.FRAG_LOAD_TIMEOUT:case b.KEY_LOAD_TIMEOUT:case b.LEVEL_LOAD_TIMEOUT:case b.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Ym(n,e){const t=ll(e);return n.default[`${t?"timeout":"error"}Retry`]}function If(n,e){const t=n.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*n.retryDelayMs,n.maxRetryDelayMs)}function qm(n){return Ee(Ee({},n),{errorRetry:null,timeoutRetry:null})}function ul(n,e,t,r){if(!n)return!1;const s=r==null?void 0:r.code,i=e<n.maxNumRetry&&(hI(s)||!!t);return n.shouldRetry?n.shouldRetry(n,e,t,r,i):i}function hI(n){return n===0&&navigator.onLine===!1||!!n&&(n<400||n>499)}var ut={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},on={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class mI extends Zn{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(x.ERROR,this.onError,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(x.ERROR,this.onError,this),e.off(x.ERROR,this.onErrorOut,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===Z.MAIN?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var r;if(t.fatal)return;const s=this.hls,i=t.context;switch(t.details){case b.FRAG_LOAD_ERROR:case b.FRAG_LOAD_TIMEOUT:case b.KEY_LOAD_ERROR:case b.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case b.FRAG_PARSING_ERROR:if((r=t.frag)!=null&&r.gap){t.errorAction=ro();return}case b.FRAG_GAP:case b.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=ut.SendAlternateToPenaltyBox;return}case b.LEVEL_EMPTY_ERROR:case b.LEVEL_PARSING_ERROR:{var o,a;const u=t.parent===Z.MAIN?t.level:s.loadLevel;t.details===b.LEVEL_EMPTY_ERROR&&((o=t.context)!=null&&(a=o.levelDetails)!=null&&a.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,u):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,u))}return;case b.LEVEL_LOAD_ERROR:case b.LEVEL_LOAD_TIMEOUT:typeof(i==null?void 0:i.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.level));return;case b.AUDIO_TRACK_LOAD_ERROR:case b.AUDIO_TRACK_LOAD_TIMEOUT:case b.SUBTITLE_LOAD_ERROR:case b.SUBTITLE_TRACK_LOAD_TIMEOUT:if(i){const u=s.loadLevelObj;if(u&&(i.type===he.AUDIO_TRACK&&u.hasAudioGroup(i.groupId)||i.type===he.SUBTITLE_TRACK&&u.hasSubtitleGroup(i.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.loadLevel),t.errorAction.action=ut.SendAlternateToPenaltyBox,t.errorAction.flags=on.MoveAllAlternatesMatchingHost;return}}return;case b.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const u=s.loadLevelObj,c=u==null?void 0:u.attrs["HDCP-LEVEL"];c?t.errorAction={action:ut.SendAlternateToPenaltyBox,flags:on.MoveAllAlternatesMatchingHDCP,hdcpLevel:c}:this.keySystemError(t)}return;case b.BUFFER_ADD_CODEC_ERROR:case b.REMUX_ALLOC_ERROR:case b.BUFFER_APPEND_ERROR:if(!t.errorAction){var l;t.errorAction=this.getLevelSwitchAction(t,(l=t.level)!=null?l:s.loadLevel)}return;case b.INTERNAL_EXCEPTION:case b.BUFFER_APPENDING_ERROR:case b.BUFFER_FULL_ERROR:case b.LEVEL_SWITCH_ERROR:case b.BUFFER_STALLED_ERROR:case b.BUFFER_SEEK_OVER_HOLE:case b.BUFFER_NUDGE_ON_STALL:t.errorAction=ro();return}t.type===te.KEY_SYSTEM_ERROR&&this.keySystemError(t)}keySystemError(e){const t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)}getPlaylistRetryOrSwitchAction(e,t){const r=this.hls,s=Ym(r.config.playlistLoadPolicy,e),i=this.playlistError++;if(ul(s,i,ll(e),e.response))return{action:ut.RetryRequest,flags:on.None,retryConfig:s,retryCount:i};const a=this.getLevelSwitchAction(e,t);return s&&(a.retryConfig=s,a.retryCount=i),a}getFragRetryOrSwitchAction(e){const t=this.hls,r=this.getVariantLevelIndex(e.frag),s=t.levels[r],{fragLoadPolicy:i,keyLoadPolicy:o}=t.config,a=Ym(e.details.startsWith("key")?o:i,e),l=t.levels.reduce((c,d)=>c+d.fragmentError,0);if(s&&(e.details!==b.FRAG_GAP&&s.fragmentError++,ul(a,l,ll(e),e.response)))return{action:ut.RetryRequest,flags:on.None,retryConfig:a,retryCount:l};const u=this.getLevelSwitchAction(e,r);return a&&(u.retryConfig=a,u.retryCount=l),u}getLevelSwitchAction(e,t){const r=this.hls;t==null&&(t=r.loadLevel);const s=this.hls.levels[t];if(s){var i,o;const u=e.details;s.loadError++,u===b.BUFFER_APPEND_ERROR&&s.fragmentError++;let c=-1;const{levels:d,loadLevel:f,minAutoLevel:h,maxAutoLevel:m}=r;r.autoLevelEnabled||(r.loadLevel=-1);const g=(i=e.frag)==null?void 0:i.type,y=(g===Z.AUDIO&&u===b.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(u===b.BUFFER_ADD_CODEC_ERROR||u===b.BUFFER_APPEND_ERROR))&&d.some(({audioCodec:R})=>s.audioCodec!==R),E=e.sourceBufferName==="video"&&(u===b.BUFFER_ADD_CODEC_ERROR||u===b.BUFFER_APPEND_ERROR)&&d.some(({codecSet:R,audioCodec:L})=>s.codecSet!==R&&s.audioCodec===L),{type:T,groupId:A}=(o=e.context)!=null?o:{};for(let R=d.length;R--;){const L=(R+f)%d.length;if(L!==f&&L>=h&&L<=m&&d[L].loadError===0){var a,l;const I=d[L];if(u===b.FRAG_GAP&&g===Z.MAIN&&e.frag){const C=d[L].details;if(C){const _=es(e.frag,C.fragments,e.frag.start);if(_!=null&&_.gap)continue}}else{if(T===he.AUDIO_TRACK&&I.hasAudioGroup(A)||T===he.SUBTITLE_TRACK&&I.hasSubtitleGroup(A))continue;if(g===Z.AUDIO&&(a=s.audioGroups)!=null&&a.some(C=>I.hasAudioGroup(C))||g===Z.SUBTITLE&&(l=s.subtitleGroups)!=null&&l.some(C=>I.hasSubtitleGroup(C))||y&&s.audioCodec===I.audioCodec||!y&&s.audioCodec!==I.audioCodec||E&&s.codecSet===I.codecSet)continue}c=L;break}}if(c>-1&&r.loadLevel!==c)return e.levelRetry=!0,this.playlistError=0,{action:ut.SendAlternateToPenaltyBox,flags:on.None,nextAutoLevel:c}}return{action:ut.SendAlternateToPenaltyBox,flags:on.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var r;switch((r=t.errorAction)==null?void 0:r.action){case ut.DoNothing:break;case ut.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==b.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,r=e.errorAction;if(!r)return;const{flags:s,hdcpLevel:i,nextAutoLevel:o}=r;switch(s){case on.None:this.switchLevel(e,o);break;case on.MoveAllAlternatesMatchingHDCP:i&&(t.maxHdcpLevel=td[td.indexOf(i)-1],r.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}r.resolved||this.switchLevel(e,o)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===b.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const r=hv(e.mimeType),s=this.hls.levels;for(let i=s.length;i--;)s[i][`${e.sourceBufferName}Codec`]===r&&this.hls.removeLevel(i)}}}function ro(n){const e={action:ut.DoNothing,flags:on.None};return n&&(e.resolved=!0),e}var We={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class gI{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.BUFFER_APPENDED,this.onBufferAppended,this),e.on(x.FRAG_BUFFERED,this.onFragBuffered,this),e.on(x.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.BUFFER_APPENDED,this.onBufferAppended,this),e.off(x.FRAG_BUFFERED,this.onFragBuffered,this),e.off(x.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const r=this.activePartLists[t];if(r)for(let s=r.length;s--;){const i=r[s];if(!i)break;const o=i.end;if(i.start<=e&&o!==null&&e<=o)return i}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,r){const{fragments:s}=this,i=Object.keys(s);for(let o=i.length;o--;){const a=s[i[o]];if((a==null?void 0:a.body.type)===t&&(!r||a.buffered)){const l=a.body;if(l.start<=e&&e<=l.end)return l}}return null}detectEvictedFragments(e,t,r,s,i){this.timeRanges&&(this.timeRanges[e]=t);const o=(s==null?void 0:s.fragment.sn)||-1;Object.keys(this.fragments).forEach(a=>{const l=this.fragments[a];if(!l||o>=l.body.sn)return;if(!l.buffered&&(!l.loaded||i)){l.body.type===r&&this.removeFragment(l.body);return}const u=l.range[e];if(u){if(u.time.length===0){this.removeFragment(l.body);return}u.time.some(c=>{const d=!this.isTimeBuffered(c.startPTS,c.endPTS,t);return d&&this.removeFragment(l.body),d})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const r=e.frag,s=us(r),i=this.fragments[s];if(!i||i.buffered&&r.gap)return;const o=!r.relurl;Object.keys(t).forEach(a=>{const l=r.elementaryStreams[a];if(!l)return;const u=t[a],c=o||l.partial===!0;i.range[a]=this.getBufferedTimes(r,e.part,c,u)}),i.loaded=null,Object.keys(i.range).length?(i.buffered=!0,(i.body.endList=r.endList||i.body.endList)&&(this.endListFragments[i.body.type]=i),Vo(i)||this.removeParts(r.sn-1,r.type)):this.removeFragment(i.body)}removeParts(e,t){const r=this.activePartLists[t];r&&(this.activePartLists[t]=Xm(r,s=>s.fragment.sn>=e))}fragBuffered(e,t){const r=us(e);let s=this.fragments[r];!s&&t&&(s=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),s&&(s.loaded=null,s.buffered=!0)}getBufferedTimes(e,t,r,s){const i={time:[],partial:r},o=e.start,a=e.end,l=e.minEndPTS||a,u=e.maxStartPTS||o;for(let c=0;c<s.length;c++){const d=s.start(c)-this.bufferPadding,f=s.end(c)+this.bufferPadding;if(u>=d&&l<=f){i.time.push({startPTS:Math.max(o,s.start(c)),endPTS:Math.min(a,s.end(c))});break}else if(o<f&&a>d){const h=Math.max(o,s.start(c)),m=Math.min(a,s.end(c));m>h&&(i.partial=!0,i.time.push({startPTS:h,endPTS:m}))}else if(a<=d)break}return i}getPartialFragment(e){let t=null,r,s,i,o=0;const{bufferPadding:a,fragments:l}=this;return Object.keys(l).forEach(u=>{const c=l[u];c&&Vo(c)&&(s=c.body.start-a,i=c.body.end+a,e>=s&&e<=i&&(r=Math.min(e-s,i-e),o<=r&&(t=c.body,o=r)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||Vo(t))}getState(e){const t=us(e),r=this.fragments[t];return r?r.buffered?Vo(r)?We.PARTIAL:We.OK:We.APPENDING:We.NOT_LOADED}isTimeBuffered(e,t,r){let s,i;for(let o=0;o<r.length;o++){if(s=r.start(o)-this.bufferPadding,i=r.end(o)+this.bufferPadding,e>=s&&t<=i)return!0;if(t<=s)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const r=t.frag,s=t.part?null:t,i=us(r);this.fragments[i]={body:r,appendedPTS:null,loaded:s,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:r,part:s,timeRanges:i,type:o}=t;if(r.sn==="initSegment")return;const a=r.type;if(s){let u=this.activePartLists[a];u||(this.activePartLists[a]=u=[]),u.push(s)}this.timeRanges=i;const l=i[o];this.detectEvictedFragments(o,l,a,s)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=us(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,r=Object.keys(t);if(!e)return r.length>0;for(let s=r.length;s--;){const i=t[r[s]];if((i==null?void 0:i.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,r,s,i){s&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{const a=this.fragments[o];if(!a)return;const l=a.body;l.type!==r||s&&!l.gap||l.start<t&&l.end>e&&(a.buffered||i)&&this.removeFragment(l)})}removeFragment(e){const t=us(e);e.clearElementaryStreamInfo();const r=this.activePartLists[e.type];if(r){const s=e.sn;this.activePartLists[e.type]=Xm(r,i=>i.fragment.sn!==s)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e,t;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const r=(e=this.hls)==null||(t=e.latestLevelDetails)==null?void 0:t.partList;r&&r.forEach(s=>s.clearElementaryStreamInfo())}}function Vo(n){var e,t,r;return n.buffered&&(n.body.gap||((e=n.range.video)==null?void 0:e.partial)||((t=n.range.audio)==null?void 0:t.partial)||((r=n.range.audiovideo)==null?void 0:r.partial))}function us(n){return`${n.type}_${n.level}_${n.sn}`}function Xm(n,e){return n.filter(t=>{const r=e(t);return r||t.clearElementaryStreamInfo(),r})}var wr={cbc:0,ctr:1};class pI{constructor(e,t,r){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=r}decrypt(e,t){switch(this.aesMode){case wr.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case wr.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function yI(n){const e=n.byteLength,t=e&&new DataView(n.buffer).getUint8(e-1);return t?n.slice(0,e-t):n}class vI{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),r=new Uint32Array(4);for(let s=0;s<4;s++)r[s]=t.getUint32(s*4);return r}initTable(){const e=this.sBox,t=this.invSBox,r=this.subMix,s=r[0],i=r[1],o=r[2],a=r[3],l=this.invSubMix,u=l[0],c=l[1],d=l[2],f=l[3],h=new Uint32Array(256);let m=0,g=0,p=0;for(p=0;p<256;p++)p<128?h[p]=p<<1:h[p]=p<<1^283;for(p=0;p<256;p++){let y=g^g<<1^g<<2^g<<3^g<<4;y=y>>>8^y&255^99,e[m]=y,t[y]=m;const v=h[m],E=h[v],T=h[E];let A=h[y]*257^y*16843008;s[m]=A<<24|A>>>8,i[m]=A<<16|A>>>16,o[m]=A<<8|A>>>24,a[m]=A,A=T*16843009^E*65537^v*257^m*16843008,u[y]=A<<24|A>>>8,c[y]=A<<16|A>>>16,d[y]=A<<8|A>>>24,f[y]=A,m?(m=v^h[h[h[T^v]]],g^=h[h[g]]):m=g=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let r=!0,s=0;for(;s<t.length&&r;)r=t[s]===this.key[s],s++;if(r)return;this.key=t;const i=this.keySize=t.length;if(i!==4&&i!==6&&i!==8)throw new Error("Invalid aes key size="+i);const o=this.ksRows=(i+6+1)*4;let a,l;const u=this.keySchedule=new Uint32Array(o),c=this.invKeySchedule=new Uint32Array(o),d=this.sBox,f=this.rcon,h=this.invSubMix,m=h[0],g=h[1],p=h[2],y=h[3];let v,E;for(a=0;a<o;a++){if(a<i){v=u[a]=t[a];continue}E=v,a%i===0?(E=E<<8|E>>>24,E=d[E>>>24]<<24|d[E>>>16&255]<<16|d[E>>>8&255]<<8|d[E&255],E^=f[a/i|0]<<24):i>6&&a%i===4&&(E=d[E>>>24]<<24|d[E>>>16&255]<<16|d[E>>>8&255]<<8|d[E&255]),u[a]=v=(u[a-i]^E)>>>0}for(l=0;l<o;l++)a=o-l,l&3?E=u[a]:E=u[a-4],l<4||a<=4?c[l]=E:c[l]=m[d[E>>>24]]^g[d[E>>>16&255]]^p[d[E>>>8&255]]^y[d[E&255]],c[l]=c[l]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,r){const s=this.keySize+6,i=this.invKeySchedule,o=this.invSBox,a=this.invSubMix,l=a[0],u=a[1],c=a[2],d=a[3],f=this.uint8ArrayToUint32Array_(r);let h=f[0],m=f[1],g=f[2],p=f[3];const y=new Int32Array(e),v=new Int32Array(y.length);let E,T,A,R,L,I,C,_,F,B,ie,z,Y,V;const W=this.networkToHostOrderSwap;for(;t<y.length;){for(F=W(y[t]),B=W(y[t+1]),ie=W(y[t+2]),z=W(y[t+3]),L=F^i[0],I=z^i[1],C=ie^i[2],_=B^i[3],Y=4,V=1;V<s;V++)E=l[L>>>24]^u[I>>16&255]^c[C>>8&255]^d[_&255]^i[Y],T=l[I>>>24]^u[C>>16&255]^c[_>>8&255]^d[L&255]^i[Y+1],A=l[C>>>24]^u[_>>16&255]^c[L>>8&255]^d[I&255]^i[Y+2],R=l[_>>>24]^u[L>>16&255]^c[I>>8&255]^d[C&255]^i[Y+3],L=E,I=T,C=A,_=R,Y=Y+4;E=o[L>>>24]<<24^o[I>>16&255]<<16^o[C>>8&255]<<8^o[_&255]^i[Y],T=o[I>>>24]<<24^o[C>>16&255]<<16^o[_>>8&255]<<8^o[L&255]^i[Y+1],A=o[C>>>24]<<24^o[_>>16&255]<<16^o[L>>8&255]<<8^o[I&255]^i[Y+2],R=o[_>>>24]<<24^o[L>>16&255]<<16^o[I>>8&255]<<8^o[C&255]^i[Y+3],v[t]=W(E^h),v[t+1]=W(R^m),v[t+2]=W(A^g),v[t+3]=W(T^p),h=F,m=B,g=ie,p=z,t=t+4}return v.buffer}}class EI{constructor(e,t,r){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=r}expandKey(){const e=xI(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function xI(n){switch(n){case wr.cbc:return"AES-CBC";case wr.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${n}`)}}const SI=16;class Rf{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const r=self.crypto;r&&(this.subtle=r.subtle||r.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const r=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?yI(r):r}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,r,s){return this.useSoftware?new Promise((i,o)=>{const a=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(a,t,r,s);const l=this.flush();l?i(l.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,r,s)}softwareDecrypt(e,t,r,s){const{currentIV:i,currentResult:o,remainderData:a}=this;if(s!==wr.cbc||t.byteLength!==16)return pe.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),a&&(e=Zt(a,e),this.remainderData=null);const l=this.getValidChunk(e);if(!l.length)return null;i&&(r=i);let u=this.softwareDecrypter;u||(u=this.softwareDecrypter=new vI),u.expandKey(t);const c=o;return this.currentResult=u.decrypt(l.buffer,0,r),this.currentIV=l.slice(-16).buffer,c||null}webCryptoDecrypt(e,t,r,s){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,r,s));this.key=t,this.fastAesKey=new EI(this.subtle,t,s)}return this.fastAesKey.expandKey().then(i=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new pI(this.subtle,new Uint8Array(r),s).decrypt(e.buffer,i)):Promise.reject(new Error("web crypto not initialized"))).catch(i=>(pe.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${i.name}: ${i.message}`),this.onWebCryptoError(e,t,r,s)))}onWebCryptoError(e,t,r,s){const i=this.enableSoftwareAES;if(i){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r,s);const o=this.flush();if(o)return o.buffer}throw new Error("WebCrypto"+(i?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const r=e.length-e.length%SI;return r!==e.length&&(t=e.slice(0,r),this.remainderData=e.slice(r)),t}logOnce(e){this.logEnabled&&(pe.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const Qm=Math.pow(2,17);class TI{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const r=e.url;if(!r)return Promise.reject(new $n({type:te.NETWORK_ERROR,details:b.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${r?"part list":"url"}`),networkDetails:null}));this.abort();const s=this.config,i=s.fLoader,o=s.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(m=>m[0]==="GAP")){l(Zm(e));return}else e.gap=!1;const u=this.loader=i?new i(s):new o(s),c=Jm(e);e.loader=u;const d=qm(s.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:Qm};e.stats=u.stats;const h={onSuccess:(m,g,p,y)=>{this.resetLoader(e,u);let v=m.data;p.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(v.slice(0,16)),v=v.slice(16)),a({frag:e,part:null,payload:v,networkDetails:y})},onError:(m,g,p,y)=>{this.resetLoader(e,u),l(new $n({type:te.NETWORK_ERROR,details:b.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Ee({url:r,data:void 0},m),error:new Error(`HTTP Error ${m.code} ${m.text}`),networkDetails:p,stats:y}))},onAbort:(m,g,p)=>{this.resetLoader(e,u),l(new $n({type:te.NETWORK_ERROR,details:b.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:p,stats:m}))},onTimeout:(m,g,p)=>{this.resetLoader(e,u),l(new $n({type:te.NETWORK_ERROR,details:b.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:p,stats:m}))}};t&&(h.onProgress=(m,g,p,y)=>t({frag:e,part:null,payload:p,networkDetails:y})),u.load(c,f,h)})}loadPart(e,t,r){this.abort();const s=this.config,i=s.fLoader,o=s.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){l(Zm(e,t));return}const u=this.loader=i?new i(s):new o(s),c=Jm(e,t);e.loader=u;const d=qm(s.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Qm};t.stats=u.stats,u.load(c,f,{onSuccess:(h,m,g,p)=>{this.resetLoader(e,u),this.updateStatsFromPart(e,t);const y={frag:e,part:t,payload:h.data,networkDetails:p};r(y),a(y)},onError:(h,m,g,p)=>{this.resetLoader(e,u),l(new $n({type:te.NETWORK_ERROR,details:b.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Ee({url:c.url,data:void 0},h),error:new Error(`HTTP Error ${h.code} ${h.text}`),networkDetails:g,stats:p}))},onAbort:(h,m,g)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,u),l(new $n({type:te.NETWORK_ERROR,details:b.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:g,stats:h}))},onTimeout:(h,m,g)=>{this.resetLoader(e,u),l(new $n({type:te.NETWORK_ERROR,details:b.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:g,stats:h}))}})})}updateStatsFromPart(e,t){const r=e.stats,s=t.stats,i=s.total;if(r.loaded+=s.loaded,i){const l=Math.round(e.duration/t.duration),u=Math.min(Math.round(r.loaded/i),l),d=(l-u)*Math.round(r.loaded/u);r.total=r.loaded+d}else r.total=Math.max(r.loaded,r.total);const o=r.loading,a=s.loading;o.start?o.first+=a.first-a.start:(o.start=a.start,o.first=a.first),o.end=a.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function Jm(n,e=null){const t=e||n,r={frag:n,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},s=t.byteRangeStartOffset,i=t.byteRangeEndOffset;if(K(s)&&K(i)){var o;let a=s,l=i;if(n.sn==="initSegment"&&AI((o=n.decryptdata)==null?void 0:o.method)){const u=i-s;u%16&&(l=i+(16-u%16)),s!==0&&(r.resetIV=!0,a=s-16)}r.rangeStart=a,r.rangeEnd=l}return r}function Zm(n,e){const t=new Error(`GAP ${n.gap?"tag":"attribute"} found`),r={type:te.MEDIA_ERROR,details:b.FRAG_GAP,fatal:!1,frag:n,error:t,networkDetails:null};return e&&(r.part=e),(e||n).stats.aborted=!0,new $n(r)}function AI(n){return n==="AES-128"||n==="AES-256"}class $n extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class Ev extends Zn{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class _f{constructor(e,t,r,s=0,i=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Ho(),this.buffering={audio:Ho(),video:Ho(),audiovideo:Ho()},this.level=e,this.sn=t,this.id=r,this.size=s,this.part=i,this.partial=o}}function Ho(){return{start:0,executeStart:0,executeEnd:0,end:0}}const eg={length:0,start:()=>0,end:()=>0};class fe{static isBuffered(e,t){if(e){const r=fe.getBuffered(e);for(let s=r.length;s--;)if(t>=r.start(s)&&t<=r.end(s))return!0}return!1}static bufferedRanges(e){if(e){const t=fe.getBuffered(e);return fe.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let r=0;r<e.length;r++)t.push({start:e.start(r),end:e.end(r)});return t}static bufferInfo(e,t,r){if(e){const s=fe.bufferedRanges(e);if(s.length)return fe.bufferedInfo(s,t,r)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,r){t=Math.max(0,t),e.length>1&&e.sort((c,d)=>c.start-d.start||d.end-c.end);let s=-1,i=[];if(r)for(let c=0;c<e.length;c++){t>=e[c].start&&t<=e[c].end&&(s=c);const d=i.length;if(d){const f=i[d-1].end;e[c].start-f<r?e[c].end>f&&(i[d-1].end=e[c].end):i.push(e[c])}else i.push(e[c])}else i=e;let o=0,a,l=t,u=t;for(let c=0;c<i.length;c++){const d=i[c].start,f=i[c].end;if(s===-1&&t>=d&&t<=f&&(s=c),t+r>=d&&t<f)l=d,u=f,o=u-t;else if(t+r<d){a=d;break}}return{len:o,start:l||0,end:u||0,nextStart:a,buffered:e,bufferedIndex:s}}static getBuffered(e){try{return e.buffered||eg}catch(t){return pe.log("failed to get media.buffered",t),eg}}}const xv=/\{\$([a-zA-Z0-9-_]+)\}/g;function tg(n){return xv.test(n)}function nd(n,e){if(n.variableList!==null||n.hasVariableRefs){const t=n.variableList;return e.replace(xv,r=>{const s=r.substring(2,r.length-1),i=t==null?void 0:t[s];return i===void 0?(n.playlistParsingError||(n.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${s}"`)),r):i})}return e}function ng(n,e,t){let r=n.variableList;r||(n.variableList=r={});let s,i;if("QUERYPARAM"in e){s=e.QUERYPARAM;try{const o=new self.URL(t).searchParams;if(o.has(s))i=o.get(s);else throw new Error(`"${s}" does not match any query parameter in URI: "${t}"`)}catch(o){n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else s=e.NAME,i=e.VALUE;s in r?n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${s}"`)):r[s]=i||""}function LI(n,e,t){const r=e.IMPORT;if(t&&r in t){let s=n.variableList;s||(n.variableList=s={}),s[r]=t[r]}else n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${r}"`))}const II=/^(\d+)x(\d+)$/,rg=/(.+?)=(".*?"|.*?)(?:,|$)/g;class De{constructor(e,t){typeof e=="string"&&(e=De.parseAttrList(e,t)),Le(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const r=new Uint8Array(t.length/2);for(let s=0;s<t.length/2;s++)r[s]=parseInt(t.slice(s*2,s*2+2),16);return r}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const r=this[e];return r?parseFloat(r):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const r=this[e];return(r?r.split(/[ ,]+/):[]).reduce((s,i)=>(s[i.toLowerCase()]=!0,s),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=II.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let r;const s={},i='"';for(rg.lastIndex=0;(r=rg.exec(e))!==null;){const o=r[1].trim();let a=r[2];const l=a.indexOf(i)===0&&a.lastIndexOf(i)===a.length-1;let u=!1;if(l)a=a.slice(1,-1);else switch(o){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":u=!0}if(t&&(l||u))a=nd(t,a);else if(!u&&!l)switch(o){case"CLOSED-CAPTIONS":if(a==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":pe.warn(`${e}: attribute ${o} is missing quotes`)}s[o]=a}return s}}const RI="com.apple.hls.interstitial";function _I(n){return n!=="ID"&&n!=="CLASS"&&n!=="CUE"&&n!=="START-DATE"&&n!=="DURATION"&&n!=="END-DATE"&&n!=="END-ON-NEXT"}function wI(n){return n==="SCTE35-OUT"||n==="SCTE35-IN"||n==="SCTE35-CMD"}class Sv{constructor(e,t,r=0){var s;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(s=t==null?void 0:t.tagOrder)!=null?s:r,t){const i=t.attr;for(const o in i)if(Object.prototype.hasOwnProperty.call(e,o)&&e[o]!==i[o]){pe.warn(`DATERANGE tag attribute: "${o}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=o;break}e=Le(new De({}),i,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const i=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);K(i.getTime())&&(this._endDate=i)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(pe.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(K(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===RI}get isValid(){return!!this.id&&!this._badValueForSameId&&K(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const kI=10;class CI{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&r>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}get hasProgramDateTime(){return this.fragments.length?K(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||kI}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let r=e.length;r--;)if(e[r].index>t)return e[r].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function bs(n){return n==="AES-128"||n==="AES-256"||n==="AES-256-CTR"}function wf(n){switch(n){case"AES-128":case"AES-256":return wr.cbc;case"AES-256-CTR":return wr.ctr;default:throw new Error(`invalid full segment method ${n}`)}}function kf(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0))}function rd(n){return Uint8Array.from(unescape(encodeURIComponent(n)),e=>e.charCodeAt(0))}function bI(n){const e=rd(n).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function DI(n){const e=function(r,s,i){const o=r[s];r[s]=r[i],r[i]=o};e(n,0,3),e(n,1,2),e(n,4,5),e(n,6,7)}function PI(n){const e=n.split(":");let t=null;if(e[0]==="data"&&e.length===2){const r=e[1].split(";"),s=r[r.length-1].split(",");if(s.length===2){const i=s[0]==="base64",o=s[1];i?(r.splice(-1,1),t=kf(o)):t=bI(o)}}return t}const cl=typeof self<"u"?self:void 0;var xe={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},_t={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function _u(n){switch(n){case _t.FAIRPLAY:return xe.FAIRPLAY;case _t.PLAYREADY:return xe.PLAYREADY;case _t.WIDEVINE:return xe.WIDEVINE;case _t.CLEARKEY:return xe.CLEARKEY}}var Ko={CENC:"1077efecc0b24d02ace33c1e52e2fb4b",CLEARKEY:"e2719d58a985b3c9781ab030af78d30e",PLAYREADY:"9a04f07998404286ab92e65be0885f95",WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function wu(n){if(n===Ko.WIDEVINE)return xe.WIDEVINE;if(n===Ko.PLAYREADY)return xe.PLAYREADY;if(n===Ko.CENC||n===Ko.CLEARKEY)return xe.CLEARKEY}function ku(n){switch(n){case xe.FAIRPLAY:return _t.FAIRPLAY;case xe.PLAYREADY:return _t.PLAYREADY;case xe.WIDEVINE:return _t.WIDEVINE;case xe.CLEARKEY:return _t.CLEARKEY}}function zo(n){const{drmSystems:e,widevineLicenseUrl:t}=n,r=e?[xe.FAIRPLAY,xe.WIDEVINE,xe.PLAYREADY,xe.CLEARKEY].filter(s=>!!e[s]):[];return!r[xe.WIDEVINE]&&t&&r.push(xe.WIDEVINE),r}const Tv=function(n){return cl!=null&&(n=cl.navigator)!=null&&n.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function OI(n,e,t,r){let s;switch(n){case xe.FAIRPLAY:s=["cenc","sinf"];break;case xe.WIDEVINE:case xe.PLAYREADY:s=["cenc"];break;case xe.CLEARKEY:s=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${n}`)}return NI(s,e,t,r)}function NI(n,e,t,r){return[{initDataTypes:n,persistentState:r.persistentState||"optional",distinctiveIdentifier:r.distinctiveIdentifier||"optional",sessionTypes:r.sessionTypes||[r.sessionType||"temporary"],audioCapabilities:e.map(i=>({contentType:`audio/mp4; codecs=${i}`,robustness:r.audioRobustness||"",encryptionScheme:r.audioEncryptionScheme||null})),videoCapabilities:t.map(i=>({contentType:`video/mp4; codecs=${i}`,robustness:r.videoRobustness||"",encryptionScheme:r.videoEncryptionScheme||null}))}]}function MI(n){var e;return n.sessionType==="persistent-license"||!!((e=n.sessionTypes)!=null&&e.some(t=>t==="persistent-license"))}function Av(n){const e=new Uint16Array(n.buffer,n.byteOffset,n.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),r=t.substring(t.indexOf("<"),t.length),o=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("KID")[0];if(o){const a=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(a){const l=kf(a).subarray(0,16);return DI(l),l}}return null}let Wo={};class so{static clearKeyUriToKeyIdMap(){Wo={}}constructor(e,t,r,s=[1],i=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=r,this.keyFormatVersions=s,this.iv=i,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!bs(e)}isSupported(){if(this.method){if(bs(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case _t.FAIRPLAY:case _t.WIDEVINE:case _t.PLAYREADY:case _t.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(bs(this.method)&&this.uri&&!this.iv){typeof e!="number"&&(pe.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const r=FI(e);return new so(this.method,this.uri,"identity",this.keyFormatVersions,r)}const t=PI(this.uri);if(t)switch(this.keyFormat){case _t.WIDEVINE:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case _t.PLAYREADY:{const r=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=G1(r,null,t),this.keyId=Av(t);break}default:{let r=t.subarray(0,16);if(r.length!==16){const s=new Uint8Array(16);s.set(r,16-r.length),r=s}this.keyId=r;break}}if(!this.keyId||this.keyId.byteLength!==16){let r=Wo[this.uri];if(!r){const s=Object.keys(Wo).length%Number.MAX_SAFE_INTEGER;r=new Uint8Array(16),new DataView(r.buffer,12,4).setUint32(0,s),Wo[this.uri]=r}this.keyId=r}return this}}function FI(n){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=n>>8*(15-t)&255;return e}const sg=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,ig=/#EXT-X-MEDIA:(.*)/g,UI=/^#EXT(?:INF|-X-TARGETDURATION):/m,Cu=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),BI=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class wn{static findGroup(e,t){for(let r=0;r<e.length;r++){const s=e[r];if(s.id===t)return s}}static resolve(e,t){return Sf.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return UI.test(e)}static parseMasterPlaylist(e,t){const r=tg(e),s={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:r},i=[];sg.lastIndex=0;let o;for(;(o=sg.exec(e))!=null;)if(o[1]){var a;const u=new De(o[1],s),c=nd(s,o[2]),d={attrs:u,bitrate:u.decimalInteger("BANDWIDTH")||u.decimalInteger("AVERAGE-BANDWIDTH"),name:u.NAME,url:wn.resolve(c,t)},f=u.decimalResolution("RESOLUTION");f&&(d.width=f.width,d.height=f.height),lg(u.CODECS,d);const h=u["SUPPLEMENTAL-CODECS"];h&&(d.supplemental={},lg(h,d.supplemental)),(a=d.unknownCodecs)!=null&&a.length||i.push(d),s.levels.push(d)}else if(o[3]){const u=o[3],c=o[4];switch(u){case"SESSION-DATA":{const d=new De(c,s),f=d["DATA-ID"];f&&(s.sessionData===null&&(s.sessionData={}),s.sessionData[f]=d);break}case"SESSION-KEY":{const d=og(c,t,s);d.encrypted&&d.isSupported()?(s.sessionKeys===null&&(s.sessionKeys=[]),s.sessionKeys.push(d)):pe.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${c}"`);break}case"DEFINE":{{const d=new De(c,s);ng(s,d,t)}break}case"CONTENT-STEERING":{const d=new De(c,s);s.contentSteering={uri:wn.resolve(d["SERVER-URI"],t),pathwayId:d["PATHWAY-ID"]||"."};break}case"START":{s.startTimeOffset=ag(c);break}}}const l=i.length>0&&i.length<s.levels.length;return s.levels=l?i:s.levels,s.levels.length===0&&(s.playlistParsingError=new Error("no levels found in manifest")),s}static parseMasterPlaylistMedia(e,t,r){let s;const i={},o=r.levels,a={AUDIO:o.map(u=>({id:u.attrs.AUDIO,audioCodec:u.audioCodec})),SUBTITLES:o.map(u=>({id:u.attrs.SUBTITLES,textCodec:u.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(ig.lastIndex=0;(s=ig.exec(e))!==null;){const u=new De(s[1],r),c=u.TYPE;if(c){const d=a[c],f=i[c]||[];i[c]=f;const h=u.LANGUAGE,m=u["ASSOC-LANGUAGE"],g=u.CHANNELS,p=u.CHARACTERISTICS,y=u["INSTREAM-ID"],v={attrs:u,bitrate:0,id:l++,groupId:u["GROUP-ID"]||"",name:u.NAME||h||"",type:c,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:h,url:u.URI?wn.resolve(u.URI,t):""};if(m&&(v.assocLang=m),g&&(v.channels=g),p&&(v.characteristics=p),y&&(v.instreamId=y),d!=null&&d.length){const E=wn.findGroup(d,v.groupId)||d[0];ug(v,E,"audioCodec"),ug(v,E,"textCodec")}f.push(v)}}return i}static parseLevelPlaylist(e,t,r,s,i,o){var a;const l={url:t},u=new CI(t),c=u.fragments,d=[];let f=null,h=0,m=0,g=0,p=0,y=0,v=null,E=new Au(s,l),T,A,R,L=-1,I=!1,C=null,_;if(Cu.lastIndex=0,u.m3u8=e,u.hasVariableRefs=tg(e),((a=Cu.exec(e))==null?void 0:a[0])!=="#EXTM3U")return u.playlistParsingError=new Error("Missing format identifier #EXTM3U"),u;for(;(T=Cu.exec(e))!==null;){I&&(I=!1,E=new Au(s,l),E.playlistOffset=g,E.start=g,E.sn=h,E.cc=p,y&&(E.bitrate=y),E.level=r,f&&(E.initSegment=f,f.rawProgramDateTime&&(E.rawProgramDateTime=f.rawProgramDateTime,f.rawProgramDateTime=null),C&&(E.setByteRange(C),C=null)));const z=T[1];if(z){E.duration=parseFloat(z);const Y=(" "+T[2]).slice(1);E.title=Y||null,E.tagList.push(Y?["INF",z,Y]:["INF",z])}else if(T[3]){if(K(E.duration)){E.playlistOffset=g,E.start=g,R&&dg(E,R,u),E.sn=h,E.level=r,E.cc=p,c.push(E);const Y=(" "+T[3]).slice(1);E.relurl=nd(u,Y),sd(E,v,d),v=E,g+=E.duration,h++,m=0,I=!0}}else{if(T=T[0].match(BI),!T){pe.warn("No matches on slow regex match for level playlist!");continue}for(A=1;A<T.length&&T[A]===void 0;A++);const Y=(" "+T[A]).slice(1),V=(" "+T[A+1]).slice(1),W=T[A+2]?(" "+T[A+2]).slice(1):null;switch(Y){case"BYTERANGE":v?E.setByteRange(V,v):E.setByteRange(V);break;case"PROGRAM-DATE-TIME":E.rawProgramDateTime=V,E.tagList.push(["PROGRAM-DATE-TIME",V]),L===-1&&(L=c.length);break;case"PLAYLIST-TYPE":u.type&&Fn(u,Y,T),u.type=V.toUpperCase();break;case"MEDIA-SEQUENCE":u.startSN!==0?Fn(u,Y,T):c.length>0&&fg(u,Y,T),h=u.startSN=parseInt(V);break;case"SKIP":{u.skippedSegments&&Fn(u,Y,T);const M=new De(V,u),P=M.decimalInteger("SKIPPED-SEGMENTS");if(K(P)){u.skippedSegments+=P;for(let j=P;j--;)c.push(null);h+=P}const N=M.enumeratedString("RECENTLY-REMOVED-DATERANGES");N&&(u.recentlyRemovedDateranges=(u.recentlyRemovedDateranges||[]).concat(N.split("	")));break}case"TARGETDURATION":u.targetduration!==0&&Fn(u,Y,T),u.targetduration=Math.max(parseInt(V),1);break;case"VERSION":u.version!==null&&Fn(u,Y,T),u.version=parseInt(V);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":u.live||Fn(u,Y,T),u.live=!1;break;case"#":(V||W)&&E.tagList.push(W?[V,W]:[V]);break;case"DISCONTINUITY":p++,E.tagList.push(["DIS"]);break;case"GAP":E.gap=!0,E.tagList.push([Y]);break;case"BITRATE":E.tagList.push([Y,V]),y=parseInt(V)*1e3,K(y)?E.bitrate=y:y=0;break;case"DATERANGE":{const M=new De(V,u),P=new Sv(M,u.dateRanges[M.ID],u.dateRangeTagCount);u.dateRangeTagCount++,P.isValid||u.skippedSegments?u.dateRanges[P.id]=P:pe.warn(`Ignoring invalid DATERANGE tag: "${V}"`),E.tagList.push(["EXT-X-DATERANGE",V]);break}case"DEFINE":{{const M=new De(V,u);"IMPORT"in M?LI(u,M,o):ng(u,M,t)}break}case"DISCONTINUITY-SEQUENCE":u.startCC!==0?Fn(u,Y,T):c.length>0&&fg(u,Y,T),u.startCC=p=parseInt(V);break;case"KEY":{const M=og(V,t,u);if(M.isSupported()){if(M.method==="NONE"){R=void 0;break}R||(R={}),R[M.keyFormat]&&(R=Le({},R)),R[M.keyFormat]=M}else pe.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${V}"`);break}case"START":u.startTimeOffset=ag(V);break;case"MAP":{const M=new De(V,u);if(E.duration){const P=new Au(s,l);cg(P,M,r,R),f=P,E.initSegment=f,f.rawProgramDateTime&&!E.rawProgramDateTime&&(E.rawProgramDateTime=f.rawProgramDateTime)}else{const P=E.byteRangeEndOffset;if(P){const N=E.byteRangeStartOffset;C=`${P-N}@${N}`}else C=null;cg(E,M,r,R),f=E,I=!0}f.cc=p;break}case"SERVER-CONTROL":{_&&Fn(u,Y,T),_=new De(V),u.canBlockReload=_.bool("CAN-BLOCK-RELOAD"),u.canSkipUntil=_.optionalFloat("CAN-SKIP-UNTIL",0),u.canSkipDateRanges=u.canSkipUntil>0&&_.bool("CAN-SKIP-DATERANGES"),u.partHoldBack=_.optionalFloat("PART-HOLD-BACK",0),u.holdBack=_.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{u.partTarget&&Fn(u,Y,T);const M=new De(V);u.partTarget=M.decimalFloatingPoint("PART-TARGET");break}case"PART":{let M=u.partList;M||(M=u.partList=[]);const P=m>0?M[M.length-1]:void 0,N=m++,j=new De(V,u),H=new _1(j,E,l,N,P);M.push(H),E.duration+=H.duration;break}case"PRELOAD-HINT":{const M=new De(V,u);u.preloadHint=M;break}case"RENDITION-REPORT":{const M=new De(V,u);u.renditionReports=u.renditionReports||[],u.renditionReports.push(M);break}default:pe.warn(`line parsed but not handled: ${T}`);break}}}v&&!v.relurl?(c.pop(),g-=v.duration,u.partList&&(u.fragmentHint=v)):u.partList&&(sd(E,v,d),E.cc=p,u.fragmentHint=E,R&&dg(E,R,u)),u.targetduration||(u.playlistParsingError=new Error("#EXT-X-TARGETDURATION is required"));const F=c.length,B=c[0],ie=c[F-1];if(g+=u.skippedSegments*u.targetduration,g>0&&F&&ie){u.averagetargetduration=g/F;const z=ie.sn;u.endSN=z!=="initSegment"?z:0,u.live||(ie.endList=!0),B&&u.startCC===void 0&&(u.startCC=B.cc),L>0&&(jI(c,L),B&&d.unshift(B))}else u.endSN=0,u.startCC=0;return u.fragmentHint&&(g+=u.fragmentHint.duration),u.totalduration=g,d.length&&u.dateRangeTagCount&&B&&Lv(d,u),u.endCC=p,u}}function Lv(n,e){const t=n.length,r=n[t-1],s=e.live?1/0:e.totalduration,i=Object.keys(e.dateRanges);for(let o=i.length;o--;){const a=e.dateRanges[i[o]],l=a.startDate.getTime();a.tagAnchor=r.ref;for(let u=t;u--;){const c=$I(e,l,n,u,s);if(c!==-1){a.tagAnchor=e.fragments[c].ref;break}}}}function $I(n,e,t,r,s){const i=t[r];if(i){const a=i.programDateTime;if(e>=a||r===0){var o;const l=(((o=t[r+1])==null?void 0:o.start)||s)-i.start;if(e<=a+l*1e3){const u=t[r].sn-n.startSN,c=n.fragments;if(c.length>t.length){const f=(t[r+1]||c[c.length-1]).sn-n.startSN;for(let h=f;h>u;h--){const m=c[h].programDateTime;if(e>=m&&e<m+c[h].duration*1e3)return h}}return u}}}return-1}function og(n,e,t){var r,s;const i=new De(n,t),o=(r=i.METHOD)!=null?r:"",a=i.URI,l=i.hexadecimalInteger("IV"),u=i.KEYFORMATVERSIONS,c=(s=i.KEYFORMAT)!=null?s:"identity";a&&i.IV&&!l&&pe.error(`Invalid IV: ${i.IV}`);const d=a?wn.resolve(a,e):"",f=(u||"1").split("/").map(Number).filter(Number.isFinite);return new so(o,d,c,f,l)}function ag(n){const t=new De(n).decimalFloatingPoint("TIME-OFFSET");return K(t)?t:null}function lg(n,e){let t=(n||"").split(/[ ,]+/).filter(r=>r);["video","audio","text"].forEach(r=>{const s=t.filter(i=>dv(i,r));s.length&&(e[`${r}Codec`]=s.map(i=>i.split("/")[0]).join(","),t=t.filter(i=>s.indexOf(i)===-1))}),e.unknownCodecs=t}function ug(n,e,t){const r=e[t];r&&(n[t]=r)}function jI(n,e){let t=n[e];for(let r=e;r--;){const s=n[r];if(!s)return;s.programDateTime=t.programDateTime-s.duration*1e3,t=s}}function sd(n,e,t){n.rawProgramDateTime?t.push(n):e!=null&&e.programDateTime&&(n.programDateTime=e.endProgramDateTime)}function cg(n,e,t,r){n.relurl=e.URI,e.BYTERANGE&&n.setByteRange(e.BYTERANGE),n.level=t,n.sn="initSegment",r&&(n.levelkeys=r),n.initSegment=null}function dg(n,e,t){n.levelkeys=e;const{encryptedFragments:r}=t;(!r.length||r[r.length-1].levelkeys!==e)&&Object.keys(e).some(s=>e[s].isCommonEncryption)&&r.push(n)}function Fn(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function fg(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function bu(n,e){const t=e.startPTS;if(K(t)){let r=0,s;e.sn>n.sn?(r=t-n.start,s=n):(r=n.start-t,s=e),s.duration!==r&&s.setDuration(r)}else e.sn>n.sn?n.cc===e.cc&&n.minEndPTS?e.setStart(n.start+(n.minEndPTS-n.start)):e.setStart(n.start+n.duration):e.setStart(Math.max(n.start-e.duration,0))}function Iv(n,e,t,r,s,i){r-t<=0&&(pe.warn("Fragment should have a positive duration",e),r=t+e.duration,i=s+e.duration);let a=t,l=r;const u=e.startPTS,c=e.endPTS;if(K(u)){const p=Math.abs(u-t);K(e.deltaPTS)?e.deltaPTS=Math.max(p,e.deltaPTS):e.deltaPTS=p,a=Math.max(t,u),t=Math.min(t,u),s=Math.min(s,e.startDTS),l=Math.min(r,c),r=Math.max(r,c),i=Math.max(i,e.endDTS)}const d=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(r-e.start),e.startPTS=t,e.maxStartPTS=a,e.startDTS=s,e.endPTS=r,e.minEndPTS=l,e.endDTS=i;const f=e.sn;if(!n||f<n.startSN||f>n.endSN)return 0;let h;const m=f-n.startSN,g=n.fragments;for(g[m]=e,h=m;h>0;h--)bu(g[h],g[h-1]);for(h=m;h<g.length-1;h++)bu(g[h],g[h+1]);return n.fragmentHint&&bu(g[g.length-1],n.fragmentHint),n.PTSKnown=n.alignedSliding=!0,d}function GI(n,e){if(n===e)return;let t=null;const r=n.fragments;for(let l=r.length-1;l>=0;l--){const u=r[l].initSegment;if(u){t=u;break}}n.fragmentHint&&delete n.fragmentHint.endPTS;let s;KI(n,e,(l,u,c,d)=>{if(!e.startCC&&u.cc!==l.cc){var f,h;const m=l.cc-u.cc;for(let g=c;g<d.length;g++)d[g].cc+=m;e.startCC=(f=(h=wv(n,e.startSN-1))==null?void 0:h.cc)!=null?f:d[0].cc,e.endCC=d[d.length-1].cc}K(l.startPTS)&&K(l.endPTS)&&(u.setStart(u.startPTS=l.startPTS),u.startDTS=l.startDTS,u.maxStartPTS=l.maxStartPTS,u.endPTS=l.endPTS,u.endDTS=l.endDTS,u.minEndPTS=l.minEndPTS,u.setDuration(l.endPTS-l.startPTS),u.duration&&(s=u),e.PTSKnown=e.alignedSliding=!0),l.hasStreams&&(u.elementaryStreams=l.elementaryStreams),u.loader=l.loader,l.hasStats&&(u.stats=l.stats),l.initSegment&&(u.initSegment=l.initSegment,t=l.initSegment)});const i=e.fragments,o=e.fragmentHint?i.concat(e.fragmentHint):i;if(t&&o.forEach(l=>{var u;l&&(!l.initSegment||l.initSegment.relurl===((u=t)==null?void 0:u.relurl))&&(l.initSegment=t)}),e.skippedSegments)if(e.deltaUpdateFailed=i.some(l=>!l),e.deltaUpdateFailed){pe.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let l=e.skippedSegments;l--;)i.shift();e.startSN=i[0].sn}else{e.endCC=i[i.length-1].cc,e.canSkipDateRanges&&(e.dateRanges=VI(n.dateRanges,e));const l=n.fragments.filter(u=>u.rawProgramDateTime);if(n.hasProgramDateTime&&!e.hasProgramDateTime)for(let u=1;u<o.length;u++)o[u].programDateTime===null&&sd(o[u],o[u-1],l);Lv(l,e)}HI(n.partList,e.partList,(l,u)=>{u.elementaryStreams=l.elementaryStreams,u.stats=l.stats}),s?Iv(e,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS):Rv(n,e),i.length&&(e.totalduration=e.edge-i[0].start),e.driftStartTime=n.driftStartTime,e.driftStart=n.driftStart;const a=e.advancedDateTime;if(e.advanced&&a){const l=e.edge;e.driftStart||(e.driftStartTime=a,e.driftStart=l),e.driftEndTime=a,e.driftEnd=l}else e.driftEndTime=n.driftEndTime,e.driftEnd=n.driftEnd,e.advancedDateTime=n.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=n.requestScheduled)}function VI(n,e){const{dateRanges:t,recentlyRemovedDateranges:r}=e,s=Le({},n);r&&r.forEach(a=>{delete s[a]});const o=Object.keys(s).length;return o&&Object.keys(t).forEach(a=>{const l=s[a],u=new Sv(t[a].attr,l);u.isValid?(s[a]=u,l||(u.tagOrder+=o)):pe.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${be(t[a].attr)}"`)}),s}function HI(n,e,t){if(n&&e){let r=0;for(let s=0,i=n.length;s<=i;s++){const o=n[s],a=e[s+r];o&&a&&o.index===a.index&&o.fragment.sn===a.fragment.sn?t(o,a):r--}}}function KI(n,e,t){const r=e.skippedSegments,s=Math.max(n.startSN,e.startSN)-e.startSN,i=(n.fragmentHint?1:0)+(r?e.endSN:Math.min(n.endSN,e.endSN))-e.startSN,o=e.startSN-n.startSN,a=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments;for(let u=s;u<=i;u++){const c=l[o+u];let d=a[u];if(r&&!d&&c&&(d=e.fragments[u]=c),c&&d){if(t(c,d,u,a),c.url&&c.url!==d.url){e.playlistParsingError=hg(`media sequence mismatch ${d.sn}:`,n,e,c,d);return}else if(c.cc!==d.cc){e.playlistParsingError=hg(`discontinuity sequence mismatch (${c.cc}!=${d.cc})`,n,e,c,d);return}}}}function hg(n,e,t,r,s){return new Error(`${n} ${s.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function Rv(n,e,t=!0){const r=e.startSN+e.skippedSegments-n.startSN,s=n.fragments,i=r>=0;let o=0;if(i&&r<s.length)o=s[r].start;else if(i&&e.startSN===n.endSN+1)o=n.fragmentEnd;else if(i&&t)o=n.fragmentStart+r*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)o=n.fragmentStart;else return;id(e,o)}function id(n,e){if(e){const t=n.fragments;for(let r=n.skippedSegments;r<t.length;r++)t[r].addStart(e);n.fragmentHint&&n.fragmentHint.addStart(e)}}function _v(n,e=1/0){let t=1e3*n.targetduration;if(n.updated){const r=n.fragments;if(r.length&&t*4>e){const i=r[r.length-1].duration*1e3;i<t&&(t=i)}}else t/=2;return Math.round(t)}function wv(n,e,t){if(!n)return null;let r=n.fragments[e-n.startSN];return r||(r=n.fragmentHint,r&&r.sn===e)?r:e<n.startSN&&t&&t.sn===e?t:null}function mg(n,e,t){return n?kv(n.partList,e,t):null}function kv(n,e,t){if(n)for(let r=n.length;r--;){const s=n[r];if(s.index===t&&s.fragment.sn===e)return s}return null}function Cv(n){n.forEach((e,t)=>{var r;(r=e.details)==null||r.fragments.forEach(s=>{s.level=t,s.initSegment&&(s.initSegment.level=t)})})}function bi(n,e){for(let r=0,s=n.length;r<s;r++){var t;if(((t=n[r])==null?void 0:t.cc)===e)return n[r]}return null}function zI(n,e){return!!(n&&e.startCC<n.endCC&&e.endCC>n.startCC)}function gg(n,e){if(n){const t=n.start+e;n.start=n.startPTS=t,n.endPTS=t+n.duration}}function bv(n,e){const t=e.fragments;for(let r=0,s=t.length;r<s;r++)gg(t[r],n);e.fragmentHint&&gg(e.fragmentHint,n),e.alignedSliding=!0}function WI(n,e){n&&(Dv(e,n),!e.alignedSliding&&n&&dl(e,n),!e.alignedSliding&&n&&!e.skippedSegments&&Rv(n,e,!1))}function Dv(n,e){if(!zI(e,n))return;const t=Math.min(e.endCC,n.endCC),r=bi(e.fragments,t),s=bi(n.fragments,t);if(!r||!s)return;pe.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const i=r.start-s.start;bv(i,n)}function dl(n,e){if(!n.hasProgramDateTime||!e.hasProgramDateTime)return;const t=n.fragments,r=e.fragments;if(!t.length||!r.length)return;let s,i;const o=Math.min(e.endCC,n.endCC);e.startCC<o&&n.startCC<o&&(s=bi(r,o),i=bi(t,o)),(!s||!i)&&(s=r[Math.floor(r.length/2)],i=bi(t,s.cc)||t[Math.floor(t.length/2)]);const a=s.programDateTime,l=i.programDateTime;if(!a||!l)return;const u=(l-a)/1e3-(i.start-s.start);bv(u,n)}const YI={toString:function(n){let e="";const t=n.length;for(let r=0;r<t;r++)e+=`[${n.start(r).toFixed(3)}-${n.end(r).toFixed(3)}]`;return e}},U={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Cf extends Ev{constructor(e,t,r,s,i){super(s,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=U.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:o,fragCurrent:a,media:l,mediaBuffer:u,state:c}=this,d=l?l.currentTime:0,f=fe.bufferInfo(u||l,d,o.maxBufferHole);if(this.log(`media seeking to ${K(d)?d.toFixed(3):d}, state: ${c}`),this.state===U.ENDED)this.resetLoadingState();else if(a){const h=o.maxFragLookUpTolerance,m=a.start-h,g=a.start+a.duration+h;if(!f.len||g<f.start||m>f.end){const p=d>g;(d<m||p)&&(p&&a.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),a.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(l){this.fragmentTracker.removeFragmentsInRange(d,1/0,this.playlistType,!0);const h=this.lastCurrentTime;if(d>h&&(this.lastCurrentTime=d),!this.loadingParts){const m=Math.max(f.end,d),g=this.shouldLoadParts(this.getLevelDetails(),m);g&&(this.log(`LL-Part loading ON after seeking to ${d.toFixed(2)} with buffer @${m.toFixed(2)}`),this.loadingParts=g)}}!this.hls.hasEnoughToStart&&!f.len&&(this.log(`setting startPosition to ${d} because of seek before start`),this.nextLoadPosition=this.startPosition=d),this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=i,this.hls=e,this.fragmentLoader=new TI(e.config),this.keyLoader=r,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Rf(e.config)}registerListeners(){const{hls:e}=this;e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(x.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(x.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===U.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=U.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const r=e.end||0,s=this.config.timelineOffset||0;if(r<=s)return!1;const i=e.nextStart;if(i&&i>s&&i<t.edge||this.media.currentTime<e.start)return!1;const a=t.partList;if(a!=null&&a.length){const u=a[a.length-1];return fe.isBuffered(this.media,u.start+u.duration/2)}const l=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(l)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var e;return(e=this.levelLastLoaded)==null?void 0:e.details}}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const r=this.media=this.mediaBuffer=t.media;r.removeEventListener("seeking",this.onMediaSeeking),r.removeEventListener("ended",this.onMediaEnded),r.addEventListener("seeking",this.onMediaSeeking),r.addEventListener("ended",this.onMediaEnded);const s=this.config;this.levels&&s.autoStartLoad&&this.state===U.STOPPED&&this.startLoad(s.startPosition)}onMediaDetaching(e,t){const r=!!t.transferMedia,s=this.media;if(s!==null){if(s.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),s.removeEventListener("seeking",this.onMediaSeeking),s.removeEventListener("ended",this.onMediaEnded),this.keyLoader&&!r&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,r){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=U.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,r){this.startFragRequested=!0,this._loadFragForPlayback(e,t,r)}_loadFragForPlayback(e,t,r){const s=i=>{const o=i.frag;if(this.fragContextChanged(o)){this.warn(`${o.type} sn: ${o.sn}${i.part?" part: "+i.part.index:""} of ${this.fragInfo(o,!1,i.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(o);return}o.stats.chunkCount++,this._handleFragmentLoadProgress(i)};this._doFragLoad(e,t,r,s).then(i=>{if(!i)return;const o=this.state,a=i.frag;if(this.fragContextChanged(a)){(o===U.FRAG_LOADING||!this.fragCurrent&&o===U.PARSING)&&(this.fragmentTracker.removeFragment(a),this.state=U.IDLE);return}"payload"in i&&(this.log(`Loaded ${a.type} sn: ${a.sn} of ${this.playlistLabel()} ${a.level}`),this.hls.trigger(x.FRAG_LOADED,i)),this._handleFragmentLoadComplete(i)}).catch(i=>{this.state===U.STOPPED||this.state===U.ERROR||(this.warn(`Frag error: ${(i==null?void 0:i.message)||i}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:r}=this;if(r.getState(e)===We.APPENDING){const i=e.type,o=this.getFwdBufferInfo(this.mediaBuffer,i),a=Math.max(e.duration,o?o.len:this.config.maxBufferLength),l=this.backtrackFragment;((l?e.sn-l.sn:0)===1||this.reduceMaxBufferLength(a,e.duration))&&r.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?r.removeAllFragments():r.hasParts(e.type)&&(r.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),r.getState(e)===We.PARTIAL&&r.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,r=null){if(!(e-t))return;const s={startOffset:e,endOffset:t,type:r};this.hls.trigger(x.BUFFER_FLUSHING,s)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(r=>{const s=r==null?void 0:r.frag;if(!s||this.fragContextChanged(s)||!this.levels)throw new Error("init load aborted");return r}).then(r=>{const{hls:s}=this,{frag:i,payload:o}=r,a=i.decryptdata;if(o&&o.byteLength>0&&a!=null&&a.key&&a.iv&&bs(a.method)){const l=self.performance.now();return this.decrypter.decrypt(new Uint8Array(o),a.key.buffer,a.iv.buffer,wf(a.method)).catch(u=>{throw s.trigger(x.ERROR,{type:te.MEDIA_ERROR,details:b.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:i}),u}).then(u=>{const c=self.performance.now();return s.trigger(x.FRAG_DECRYPTED,{frag:i,payload:u,stats:{tstart:l,tdecrypt:c}}),r.payload=u,this.completeInitSegmentLoad(r)})}return this.completeInitSegmentLoad(r)}).catch(r=>{this.state===U.STOPPED||this.state===U.ERROR||(this.warn(r),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const r=e.frag.stats;this.state!==U.STOPPED&&(this.state=U.IDLE),e.frag.data=new Uint8Array(e.payload),r.parsing.start=r.buffering.start=self.performance.now(),r.parsing.end=r.buffering.end=self.performance.now(),this.tick()}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const r=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${r?YI.toString(fe.getBuffered(r)):"(detached)"})`),Ze(e)){var s;if(e.type!==Z.SUBTITLE){const o=e.elementaryStreams;if(!Object.keys(o).some(a=>!!o[a])){this.state=U.IDLE;return}}const i=(s=this.levels)==null?void 0:s[e.level];i!=null&&i.fragmentError&&(this.log(`Resetting level fragment error count of ${i.fragmentError} on frag buffered`),i.fragmentError=0)}this.state=U.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:r,part:s,partsLoaded:i}=e,o=!i||i.length===0||i.some(l=>!l),a=new _f(r.level,r.sn,r.stats.chunkCount+1,0,s?s.index:-1,!o);t.flush(a)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,r=null,s){var i;this.fragCurrent=e;const o=t==null?void 0:t.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let a=null;e.encrypted&&!((i=e.decryptdata)!=null&&i.key)?(this.log(`Loading key for ${e.sn} of [${o.startSN}-${o.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=U.KEY_LOADING,this.fragCurrent=e,a=this.keyLoader.load(e).then(d=>{if(!this.fragContextChanged(d.frag))return this.hls.trigger(x.KEY_LOADED,d),this.state===U.KEY_LOADING&&(this.state=U.IDLE),d}),this.hls.trigger(x.KEY_LOADING,{frag:e}),this.fragCurrent===null&&(a=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!e.encrypted&&o.encryptedFragments.length&&this.keyLoader.loadClear(e,o.encryptedFragments);const l=this.fragPrevious;if(Ze(e)&&(!l||e.sn!==l.sn)){const d=this.shouldLoadParts(t.details,e.end);d!==this.loadingParts&&(this.log(`LL-Part loading ${d?"ON":"OFF"} loading sn ${l==null?void 0:l.sn}->${e.sn}`),this.loadingParts=d)}if(r=Math.max(e.start,r||0),this.loadingParts&&Ze(e)){const d=o.partList;if(d&&s){r>e.end&&o.fragmentHint&&(e=o.fragmentHint);const f=this.getNextPart(d,e,r);if(f>-1){const h=d[f];e=this.fragCurrent=h.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${h.index} (${f}/${d.length-1}) of ${this.fragInfo(e,!1,h)}) cc: ${e.cc} [${o.startSN}-${o.endSN}], target: ${parseFloat(r.toFixed(3))}`),this.nextLoadPosition=h.start+h.duration,this.state=U.FRAG_LOADING;let m;return a?m=a.then(g=>!g||this.fragContextChanged(g.frag)?null:this.doFragPartsLoad(e,h,t,s)).catch(g=>this.handleFragLoadError(g)):m=this.doFragPartsLoad(e,h,t,s).catch(g=>this.handleFragLoadError(g)),this.hls.trigger(x.FRAG_LOADING,{frag:e,part:h,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):m}else if(!e.url||this.loadedEndOfParts(d,r))return Promise.resolve(null)}}if(Ze(e)&&this.loadingParts)this.log(`LL-Part loading OFF after next part miss @${r.toFixed(2)}`),this.loadingParts=!1;else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${o?"["+o.startSN+"-"+o.endSN+"]":""}, target: ${parseFloat(r.toFixed(3))}`),K(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=U.FRAG_LOADING;const u=this.config.progressive;let c;return u&&a?c=a.then(d=>!d||this.fragContextChanged(d==null?void 0:d.frag)?null:this.fragmentLoader.load(e,s)).catch(d=>this.handleFragLoadError(d)):c=Promise.all([this.fragmentLoader.load(e,u?s:void 0),a]).then(([d])=>(!u&&d&&s&&s(d),d)).catch(d=>this.handleFragLoadError(d)),this.hls.trigger(x.FRAG_LOADING,{frag:e,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):c}doFragPartsLoad(e,t,r,s){return new Promise((i,o)=>{var a;const l=[],u=(a=r.details)==null?void 0:a.partList,c=d=>{this.fragmentLoader.loadPart(e,d,s).then(f=>{l[d.index]=f;const h=f.part;this.hls.trigger(x.FRAG_LOADED,f);const m=mg(r.details,e.sn,d.index+1)||kv(u,e.sn,d.index+1);if(m)c(m);else return i({frag:e,part:h,partsLoaded:l})}).catch(o)};c(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===b.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(x.ERROR,t)}else this.hls.trigger(x.ERROR,{type:te.OTHER_ERROR,details:b.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==U.PARSING){!this.fragCurrent&&this.state!==U.STOPPED&&this.state!==U.ERROR&&(this.state=U.IDLE);return}const{frag:r,part:s,level:i}=t,o=self.performance.now();r.stats.parsing.end=o,s&&(s.stats.parsing.end=o);const a=this.getLevelDetails(),u=a&&r.sn>a.endSN||this.shouldLoadParts(a,r.end);u!==this.loadingParts&&(this.log(`LL-Part loading ${u?"ON":"OFF"} after parsing segment ending @${r.end.toFixed(2)}`),this.loadingParts=u),this.updateLevelTiming(r,s,i,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e!=null&&e.partList){var r;const i=e.partList[0],o=i.end+(((r=e.fragmentHint)==null?void 0:r.duration)||0);if(t>=o){var s;if((this.hls.hasEnoughToStart?((s=this.media)==null?void 0:s.currentTime)||this.lastCurrentTime:this.getLoadPosition())>i.start-i.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:r}=this,{level:s,sn:i,part:o}=e;if(!(t!=null&&t[s]))return this.warn(`Levels object was unset while buffering fragment ${i} of ${this.playlistLabel()} ${s}. The current chunk will not be buffered.`),null;const a=t[s],l=a.details,u=o>-1?mg(l,i,o):null,c=u?u.fragment:wv(l,i,r);return c?(r&&r!==c&&(c.stats=r.stats),{frag:c,part:u,level:a}):null}bufferFragmentData(e,t,r,s,i){var o;if(!e||this.state!==U.PARSING)return;const{data1:a,data2:l}=e;let u=a;if(a&&l&&(u=Zt(a,l)),!((o=u)!=null&&o.length))return;const c={type:e.type,frag:t,part:r,chunkMeta:s,parent:t.type,data:u};if(this.hls.trigger(x.BUFFER_APPENDING,c),e.dropped&&e.independent&&!r){if(i)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!fe.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const r=t.currentTime,s=fe.bufferInfo(t,r,0),i=e.duration,o=Math.min(this.config.maxFragLookUpTolerance*2,i*.25),a=Math.max(Math.min(e.start-o,s.end-o),r+o);e.start-a>o&&this.flushMainBuffer(a,e.start)}getFwdBufferInfo(e,t){var r;const s=this.getLoadPosition();if(!K(s))return null;const o=this.lastCurrentTime>s||(r=this.media)!=null&&r.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,s,t,o)}getFwdBufferInfoAtPos(e,t,r,s){const i=fe.bufferInfo(e,t,s);if(i.len===0&&i.nextStart!==void 0){const o=this.fragmentTracker.getBufferedFrag(t,r);if(o&&(i.nextStart<=o.end||o.gap)){const a=Math.max(Math.min(i.nextStart,o.end)-t,s);return fe.bufferInfo(e,t,a)}}return i}getMaxBufferLength(e){const{config:t}=this;let r;return e?r=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):r=t.maxBufferLength,Math.min(r,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const r=this.config,s=Math.max(Math.min(e-t,r.maxBufferLength),t),i=Math.max(e-t*3,r.maxMaxBufferLength/2,s);return i>=s?(r.maxMaxBufferLength=i,this.warn(`Reduce max buffer length to ${i}s`),!0):!1}getAppendedFrag(e,t=Z.MAIN){var r;const s=(r=this.fragmentTracker)==null?void 0:r.getAppendedFrag(e,t);return s&&"fragment"in s?s.fragment:s}getNextFragment(e,t){const r=t.fragments,s=r.length;if(!s)return null;const{config:i}=this,o=r[0].start,a=i.lowLatencyMode&&!!t.partList;let l=null;if(t.live){const d=i.initialLiveManifestSize;if(s<d)return this.warn(`Not enough fragments to start playback (have: ${s}, need: ${d})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<o){var u;a&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),l=this.getInitialLiveFragment(t,r);const f=this.hls.startPosition,h=this.hls.liveSyncPosition,m=l?(f!==-1&&f>=o?f:h)||l.start:e;this.log(`Setting startPosition to ${m} to match start frag at live edge. mainStart: ${f} liveSyncPosition: ${h} frag.start: ${(u=l)==null?void 0:u.start}`),this.startPosition=this.nextLoadPosition=m}}else e<=o&&(l=r[0]);if(!l){const d=this.loadingParts?t.partEnd:t.fragmentEnd;l=this.getFragmentAtPosition(e,d,t)}let c=this.filterReplacedPrimary(l,t);if(!c&&l){const d=l.sn-t.startSN;c=this.filterReplacedPrimary(r[d+1]||null,t)}return this.mapToInitFragWhenRequired(c)}isLoopLoading(e,t){const r=this.fragmentTracker.getState(e);return(r===We.OK||r===We.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,r,s,i){let o=null;if(e.gap&&(o=this.getNextFragment(this.nextLoadPosition,t),o&&!o.gap&&r.nextStart)){const a=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,r.nextStart,s,0);if(a!==null&&r.len+a.len>=i){const l=o.sn;return this.loopSn!==l&&(this.log(`buffer full after gaps in "${s}" playlist starting at sn: ${l}`),this.loopSn=l),null}}return this.loopSn=void 0,o}get primaryPrefetch(){if(pg(this.hls.config)){var e,t;if((e=this.hls.interstitialsManager)==null||(t=e.playingItem)==null?void 0:t.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(pg(this.hls.config)&&e.type!==Z.SUBTITLE){const r=this.hls.interstitialsManager,s=r==null?void 0:r.bufferingItem;if(s){const o=s.event;if(o){if(o.appendInPlace||Math.abs(e.start-s.start)>1||s.start===0)return null}else if(e.end<=s.start&&(t==null?void 0:t.live)===!1||e.start>s.end&&s.nextEvent&&(s.nextEvent.appendInPlace||e.start-s.end>1))return null}const i=r==null?void 0:r.playerQueue;if(i)for(let o=i.length;o--;){const a=i[o].interstitial;if(a.appendInPlace&&e.start>=a.startTime&&e.end<=a.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!(e!=null&&e.initSegment.data)&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,r){let s=-1,i=!1,o=!0;for(let a=0,l=e.length;a<l;a++){const u=e[a];if(o=o&&!u.independent,s>-1&&r<u.start)break;const c=u.loaded;c?s=-1:(i||u.independent||o)&&u.fragment===t&&(s=a),i=c}return s}loadedEndOfParts(e,t){const r=e[e.length-1];return r&&t>r.start&&r.loaded}getInitialLiveFragment(e,t){const r=this.fragPrevious;let s=null;if(r){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${r.programDateTime}`),s=uI(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!s){const i=r.sn+1;if(i>=e.startSN&&i<=e.endSN){const o=t[i-e.startSN];r.cc===o.cc&&(s=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${s.sn}`))}s||(s=vv(t,r.cc),s&&this.log(`Live playlist, switching playlist, load frag with same CC: ${s.sn}`))}}else{const i=this.hls.liveSyncPosition;i!==null&&(s=this.getFragmentAtPosition(i,this.bitrateTest?e.fragmentEnd:e.edge,e))}return s}getFragmentAtPosition(e,t,r){const{config:s}=this;let{fragPrevious:i}=this,{fragments:o,endSN:a}=r;const{fragmentHint:l}=r,{maxFragLookUpTolerance:u}=s,c=r.partList,d=!!(this.loadingParts&&c!=null&&c.length&&l);d&&l&&!this.bitrateTest&&c[c.length-1].fragment.sn===l.sn&&(o=o.concat(l),a=l.sn);let f;if(e<t){var h;const g=e<this.lastCurrentTime||e>t-u||(h=this.media)!=null&&h.paused||!this.startFragRequested?0:u;f=es(i,o,e,g)}else f=o[o.length-1];if(f){const m=f.sn-r.startSN,g=this.fragmentTracker.getState(f);if((g===We.OK||g===We.PARTIAL&&f.gap)&&(i=f),i&&f.sn===i.sn&&(!d||c[0].fragment.sn>f.sn||!r.live&&!d)&&i&&f.level===i.level){const y=o[m+1];f.sn<a&&this.fragmentTracker.getState(y)!==We.OK?f=y:f=null}}return f}alignPlaylists(e,t,r){const s=e.fragments.length;if(!s)return this.warn("No fragments in live playlist"),0;const i=e.fragmentStart,o=!t,a=e.alignedSliding&&K(i);if(o||!a&&!i){WI(r,e);const l=e.fragmentStart;return this.log(`Live playlist sliding: ${l.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${s}`),l}return i}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let r=this.startPosition;r<t&&(r=-1);const s=this.timelineOffset;if(r===-1){const i=this.startTimeOffset!==null,o=i?this.startTimeOffset:e.startTimeOffset;o!==null&&K(o)?(r=t+o,o<0&&(r+=e.edge),r=Math.min(Math.max(t,r),t+e.totalduration),this.log(`Setting startPosition to ${r} for start time offset ${o} found in ${i?"multivariant":"media"} playlist`),this.startPosition=r):e.live?(r=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${r}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=r=0),this.lastCurrentTime=r+s}this.nextLoadPosition=r+s}getLoadPosition(){var e;const{media:t}=this;let r=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?r=t.currentTime:this.nextLoadPosition>=0&&(r=this.nextLoadPosition),r}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&Ze(e)&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==U.FRAG_LOADING_WAITING_RETRY)&&(this.state=U.IDLE)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const m=this.getCurrentContext(t.chunkMeta);m&&(t.frag=m.frag)}const r=t.frag;if(!r||r.type!==e||!this.levels)return;if(this.fragContextChanged(r)){var s;this.warn(`Frag load error must match current frag to retry ${r.url} > ${(s=this.fragCurrent)==null?void 0:s.url}`);return}const i=t.details===b.FRAG_GAP;i&&this.fragmentTracker.fragBuffered(r,!0);const o=t.errorAction,{action:a,flags:l,retryCount:u=0,retryConfig:c}=o||{},d=!!o&&!!c,f=d&&a===ut.RetryRequest,h=d&&!o.resolved&&l===on.MoveAllAlternatesMatchingHost;if(!f&&h&&Ze(r)&&!r.endList)this.resetFragmentErrors(e),this.treatAsGap(r),o.resolved=!0;else if((f||h)&&u<c.maxNumRetry){this.resetStartWhenNotLoaded(this.levelLastLoaded);const m=If(c,u);this.warn(`Fragment ${r.sn} of ${e} ${r.level} errored with ${t.details}, retrying loading ${u+1}/${c.maxNumRetry} in ${m}ms`),o.resolved=!0,this.retryDate=self.performance.now()+m,this.state=U.FRAG_LOADING_WAITING_RETRY}else if(c&&o)if(this.resetFragmentErrors(e),u<c.maxNumRetry)!i&&a!==ut.RemoveAlternatePermanently&&(o.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${u})`);return}else a===ut.SendAlternateToPenaltyBox?this.state=U.WAITING_LEVEL:this.state=U.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===U.PARSING||this.state===U.PARSED){const t=e.frag,r=e.parent,s=this.getFwdBufferInfo(this.mediaBuffer,r),i=s&&s.len>.5;i&&this.reduceMaxBufferLength(s.len,(t==null?void 0:t.duration)||10);const o=!i;return o&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${r} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),o}return!1}resetFragmentErrors(e){e===Z.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==U.STOPPED&&(this.state=U.IDLE)}afterBufferFlushed(e,t,r){if(!e)return;const s=fe.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,s,r),this.state===U.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==U.STOPPED&&(this.state=U.IDLE)}resetStartWhenNotLoaded(e){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of ${this.playlistLabel()} ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,r,s){const i=r.details;if(!i){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((l,u)=>{const c=e.elementaryStreams[u];if(c){const d=c.endPTS-c.startPTS;if(d<=0)return this.warn(`Could not parse fragment ${e.sn} ${u} duration reliably (${d})`),l||!1;const f=s?0:Iv(i,e,c.startPTS,c.endPTS,c.startDTS,c.endDTS);return this.hls.trigger(x.LEVEL_PTS_UPDATED,{details:i,level:r,drift:f,type:u,frag:e,start:c.startPTS,end:c.endPTS}),!0}return l},!1)){var a;if(r.fragmentError===0&&this.treatAsGap(e,r),((a=this.transmuxer)==null?void 0:a.error)===null){const l=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(l.message),this.hls.trigger(x.ERROR,{type:te.MEDIA_ERROR,details:b.FRAG_PARSING_ERROR,fatal:!1,error:l,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${r.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=U.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(x.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===Z.MAIN?"level":"track"}fragInfo(e,t=!0,r){var s,i;return`${this.playlistLabel()} ${e.level} (${r?"part":"frag"}:[${((s=t&&!r?e.startPTS:(r||e).start)!=null?s:NaN).toFixed(3)}-${((i=t&&!r?e.endPTS:(r||e).end)!=null?i:NaN).toFixed(3)}]${r&&e.type==="main"?"INDEPENDENT="+(r.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function pg(n){return!!n.interstitialsController&&n.enableInterstitialPlayback!==!1}class Pv{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let r;if(e.length)e.length===1?r=e[0]:r=qI(e,t);else return new Uint8Array(0);return this.reset(),r}reset(){this.chunks.length=0,this.dataLength=0}}function qI(n,e){const t=new Uint8Array(e);let r=0;for(let s=0;s<n.length;s++){const i=n[s];t.set(i,r),r+=i.length}return t}var Du={exports:{}},yg;function XI(){return yg||(yg=1,function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function s(l,u,c){this.fn=l,this.context=u,this.once=c||!1}function i(l,u,c,d,f){if(typeof c!="function")throw new TypeError("The listener must be a function");var h=new s(c,d||l,f),m=t?t+u:u;return l._events[m]?l._events[m].fn?l._events[m]=[l._events[m],h]:l._events[m].push(h):(l._events[m]=h,l._eventsCount++),l}function o(l,u){--l._eventsCount===0?l._events=new r:delete l._events[u]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var u=[],c,d;if(this._eventsCount===0)return u;for(d in c=this._events)e.call(c,d)&&u.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(c)):u},a.prototype.listeners=function(u){var c=t?t+u:u,d=this._events[c];if(!d)return[];if(d.fn)return[d.fn];for(var f=0,h=d.length,m=new Array(h);f<h;f++)m[f]=d[f].fn;return m},a.prototype.listenerCount=function(u){var c=t?t+u:u,d=this._events[c];return d?d.fn?1:d.length:0},a.prototype.emit=function(u,c,d,f,h,m){var g=t?t+u:u;if(!this._events[g])return!1;var p=this._events[g],y=arguments.length,v,E;if(p.fn){switch(p.once&&this.removeListener(u,p.fn,void 0,!0),y){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,c),!0;case 3:return p.fn.call(p.context,c,d),!0;case 4:return p.fn.call(p.context,c,d,f),!0;case 5:return p.fn.call(p.context,c,d,f,h),!0;case 6:return p.fn.call(p.context,c,d,f,h,m),!0}for(E=1,v=new Array(y-1);E<y;E++)v[E-1]=arguments[E];p.fn.apply(p.context,v)}else{var T=p.length,A;for(E=0;E<T;E++)switch(p[E].once&&this.removeListener(u,p[E].fn,void 0,!0),y){case 1:p[E].fn.call(p[E].context);break;case 2:p[E].fn.call(p[E].context,c);break;case 3:p[E].fn.call(p[E].context,c,d);break;case 4:p[E].fn.call(p[E].context,c,d,f);break;default:if(!v)for(A=1,v=new Array(y-1);A<y;A++)v[A-1]=arguments[A];p[E].fn.apply(p[E].context,v)}}return!0},a.prototype.on=function(u,c,d){return i(this,u,c,d,!1)},a.prototype.once=function(u,c,d){return i(this,u,c,d,!0)},a.prototype.removeListener=function(u,c,d,f){var h=t?t+u:u;if(!this._events[h])return this;if(!c)return o(this,h),this;var m=this._events[h];if(m.fn)m.fn===c&&(!f||m.once)&&(!d||m.context===d)&&o(this,h);else{for(var g=0,p=[],y=m.length;g<y;g++)(m[g].fn!==c||f&&!m[g].once||d&&m[g].context!==d)&&p.push(m[g]);p.length?this._events[h]=p.length===1?p[0]:p:o(this,h)}return this},a.prototype.removeAllListeners=function(u){var c;return u?(c=t?t+u:u,this._events[c]&&o(this,c)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a}(Du)),Du.exports}var QI=XI(),bf=I1(QI);const io="1.6.2",Gs={};function JI(){return typeof __HLS_WORKER_BUNDLE__=="function"}function ZI(){const n=Gs[io];if(n)return n.clientCount++,n;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),s={worker:new self.Worker(t),objectURL:t,clientCount:1};return Gs[io]=s,s}function eR(n){const e=Gs[n];if(e)return e.clientCount++,e;const t=new self.URL(n,self.location.href).href,s={worker:new self.Worker(t),scriptURL:t,clientCount:1};return Gs[n]=s,s}function tR(n){const e=Gs[n||io];if(e&&e.clientCount--===1){const{worker:r,objectURL:s}=e;delete Gs[n||io],s&&self.URL.revokeObjectURL(s),r.terminate()}}function Ov(n,e){return e+10<=n.length&&n[e]===51&&n[e+1]===68&&n[e+2]===73&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function Df(n,e){return e+10<=n.length&&n[e]===73&&n[e+1]===68&&n[e+2]===51&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function $l(n,e){let t=0;return t=(n[e]&127)<<21,t|=(n[e+1]&127)<<14,t|=(n[e+2]&127)<<7,t|=n[e+3]&127,t}function oo(n,e){const t=e;let r=0;for(;Df(n,e);){r+=10;const s=$l(n,e+6);r+=s,Ov(n,e+10)&&(r+=10),e+=r}if(r>0)return n.subarray(t,t+r)}function nR(n,e,t,r){const s=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],i=e[t+2],o=i>>2&15;if(o>12){const h=new Error(`invalid ADTS sampling index:${o}`);n.emit(x.ERROR,x.ERROR,{type:te.MEDIA_ERROR,details:b.FRAG_PARSING_ERROR,fatal:!0,error:h,reason:h.message});return}const a=(i>>6&3)+1,l=e[t+3]>>6&3|(i&1)<<2,u="mp4a.40."+a,c=s[o];let d=o;(a===5||a===29)&&(d-=3);const f=[a<<3|(d&14)>>1,(d&1)<<7|l<<3];return pe.log(`manifest codec:${r}, parsed codec:${u}, channels:${l}, rate:${c} (ADTS object type:${a} sampling index:${o})`),{config:f,samplerate:c,channelCount:l,codec:u,parsedCodec:u,manifestCodec:r}}function Nv(n,e){return n[e]===255&&(n[e+1]&246)===240}function Mv(n,e){return n[e+1]&1?7:9}function Pf(n,e){return(n[e+3]&3)<<11|n[e+4]<<3|(n[e+5]&224)>>>5}function rR(n,e){return e+5<n.length}function fl(n,e){return e+1<n.length&&Nv(n,e)}function sR(n,e){return rR(n,e)&&Nv(n,e)&&Pf(n,e)<=n.length-e}function iR(n,e){if(fl(n,e)){const t=Mv(n,e);if(e+t>=n.length)return!1;const r=Pf(n,e);if(r<=t)return!1;const s=e+r;return s===n.length||fl(n,s)}return!1}function Fv(n,e,t,r,s){if(!n.samplerate){const i=nR(e,t,r,s);if(!i)return;Le(n,i)}}function Uv(n){return 1024*9e4/n}function oR(n,e){const t=Mv(n,e);if(e+t<=n.length){const r=Pf(n,e)-t;if(r>0)return{headerLength:t,frameLength:r}}}function Bv(n,e,t,r,s){const i=Uv(n.samplerate),o=r+s*i,a=oR(e,t);let l;if(a){const{frameLength:d,headerLength:f}=a,h=f+d,m=Math.max(0,t+h-e.length);m?(l=new Uint8Array(h-f),l.set(e.subarray(t+f,e.length),0)):l=e.subarray(t+f,t+h);const g={unit:l,pts:o};return m||n.samples.push(g),{sample:g,length:h,missing:m}}const u=e.length-t;return l=new Uint8Array(u),l.set(e.subarray(t,e.length),0),{sample:{unit:l,pts:o},length:u,missing:-1}}function aR(n,e){return Df(n,e)&&$l(n,e+6)+10<=n.length-e}function lR(n){if(n.size<2)return;const e=Bt(n.data,!0),t=new Uint8Array(n.data.subarray(e.length+1));return{key:n.type,info:e,data:t.buffer}}function uR(n){if(n.size<2)return;if(n.type==="TXXX"){let t=1;const r=Bt(n.data.subarray(t),!0);t+=r.length+1;const s=Bt(n.data.subarray(t));return{key:n.type,info:r,data:s}}const e=Bt(n.data.subarray(1));return{key:n.type,info:"",data:e}}function cR(n){if(n.type==="WXXX"){if(n.size<2)return;let t=1;const r=Bt(n.data.subarray(t),!0);t+=r.length+1;const s=Bt(n.data.subarray(t));return{key:n.type,info:r,data:s}}const e=Bt(n.data);return{key:n.type,info:"",data:e}}function dR(n){return btoa(String.fromCharCode(...n))}function $v(n,e){if(n<0)return-$v(-n,e);const t=Math.pow(10,e);if(Math.abs(n*t%1-.5)<Number.EPSILON){const s=Math.floor(n*t);return(s%2===0?s:s+1)/t}else return Math.round(n*t)/t}function fR(n,e){const t=new URL(n),r=new URL(e);if(t.origin!==r.origin)return n;const s=t.pathname.split("/").slice(1),i=r.pathname.split("/").slice(1,-1);for(;s[0]===i[0];)s.shift(),i.shift();for(;i.length;)i.shift(),s.unshift("..");return s.join("/")}function hR(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const i=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(s=="x"?i:i&3|8).toString(16)})}}}function mR(n){return n instanceof ArrayBuffer?n:n.byteOffset==0&&n.byteLength==n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer}function Pu(n,e=0,t=1/0){return gR(n,e,t,Uint8Array)}function gR(n,e,t,r){const s=pR(n);let i=1;"BYTES_PER_ELEMENT"in r&&(i=r.BYTES_PER_ELEMENT);const o=yR(n)?n.byteOffset:0,a=(o+n.byteLength)/i,l=(o+e)/i,u=Math.floor(Math.max(0,Math.min(l,a))),c=Math.floor(Math.min(u+Math.max(t,0),a));return new r(s,u,c-u)}function pR(n){return n instanceof ArrayBuffer?n:n.buffer}function yR(n){return n&&n.buffer instanceof ArrayBuffer&&n.byteLength!==void 0&&n.byteOffset!==void 0}function vR(n){const e={key:n.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(n.size<2)return;if(n.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const r=n.data.subarray(1).indexOf(0);if(r===-1)return;const s=Bt(Pu(n.data,1,r)),i=n.data[2+r],o=n.data.subarray(3+r).indexOf(0);if(o===-1)return;const a=Bt(Pu(n.data,3+r,o));let l;return s==="-->"?l=Bt(Pu(n.data,4+r+o)):l=mR(n.data.subarray(4+r+o)),e.mimeType=s,e.pictureType=i,e.description=a,e.data=l,e}function ER(n){return n.type==="PRIV"?lR(n):n.type[0]==="W"?cR(n):n.type==="APIC"?vR(n):uR(n)}function xR(n){const e=String.fromCharCode(n[0],n[1],n[2],n[3]),t=$l(n,4),r=10;return{type:e,size:t,data:n.subarray(r,r+t)}}const Yo=10,SR=10;function jv(n){let e=0;const t=[];for(;Df(n,e);){const r=$l(n,e+6);n[e+5]>>6&1&&(e+=Yo),e+=Yo;const s=e+r;for(;e+SR<s;){const i=xR(n.subarray(e)),o=ER(i);o&&t.push(o),e+=i.size+Yo}Ov(n,e)&&(e+=Yo)}return t}function Gv(n){return n&&n.key==="PRIV"&&n.info==="com.apple.streaming.transportStreamTimestamp"}function TR(n){if(n.data.byteLength===8){const e=new Uint8Array(n.data),t=e[3]&1;let r=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return r/=45,t&&(r+=4772185884e-2),Math.round(r)}}function Of(n){const e=jv(n);for(let t=0;t<e.length;t++){const r=e[t];if(Gv(r))return TR(r)}}let Mt=function(n){return n.audioId3="org.id3",n.dateRange="com.apple.quicktime.HLS",n.emsg="https://aomedia.org/emsg/ID3",n.misbklv="urn:misb:KLV:bin:1910.1",n}({});function In(n="",e=9e4){return{type:n,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class Nf{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,r,s){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,r){}demux(e,t){this.cachedData&&(e=Zt(this.cachedData,e),this.cachedData=null);let r=oo(e,0),s=r?r.length:0,i;const o=this._audioTrack,a=this._id3Track,l=r?Of(r):void 0,u=e.length;for((this.basePTS===null||this.frameIndex===0&&K(l))&&(this.basePTS=AR(l,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),r&&r.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:Mt.audioId3,duration:Number.POSITIVE_INFINITY});s<u;){if(this.canParse(e,s)){const c=this.appendFrame(o,e,s);c?(this.frameIndex++,this.lastPTS=c.sample.pts,s+=c.length,i=s):s=u}else aR(e,s)?(r=oo(e,s),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:Mt.audioId3,duration:Number.POSITIVE_INFINITY}),s+=r.length,i=s):s++;if(s===u&&i!==u){const c=e.slice(i);this.cachedData?this.cachedData=Zt(this.cachedData,c):this.cachedData=c}}return{audioTrack:o,videoTrack:In(),id3Track:a,textTrack:In()}}demuxSampleAes(e,t,r){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:In(),id3Track:this._id3Track,textTrack:In()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const AR=(n,e,t)=>{if(K(n))return n*90;const r=t?t.baseTime*9e4/t.timescale:0;return e*9e4+r};let qo=null;const LR=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],IR=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],RR=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],_R=[0,1,1,4];function Vv(n,e,t,r,s){if(t+24>e.length)return;const i=Hv(e,t);if(i&&t+i.frameLength<=e.length){const o=i.samplesPerFrame*9e4/i.sampleRate,a=r+s*o,l={unit:e.subarray(t,t+i.frameLength),pts:a,dts:a};return n.config=[],n.channelCount=i.channelCount,n.samplerate=i.sampleRate,n.samples.push(l),{sample:l,length:i.frameLength,missing:0}}}function Hv(n,e){const t=n[e+1]>>3&3,r=n[e+1]>>1&3,s=n[e+2]>>4&15,i=n[e+2]>>2&3;if(t!==1&&s!==0&&s!==15&&i!==3){const o=n[e+2]>>1&1,a=n[e+3]>>6,l=t===3?3-r:r===3?3:4,u=LR[l*14+s-1]*1e3,d=IR[(t===3?0:t===2?1:2)*3+i],f=a===3?1:2,h=RR[t][r],m=_R[r],g=h*8*m,p=Math.floor(h*u/d+o)*m;if(qo===null){const E=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);qo=E?parseInt(E[1]):0}return!!qo&&qo<=87&&r===2&&u>=224e3&&a===0&&(n[e+3]=n[e+3]|128),{sampleRate:d,channelCount:f,frameLength:p,samplesPerFrame:g}}}function Mf(n,e){return n[e]===255&&(n[e+1]&224)===224&&(n[e+1]&6)!==0}function Kv(n,e){return e+1<n.length&&Mf(n,e)}function wR(n,e){return Mf(n,e)&&4<=n.length-e}function zv(n,e){if(e+1<n.length&&Mf(n,e)){const r=Hv(n,e);let s=4;r!=null&&r.frameLength&&(s=r.frameLength);const i=e+s;return i===n.length||Kv(n,i)}return!1}class kR extends Nf{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,r,s){super.resetInitSegment(e,t,r,s),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const r=oo(e,0);let s=(r==null?void 0:r.length)||0;if(zv(e,s))return!1;for(let i=e.length;s<i;s++)if(iR(e,s))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return sR(e,t)}appendFrame(e,t,r){Fv(e,this.observer,t,r,e.manifestCodec);const s=Bv(e,t,r,this.basePTS,this.frameIndex);if(s&&s.missing===0)return s}}const Wv=(n,e)=>{let t=0,r=5;e+=r;const s=new Uint32Array(1),i=new Uint32Array(1),o=new Uint8Array(1);for(;r>0;){o[0]=n[e];const a=Math.min(r,8),l=8-a;i[0]=4278190080>>>24+l<<l,s[0]=(o[0]&i[0])>>l,t=t?t<<a|s[0]:s[0],e+=1,r-=a}return t};class CR extends Nf{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,r,s){super.resetInitSegment(e,t,r,s),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,r){const s=Yv(e,t,r,this.basePTS,this.frameIndex);if(s!==-1)return{sample:e.samples[e.samples.length-1],length:s,missing:0}}static probe(e){if(!e)return!1;const t=oo(e,0);if(!t)return!1;const r=t.length;return e[r]===11&&e[r+1]===119&&Of(t)!==void 0&&Wv(e,r)<16}}function Yv(n,e,t,r,s){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const i=e[t+4]>>6;if(i>=3)return-1;const a=[48e3,44100,32e3][i],l=e[t+4]&63,c=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][l*3+i]*2;if(t+c>e.length)return-1;const d=e[t+6]>>5;let f=0;d===2?f+=2:(d&1&&d!==1&&(f+=2),d&4&&(f+=2));const h=(e[t+6]<<8|e[t+7])>>12-f&1,g=[2,1,2,3,3,4,4,5][d]+h,p=e[t+5]>>3,y=e[t+5]&7,v=new Uint8Array([i<<6|p<<1|y>>2,(y&3)<<6|d<<3|h<<2|l>>4,l<<4&224]),E=1536/a*9e4,T=r+s*E,A=e.subarray(t,t+c);return n.config=v,n.channelCount=g,n.samplerate=a,n.samples.push({unit:A,pts:T}),c}class bR extends Nf{resetInitSegment(e,t,r,s){super.resetInitSegment(e,t,r,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=oo(e,0);let r=(t==null?void 0:t.length)||0;if(t&&e[r]===11&&e[r+1]===119&&Of(t)!==void 0&&Wv(e,r)<=16)return!1;for(let s=e.length;r<s;r++)if(zv(e,r))return pe.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return wR(e,t)}appendFrame(e,t,r){if(this.basePTS!==null)return Vv(e,t,r,this.basePTS,this.frameIndex)}}const DR=/\/emsg[-/]ID3/i;class PR{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,r,s){const i=this.videoTrack=In("video",1),o=this.audioTrack=In("audio",1),a=this.txtTrack=In("text",1);if(this.id3Track=In("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const l=av(e);if(l.video){const{id:u,timescale:c,codec:d,supplemental:f}=l.video;i.id=u,i.timescale=a.timescale=c,i.codec=d,i.supplemental=f}if(l.audio){const{id:u,timescale:c,codec:d}=l.audio;o.id=u,o.timescale=c,o.codec=d}a.id=sv.text,i.sampleDuration=0,i.duration=o.duration=s}resetContiguity(){this.remainderData=null}static probe(e){return C1(e)}demux(e,t){this.timeOffset=t;let r=e;const s=this.videoTrack,i=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=Zt(this.remainderData,e));const a=U1(r);this.remainderData=a.remainder,s.samples=a.valid||new Uint8Array}else s.samples=r;const o=this.extractID3Track(s,t);return i.samples=Um(t,s),{videoTrack:s,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const s=this.extractID3Track(t,this.timeOffset);return r.samples=Um(e,t),{videoTrack:t,audioTrack:In(),id3Track:s,textTrack:In()}}extractID3Track(e,t){const r=this.id3Track;if(e.samples.length){const s=le(e.samples,["emsg"]);s&&s.forEach(i=>{const o=$1(i);if(DR.test(o.schemeIdUri)){const a=vg(o,t);let l=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const u=o.payload;r.samples.push({data:u,len:u.byteLength,dts:a,pts:a,type:Mt.emsg,duration:l})}else if(this.config.enableEmsgKLVMetadata&&o.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const a=vg(o,t);r.samples.push({data:o.payload,len:o.payload.byteLength,dts:a,pts:a,type:Mt.misbklv,duration:Number.POSITIVE_INFINITY})}})}return r}demuxSampleAes(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function vg(n,e){return K(n.presentationTime)?n.presentationTime/n.timeScale:e+n.presentationTimeDelta/n.timeScale}class OR{constructor(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new Rf(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,wr.cbc)}decryptAacSample(e,t,r){const s=e[t].unit;if(s.length<=16)return;const i=s.subarray(16,s.length-s.length%16),o=i.buffer.slice(i.byteOffset,i.byteOffset+i.length);this.decryptBuffer(o).then(a=>{const l=new Uint8Array(a);s.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,r)})}decryptAacSamples(e,t,r){for(;;t++){if(t>=e.length){r();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,r),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,r=new Int8Array(t);let s=0;for(let i=32;i<e.length-16;i+=160,s+=16)r.set(e.subarray(i,i+16),s);return r}getAvcDecryptedUnit(e,t){const r=new Uint8Array(t);let s=0;for(let i=32;i<e.length-16;i+=160,s+=16)e.set(r.subarray(s,s+16),i);return e}decryptAvcSample(e,t,r,s,i){const o=uv(i.data),a=this.getAvcEncryptedData(o);this.decryptBuffer(a.buffer).then(l=>{i.data=this.getAvcDecryptedUnit(o,l),this.decrypter.isSync()||this.decryptAvcSamples(e,t,r+1,s)})}decryptAvcSamples(e,t,r,s){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length){s();return}const i=e[t].units;for(;!(r>=i.length);r++){const o=i[r];if(!(o.data.length<=48||o.type!==1&&o.type!==5)&&(this.decryptAvcSample(e,t,r,s,o),!this.decrypter.isSync()))return}}}}class qv{constructor(){this.VideoSample=null}createVideoSample(e,t,r){return{key:e,frame:!1,pts:t,dts:r,units:[],length:0}}getLastNalUnit(e){var t;let r=this.VideoSample,s;if((!r||r.units.length===0)&&(r=e[e.length-1]),(t=r)!=null&&t.units){const i=r.units;s=i[i.length-1]}return s}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const r=t.samples,s=r.length;if(s){const i=r[s-1];e.pts=i.pts,e.dts=i.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,r){const s=t.byteLength;let i=e.naluState||0;const o=i,a=[];let l=0,u,c,d,f=-1,h=0;for(i===-1&&(f=0,h=this.getNALuType(t,0),i=0,l=1);l<s;){if(u=t[l++],!i){i=u?0:1;continue}if(i===1){i=u?0:2;continue}if(!u)i=3;else if(u===1){if(c=l-i-1,f>=0){const m={data:t.subarray(f,c),type:h};a.push(m)}else{const m=this.getLastNalUnit(e.samples);m&&(o&&l<=4-o&&m.state&&(m.data=m.data.subarray(0,m.data.byteLength-o)),c>0&&(m.data=Zt(m.data,t.subarray(0,c)),m.state=0))}l<s?(d=this.getNALuType(t,l),f=l,h=d,i=0):i=-1}else i=0}if(f>=0&&i>=0){const m={data:t.subarray(f,s),type:h,state:i};a.push(m)}if(a.length===0){const m=this.getLastNalUnit(e.samples);m&&(m.data=Zt(m.data,t))}return e.naluState=i,a}}class Di{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,r=e.byteLength-t,s=new Uint8Array(4),i=Math.min(4,t);if(i===0)throw new Error("no bytes available");s.set(e.subarray(r,r+i)),this.word=new DataView(s.buffer).getUint32(0),this.bitsAvailable=i*8,this.bytesAvailable-=i}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const r=this.word>>>32-t;if(e>32&&pe.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?r<<t|this.readBits(t):r}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class Eg extends qv{parsePES(e,t,r,s){const i=this.parseNALu(e,r.data,s);let o=this.VideoSample,a,l=!1;r.data=null,o&&i.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),i.forEach(u=>{var c,d;switch(u.type){case 1:{let g=!1;a=!0;const p=u.data;if(l&&p.length>4){const y=this.readSliceType(p);(y===2||y===4||y===7||y===9)&&(g=!0)}if(g){var f;(f=o)!=null&&f.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.frame=!0,o.key=g;break}case 5:a=!0,(c=o)!=null&&c.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.key=!0,o.frame=!0;break;case 6:{a=!0,Af(u.data,1,r.pts,t.samples);break}case 7:{var h,m;a=!0,l=!0;const g=u.data,p=this.readSPS(g);if(!e.sps||e.width!==p.width||e.height!==p.height||((h=e.pixelRatio)==null?void 0:h[0])!==p.pixelRatio[0]||((m=e.pixelRatio)==null?void 0:m[1])!==p.pixelRatio[1]){e.width=p.width,e.height=p.height,e.pixelRatio=p.pixelRatio,e.sps=[g];const y=g.subarray(1,4);let v="avc1.";for(let E=0;E<3;E++){let T=y[E].toString(16);T.length<2&&(T="0"+T),v+=T}e.codec=v}break}case 8:a=!0,e.pps=[u.data];break;case 9:a=!0,e.audFound=!0,(d=o)!=null&&d.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;case 12:a=!0;break;default:a=!1;break}o&&a&&o.units.push(u)}),s&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new Di(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let r=8,s=8,i;for(let o=0;o<e;o++)s!==0&&(i=t.readEG(),s=(r+i+256)%256),r=s===0?r:s}readSPS(e){const t=new Di(e);let r=0,s=0,i=0,o=0,a,l,u;const c=t.readUByte.bind(t),d=t.readBits.bind(t),f=t.readUEG.bind(t),h=t.readBoolean.bind(t),m=t.skipBits.bind(t),g=t.skipEG.bind(t),p=t.skipUEG.bind(t),y=this.skipScalingList.bind(this);c();const v=c();if(d(5),m(3),c(),p(),v===100||v===110||v===122||v===244||v===44||v===83||v===86||v===118||v===128){const I=f();if(I===3&&m(1),p(),p(),m(1),h())for(l=I!==3?8:12,u=0;u<l;u++)h()&&(u<6?y(16,t):y(64,t))}p();const E=f();if(E===0)f();else if(E===1)for(m(1),g(),g(),a=f(),u=0;u<a;u++)g();p(),m(1);const T=f(),A=f(),R=d(1);R===0&&m(1),m(1),h()&&(r=f(),s=f(),i=f(),o=f());let L=[1,1];if(h()&&h())switch(c()){case 1:L=[1,1];break;case 2:L=[12,11];break;case 3:L=[10,11];break;case 4:L=[16,11];break;case 5:L=[40,33];break;case 6:L=[24,11];break;case 7:L=[20,11];break;case 8:L=[32,11];break;case 9:L=[80,33];break;case 10:L=[18,11];break;case 11:L=[15,11];break;case 12:L=[64,33];break;case 13:L=[160,99];break;case 14:L=[4,3];break;case 15:L=[3,2];break;case 16:L=[2,1];break;case 255:{L=[c()<<8|c(),c()<<8|c()];break}}return{width:Math.ceil((T+1)*16-r*2-s*2),height:(2-R)*(A+1)*16-(R?2:4)*(i+o),pixelRatio:L}}}class xg extends qv{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,r,s){const i=this.parseNALu(e,r.data,s);let o=this.VideoSample,a,l=!1;r.data=null,o&&i.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),i.forEach(u=>{var c,d;switch(u.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o||(o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),o.frame=!0,a=!0;break;case 16:case 17:case 18:case 21:if(a=!0,l){var f;(f=o)!=null&&f.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.key=!0,o.frame=!0;break;case 19:case 20:a=!0,(c=o)!=null&&c.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.key=!0,o.frame=!0;break;case 39:a=!0,Af(u.data,2,r.pts,t.samples);break;case 32:a=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=Le(e.params,this.readVPS(u.data)),this.initVPS=u.data),e.vps=[u.data];break;case 33:if(a=!0,l=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],u.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const h=this.readSPS(u.data);e.width=h.width,e.height=h.height,e.pixelRatio=h.pixelRatio,e.codec=h.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const m in h.params)e.params[m]=h.params[m]}this.pushParameterSet(e.sps,u.data,e.vps),o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.key=!0;break;case 34:if(a=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const h=this.readPPS(u.data);for(const m in h)e.params[m]=h[m]}this.pushParameterSet(e.pps,u.data,e.vps)}break;case 35:a=!0,e.audFound=!0,(d=o)!=null&&d.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;default:a=!1;break}o&&a&&o.units.push(u)}),s&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}pushParameterSet(e,t,r){(r&&r[0]===this.initVPS||!r&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let r=0;for(let s=0;s<e.byteLength;s++)s>=2&&e[s]===3&&e[s-1]===0&&e[s-2]===0||(t[r]=e[s],r++);return new Uint8Array(t.buffer,0,r)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new Di(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const r=t.readBits(3),s=t.readBoolean();return{numTemporalLayers:r+1,temporalIdNested:s}}readSPS(e){const t=new Di(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const r=t.readBits(3);t.readBoolean();const s=t.readBits(2),i=t.readBoolean(),o=t.readBits(5),a=t.readUByte(),l=t.readUByte(),u=t.readUByte(),c=t.readUByte(),d=t.readUByte(),f=t.readUByte(),h=t.readUByte(),m=t.readUByte(),g=t.readUByte(),p=t.readUByte(),y=t.readUByte(),v=[],E=[];for(let re=0;re<r;re++)v.push(t.readBoolean()),E.push(t.readBoolean());if(r>0)for(let re=r;re<8;re++)t.readBits(2);for(let re=0;re<r;re++)v[re]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),E[re]&&t.readUByte();t.readUEG();const T=t.readUEG();T==3&&t.skipBits(1);const A=t.readUEG(),R=t.readUEG(),L=t.readBoolean();let I=0,C=0,_=0,F=0;L&&(I+=t.readUEG(),C+=t.readUEG(),_+=t.readUEG(),F+=t.readUEG());const B=t.readUEG(),ie=t.readUEG(),z=t.readUEG(),Y=t.readBoolean();for(let re=Y?0:r;re<=r;re++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let de=0;de<4;de++)for(let ye=0;ye<(de===3?2:6);ye++)if(!t.readBoolean())t.readUEG();else{const Ge=Math.min(64,1<<4+(de<<1));de>1&&t.readEG();for(let qe=0;qe<Ge;qe++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const M=t.readUEG();let P=0;for(let re=0;re<M;re++){let de=!1;if(re!==0&&(de=t.readBoolean()),de){re===M&&t.readUEG(),t.readBoolean(),t.readUEG();let ye=0;for(let Ue=0;Ue<=P;Ue++){const Ge=t.readBoolean();let qe=!1;Ge||(qe=t.readBoolean()),(Ge||qe)&&ye++}P=ye}else{const ye=t.readUEG(),Ue=t.readUEG();P=ye+Ue;for(let Ge=0;Ge<ye;Ge++)t.readUEG(),t.readBoolean();for(let Ge=0;Ge<Ue;Ge++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const re=t.readUEG();for(let de=0;de<re;de++){for(let ye=0;ye<z+4;ye++)t.readBits(1);t.readBits(1)}}let j=0,H=1,Q=1,ae=!0,J=1,ue=0;t.readBoolean(),t.readBoolean();let Ie=!1;if(t.readBoolean()){if(t.readBoolean()){const Tt=t.readUByte(),On=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],Ot=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];Tt>0&&Tt<16?(H=On[Tt-1],Q=Ot[Tt-1]):Tt===255&&(H=t.readBits(16),Q=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),Ie=t.readBoolean(),Ie&&(I+=t.readUEG(),C+=t.readUEG(),_+=t.readUEG(),F+=t.readUEG()),t.readBoolean()&&(J=t.readBits(32),ue=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const Ot=t.readBoolean(),Ht=t.readBoolean();let ht=!1;(Ot||Ht)&&(ht=t.readBoolean(),ht&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),ht&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let tr=0;tr<=r;tr++){ae=t.readBoolean();const vo=ae||t.readBoolean();let Qs=!1;vo?t.readEG():Qs=t.readBoolean();const ss=Qs?1:t.readUEG()+1;if(Ot)for(let nr=0;nr<ss;nr++)t.readUEG(),t.readUEG(),ht&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(Ht)for(let nr=0;nr<ss;nr++)t.readUEG(),t.readUEG(),ht&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),j=t.readUEG())}let tt=A,er=R;if(L||Ie){let re=1,de=1;T===1?re=de=2:T==2&&(re=2),tt=A-re*C-re*I,er=R-de*F-de*_}const Vt=s?["A","B","C"][s]:"",gn=a<<24|l<<16|u<<8|c;let Pn=0;for(let re=0;re<32;re++)Pn=(Pn|(gn>>re&1)<<31-re)>>>0;let ne=Pn.toString(16);return o===1&&ne==="2"&&(ne="6"),{codecString:`hvc1.${Vt}${o}.${ne}.${i?"H":"L"}${y}.B0`,params:{general_tier_flag:i,general_profile_idc:o,general_profile_space:s,general_profile_compatibility_flags:[a,l,u,c],general_constraint_indicator_flags:[d,f,h,m,g,p],general_level_idc:y,bit_depth:B+8,bit_depth_luma_minus8:B,bit_depth_chroma_minus8:ie,min_spatial_segmentation_idc:j,chroma_format_idc:T,frame_rate:{fixed:ae,fps:ue/J}},width:tt,height:er,pixelRatio:[H,Q]}}readPPS(e){const t=new Di(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const s=t.readBoolean(),i=t.readBoolean();let o=1;return i&&s?o=0:i?o=3:s&&(o=2),{parallelismType:o}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const Qe=188;class cr{constructor(e,t,r,s){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.logger=s,this.videoParser=null}static probe(e,t){const r=cr.syncOffset(e);return r>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${r}`),r!==-1}static syncOffset(e){const t=e.length;let r=Math.min(Qe*5,t-Qe)+1,s=0;for(;s<r;){let i=!1,o=-1,a=0;for(let l=s;l<t;l+=Qe)if(e[l]===71&&(t-l===Qe||e[l+Qe]===71)){if(a++,o===-1&&(o=l,o!==0&&(r=Math.min(o+Qe*99,e.length-Qe)+1)),i||(i=od(e,l)===0),i&&a>1&&(o===0&&a>2||l+Qe>r))return o}else{if(a)return-1;break}s++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:sv[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,r,s){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=cr.createTrack("video"),this._videoTrack.duration=s,this._audioTrack=cr.createTrack("audio",s),this._id3Track=cr.createTrack("id3"),this._txtTrack=cr.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=r}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:r}=this;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,r=!1,s=!1){r||(this.sampleAes=null);let i;const o=this._videoTrack,a=this._audioTrack,l=this._id3Track,u=this._txtTrack;let c=o.pid,d=o.pesData,f=a.pid,h=l.pid,m=a.pesData,g=l.pesData,p=null,y=this.pmtParsed,v=this._pmtId,E=e.length;if(this.remainderData&&(e=Zt(this.remainderData,e),E=e.length,this.remainderData=null),E<Qe&&!s)return this.remainderData=e,{audioTrack:a,videoTrack:o,id3Track:l,textTrack:u};const T=Math.max(0,cr.syncOffset(e));E-=(E-T)%Qe,E<e.byteLength&&!s&&(this.remainderData=new Uint8Array(e.buffer,E,e.buffer.byteLength-E));let A=0;for(let L=T;L<E;L+=Qe)if(e[L]===71){const I=!!(e[L+1]&64),C=od(e,L),_=(e[L+3]&48)>>4;let F;if(_>1){if(F=L+5+e[L+4],F===L+Qe)continue}else F=L+4;switch(C){case c:if(I){if(d&&(i=cs(d,this.logger))){if(this.videoParser===null)switch(o.segmentCodec){case"avc":this.videoParser=new Eg;break;case"hevc":this.videoParser=new xg;break}this.videoParser!==null&&this.videoParser.parsePES(o,u,i,!1)}d={data:[],size:0}}d&&(d.data.push(e.subarray(F,L+Qe)),d.size+=L+Qe-F);break;case f:if(I){if(m&&(i=cs(m,this.logger)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,i);break;case"mp3":this.parseMPEGPES(a,i);break;case"ac3":this.parseAC3PES(a,i);break}m={data:[],size:0}}m&&(m.data.push(e.subarray(F,L+Qe)),m.size+=L+Qe-F);break;case h:I&&(g&&(i=cs(g,this.logger))&&this.parseID3PES(l,i),g={data:[],size:0}),g&&(g.data.push(e.subarray(F,L+Qe)),g.size+=L+Qe-F);break;case 0:I&&(F+=e[F]+1),v=this._pmtId=NR(e,F);break;case v:{I&&(F+=e[F]+1);const B=MR(e,F,this.typeSupported,r,this.observer,this.logger);c=B.videoPid,c>0&&(o.pid=c,o.segmentCodec=B.segmentVideoCodec),f=B.audioPid,f>0&&(a.pid=f,a.segmentCodec=B.segmentAudioCodec),h=B.id3Pid,h>0&&(l.pid=h),p!==null&&!y&&(this.logger.warn(`MPEG-TS PMT found at ${L} after unknown PID '${p}'. Backtracking to sync byte @${T} to parse all TS packets.`),p=null,L=T-188),y=this.pmtParsed=!0;break}case 17:case 8191:break;default:p=C;break}}else A++;A>0&&ad(this.observer,new Error(`Found ${A} TS packet/s that do not start with 0x47`),void 0,this.logger),o.pesData=d,a.pesData=m,l.pesData=g;const R={audioTrack:a,videoTrack:o,id3Track:l,textTrack:u};return s&&this.extractRemainingSamples(R),R}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:r,id3Track:s,textTrack:i}=e,o=r.pesData,a=t.pesData,l=s.pesData;let u;if(o&&(u=cs(o,this.logger))){if(this.videoParser===null)switch(r.segmentCodec){case"avc":this.videoParser=new Eg;break;case"hevc":this.videoParser=new xg;break}this.videoParser!==null&&(this.videoParser.parsePES(r,i,u,!0),r.pesData=null)}else r.pesData=o;if(a&&(u=cs(a,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,u);break;case"mp3":this.parseMPEGPES(t,u);break;case"ac3":this.parseAC3PES(t,u);break}t.pesData=null}else a!=null&&a.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;l&&(u=cs(l,this.logger))?(this.parseID3PES(s,u),s.pesData=null):s.pesData=l}demuxSampleAes(e,t,r){const s=this.demux(e,r,!0,!this.config.progressive),i=this.sampleAes=new OR(this.observer,this.config,t);return this.decrypt(s,i)}decrypt(e,t){return new Promise(r=>{const{audioTrack:s,videoTrack:i}=e;s.samples&&s.segmentCodec==="aac"?t.decryptAacSamples(s.samples,0,()=>{i.samples?t.decryptAvcSamples(i.samples,0,0,()=>{r(e)}):r(e)}):i.samples&&t.decryptAvcSamples(i.samples,0,0,()=>{r(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let r=0;const s=this.aacOverFlow;let i=t.data;if(s){this.aacOverFlow=null;const d=s.missing,f=s.sample.unit.byteLength;if(d===-1)i=Zt(s.sample.unit,i);else{const h=f-d;s.sample.unit.set(i.subarray(0,d),h),e.samples.push(s.sample),r=s.missing}}let o,a;for(o=r,a=i.length;o<a-1&&!fl(i,o);o++);if(o!==r){let d;const f=o<a-1;if(f?d=`AAC PES did not start with ADTS header,offset:${o}`:d="No ADTS header found in AAC PES",ad(this.observer,new Error(d),f,this.logger),!f)return}Fv(e,this.observer,i,o,this.audioCodec);let l;if(t.pts!==void 0)l=t.pts;else if(s){const d=Uv(e.samplerate);l=s.sample.pts+d}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let u=0,c;for(;o<a;)if(c=Bv(e,i,o,l,u),o+=c.length,c.missing){this.aacOverFlow=c;break}else for(u++;o<a-1&&!fl(i,o);o++);}parseMPEGPES(e,t){const r=t.data,s=r.length;let i=0,o=0;const a=t.pts;if(a===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<s;)if(Kv(r,o)){const l=Vv(e,r,o,a,i);if(l)o+=l.length,i++;else break}else o++}parseAC3PES(e,t){{const r=t.data,s=t.pts;if(s===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const i=r.length;let o=0,a=0,l;for(;a<i&&(l=Yv(e,r,a,s,o++))>0;)a+=l}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const r=Le({},t,{type:this._videoTrack?Mt.emsg:Mt.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(r)}}function od(n,e){return((n[e+1]&31)<<8)+n[e+2]}function NR(n,e){return(n[e+10]&31)<<8|n[e+11]}function MR(n,e,t,r,s,i){const o={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},a=(n[e+1]&15)<<8|n[e+2],l=e+3+a-4,u=(n[e+10]&15)<<8|n[e+11];for(e+=12+u;e<l;){const c=od(n,e),d=(n[e+3]&15)<<8|n[e+4];switch(n[e]){case 207:if(!r){Ou("ADTS AAC",i);break}case 15:o.audioPid===-1&&(o.audioPid=c);break;case 21:o.id3Pid===-1&&(o.id3Pid=c);break;case 219:if(!r){Ou("H.264",i);break}case 27:o.videoPid===-1&&(o.videoPid=c);break;case 3:case 4:!t.mpeg&&!t.mp3?i.log("MPEG audio found, not supported in this browser"):o.audioPid===-1&&(o.audioPid=c,o.segmentAudioCodec="mp3");break;case 193:if(!r){Ou("AC-3",i);break}case 129:t.ac3?o.audioPid===-1&&(o.audioPid=c,o.segmentAudioCodec="ac3"):i.log("AC-3 audio found, not supported in this browser");break;case 6:if(o.audioPid===-1&&d>0){let f=e+5,h=d;for(;h>2;){switch(n[f]){case 106:t.ac3!==!0?i.log("AC-3 audio found, not supported in this browser for now"):(o.audioPid=c,o.segmentAudioCodec="ac3");break}const g=n[f+1]+2;f+=g,h-=g}}break;case 194:case 135:return ad(s,new Error("Unsupported EC-3 in M2TS found"),void 0,i),o;case 36:o.videoPid===-1&&(o.videoPid=c,o.segmentVideoCodec="hevc",i.log("HEVC in M2TS found"));break}e+=d+5}return o}function ad(n,e,t,r){r.warn(`parsing error: ${e.message}`),n.emit(x.ERROR,x.ERROR,{type:te.MEDIA_ERROR,details:b.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function Ou(n,e){e.log(`${n} with AES-128-CBC encryption found in unencrypted stream`)}function cs(n,e){let t=0,r,s,i,o,a;const l=n.data;if(!n||n.size===0)return null;for(;l[0].length<19&&l.length>1;)l[0]=Zt(l[0],l[1]),l.splice(1,1);if(r=l[0],(r[0]<<16)+(r[1]<<8)+r[2]===1){if(s=(r[4]<<8)+r[5],s&&s>n.size-6)return null;const c=r[7];c&192&&(o=(r[9]&14)*536870912+(r[10]&255)*4194304+(r[11]&254)*16384+(r[12]&255)*128+(r[13]&254)/2,c&64?(a=(r[14]&14)*536870912+(r[15]&255)*4194304+(r[16]&254)*16384+(r[17]&255)*128+(r[18]&254)/2,o-a>60*9e4&&(e.warn(`${Math.round((o-a)/9e4)}s delta between PTS and DTS, align them`),o=a)):a=o),i=r[8];let d=i+9;if(n.size<=d)return null;n.size-=d;const f=new Uint8Array(n.size);for(let h=0,m=l.length;h<m;h++){r=l[h];let g=r.byteLength;if(d)if(d>g){d-=g;continue}else r=r.subarray(d),g-=d,d=0;f.set(r,t),t+=g}return s&&(s-=i+3),{data:f,pts:o,dts:a,len:s}}return null}class FR{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const sr=Math.pow(2,32)-1;class k{static init(){k.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in k.types)k.types.hasOwnProperty(e)&&(k.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);k.HDLR_TYPES={video:t,audio:r};const s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);k.STTS=k.STSC=k.STCO=i,k.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),k.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),k.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),k.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const o=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);k.FTYP=k.box(k.types.ftyp,o,l,o,a),k.DINF=k.box(k.types.dinf,k.box(k.types.dref,s))}static box(e,...t){let r=8,s=t.length;const i=s;for(;s--;)r+=t[s].byteLength;const o=new Uint8Array(r);for(o[0]=r>>24&255,o[1]=r>>16&255,o[2]=r>>8&255,o[3]=r&255,o.set(e,4),s=0,r=8;s<i;s++)o.set(t[s],r),r+=t[s].byteLength;return o}static hdlr(e){return k.box(k.types.hdlr,k.HDLR_TYPES[e])}static mdat(e){return k.box(k.types.mdat,e)}static mdhd(e,t){t*=e;const r=Math.floor(t/(sr+1)),s=Math.floor(t%(sr+1));return k.box(k.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,s>>24,s>>16&255,s>>8&255,s&255,85,196,0,0]))}static mdia(e){return k.box(k.types.mdia,k.mdhd(e.timescale||0,e.duration||0),k.hdlr(e.type),k.minf(e))}static mfhd(e){return k.box(k.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?k.box(k.types.minf,k.box(k.types.smhd,k.SMHD),k.DINF,k.stbl(e)):k.box(k.types.minf,k.box(k.types.vmhd,k.VMHD),k.DINF,k.stbl(e))}static moof(e,t,r){return k.box(k.types.moof,k.mfhd(e),k.traf(r,t))}static moov(e){let t=e.length;const r=[];for(;t--;)r[t]=k.trak(e[t]);return k.box.apply(null,[k.types.moov,k.mvhd(e[0].timescale||0,e[0].duration||0)].concat(r).concat(k.mvex(e)))}static mvex(e){let t=e.length;const r=[];for(;t--;)r[t]=k.trex(e[t]);return k.box.apply(null,[k.types.mvex,...r])}static mvhd(e,t){t*=e;const r=Math.floor(t/(sr+1)),s=Math.floor(t%(sr+1)),i=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,s>>24,s>>16&255,s>>8&255,s&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return k.box(k.types.mvhd,i)}static sdtp(e){const t=e.samples||[],r=new Uint8Array(4+t.length);let s,i;for(s=0;s<t.length;s++)i=t[s].flags,r[s+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return k.box(k.types.sdtp,r)}static stbl(e){return k.box(k.types.stbl,k.stsd(e),k.box(k.types.stts,k.STTS),k.box(k.types.stsc,k.STSC),k.box(k.types.stsz,k.STSZ),k.box(k.types.stco,k.STCO))}static avc1(e){let t=[],r=[],s,i,o;for(s=0;s<e.sps.length;s++)i=e.sps[s],o=i.byteLength,t.push(o>>>8&255),t.push(o&255),t=t.concat(Array.prototype.slice.call(i));for(s=0;s<e.pps.length;s++)i=e.pps[s],o=i.byteLength,r.push(o>>>8&255),r.push(o&255),r=r.concat(Array.prototype.slice.call(i));const a=k.box(k.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(r))),l=e.width,u=e.height,c=e.pixelRatio[0],d=e.pixelRatio[1];return k.box(k.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,u>>8&255,u&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,k.box(k.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),k.box(k.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,c&255,d>>24,d>>16&255,d>>8&255,d&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return k.box(k.types.mp4a,k.audioStsd(e),k.box(k.types.esds,k.esds(e)))}static mp3(e){return k.box(k.types[".mp3"],k.audioStsd(e))}static ac3(e){return k.box(k.types["ac-3"],k.audioStsd(e),k.box(k.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return k.box(k.types.stsd,k.STSD,k.mp4a(e));if(t==="ac3"&&e.config)return k.box(k.types.stsd,k.STSD,k.ac3(e));if(t==="mp3"&&e.codec==="mp3")return k.box(k.types.stsd,k.STSD,k.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return k.box(k.types.stsd,k.STSD,k.avc1(e));if(t==="hevc"&&e.vps)return k.box(k.types.stsd,k.STSD,k.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,r=(e.duration||0)*(e.timescale||0),s=e.width||0,i=e.height||0,o=Math.floor(r/(sr+1)),a=Math.floor(r%(sr+1));return k.box(k.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,a>>24,a>>16&255,a>>8&255,a&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,s&255,0,0,i>>8&255,i&255,0,0]))}static traf(e,t){const r=k.sdtp(e),s=e.id,i=Math.floor(t/(sr+1)),o=Math.floor(t%(sr+1));return k.box(k.types.traf,k.box(k.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,s&255])),k.box(k.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,i&255,o>>24,o>>16&255,o>>8&255,o&255])),k.trun(e,r.length+16+20+8+16+8+8),r)}static trak(e){return e.duration=e.duration||4294967295,k.box(k.types.trak,k.tkhd(e),k.mdia(e))}static trex(e){const t=e.id;return k.box(k.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const r=e.samples||[],s=r.length,i=12+16*s,o=new Uint8Array(i);let a,l,u,c,d,f;for(t+=8+i,o.set([e.type==="video"?1:0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,s&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),a=0;a<s;a++)l=r[a],u=l.duration,c=l.size,d=l.flags,f=l.cts,o.set([u>>>24&255,u>>>16&255,u>>>8&255,u&255,c>>>24&255,c>>>16&255,c>>>8&255,c&255,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,d.degradPrio&61440,d.degradPrio&15,f>>>24&255,f>>>16&255,f>>>8&255,f&255],12+16*a);return k.box(k.types.trun,o)}static initSegment(e){k.types||k.init();const t=k.moov(e);return Zt(k.FTYP,t)}static hvc1(e){const t=e.params,r=[e.vps,e.sps,e.pps],s=4,i=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),s-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),r.length]);let o=i.length;for(let m=0;m<r.length;m+=1){o+=3;for(let g=0;g<r[m].length;g+=1)o+=2+r[m][g].length}const a=new Uint8Array(o);a.set(i,0),o=i.length;const l=r.length-1;for(let m=0;m<r.length;m+=1){a.set(new Uint8Array([32+m|(m===l?128:0),0,r[m].length]),o),o+=3;for(let g=0;g<r[m].length;g+=1)a.set(new Uint8Array([r[m][g].length>>8,r[m][g].length&255]),o),o+=2,a.set(r[m][g],o),o+=r[m][g].length}const u=k.box(k.types.hvcC,a),c=e.width,d=e.height,f=e.pixelRatio[0],h=e.pixelRatio[1];return k.box(k.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,c>>8&255,c&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u,k.box(k.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),k.box(k.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,f&255,h>>24,h>>16&255,h>>8&255,h&255])))}}k.types=void 0;k.HDLR_TYPES=void 0;k.STTS=void 0;k.STSC=void 0;k.STCO=void 0;k.STSZ=void 0;k.VMHD=void 0;k.SMHD=void 0;k.STSD=void 0;k.FTYP=void 0;k.DINF=void 0;const Xv=9e4;function Ff(n,e,t=1,r=!1){const s=n*e*t;return r?Math.round(s):s}function UR(n,e,t=1,r=!1){return Ff(n,e,1/t,r)}function ci(n,e=!1){return Ff(n,1e3,1/Xv,e)}function BR(n,e=1){return Ff(n,Xv,1/e)}const $R=10*1e3,jR=1024,GR=1152,VR=1536;let ds=null,Nu=null;function Sg(n,e,t,r){return{duration:e,size:t,cts:r,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:n?2:1,isNonSync:n?0:1}}}class Ta{constructor(e,t,r,s){if(this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.logger=s,this.ISGenerated=!1,ds===null){const o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);ds=o?parseInt(o[1]):0}if(Nu===null){const i=navigator.userAgent.match(/Safari\/(\d+)/i);Nu=i?parseInt(i[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){this.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const r=e[0].pts,s=e.reduce((i,o)=>{let a=o.pts,l=a-i;return l<-4294967296&&(t=!0,a=zt(a,r),l=a-i),l>0?i:a},r);return t&&this.logger.debug("PTS rollover detected"),s}remux(e,t,r,s,i,o,a,l){let u,c,d,f,h,m,g=i,p=i;const y=e.pid>-1,v=t.pid>-1,E=t.samples.length,T=e.samples.length>0,A=a&&E>0||E>1;if((!y||T)&&(!v||A)||this.ISGenerated||a){if(this.ISGenerated){var L,I,C,_;const z=this.videoTrackConfig;(z&&(t.width!==z.width||t.height!==z.height||((L=t.pixelRatio)==null?void 0:L[0])!==((I=z.pixelRatio)==null?void 0:I[0])||((C=t.pixelRatio)==null?void 0:C[1])!==((_=z.pixelRatio)==null?void 0:_[1]))||!z&&A||this.nextAudioPts===null&&T)&&this.resetInitSegment()}this.ISGenerated||(d=this.generateIS(e,t,i,o));const F=this.isVideoContiguous;let B=-1,ie;if(A&&(B=HR(t.samples),!F&&this.config.forceKeyFrameOnDiscontinuity))if(m=!0,B>0){this.logger.warn(`[mp4-remuxer]: Dropped ${B} out of ${E} video samples due to a missing keyframe`);const z=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(B),t.dropped+=B,p+=(t.samples[0].pts-z)/t.inputTimeScale,ie=p}else B===-1&&(this.logger.warn(`[mp4-remuxer]: No keyframe found out of ${E} video samples`),m=!1);if(this.ISGenerated){if(T&&A){const z=this.getVideoStartPts(t.samples),V=(zt(e.samples[0].pts,z)-z)/t.inputTimeScale;g+=Math.max(0,V),p+=Math.max(0,-V)}if(T){if(e.samplerate||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),d=this.generateIS(e,t,i,o)),c=this.remuxAudio(e,g,this.isAudioContiguous,o,v||A||l===Z.AUDIO?p:void 0),A){const z=c?c.endPTS-c.startPTS:0;t.inputTimeScale||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),d=this.generateIS(e,t,i,o)),u=this.remuxVideo(t,p,F,z)}}else A&&(u=this.remuxVideo(t,p,F,0));u&&(u.firstKeyFrame=B,u.independent=B!==-1,u.firstKeyFramePTS=ie)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(h=Qv(r,i,this._initPTS,this._initDTS)),s.samples.length&&(f=Jv(s,i,this._initPTS))),{audio:c,video:u,initSegment:d,independent:m,text:f,id3:h}}generateIS(e,t,r,s){const i=e.samples,o=t.samples,a=this.typeSupported,l={},u=this._initPTS;let c=!u||s,d="audio/mp4",f,h,m;if(c&&(f=h=1/0),e.config&&i.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":a.mpeg?(d="audio/mpeg",e.codec=""):a.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}l.audio={id:"audio",container:d,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&a.mpeg?new Uint8Array(0):k.initSegment([e]),metadata:{channelCount:e.channelCount}},c&&(m=e.inputTimeScale,!u||m!==u.timescale?f=h=i[0].pts-Math.round(m*r):c=!1)}if(t.sps&&t.pps&&o.length){if(t.timescale=t.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:k.initSegment([t]),metadata:{width:t.width,height:t.height}},c)if(m=t.inputTimeScale,!u||m!==u.timescale){const g=this.getVideoStartPts(o),p=Math.round(m*r);h=Math.min(h,zt(o[0].dts,g)-p),f=Math.min(f,g-p)}else c=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(l).length)return this.ISGenerated=!0,c?(this._initPTS={baseTime:f,timescale:m},this._initDTS={baseTime:h,timescale:m}):f=m=void 0,{tracks:l,initPTS:f,timescale:m}}remuxVideo(e,t,r,s){const i=e.inputTimeScale,o=e.samples,a=[],l=o.length,u=this._initPTS;let c=this.nextAvcDts,d=8,f=this.videoSampleDuration,h,m,g=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,y=!1;if(!r||c===null){const P=t*i,N=o[0].pts-zt(o[0].dts,o[0].pts);ds&&c!==null&&Math.abs(P-N-c)<15e3?r=!0:c=P-N}const v=u.baseTime*i/u.timescale;for(let P=0;P<l;P++){const N=o[P];N.pts=zt(N.pts-v,c),N.dts=zt(N.dts-v,c),N.dts<o[P>0?P-1:P].dts&&(y=!0)}y&&o.sort(function(P,N){const j=P.dts-N.dts,H=P.pts-N.pts;return j||H}),h=o[0].dts,m=o[o.length-1].dts;const E=m-h,T=E?Math.round(E/(l-1)):f||e.inputTimeScale/30;if(r){const P=h-c,N=P>T,j=P<-1;if((N||j)&&(N?this.logger.warn(`${(e.segmentCodec||"").toUpperCase()}: ${ci(P,!0)} ms (${P}dts) hole between fragments detected at ${t.toFixed(3)}`):this.logger.warn(`${(e.segmentCodec||"").toUpperCase()}: ${ci(-P,!0)} ms (${P}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!j||c>=o[0].pts||ds)){h=c;const H=o[0].pts-P;if(N)o[0].dts=h,o[0].pts=H;else{let Q=!0;for(let ae=0;ae<o.length&&!(o[ae].dts>H&&Q);ae++){const J=o[ae].pts;if(o[ae].dts-=P,o[ae].pts-=P,ae<o.length-1){const ue=o[ae+1].pts,Ie=o[ae].pts,He=ue<=Ie,tt=ue<=J;Q=He==tt}}}this.logger.log(`Video: Initial PTS/DTS adjusted: ${ci(H,!0)}/${ci(h,!0)}, delta: ${ci(P,!0)} ms`)}}h=Math.max(0,h);let A=0,R=0,L=h;for(let P=0;P<l;P++){const N=o[P],j=N.units,H=j.length;let Q=0;for(let ae=0;ae<H;ae++)Q+=j[ae].data.length;R+=Q,A+=H,N.length=Q,N.dts<L?(N.dts=L,L+=T/4|0||1):L=N.dts,g=Math.min(N.pts,g),p=Math.max(N.pts,p)}m=o[l-1].dts;const I=R+4*A+8;let C;try{C=new Uint8Array(I)}catch(P){this.observer.emit(x.ERROR,x.ERROR,{type:te.MUX_ERROR,details:b.REMUX_ALLOC_ERROR,fatal:!1,error:P,bytes:I,reason:`fail allocating video mdat ${I}`});return}const _=new DataView(C.buffer);_.setUint32(0,I),C.set(k.types.mdat,4);let F=!1,B=Number.POSITIVE_INFINITY,ie=Number.POSITIVE_INFINITY,z=Number.NEGATIVE_INFINITY,Y=Number.NEGATIVE_INFINITY;for(let P=0;P<l;P++){const N=o[P],j=N.units;let H=0;for(let J=0,ue=j.length;J<ue;J++){const Ie=j[J],He=Ie.data,tt=Ie.data.byteLength;_.setUint32(d,tt),d+=4,C.set(He,d),d+=tt,H+=4+tt}let Q;if(P<l-1)f=o[P+1].dts-N.dts,Q=o[P+1].pts-N.pts;else{const J=this.config,ue=P>0?N.dts-o[P-1].dts:T;if(Q=P>0?N.pts-o[P-1].pts:T,J.stretchShortVideoTrack&&this.nextAudioPts!==null){const Ie=Math.floor(J.maxBufferHole*i),He=(s?g+s*i:this.nextAudioPts)-N.pts;He>Ie?(f=He-ue,f<0?f=ue:F=!0,this.logger.log(`[mp4-remuxer]: It is approximately ${He/90} ms to the next segment; using duration ${f/90} ms for the last video frame.`)):f=ue}else f=ue}const ae=Math.round(N.pts-N.dts);B=Math.min(B,f),z=Math.max(z,f),ie=Math.min(ie,Q),Y=Math.max(Y,Q),a.push(Sg(N.key,f,H,ae))}if(a.length){if(ds){if(ds<70){const P=a[0].flags;P.dependsOn=2,P.isNonSync=0}}else if(Nu&&Y-ie<z-B&&T/z<.025&&a[0].cts===0){this.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let P=h;for(let N=0,j=a.length;N<j;N++){const H=P+a[N].duration,Q=P+a[N].cts;if(N<j-1){const ae=H+a[N+1].cts;a[N].duration=ae-Q}else a[N].duration=N?a[N-1].duration:T;a[N].cts=0,P=H}}}f=F||!f?T:f,this.nextAvcDts=c=m+f,this.videoSampleDuration=f,this.isVideoContiguous=!0;const M={data1:k.moof(e.sequenceNumber++,h,Le(e,{samples:a})),data2:C,startPTS:g/i,endPTS:(p+f)/i,startDTS:h/i,endDTS:c/i,type:"video",hasAudio:!1,hasVideo:!0,nb:a.length,dropped:e.dropped};return e.samples=[],e.dropped=0,M}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return GR;case"ac3":return VR;default:return jR}}remuxAudio(e,t,r,s,i){const o=e.inputTimeScale,a=e.samplerate?e.samplerate:o,l=o/a,u=this.getSamplesPerFrame(e),c=u*l,d=this._initPTS,f=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,h=[],m=i!==void 0;let g=e.samples,p=f?0:8,y=this.nextAudioPts||-1;const v=t*o,E=d.baseTime*o/d.timescale;if(this.isAudioContiguous=r=r||g.length&&y>0&&(s&&Math.abs(v-y)<9e3||Math.abs(zt(g[0].pts-E,v)-y)<20*c),g.forEach(function(V){V.pts=zt(V.pts-E,v)}),!r||y<0){if(g=g.filter(V=>V.pts>=0),!g.length)return;i===0?y=0:s&&!m?y=Math.max(0,v):y=g[0].pts}if(e.segmentCodec==="aac"){const V=this.config.maxAudioFramesDrift;for(let W=0,M=y;W<g.length;W++){const P=g[W],N=P.pts,j=N-M,H=Math.abs(1e3*j/o);if(j<=-V*c&&m)W===0&&(this.logger.warn(`Audio frame @ ${(N/o).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*j/o)} ms.`),this.nextAudioPts=y=M=N);else if(j>=V*c&&H<$R&&m){let Q=Math.round(j/c);M=N-Q*c,M<0&&(Q--,M+=c),W===0&&(this.nextAudioPts=y=M),this.logger.warn(`[mp4-remuxer]: Injecting ${Q} audio frame @ ${(M/o).toFixed(3)}s due to ${Math.round(1e3*j/o)} ms gap.`);for(let ae=0;ae<Q;ae++){const J=Math.max(M,0);let ue=FR.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);ue||(this.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),ue=P.unit.subarray()),g.splice(W,0,{unit:ue,pts:J}),M+=c,W++}}P.pts=M,M+=c}}let T=null,A=null,R,L=0,I=g.length;for(;I--;)L+=g[I].unit.byteLength;for(let V=0,W=g.length;V<W;V++){const M=g[V],P=M.unit;let N=M.pts;if(A!==null){const H=h[V-1];H.duration=Math.round((N-A)/l)}else if(r&&e.segmentCodec==="aac"&&(N=y),T=N,L>0){L+=p;try{R=new Uint8Array(L)}catch(H){this.observer.emit(x.ERROR,x.ERROR,{type:te.MUX_ERROR,details:b.REMUX_ALLOC_ERROR,fatal:!1,error:H,bytes:L,reason:`fail allocating audio mdat ${L}`});return}f||(new DataView(R.buffer).setUint32(0,L),R.set(k.types.mdat,4))}else return;R.set(P,p);const j=P.byteLength;p+=j,h.push(Sg(!0,u,j,0)),A=N}const C=h.length;if(!C)return;const _=h[h.length-1];this.nextAudioPts=y=A+l*_.duration;const F=f?new Uint8Array(0):k.moof(e.sequenceNumber++,T/l,Le({},e,{samples:h}));e.samples=[];const B=T/o,ie=y/o,Y={data1:F,data2:R,startPTS:B,endPTS:ie,startDTS:B,endDTS:ie,type:"audio",hasAudio:!0,hasVideo:!1,nb:C};return this.isAudioContiguous=!0,Y}}function zt(n,e){let t;if(e===null)return n;for(e<n?t=-8589934592:t=8589934592;Math.abs(n-e)>4294967296;)n+=t;return n}function HR(n){for(let e=0;e<n.length;e++)if(n[e].key)return e;return-1}function Qv(n,e,t,r){const s=n.samples.length;if(!s)return;const i=n.inputTimeScale;for(let a=0;a<s;a++){const l=n.samples[a];l.pts=zt(l.pts-t.baseTime*i/t.timescale,e*i)/i,l.dts=zt(l.dts-r.baseTime*i/r.timescale,e*i)/i}const o=n.samples;return n.samples=[],{samples:o}}function Jv(n,e,t){const r=n.samples.length;if(!r)return;const s=n.inputTimeScale;for(let o=0;o<r;o++){const a=n.samples[o];a.pts=zt(a.pts-t.baseTime*s/t.timescale,e*s)/s}n.samples.sort((o,a)=>o.pts-a.pts);const i=n.samples;return n.samples=[],{samples:i}}class KR{constructor(e,t,r,s){this.logger=void 0,this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.logger=s}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,t,r,s){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(P1(e,s)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:r}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const s=this.initData=av(e);s.audio&&(t=Tg(s.audio,Te.AUDIO)),s.video&&(r=Tg(s.video,Te.VIDEO));const i={};s.audio&&s.video?i.audiovideo={container:"video/mp4",codec:t+","+r,supplemental:s.video.supplemental,initSegment:e,id:"main"}:s.audio?i.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:s.video?i.video={container:"video/mp4",codec:r,supplemental:s.video.supplemental,initSegment:e,id:"main"}:this.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=i}remux(e,t,r,s,i,o){var a,l;let{initPTS:u,lastEndTime:c}=this;const d={audio:void 0,video:void 0,text:s,id3:r,initSegment:void 0};K(c)||(c=this.lastEndTime=i||0);const f=t.samples;if(!(f!=null&&f.length))return d;const h={initPTS:void 0,timescale:1};let m=this.initData;if((a=m)!=null&&a.length||(this.generateInitSegment(f),m=this.initData),!((l=m)!=null&&l.length))return this.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),d;this.emitInitSegment&&(h.tracks=this.initTracks,this.emitInitSegment=!1);const g=N1(f,m),p=O1(m,f),y=p===null?i:p;(o||!u)&&(zR(u,y,i,g)||h.timescale!==u.timescale)&&(h.initPTS=y-i,u&&u.timescale===1&&this.logger.warn(`Adjusting initPTS @${i} from ${u.baseTime/u.timescale} to ${h.initPTS}`),this.initPTS=u={baseTime:h.initPTS,timescale:1});const v=e?y-u.baseTime/u.timescale:c,E=v+g;F1(m,f,u.baseTime/u.timescale),g>0?this.lastEndTime=E:(this.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const T=!!m.audio,A=!!m.video;let R="";T&&(R+="audio"),A&&(R+="video");const L={data1:f,startPTS:v,startDTS:v,endPTS:E,endDTS:E,type:R,hasAudio:T,hasVideo:A,nb:1,dropped:0};return d.audio=L.type==="audio"?L:void 0,d.video=L.type!=="audio"?L:void 0,d.initSegment=h,d.id3=Qv(r,i,u,u),s.samples.length&&(d.text=Jv(s,i,u)),d}}function zR(n,e,t,r){if(n===null)return!0;const s=Math.max(r,1),i=e-n.baseTime/n.timescale;return Math.abs(i-t)>s}function Tg(n,e){const t=n==null?void 0:n.codec;return t&&t.length>4?t:e===Te.AUDIO?t==="ec-3"||t==="ac-3"||t==="alac"?t:t==="fLaC"||t==="Opus"?il(t,!1):(pe.warn(`Unhandled audio codec "${t}" in mp4 MAP`),t||"mp4a"):(pe.warn(`Unhandled video codec "${t}" in mp4 MAP`),t||"avc1")}let jn;try{jn=self.performance.now.bind(self.performance)}catch{jn=Date.now}const Aa=[{demux:PR,remux:KR},{demux:cr,remux:Ta},{demux:kR,remux:Ta},{demux:bR,remux:Ta}];Aa.splice(2,0,{demux:CR,remux:Ta});class Ag{constructor(e,t,r,s,i,o){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=r,this.id=i,this.logger=o}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,r,s){const i=r.transmuxing;i.executeStart=jn();let o=new Uint8Array(e);const{currentTransmuxState:a,transmuxConfig:l}=this;s&&(this.currentTransmuxState=s);const{contiguous:u,discontinuity:c,trackSwitch:d,accurateTimeOffset:f,timeOffset:h,initSegmentChange:m}=s||a,{audioCodec:g,videoCodec:p,defaultInitPts:y,duration:v,initSegmentData:E}=l,T=WR(o,t);if(T&&bs(T.method)){const I=this.getDecrypter(),C=wf(T.method);if(I.isSync()){let _=I.softwareDecrypt(o,T.key.buffer,T.iv.buffer,C);if(r.part>-1){const B=I.flush();_=B&&B.buffer}if(!_)return i.executeEnd=jn(),Mu(r);o=new Uint8Array(_)}else return this.asyncResult=!0,this.decryptionPromise=I.webCryptoDecrypt(o,T.key.buffer,T.iv.buffer,C).then(_=>{const F=this.push(_,null,r);return this.decryptionPromise=null,F}),this.decryptionPromise}const A=this.needsProbing(c,d);if(A){const I=this.configureTransmuxer(o);if(I)return this.logger.warn(`[transmuxer] ${I.message}`),this.observer.emit(x.ERROR,x.ERROR,{type:te.MEDIA_ERROR,details:b.FRAG_PARSING_ERROR,fatal:!1,error:I,reason:I.message}),i.executeEnd=jn(),Mu(r)}(c||d||m||A)&&this.resetInitSegment(E,g,p,v,t),(c||m||A)&&this.resetInitialTimestamp(y),u||this.resetContiguity();const R=this.transmux(o,T,h,f,r);this.asyncResult=ao(R);const L=this.currentTransmuxState;return L.contiguous=!0,L.discontinuity=!1,L.trackSwitch=!1,i.executeEnd=jn(),R}flush(e){const t=e.transmuxing;t.executeStart=jn();const{decrypter:r,currentTransmuxState:s,decryptionPromise:i}=this;if(i)return this.asyncResult=!0,i.then(()=>this.flush(e));const o=[],{timeOffset:a}=s;if(r){const d=r.flush();d&&o.push(this.push(d.buffer,null,e))}const{demuxer:l,remuxer:u}=this;if(!l||!u){t.executeEnd=jn();const d=[Mu(e)];return this.asyncResult?Promise.resolve(d):d}const c=l.flush(a);return ao(c)?(this.asyncResult=!0,c.then(d=>(this.flushRemux(o,d,e),o))):(this.flushRemux(o,c,e),this.asyncResult?Promise.resolve(o):o)}flushRemux(e,t,r){const{audioTrack:s,videoTrack:i,id3Track:o,textTrack:a}=t,{accurateTimeOffset:l,timeOffset:u}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${r.sn}${r.part>-1?" part: "+r.part:""} of ${this.id===Z.MAIN?"level":"track"} ${r.level}`);const c=this.remuxer.remux(s,i,o,a,u,l,!0,this.id);e.push({remuxResult:c,chunkMeta:r}),r.transmuxing.executeEnd=jn()}resetInitialTimestamp(e){const{demuxer:t,remuxer:r}=this;!t||!r||(t.resetTimeStamp(e),r.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,r,s,i){const{demuxer:o,remuxer:a}=this;!o||!a||(o.resetInitSegment(e,t,r,s),a.resetInitSegment(e,t,r,i))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,r,s,i){let o;return t&&t.method==="SAMPLE-AES"?o=this.transmuxSampleAes(e,t,r,s,i):o=this.transmuxUnencrypted(e,r,s,i),o}transmuxUnencrypted(e,t,r,s){const{audioTrack:i,videoTrack:o,id3Track:a,textTrack:l}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(i,o,a,l,t,r,!1,this.id),chunkMeta:s}}transmuxSampleAes(e,t,r,s,i){return this.demuxer.demuxSampleAes(e,t,r).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,r,s,!1,this.id),chunkMeta:i}))}configureTransmuxer(e){const{config:t,observer:r,typeSupported:s}=this;let i;for(let d=0,f=Aa.length;d<f;d++){var o;if((o=Aa[d].demux)!=null&&o.probe(e,this.logger)){i=Aa[d];break}}if(!i)return new Error("Failed to find demuxer by probing fragment data");const a=this.demuxer,l=this.remuxer,u=i.remux,c=i.demux;(!l||!(l instanceof u))&&(this.remuxer=new u(r,t,s,this.logger)),(!a||!(a instanceof c))&&(this.demuxer=new c(r,t,s,this.logger),this.probe=c.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Rf(this.config)),e}}function WR(n,e){let t=null;return n.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const Mu=n=>({remuxResult:{},chunkMeta:n});function ao(n){return"then"in n&&n.then instanceof Function}class YR{constructor(e,t,r,s,i){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=r,this.duration=s,this.defaultInitPts=i||null}}class qR{constructor(e,t,r,s,i,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=r,this.trackSwitch=s,this.timeOffset=i,this.initSegmentChange=o}}let Lg=0;class Zv{constructor(e,t,r,s){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=Lg++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=l=>{const u=l.data,c=this.hls;if(!(!c||!(u!=null&&u.event)||u.instanceNo!==this.instanceNo))switch(u.event){case"init":{var d;const f=(d=this.workerContext)==null?void 0:d.objectURL;f&&self.URL.revokeObjectURL(f);break}case"transmuxComplete":{this.handleTransmuxComplete(u.data);break}case"flush":{this.onFlush(u.data);break}case"workerLog":{c.logger[u.data.logType]&&c.logger[u.data.logType](u.data.message);break}default:{u.data=u.data||{},u.data.frag=this.frag,u.data.part=this.part,u.data.id=this.id,c.trigger(u.event,u.data);break}}},this.onWorkerError=l=>{if(!this.hls)return;const u=new Error(`${l.message}  (${l.filename}:${l.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(x.ERROR,{type:te.OTHER_ERROR,details:b.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:u})};const i=e.config;this.hls=e,this.id=t,this.useWorker=!!i.enableWorker,this.onTransmuxComplete=r,this.onFlush=s;const o=(l,u)=>{u=u||{},u.frag=this.frag||void 0,l===x.ERROR&&(u=u,u.parent=this.id,u.part=this.part,this.error=u.error),this.hls.trigger(l,u)};this.observer=new bf,this.observer.on(x.FRAG_DECRYPTED,o),this.observer.on(x.ERROR,o);const a=$m(i.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const l=this.hls.logger;if(i.workerPath||JI()){try{i.workerPath?(l.log(`loading Web Worker ${i.workerPath} for "${t}"`),this.workerContext=eR(i.workerPath)):(l.log(`injecting Web Worker for "${t}"`),this.workerContext=ZI());const{worker:c}=this.workerContext;c.addEventListener("message",this.onWorkerMessage),c.addEventListener("error",this.onWorkerError),c.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:a,id:t,config:be(i)})}catch(c){l.warn(`Error setting up "${t}" Web Worker, fallback to inline`,c),this.terminateWorker(),this.error=null,this.transmuxer=new Ag(this.observer,a,i,"",t,e.logger)}return}}this.transmuxer=new Ag(this.observer,a,i,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=Lg++;const t=this.hls.config,r=$m(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:r,id:this.id,config:be(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),tR(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,r,s,i,o,a,l,u,c){var d,f;u.transmuxing.start=self.performance.now();const{instanceNo:h,transmuxer:m}=this,g=o?o.start:i.start,p=i.decryptdata,y=this.frag,v=!(y&&i.cc===y.cc),E=!(y&&u.level===y.level),T=y?u.sn-y.sn:-1,A=this.part?u.part-this.part.index:-1,R=T===0&&u.id>1&&u.id===(y==null?void 0:y.stats.chunkCount),L=!E&&(T===1||T===0&&(A===1||R&&A<=0)),I=self.performance.now();(E||T||i.stats.parsing.start===0)&&(i.stats.parsing.start=I),o&&(A||!L)&&(o.stats.parsing.start=I);const C=!(y&&((d=i.initSegment)==null?void 0:d.url)===((f=y.initSegment)==null?void 0:f.url)),_=new qR(v,L,l,E,g,C);if(!L||v||C){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${i.type} sn: ${u.sn}${u.part>-1?" part: "+u.part:""} ${this.id===Z.MAIN?"level":"track"}: ${u.level} id: ${u.id}
        discontinuity: ${v}
        trackSwitch: ${E}
        contiguous: ${L}
        accurateTimeOffset: ${l}
        timeOffset: ${g}
        initSegmentChange: ${C}`);const F=new YR(r,s,t,a,c);this.configureTransmuxer(F)}if(this.frag=i,this.part=o,this.workerContext)this.workerContext.worker.postMessage({instanceNo:h,cmd:"demux",data:e,decryptdata:p,chunkMeta:u,state:_},e instanceof ArrayBuffer?[e]:[]);else if(m){const F=m.push(e,p,u,_);ao(F)?F.then(B=>{this.handleTransmuxComplete(B)}).catch(B=>{this.transmuxerError(B,u,"transmuxer-interface push error")}):this.handleTransmuxComplete(F)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:r}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(r){const s=r.flush(e);ao(s)?s.then(i=>{this.handleFlushResult(i,e)}).catch(i=>{this.transmuxerError(i,e,"transmuxer-interface flush error")}):this.handleFlushResult(s,e)}}transmuxerError(e,t,r){this.hls&&(this.error=e,this.hls.trigger(x.ERROR,{type:te.MEDIA_ERROR,details:b.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:r}))}handleFlushResult(e,t){e.forEach(r=>{this.handleTransmuxComplete(r)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:r}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):r&&r.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const Ig=100;class XR extends Cf{constructor(e,t,r){super(e,t,r,"audio-stream-controller",Z.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(x.LEVEL_LOADED,this.onLevelLoaded,this),e.on(x.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(x.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(x.BUFFER_RESET,this.onBufferReset,this),e.on(x.BUFFER_CREATED,this.onBufferCreated,this),e.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(x.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(x.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(x.FRAG_LOADING,this.onFragLoading,this),e.on(x.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(x.LEVEL_LOADED,this.onLevelLoaded,this),e.off(x.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(x.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(x.BUFFER_RESET,this.onBufferReset,this),e.off(x.BUFFER_CREATED,this.onBufferCreated,this),e.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(x.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(x.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(x.FRAG_LOADING,this.onFragLoading,this),e.off(x.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:r,initPTS:s,timescale:i}){if(r===Z.MAIN){const o=t.cc,a=this.fragCurrent;if(this.initPTS[o]={baseTime:s,timescale:i},this.log(`InitPTS for cc: ${o} found from main: ${s}/${i}`),this.mainAnchor=t,this.state===U.WAITING_INIT_PTS){const l=this.waitingData;(!l&&!this.loadingParts||l&&l.frag.cc!==o)&&(this.nextLoadPosition=this.findSyncFrag(t).start),this.tick()}else!this.hls.hasEnoughToStart&&a&&a.cc!==o?(this.startFragRequested=!1,this.nextLoadPosition=this.findSyncFrag(t).start,a.abortRequests(),this.resetLoadingState()):this.state===U.IDLE&&this.tick()}}findSyncFrag(e){const t=this.getLevelDetails(),r=e.cc;return fI(t,r,e)||t&&vv(t.fragments,r)||e}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=U.STOPPED;return}const r=this.lastCurrentTime;this.stopLoad(),this.setInterval(Ig),r>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${r.toFixed(3)}`),e=r,this.state=U.IDLE):this.state=U.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case U.IDLE:this.doTickIdle();break;case U.WAITING_TRACK:{const{levels:t,trackId:r}=this,s=t==null?void 0:t[r],i=s==null?void 0:s.details;if(i&&!this.waitForLive(s)){if(this.waitForCdnTuneIn(i))break;this.state=U.WAITING_INIT_PTS}break}case U.FRAG_LOADING_WAITING_RETRY:{var e;const t=performance.now(),r=this.retryDate;if(!r||t>=r||(e=this.media)!=null&&e.seeking){const{levels:s,trackId:i}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((s==null?void 0:s[i])||null),this.state=U.IDLE}break}case U.WAITING_INIT_PTS:{const t=this.waitingData;if(t){const{frag:r,part:s,cache:i,complete:o}=t,a=this.mainAnchor;if(this.initPTS[r.cc]!==void 0){this.waitingData=null,this.state=U.FRAG_LOADING;const l=i.flush().buffer,u={frag:r,part:s,payload:l,networkDetails:null};this._handleFragmentLoadProgress(u),o&&super._handleFragmentLoadComplete(u)}else a&&a.cc!==t.frag.cc&&(this.log(`Waiting fragment cc (${r.cc}) cancelled because video is at cc ${a.cc}`),this.nextLoadPosition=this.findSyncFrag(a).start,this.clearWaitingFragment())}else this.state=U.IDLE}}this.onTickEnd()}clearWaitingFragment(){const e=this.waitingData;e&&(this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.state!==U.STOPPED&&(this.state=U.IDLE))}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:r,media:s,trackId:i}=this,o=t.config;if(!this.buffering||!s&&!this.primaryPrefetch&&(this.startFragRequested||!o.startFragPrefetch)||!(r!=null&&r[i]))return;const a=r[i],l=a.details;if(!l||this.waitForLive(a)||this.waitForCdnTuneIn(l)){this.state=U.WAITING_TRACK,this.startFragRequested=!1;return}const u=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&u&&(this.bufferFlushed=!1,this.afterBufferFlushed(u,Te.AUDIO,Z.AUDIO));const c=this.getFwdBufferInfo(u,Z.AUDIO);if(c===null)return;if(!this.switchingTrack&&this._streamEnded(c,l)){t.trigger(x.BUFFER_EOS,{type:"audio"}),this.state=U.ENDED;return}const d=c.len,f=t.maxBufferLength,h=l.fragments,m=h[0].start,g=this.getLoadPosition(),p=this.flushing?g:c.end;if(this.switchingTrack&&s){const E=g;l.PTSKnown&&E<m&&(c.end>m||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),s.currentTime=m+.05)}if(d>=f&&!this.switchingTrack&&p<h[h.length-1].start)return;let y=this.getNextFragment(p,l);if(y&&this.isLoopLoading(y,p)&&(y=this.getNextFragmentLoopLoading(y,l,c,Z.MAIN,f)),!y){this.bufferFlushed=!0;return}let v=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&v&&Ze(y)&&!y.endList&&(!l.live||!this.loadingParts&&p<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(v)===We.OK&&(this.mainFragLoading=v=null),v&&Ze(v))){if(y.start>v.end){const T=this.fragmentTracker.getFragAtPos(p,Z.MAIN);T&&T.end>v.end&&(v=T,this.mainFragLoading={frag:T,targetBufferTime:null})}if(y.start>v.end)return}this.loadFragment(y,a,p)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(r=>new no(r))}onAudioTrackSwitching(e,t){const r=!!t.url;this.trackId=t.id;const{fragCurrent:s}=this;s&&(s.abortRequests(),this.removeUnbufferedFrags(s.start)),this.resetLoadingState(),r?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==U.STOPPED&&(this.setInterval(Ig),this.state=U.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const r=this.cachedTrackLoadedData;r&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(x.AUDIO_TRACK_LOADED,r))}onAudioTrackLoaded(e,t){var r;const{levels:s}=this,{details:i,id:o,groupId:a,track:l}=t;if(!s){this.warn(`Audio tracks reset while loading track ${o} "${l.name}" of "${a}"`);return}const u=this.mainDetails;if(!u||i.endCC>u.endCC||u.expired){this.cachedTrackLoadedData=t,this.state!==U.STOPPED&&(this.state=U.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${o} "${l.name}" of "${a}" loaded [${i.startSN},${i.endSN}]${i.lastPartSn?`[part-${i.lastPartSn}-${i.lastPartIndex}]`:""},duration:${i.totalduration}`);const c=s[o];let d=0;if(i.live||(r=c.details)!=null&&r.live){if(this.checkLiveUpdate(i),i.deltaUpdateFailed)return;if(c.details){var f;d=this.alignPlaylists(i,c.details,(f=this.levelLastLoaded)==null?void 0:f.details)}i.alignedSliding||(Dv(i,u),i.alignedSliding||dl(i,u),d=i.fragmentStart)}c.details=i,this.levelLastLoaded=c,this.startFragRequested||this.setStartPosition(u,d),this.hls.trigger(x.AUDIO_TRACK_UPDATED,{details:i,id:o,groupId:t.groupId}),this.state===U.WAITING_TRACK&&!this.waitForCdnTuneIn(i)&&(this.state=U.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const r=e.frag,{part:s,payload:i}=e,{config:o,trackId:a,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const u=l[a];if(!u){this.warn("Audio track is undefined on fragment load progress");return}const c=u.details;if(!c){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(r.start);return}const d=o.defaultAudioCodec||u.audioCodec||"mp4a.40.2";let f=this.transmuxer;f||(f=this.transmuxer=new Zv(this.hls,Z.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const h=this.initPTS[r.cc],m=(t=r.initSegment)==null?void 0:t.data;if(h!==void 0){const p=s?s.index:-1,y=p!==-1,v=new _f(r.level,r.sn,r.stats.chunkCount,i.byteLength,p,y);f.push(i,m,d,"",r,s,c.totalduration,!1,v,h)}else{this.log(`Unknown video PTS for cc ${r.cc}, waiting for video PTS before demuxing audio frag ${r.sn} of [${c.startSN} ,${c.endSN}],track ${a}`);const{cache:g}=this.waitingData=this.waitingData||{frag:r,part:s,cache:new Pv,complete:!1};g.push(new Uint8Array(i)),this.state!==U.STOPPED&&(this.state=U.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===Z.MAIN&&Ze(t.frag)&&(this.mainFragLoading=t,this.state===U.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:r,part:s}=t;if(r.type!==Z.AUDIO){!this.audioOnly&&r.type===Z.MAIN&&!r.elementaryStreams.video&&!r.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${s?" p: "+s.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(Ze(r)){this.fragPrevious=r;const i=this.switchingTrack;i&&(this.bufferedTrack=i,this.switchingTrack=null,this.hls.trigger(x.AUDIO_TRACK_SWITCHED,Ee({},i)))}this.fragBufferedComplete(r,s),this.media&&this.tick()}onError(e,t){var r;if(t.fatal){this.state=U.ERROR;return}switch(t.details){case b.FRAG_GAP:case b.FRAG_PARSING_ERROR:case b.FRAG_DECRYPT_ERROR:case b.FRAG_LOAD_ERROR:case b.FRAG_LOAD_TIMEOUT:case b.KEY_LOAD_ERROR:case b.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Z.AUDIO,t);break;case b.AUDIO_TRACK_LOAD_ERROR:case b.AUDIO_TRACK_LOAD_TIMEOUT:case b.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===U.WAITING_TRACK&&((r=t.context)==null?void 0:r.type)===he.AUDIO_TRACK&&(this.state=U.IDLE);break;case b.BUFFER_ADD_CODEC_ERROR:case b.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.resetLoadingState();break;case b.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case b.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==Te.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==Te.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===U.ENDED&&(this.state=U.IDLE);const r=this.mediaBuffer||this.media;r&&(this.afterBufferFlushed(r,t,Z.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const r="audio",{hls:s}=this,{remuxResult:i,chunkMeta:o}=e,a=this.getCurrentContext(o);if(!a){this.resetWhenMissingContext(o);return}const{frag:l,part:u,level:c}=a,{details:d}=c,{audio:f,text:h,id3:m,initSegment:g}=i;if(this.fragContextChanged(l)||!d){this.fragmentTracker.removeFragment(l);return}if(this.state=U.PARSING,this.switchingTrack&&f&&this.completeAudioSwitch(this.switchingTrack),g!=null&&g.tracks){const p=l.initSegment||l;this._bufferInitSegment(c,g.tracks,p,o),s.trigger(x.FRAG_PARSING_INIT_SEGMENT,{frag:p,id:r,tracks:g.tracks})}if(f){const{startPTS:p,endPTS:y,startDTS:v,endDTS:E}=f;u&&(u.elementaryStreams[Te.AUDIO]={startPTS:p,endPTS:y,startDTS:v,endDTS:E}),l.setElementaryStreamInfo(Te.AUDIO,p,y,v,E),this.bufferFragmentData(f,l,u,o)}if(m!=null&&(t=m.samples)!=null&&t.length){const p=Le({id:r,frag:l,details:d},m);s.trigger(x.FRAG_PARSING_METADATA,p)}if(h){const p=Le({id:r,frag:l,details:d},h);s.trigger(x.FRAG_PARSING_USERDATA,p)}}_bufferInitSegment(e,t,r,s){if(this.state!==U.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const i=t.audio;i.id=Z.AUDIO;const o=e.audioCodec;this.log(`Init audio buffer, container:${i.container}, codecs[level/parsed]=[${o}/${i.codec}]`),o&&o.split(",").length===1&&(i.levelCodec=o),this.hls.trigger(x.BUFFER_CODECS,t);const a=i.initSegment;if(a!=null&&a.byteLength){const l={type:"audio",frag:r,part:null,chunkMeta:s,parent:r.type,data:a};this.hls.trigger(x.BUFFER_APPENDING,l)}this.tickImmediate()}loadFragment(e,t,r){const s=this.fragmentTracker.getState(e);if(this.switchingTrack||s===We.NOT_LOADED||s===We.PARTIAL){var i;if(!Ze(e))this._loadInitSegment(e,t);else if((i=t.details)!=null&&i.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=U.WAITING_INIT_PTS;const o=this.mainDetails;o&&o.fragmentStart!==t.details.fragmentStart&&dl(t.details,o)}else super.loadFragment(e,t,r)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:r,assocLang:s,characteristics:i,audioCodec:o,channels:a}=this.bufferedTrack;Wr({name:t,lang:r,assocLang:s,characteristics:i,audioCodec:o,channels:a},e,Fr)||(al(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(x.AUDIO_TRACK_SWITCHED,Ee({},e))}}class Uf extends Zn{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,r){const s=t==null?void 0:t.renditionReports;if(s){let i=-1;for(let o=0;o<s.length;o++){const a=s[o];let l;try{l=new self.URL(a.URI,t.url).href}catch(u){this.warn(`Could not construct new URL for Rendition Report: ${u}`),l=a.URI||""}if(l===e){i=o;break}else l===e.substring(0,l.length)&&(i=o)}if(i!==-1){const o=s[i],a=parseInt(o["LAST-MSN"])||(t==null?void 0:t.lastPartSn);let l=parseInt(o["LAST-PART"])||(t==null?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){const c=Math.min(t.age-t.partTarget,t.targetduration);l>=0&&c>t.partTarget&&(l+=1)}const u=r&&Gm(r);return new Vm(a,l>=0?l:void 0,u)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(r){this.warn(`Could not construct new URL with HLS Delivery Directives: ${r}`)}return e}playlistLoaded(e,t,r){const{details:s,stats:i}=t,o=self.performance.now(),a=i.loading.first?Math.max(0,o-i.loading.first):0;s.advancedDateTime=Date.now()-a;const l=this.hls.config.timelineOffset;if(l!==s.appliedTimelineOffset){const c=Math.max(l||0,0);s.appliedTimelineOffset=c,s.fragments.forEach(d=>{d.start=d.playlistOffset+c})}if(s.live||r!=null&&r.live){const c="levelInfo"in t?t.levelInfo:t.track;if(s.reloaded(r),r&&s.fragments.length>0){GI(r,s);const v=s.playlistParsingError;if(v){this.warn(v);const E=this.hls;if(!E.config.ignorePlaylistParsingErrors){var u;const{networkDetails:T}=t;E.trigger(x.ERROR,{type:te.NETWORK_ERROR,details:b.LEVEL_PARSING_ERROR,fatal:!1,url:s.url,error:v,reason:v.message,level:t.level||void 0,parent:(u=s.fragments[0])==null?void 0:u.type,networkDetails:T,stats:i});return}s.playlistParsingError=null}}s.requestScheduled===-1&&(s.requestScheduled=i.loading.start);const d=this.hls.mainForwardBufferInfo,f=d?d.end-d.len:0,h=(s.edge-f)*1e3,m=_v(s,h);if(s.requestScheduled+m<o?s.requestScheduled=o:s.requestScheduled+=m,this.log(`live playlist ${e} ${s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:s.updated?"UPDATED":"MISSED"}`),!this.canLoad||!s.live)return;let g,p,y;if(s.canBlockReload&&s.endSN&&s.advanced){const v=this.hls.config.lowLatencyMode,E=s.lastPartSn,T=s.endSN,A=s.lastPartIndex,R=A!==-1,L=E===T;R?L?(p=T+1,y=v?0:A):(p=E,y=v?A+1:s.maxPartIndex):p=T+1;const I=s.age,C=I+s.ageHeader;let _=Math.min(C-s.partTarget,s.targetduration*1.5);if(_>0){if(C>s.targetduration*3)this.log(`Playlist last advanced ${I.toFixed(2)}s ago. Omitting segment and part directives.`),p=void 0,y=void 0;else if(r!=null&&r.tuneInGoal&&C-s.partTarget>r.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${r.tuneInGoal} to: ${_} with playlist age: ${s.age}`),_=0;else{const F=Math.floor(_/s.targetduration);if(p+=F,y!==void 0){const B=Math.round(_%s.targetduration/s.partTarget);y+=B}this.log(`CDN Tune-in age: ${s.ageHeader}s last advanced ${I.toFixed(2)}s goal: ${_} skip sn ${F} to part ${y}`)}s.tuneInGoal=_}if(g=this.getDeliveryDirectives(s,t.deliveryDirectives,p,y),v||!L){s.requestScheduled=o,this.loadingPlaylist(c,g);return}}else(s.canBlockReload||s.canSkipUntil)&&(g=this.getDeliveryDirectives(s,t.deliveryDirectives,p,y));g&&p!==void 0&&s.canBlockReload&&(s.requestScheduled=i.loading.first+Math.max(m-a*2,m/2)),this.scheduleLoading(c,g,s)}else this.clearTimer()}scheduleLoading(e,t,r){const s=r||e.details;if(!s){this.loadingPlaylist(e,t);return}const i=self.performance.now(),o=s.requestScheduled;if(i>=o){this.loadingPlaylist(e,t);return}const a=o-i;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(a)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),a)}getDeliveryDirectives(e,t,r,s){let i=Gm(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,s=t.part,i=Sa.No),new Vm(r,s,i)}checkRetry(e){const t=e.details,r=ll(e),s=e.errorAction,{action:i,retryCount:o=0,retryConfig:a}=s||{},l=!!s&&!!a&&(i===ut.RetryRequest||!s.resolved&&i===ut.SendAlternateToPenaltyBox);if(l){var u;if(o>=a.maxNumRetry)return!1;if(r&&(u=e.context)!=null&&u.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const c=If(a,o);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),c),this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" in ${c}ms`)}e.levelRetry=!0,s.resolved=!0}return l}}function eE(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!lo(n[t].attrs,e[t].attrs))return!1;return!0}function lo(n,e,t){const r=n["STABLE-RENDITION-ID"];return r&&!t?r===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(s=>n[s]!==e[s])}function ld(n,e){return e.label.toLowerCase()===n.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(n.lang||"").toLowerCase())}class QR extends Uf{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.LEVEL_LOADING,this.onLevelLoading,this),e.on(x.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(x.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(x.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.LEVEL_LOADING,this.onLevelLoading,this),e.off(x.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(x.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(x.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:r,groupId:s,details:i}=t,o=this.tracksInGroup[r];if(!o||o.groupId!==s){this.warn(`Audio track with id:${r} and group:${s} not found in active group ${o==null?void 0:o.groupId}`);return}const a=o.details;o.details=t.details,this.log(`Audio track ${r} "${o.name}" lang:${o.lang} group:${s} loaded [${i.startSN}-${i.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.audioGroups||null,s=this.groupIds;let i=this.currentTrack;if(!r||(s==null?void 0:s.length)!==(r==null?void 0:r.length)||r!=null&&r.some(a=>(s==null?void 0:s.indexOf(a))===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(f=>!r||r.indexOf(f.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(f=>f.default)&&(this.selectDefaultTrack=!1),a.forEach((f,h)=>{f.id=h});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const l=this.hls.config.audioPreference;if(!i&&l){const f=_n(l,a,Fr);if(f>-1)i=a[f];else{const h=_n(l,this.tracks);i=this.tracks[h]}}let u=this.findTrackId(i);u===-1&&i&&(u=this.findTrackId(null));const c={audioTracks:a};this.log(`Updating audio tracks, ${a.length} track(s) found in group(s): ${r==null?void 0:r.join(",")}`),this.hls.trigger(x.AUDIO_TRACKS_UPDATED,c);const d=this.trackId;if(u!==-1&&d===-1)this.setAudioTrack(u);else if(a.length&&d===-1){var o;const f=new Error(`No audio track selected for current audio group-ID(s): ${(o=this.groupIds)==null?void 0:o.join(",")} track count: ${a.length}`);this.warn(f.message),this.hls.trigger(x.ERROR,{type:te.MEDIA_ERROR,details:b.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:f})}}}onError(e,t){t.fatal||!t.context||t.context.type===he.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const r=this.allAudioTracks;if(this.selectDefaultTrack=!1,r.length){const s=this.currentTrack;if(s&&Wr(e,s,Fr))return s;const i=_n(e,this.tracksInGroup,Fr);if(i>-1){const o=this.tracksInGroup[i];return this.setAudioTrack(i),o}else if(s){let o=t.loadLevel;o===-1&&(o=t.firstAutoLevel);const a=aI(e,t.levels,r,o,Fr);if(a===-1)return null;t.nextLoadLevel=a}if(e.channels||e.audioCodec){const o=_n(e,r);if(o>-1)return r[o]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const r=this.currentTrack,s=t[e],i=s.details&&!s.details.live;if(e===this.trackId&&s===r&&i||(this.log(`Switching to audio-track ${e} "${s.name}" lang:${s.lang} group:${s.groupId} channels:${s.channels}`),this.trackId=e,this.currentTrack=s,this.hls.trigger(x.AUDIO_TRACK_SWITCHING,Ee({},s)),i))return;const o=this.switchParams(s.url,r==null?void 0:r.details,s.details);this.loadPlaylist(o)}findTrackId(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const s=t[r];if(!(this.selectDefaultTrack&&!s.default)&&(!e||Wr(e,s,Fr)))return r}if(e){const{name:r,lang:s,assocLang:i,characteristics:o,audioCodec:a,channels:l}=e;for(let u=0;u<t.length;u++){const c=t[u];if(Wr({name:r,lang:s,assocLang:i,characteristics:o,audioCodec:a,channels:l},c,Fr))return u}for(let u=0;u<t.length;u++){const c=t[u];if(lo(e.attrs,c.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return u}for(let u=0;u<t.length;u++){const c=t[u];if(lo(e.attrs,c.attrs,["LANGUAGE"]))return u}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&al(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=e.id,s=e.groupId,i=this.getUrlWithDirectives(e.url,t),o=e.details,a=o==null?void 0:o.age;this.log(`Loading audio-track ${r} "${e.name}" lang:${e.lang} group:${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${i}`),this.hls.trigger(x.AUDIO_TRACK_LOADING,{url:i,id:r,groupId:s,deliveryDirectives:t||null,track:e})}}class JR{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,r){if(this.queues===null||this.tracks===null)return;const s=this.queues[t];s.push(e),s.length===1&&!r&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const r={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(r,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const r={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(r)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const r=(t=e[0])==null?void 0:t.label;(r==="async-blocker"||r==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const s=t[0];try{s.execute()}catch(i){var r;if(s.onError(i),this.queues===null||this.tracks===null)return;const o=(r=this.tracks[e])==null?void 0:r.buffer;o!=null&&o.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,r;return(t=this.queues)!=null&&t[e]||(r=this.tracks)!=null&&r[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const r=(t=this.tracks)==null?void 0:t[e],s=r==null?void 0:r.buffer;return s?`SourceBuffer${s.updating?" updating":""}${r.ended?" ended":""}${r.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(r=>r.label).join(", "))||""}}const Rg=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,tE="HlsJsTrackRemovedError";class ZR extends Error{constructor(e){super(e),this.name=tE}}class e_ extends Zn{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=r=>{var s;this.hls&&((s=this.mediaSource)==null?void 0:s.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=r=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=r=>{const{media:s,mediaSource:i}=this;r&&this.log("Media source opened"),!(!s||!i)&&(i.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(x.MEDIA_ATTACHED,{media:s,mediaSource:i}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:r,_objectUrl:s}=this;r!==s&&this.error(`Media element src was set while attaching MediaSource (${s} > ${r})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=L1(_r(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.BUFFER_RESET,this.onBufferReset,this),e.on(x.BUFFER_APPENDING,this.onBufferAppending,this),e.on(x.BUFFER_CODECS,this.onBufferCodecs,this),e.on(x.BUFFER_EOS,this.onBufferEos,this),e.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(x.FRAG_PARSED,this.onFragParsed,this),e.on(x.FRAG_CHANGED,this.onFragChanged,this),e.on(x.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.BUFFER_RESET,this.onBufferReset,this),e.off(x.BUFFER_APPENDING,this.onBufferAppending,this),e.off(x.BUFFER_CODECS,this.onBufferCodecs,this),e.off(x.BUFFER_EOS,this.onBufferEos,this),e.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(x.FRAG_PARSED,this.onFragParsed,this),e.off(x.FRAG_CHANGED,this.onFragChanged,this),e.off(x.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const r={};if(this.operationQueue){const i=this.isUpdating();i||this.operationQueue.removeBlockers();const o=this.isQueued();(i||o)&&this.warn(`Transfering MediaSource with${o?" operations in queue":""}${i?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const s=this.transferData;return!this.sourceBufferCount&&s&&s.mediaSource===t?Le(r,s.tracks):this.sourceBuffers.forEach(i=>{const[o]=i;o&&(r[o]=Le({},this.tracks[o]),this.removeBuffer(o)),i[0]=i[1]=null}),{media:e,mediaSource:t,tracks:r}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var r;let s=2;(t.audio&&!t.video||!t.altAudio)&&(s=1),this.bufferCodecEventsTotal=s,this.log(`${s} bufferCodec event(s) expected.`),(r=this.transferData)!=null&&r.mediaSource&&this.sourceBufferCount&&s&&this.bufferCreated()}onMediaAttaching(e,t){const r=this.media=t.media,s=_r(this.appendSource);if(this.transferData=this.overrides=void 0,r&&s){const i=!!t.mediaSource;(i||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const o=this.mediaSource=t.mediaSource||new s;if(this.assignMediaSource(o),i)this._objectUrl=r.src,this.attachTransferred();else{const a=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{r.removeAttribute("src");const l=self.ManagedMediaSource;r.disableRemotePlayback=r.disableRemotePlayback||l&&o instanceof l,_g(r),t_(r,a),r.load()}catch{r.src=a}else r.src=a}r.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,r;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(r=e.constructor)==null?void 0:r.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const r=this.tracks,s=t.tracks,i=s?Object.keys(s):null,o=i?i.length:0,a=()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()};if(s&&i&&o){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${be(r,(l,u)=>l==="initSegment"?void 0:u)};
transfer tracks: ${be(s,(l,u)=>l==="initSegment"?void 0:u)}}`),!tv(s,r)){t.mediaSource=null,t.tracks=void 0;const l=e.currentTime,u=this.details,c=Math.max(l,(u==null?void 0:u.fragments[0].start)||0);if(c-l>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${l} -> ${c}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(s)}"->"${Object.keys(r)}") start time: ${c} currentTime: ${l}`),this.onMediaDetaching(x.MEDIA_DETACHING,{}),this.onMediaAttaching(x.MEDIA_ATTACHING,t),e.currentTime=c;return}this.transferData=void 0,i.forEach(l=>{const u=l,c=s[u];if(c){const d=c.buffer;if(d){const f=this.fragmentTracker,h=c.id;if(f.hasFragments(h)||f.hasParts(h)){const p=fe.getBuffered(d);f.detectEvictedFragments(u,p,h,null,!0)}const m=Fu(u),g=[u,d];this.sourceBuffers[m]=g,d.updating&&this.operationQueue&&this.operationQueue.prependBlocker(u),this.trackSourceBuffer(u,c)}}}),a(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),a()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const r=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:s,mediaSource:i,_objectUrl:o}=this;if(i){if(this.log(`media source ${r?"transferring":"detaching"}`),r)this.sourceBuffers.forEach(([a])=>{a&&this.removeBuffer(a)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const a=i.readyState==="open";try{const l=i.sourceBuffers;for(let u=l.length;u--;)a&&l[u].abort(),i.removeSourceBuffer(l[u]);a&&i.endOfStream()}catch(l){this.warn(`onMediaDetaching: ${l.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}i.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("sourceended",this._onMediaSourceEnded),i.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(i.removeEventListener("startstreaming",this._onStartStreaming),i.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}s&&(s.removeEventListener("emptied",this._onMediaEmptied),r||(o&&self.URL.revokeObjectURL(o),this.mediaSrc===o?(s.removeAttribute("src"),this.appendSource&&_g(s),s.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(x.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const r=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),r)try{var s;(s=this.mediaSource)!=null&&s.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(r)}catch(i){this.warn(`onBufferReset ${e}`,i)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Fu(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new JR(this.tracks)}onBufferCodecs(e,t){const r=this.tracks,s=Object.keys(t);this.log(`BUFFER_CODECS: "${s}" (current SB count ${this.sourceBufferCount})`);const i="audiovideo"in t&&(r.audio||r.video)||r.audiovideo&&("audio"in t||"video"in t),o=!i&&this.sourceBufferCount&&this.media&&s.some(a=>!r[a]);if(i||o){this.warn(`Unsupported transition between "${Object.keys(r)}" and "${s}" SourceBuffers`);return}s.forEach(a=>{var l,u,c;const d=t[a],{id:f,codec:h,levelCodec:m,container:g,metadata:p,supplemental:y}=d;let v=r[a];const E=(l=this.transferData)==null||(u=l.tracks)==null?void 0:u[a],T=E!=null&&E.buffer?E:v,A=(T==null?void 0:T.pendingCodec)||(T==null?void 0:T.codec),R=T==null?void 0:T.levelCodec;v||(v=r[a]={buffer:void 0,listeners:[],codec:h,supplemental:y,container:g,levelCodec:m,metadata:p,id:f});const L=xa(A,R),I=L==null?void 0:L.replace(Rg,"$1");let C=xa(h,m);const _=(c=C)==null?void 0:c.replace(Rg,"$1");C&&L&&I!==_&&(a.slice(0,5)==="audio"&&(C=il(C,this.appendSource)),this.log(`switching codec ${A} to ${C}`),C!==(v.pendingCodec||v.codec)&&(v.pendingCodec=C),v.container=g,this.appendChangeType(a,g,C))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&this.mediaSourceOpenOrEnded&&this.checkPendingTracks()}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const r=this.tracks[t];return e[t]={id:r.id,container:r.container,codec:r.codec,levelCodec:r.levelCodec},e},{})}appendChangeType(e,t,r){const s=`${t};codecs=${r}`,i={label:`change-type=${s}`,execute:()=>{const o=this.tracks[e];if(o){const a=o.buffer;a!=null&&a.changeType&&(this.log(`changing ${e} sourceBuffer type to ${s}`),a.changeType(s),o.codec=r,o.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn(`Failed to change ${e} SourceBuffer type`,o)}};this.append(i,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const r=e.start,s=r+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(r,Z.MAIN))==null?void 0:t.gap)===!0)return;const o={label:"block-audio",execute:()=>{var a;const l=this.tracks.video;(this.lastVideoAppendEnd>s||l!=null&&l.buffer&&fe.isBuffered(l.buffer,s)||((a=this.fragmentTracker.getAppendedFrag(s,Z.MAIN))==null?void 0:a.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn("Error executing block-audio operation",a)}};this.blockedAudioAppend={op:o,frag:e},this.append(o,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:r}=this,{data:s,type:i,parent:o,frag:a,part:l,chunkMeta:u}=t,c=u.buffering[i],d=a.sn,f=self.performance.now();c.start=f;const h=a.stats.buffering,m=l?l.stats.buffering:null;h.start===0&&(h.start=f),m&&m.start===0&&(m.start=f);const g=r.audio;let p=!1;i==="audio"&&(g==null?void 0:g.container)==="audio/mpeg"&&(p=!this.lastMpegAudioChunk||u.id===1||this.lastMpegAudioChunk.sn!==u.sn,this.lastMpegAudioChunk=u);const y=this.tracks.video,v=y==null?void 0:y.buffer;if(v&&d!=="initSegment"){const A=l||a,R=this.blockedAudioAppend;if(i==="audio"&&o!=="main"&&!this.blockedAudioAppend){const I=A.start+A.duration*.05,C=v.buffered,_=this.currentOp("video");!C.length&&!_?this.blockAudio(A):!_&&!fe.isBuffered(v,I)&&this.lastVideoAppendEnd<I&&this.blockAudio(A)}else if(i==="video"){const L=A.end;if(R){const I=R.frag.start;(L>I||L<this.lastVideoAppendEnd||fe.isBuffered(v,I))&&this.unblockAudio()}this.lastVideoAppendEnd=L}}const E=(l||a).start,T={label:`append-${i}`,execute:()=>{if(c.executeStart=self.performance.now(),p){const A=this.tracks[i];if(A){const R=A.buffer;if(R){const L=E-R.timestampOffset;Math.abs(L)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${E} (delta: ${L}) sn: ${d})`),R.timestampOffset=E)}}}this.appendExecutor(s,i)},onStart:()=>{},onComplete:()=>{const A=self.performance.now();c.executeEnd=c.end=A,h.first===0&&(h.first=A),m&&m.first===0&&(m.first=A);const R={};this.sourceBuffers.forEach(([L,I])=>{L&&(R[L]=fe.getBuffered(I))}),this.appendErrors[i]=0,i==="audio"||i==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(x.BUFFER_APPENDED,{type:i,frag:a,part:l,chunkMeta:u,parent:a.type,timeRanges:R})},onError:A=>{var R;const L={type:te.MEDIA_ERROR,parent:a.type,details:b.BUFFER_APPEND_ERROR,sourceBufferName:i,frag:a,part:l,chunkMeta:u,error:A,err:A,fatal:!1},I=(R=this.media)==null?void 0:R.error;if(A.code===DOMException.QUOTA_EXCEEDED_ERR)L.details=b.BUFFER_FULL_ERROR;else if(A.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!I)L.errorAction=ro(!0);else if(A.name===tE&&this.sourceBufferCount===0)L.errorAction=ro(!0);else{const C=++this.appendErrors[i];this.warn(`Failed ${C}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${i}" sourceBuffer (${I||"no media error"})`),(C>=this.hls.config.appendErrorMaxRetry||I)&&(L.fatal=!0)}this.hls.trigger(x.ERROR,L)}};this.append(T,i,this.isPending(this.tracks[i]))}getFlushOp(e,t,r){return this.log(`queuing "${e}" remove ${t}-${r}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,r)},onStart:()=>{},onComplete:()=>{this.hls.trigger(x.BUFFER_FLUSHED,{type:e})},onError:s=>{this.warn(`Failed to remove ${t}-${r} from "${e}" SourceBuffer`,s)}}}onBufferFlushing(e,t){const{type:r,startOffset:s,endOffset:i}=t;r?this.append(this.getFlushOp(r,s,i),r):this.sourceBuffers.forEach(([o])=>{o&&this.append(this.getFlushOp(o,s,i),o)})}onFragParsed(e,t){const{frag:r,part:s}=t,i=[],o=s?s.elementaryStreams:r.elementaryStreams;o[Te.AUDIOVIDEO]?i.push("audiovideo"):(o[Te.AUDIO]&&i.push("audio"),o[Te.VIDEO]&&i.push("video"));const a=()=>{const l=self.performance.now();r.stats.buffering.end=l,s&&(s.stats.buffering.end=l);const u=s?s.stats:r.stats;this.hls.trigger(x.FRAG_BUFFERED,{frag:r,part:s,stats:u,id:r.type})};i.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${r.type} level: ${r.level} sn: ${r.sn}`),this.blockBuffers(a,i).catch(l=>{this.warn(`Fragment buffered callback ${l}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{var t,r;return e&&(!((t=this.tracks[e])!=null&&t.ended)||((r=this.tracks[e])==null?void 0:r.ending))})}onBufferEos(e,t){var r;this.sourceBuffers.forEach(([o])=>{if(o){const a=this.tracks[o];(!t.type||t.type===o)&&(a.ending=!0,a.ended||(a.ended=!0,this.log(`${o} buffer reached EOS`)))}});const s=((r=this.overrides)==null?void 0:r.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([o])=>{var a;return o&&!((a=this.tracks[o])!=null&&a.ended)})&&(s?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:o}=this;if(!o||o.readyState!=="open"){o&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${o.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),o.endOfStream(),this.hls.trigger(x.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(x.BUFFERED_TO_END,void 0)))}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){const e=this.getDurationAndRange();e&&this.blockUntilOpen(()=>this.updateMediaSource(e))}onError(e,t){if(t.details===b.BUFFER_APPEND_ERROR&&t.frag){var r;const s=(r=t.errorAction)==null?void 0:r.nextAutoLevel;K(s)&&s!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:r}=this;if(!r||t===null||!this.sourceBufferCount)return;const s=e.config,i=r.currentTime,o=t.levelTargetDuration,a=t.live&&s.liveBackBufferLength!==null?s.liveBackBufferLength:s.backBufferLength;if(K(a)&&a>=0){const l=Math.max(a,o),u=Math.floor(i/o)*o-l;this.flushBackBuffer(i,o,u)}if(K(s.frontBufferFlushThreshold)&&s.frontBufferFlushThreshold>0){const l=Math.max(s.maxBufferLength,s.frontBufferFlushThreshold),u=Math.max(l,o),c=Math.floor(i/o)*o+u;this.flushFrontBuffer(i,o,c)}}flushBackBuffer(e,t,r){this.sourceBuffers.forEach(([s,i])=>{if(i){const a=fe.getBuffered(i);if(a.length>0&&r>a.start(0)){var o;this.hls.trigger(x.BACK_BUFFER_REACHED,{bufferEnd:r});const l=this.tracks[s];if((o=this.details)!=null&&o.live)this.hls.trigger(x.LIVE_BACK_BUFFER_REACHED,{bufferEnd:r});else if(l!=null&&l.ended){this.log(`Cannot flush ${s} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(x.BUFFER_FLUSHING,{startOffset:0,endOffset:r,type:s})}}})}flushFrontBuffer(e,t,r){this.sourceBuffers.forEach(([s,i])=>{if(i){const o=fe.getBuffered(i),a=o.length;if(a<2)return;const l=o.start(a-1),u=o.end(a-1);if(r>l||e>=l&&e<=u)return;this.hls.trigger(x.BUFFER_FLUSHING,{startOffset:l,endOffset:1/0,type:s})}})}getDurationAndRange(){var e;const{details:t,mediaSource:r}=this;if(!t||!this.media||(r==null?void 0:r.readyState)!=="open")return null;const s=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&t.live&&r.setLiveSeekableRange){const u=Math.max(0,t.fragmentStart),c=Math.max(u,s);return{duration:1/0,start:u,end:c}}return{duration:1/0}}const i=(e=this.overrides)==null?void 0:e.duration;if(i)return K(i)?{duration:i}:null;const o=this.media.duration,a=K(r.duration)?r.duration:0;return s>a&&s>o||!K(o)?{duration:s}:null}updateMediaSource({duration:e,start:t,end:r}){const s=this.mediaSource;!this.media||!s||s.readyState!=="open"||(s.duration!==e&&(K(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),s.duration=e),t!==void 0&&r!==void 0&&(this.log(`MediaSource duration is set to ${s.duration}. Setting seekable range to ${t}-${r}.`),s.setLiveSeekableRange(t,r)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:r}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${be(r)}`),this.tracksReady){var s;const i=(s=this.transferData)==null?void 0:s.tracks;i&&Object.keys(i).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,r])=>{if(t){const s=this.tracks[t];e[t]={buffer:r,container:s.container,codec:s.codec,supplemental:s.supplemental,levelCodec:s.levelCodec,id:s.id,metadata:s.metadata}}}),this.hls.trigger(x.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(x.ERROR,{type:te.MEDIA_ERROR,details:b.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:r}=this;if(!r)throw new Error("createSourceBuffers called when mediaSource was null");for(const i in e){const o=i,a=e[o];if(this.isPending(a)){const l=this.getTrackCodec(a,o),u=`${a.container};codecs=${l}`;a.codec=l,this.log(`creating sourceBuffer(${u})${this.currentOp(o)?" Queued":""} ${be(a)}`);try{const c=r.addSourceBuffer(u),d=Fu(o),f=[o,c];t[d]=f,a.buffer=c}catch(c){var s;this.error(`error while trying to add sourceBuffer: ${c.message}`),this.shiftAndExecuteNext(o),(s=this.operationQueue)==null||s.removeBlockers(),delete this.tracks[o],this.hls.trigger(x.ERROR,{type:te.MEDIA_ERROR,details:b.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:c,sourceBufferName:o,mimeType:u,parent:a.id});return}this.trackSourceBuffer(o,a)}}this.bufferCreated()}getTrackCodec(e,t){const r=e.supplemental;let s=e.codec;r&&(t==="video"||t==="audiovideo")&&ed(r,"video")&&(s=W1(s,r));const i=xa(s,e.levelCodec);return i?t.slice(0,5)==="audio"?il(i,this.appendSource):i:""}trackSourceBuffer(e,t){const r=t.buffer;if(!r)return;const s=this.getTrackCodec(t,e);this.tracks[e]={buffer:r,codec:s,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(i,o)=>{const a=o.removedRanges;a!=null&&a.length&&this.hls.trigger(x.BUFFER_FLUSHED,{type:i})})}get mediaSrc(){var e,t;const r=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return r==null?void 0:r.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const r=this.currentOp(e);r&&(r.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var r;const s=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(r=this.mediaSource)==null?void 0:r.readyState}`);this.error(`${s}`,t),this.hls.trigger(x.ERROR,{type:te.MEDIA_ERROR,details:b.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:s,fatal:!1});const i=this.currentOp(e);i&&i.onError(s)}removeExecutor(e,t,r){const{media:s,mediaSource:i}=this,o=this.tracks[e],a=o==null?void 0:o.buffer;if(!s||!i||!a){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const l=K(s.duration)?s.duration:1/0,u=K(i.duration)?i.duration:1/0,c=Math.max(0,t),d=Math.min(r,l,u);d>c&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${c},${d}] from the ${e} SourceBuffer`),a.remove(c,d)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const r=this.tracks[t],s=r==null?void 0:r.buffer;if(!s)throw new ZR(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);r.ending=!1,r.ended=!1,s.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:r}=this,s=t.map(o=>this.appendBlocker(o));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(s).then(o=>{r===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var r;const s=(r=this.tracks[t])==null?void 0:r.buffer;!s||s.updating||this.shiftAndExecuteNext(t)})}append(e,t,r){this.operationQueue&&this.operationQueue.append(e,t,r)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,r){const s=this.tracks[e];if(!s)return;const i=s.buffer;if(!i)return;const o=r.bind(this,e);s.listeners.push({event:t,listener:o}),i.addEventListener(t,o)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const r=t.buffer;r&&(t.listeners.forEach(s=>{r.removeEventListener(s.event,s.listener)}),t.listeners.length=0)}}function _g(n){const e=n.querySelectorAll("source");[].slice.call(e).forEach(t=>{n.removeChild(t)})}function t_(n,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,n.appendChild(t)}function Fu(n){return n==="audio"?1:0}class Bf{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(x.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(x.BUFFER_CODECS,this.onBufferCodecs,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(x.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(x.BUFFER_CODECS,this.onBufferCodecs,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&K(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,r=this.getMaxLevel(e.length-1);r!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${r}: ${e[r].height}p@${e[r].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=r,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const r=t.filter((s,i)=>this.isLevelAllowed(s)&&i<=e);return this.clientRect=null,Bf.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,!t.width&&!t.height&&(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(r=>e.bitrate===r.bitrate&&e.width===r.width&&e.height===r.height)}static getMaxLevelByMediaSize(e,t,r){if(!(e!=null&&e.length))return-1;const s=(a,l)=>l?a.width!==l.width||a.height!==l.height:!0;let i=e.length-1;const o=Math.max(t,r);for(let a=0;a<e.length;a+=1){const l=e[a];if((l.width>=o||l.height>=o)&&s(l,e[a+1])){i=a;break}}return i}}const n_={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Lt=n_,r_={HLS:"h"},s_=r_,i_="CMCD-Object",o_="CMCD-Request",a_="CMCD-Session",l_="CMCD-Status",Si={OBJECT:i_,REQUEST:o_,SESSION:a_,STATUS:l_},u_={[Si.OBJECT]:["br","d","ot","tb"],[Si.REQUEST]:["bl","dl","mtp","nor","nrr","su"],[Si.SESSION]:["cid","pr","sf","sid","st","v"],[Si.STATUS]:["bs","rtp"]};class Vs{constructor(e,t){Array.isArray(e)&&(e=e.map(r=>r instanceof Vs?r:new Vs(r))),this.value=e,this.params=t}}const c_="Dict";function d_(n){return Array.isArray(n)?JSON.stringify(n):n instanceof Map?"Map{}":n instanceof Set?"Set{}":typeof n=="object"?JSON.stringify(n):String(n)}function f_(n,e,t,r){return new Error(`failed to ${n} "${d_(e)}" as ${t}`,{cause:r})}function Dn(n,e,t){return f_("serialize",n,e,t)}class nE{constructor(e){this.description=e}}const wg="Bare Item",h_="Boolean";function m_(n){if(typeof n!="boolean")throw Dn(n,h_);return n?"?1":"?0"}const g_="Byte Sequence";function p_(n){if(ArrayBuffer.isView(n)===!1)throw Dn(n,g_);return`:${dR(n)}:`}const y_="Integer";function v_(n){return n<-999999999999999||999999999999999<n}function rE(n){if(v_(n))throw Dn(n,y_);return n.toString()}function E_(n){return`@${rE(n.getTime()/1e3)}`}const x_="Decimal";function S_(n){const e=$v(n,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Dn(n,x_);const t=e.toString();return t.includes(".")?t:`${t}.0`}const T_="String",A_=/[\x00-\x1f\x7f]+/;function L_(n){if(A_.test(n))throw Dn(n,T_);return`"${n.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function I_(n){return n.description||n.toString().slice(7,-1)}const R_="Token";function kg(n){const e=I_(n);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw Dn(e,R_);return e}function ud(n){switch(typeof n){case"number":if(!K(n))throw Dn(n,wg);return Number.isInteger(n)?rE(n):S_(n);case"string":return L_(n);case"symbol":return kg(n);case"boolean":return m_(n);case"object":if(n instanceof Date)return E_(n);if(n instanceof Uint8Array)return p_(n);if(n instanceof nE)return kg(n);default:throw Dn(n,wg)}}const __="Key";function cd(n){if(/^[a-z*][a-z0-9\-_.*]*$/.test(n)===!1)throw Dn(n,__);return n}function $f(n){return n==null?"":Object.entries(n).map(([e,t])=>t===!0?`;${cd(e)}`:`;${cd(e)}=${ud(t)}`).join("")}function sE(n){return n instanceof Vs?`${ud(n.value)}${$f(n.params)}`:ud(n)}function w_(n){return`(${n.value.map(sE).join(" ")})${$f(n.params)}`}function k_(n,e={whitespace:!0}){if(typeof n!="object")throw Dn(n,c_);const t=n instanceof Map?n.entries():Object.entries(n),r=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([s,i])=>{i instanceof Vs||(i=new Vs(i));let o=cd(s);return i.value===!0?o+=$f(i.params):(o+="=",Array.isArray(i.value)?o+=w_(i):o+=sE(i)),o}).join(`,${r}`)}function C_(n,e){return k_(n,e)}function b_(n){return n==="ot"||n==="sf"||n==="st"}function D_(n){return typeof n=="number"?K(n):n!=null&&n!==""&&n!==!1}const La=n=>Math.round(n),P_=(n,e)=>(e!=null&&e.baseUrl&&(n=fR(n,e.baseUrl)),encodeURIComponent(n)),Xo=n=>La(n/100)*100,O_={br:La,d:La,bl:Xo,dl:Xo,mtp:Xo,nor:P_,rtp:Xo,tb:La};function N_(n,e){const t={};if(n==null||typeof n!="object")return t;const r=Object.keys(n).sort(),s=Le({},O_,e==null?void 0:e.formatters),i=e==null?void 0:e.filter;return r.forEach(o=>{if(i!=null&&i(o))return;let a=n[o];const l=s[o];l&&(a=l(a,e)),!(o==="v"&&a===1)&&(o=="pr"&&a===1||D_(a)&&(b_(o)&&typeof a=="string"&&(a=new nE(a)),t[o]=a))}),t}function iE(n,e={}){return n?C_(N_(n,e),Le({whitespace:!1},e)):""}function M_(n,e={}){const t={};if(!n)return t;const r=Object.entries(n),s=Object.entries(u_).concat(Object.entries((e==null?void 0:e.customHeaderMap)||{})),i=r.reduce((o,a)=>{var l,u;const[c,d]=a,f=((l=s.find(h=>h[1].includes(c)))===null||l===void 0?void 0:l[0])||Si.REQUEST;return(u=o[f])!==null&&u!==void 0||(o[f]={}),o[f][c]=d,o},{});return Object.entries(i).reduce((o,[a,l])=>(o[a]=iE(l,e),o),t)}function F_(n,e,t){return Le(n,M_(e,t))}const U_="CMCD";function B_(n,e={}){if(!n)return"";const t=iE(n,e);return`${U_}=${encodeURIComponent(t)}`}const Cg=/CMCD=[^&#]+/;function $_(n,e,t){const r=B_(e,t);if(!r)return n;if(Cg.test(n))return n.replace(Cg,r);const s=n.includes("?")?"&":"?";return`${n}${s}${r}`}class j_{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=s=>{try{this.apply(s,{ot:Lt.MANIFEST,su:!this.initialized})}catch(i){this.hls.logger.warn("Could not generate manifest CMCD data.",i)}},this.applyFragmentData=s=>{try{const{frag:i,part:o}=s,a=this.hls.levels[i.level],l=this.getObjectType(i),u={d:(o||i).duration*1e3,ot:l};(l===Lt.VIDEO||l===Lt.AUDIO||l==Lt.MUXED)&&(u.br=a.bitrate/1e3,u.tb=this.getTopBandwidth(l)/1e3,u.bl=this.getBufferLength(l));const c=o?this.getNextPart(o):this.getNextFrag(i);c!=null&&c.url&&c.url!==i.url&&(u.nor=c.url),this.apply(s,u)}catch(i){this.hls.logger.warn("Could not generate segment CMCD data.",i)}},this.hls=e;const t=this.config=e.config,{cmcd:r}=t;r!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=r.sessionId||e.sessionId,this.cid=r.contentId,this.useHeaders=r.useHeaders===!0,this.includeKeys=r.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHED,this.onMediaDetached,this),e.on(x.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHED,this.onMediaDetached,this),e.off(x.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var r,s;this.audioBuffer=(r=t.tracks.audio)==null?void 0:r.buffer,this.videoBuffer=(s=t.tracks.video)==null?void 0:s.buffer}createData(){var e;return{v:1,sf:s_.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){Le(t,this.createData());const r=t.ot===Lt.INIT||t.ot===Lt.VIDEO||t.ot===Lt.MUXED;this.starved&&r&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:s}=this;s&&(t=Object.keys(t).reduce((o,a)=>(s.includes(a)&&(o[a]=t[a]),o),{}));const i={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),F_(e.headers,t,i)):e.url=$_(e.url,t,i)}getNextFrag(e){var t;const r=(t=this.hls.levels[e.level])==null?void 0:t.details;if(r){const s=e.sn-r.startSN;return r.fragments[s+1]}}getNextPart(e){var t,r;const{index:s,fragment:i}=e,o=(t=this.hls.levels[i.level])==null||(r=t.details)==null?void 0:r.partList;if(o){const{sn:a}=i;for(let l=o.length-1;l>=0;l--){const u=o[l];if(u.index===s&&u.fragment.sn===a)return o[l+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Lt.TIMED_TEXT;if(e.sn==="initSegment")return Lt.INIT;if(t==="audio")return Lt.AUDIO;if(t==="main")return this.hls.audioTracks.length?Lt.VIDEO:Lt.MUXED}getTopBandwidth(e){let t=0,r;const s=this.hls;if(e===Lt.AUDIO)r=s.audioTracks;else{const i=s.maxAutoLevel,o=i>-1?i+1:s.levels.length;r=s.levels.slice(0,o)}for(const i of r)i.bitrate>t&&(t=i.bitrate);return t>0?t:NaN}getBufferLength(e){const t=this.media,r=e===Lt.AUDIO?this.audioBuffer:this.videoBuffer;return!r||!t?NaN:fe.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,r=e||this.config.loader;return class{constructor(i){this.loader=void 0,this.loader=new r(i)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(i,o,a){t(i),this.loader.load(i,o,a)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,r=e||this.config.loader;return class{constructor(i){this.loader=void 0,this.loader=new r(i)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(i,o,a){t(i),this.loader.load(i,o,a)}}}}const G_=3e5;class V_ extends Zn{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(r=>r!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:r}=t;r!==null&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:r}=t;if((r==null?void 0:r.action)===ut.SendAlternateToPenaltyBox&&r.flags===on.MoveAllAlternatesMatchingHost){const s=this.levels;let i=this._pathwayPriority,o=this.pathwayId;if(t.context){const{groupId:a,pathwayId:l,type:u}=t.context;a&&s?o=this.getPathwayForGroupId(a,u,o):l&&(o=l)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!i&&s&&(i=this.pathways()),i&&i.length>1&&(this.updatePathwayPriority(i),r.resolved=this.pathwayId!==o),r.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${o} levels: ${s&&s.length} priorities: ${be(i)} penalized: ${be(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const r=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${r}"`),t=this.getLevelsForPathway(r),this.pathwayId=r}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const r=this.penalizedPathways,s=performance.now();Object.keys(r).forEach(i=>{s-r[i]>G_&&delete r[i]});for(let i=0;i<e.length;i++){const o=e[i];if(o in r)continue;if(o===this.pathwayId)return;const a=this.hls.nextLoadLevel,l=this.hls.levels[a];if(t=this.getLevelsForPathway(o),t.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,Cv(t),this.hls.trigger(x.LEVELS_UPDATED,{levels:t});const u=this.hls.levels[a];l&&u&&this.levels&&(u.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&u.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${u.bitrate}`),this.hls.nextLoadLevel=a);break}}}getPathwayForGroupId(e,t,r){const s=this.getLevelsForPathway(r).concat(this.levels||[]);for(let i=0;i<s.length;i++)if(t===he.AUDIO_TRACK&&s[i].hasAudioGroup(e)||t===he.SUBTITLE_TRACK&&s[i].hasSubtitleGroup(e))return s[i].pathwayId;return r}clonePathways(e){const t=this.levels;if(!t)return;const r={},s={};e.forEach(i=>{const{ID:o,"BASE-ID":a,"URI-REPLACEMENT":l}=i;if(t.some(c=>c.pathwayId===o))return;const u=this.getLevelsForPathway(a).map(c=>{const d=new De(c.attrs);d["PATHWAY-ID"]=o;const f=d.AUDIO&&`${d.AUDIO}_clone_${o}`,h=d.SUBTITLES&&`${d.SUBTITLES}_clone_${o}`;f&&(r[d.AUDIO]=f,d.AUDIO=f),h&&(s[d.SUBTITLES]=h,d.SUBTITLES=h);const m=oE(c.uri,d["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l),g=new no({attrs:d,audioCodec:c.audioCodec,bitrate:c.bitrate,height:c.height,name:c.name,url:m,videoCodec:c.videoCodec,width:c.width});if(c.audioGroups)for(let p=1;p<c.audioGroups.length;p++)g.addGroupId("audio",`${c.audioGroups[p]}_clone_${o}`);if(c.subtitleGroups)for(let p=1;p<c.subtitleGroups.length;p++)g.addGroupId("text",`${c.subtitleGroups[p]}_clone_${o}`);return g});t.push(...u),bg(this.audioTracks,r,l,o),bg(this.subtitleTracks,s,l,o)})}loadSteeringManifest(e){const t=this.hls.config,r=t.loader;this.loader&&this.loader.destroy(),this.loader=new r(t);let s;try{s=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(s.protocol!=="data:"){const c=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;s.searchParams.set("_HLS_pathway",this.pathwayId),s.searchParams.set("_HLS_throughput",""+c)}const i={responseType:"json",url:s.href},o=t.steeringManifestLoadPolicy.default,a=o.errorRetry||o.timeoutRetry||{},l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},u={onSuccess:(c,d,f,h)=>{this.log(`Loaded steering manifest: "${s}"`);const m=c.data;if((m==null?void 0:m.VERSION)!==1){this.log(`Steering VERSION ${m.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=m.TTL;const{"RELOAD-URI":g,"PATHWAY-CLONES":p,"PATHWAY-PRIORITY":y}=m;if(g)try{this.uri=new self.URL(g,s).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${g}`);return}this.scheduleRefresh(this.uri||f.url),p&&this.clonePathways(p);const v={steeringManifest:m,url:s.toString()};this.hls.trigger(x.STEERING_MANIFEST_LOADED,v),y&&this.updatePathwayPriority(y)},onError:(c,d,f,h)=>{if(this.log(`Error loading steering manifest: ${c.code} ${c.text} (${d.url})`),this.stopLoad(),c.code===410){this.enabled=!1,this.log(`Steering manifest ${d.url} no longer available`);return}let m=this.timeToLoad*1e3;if(c.code===429){const g=this.loader;if(typeof(g==null?void 0:g.getResponseHeader)=="function"){const p=g.getResponseHeader("Retry-After");p&&(m=parseFloat(p)*1e3)}this.log(`Steering manifest ${d.url} rate limited`);return}this.scheduleRefresh(this.uri||d.url,m)},onTimeout:(c,d,f)=>{this.log(`Timeout loading steering manifest (${d.url})`),this.scheduleRefresh(this.uri||d.url)}};this.log(`Requesting steering manifest: ${s}`),this.loader.load(i,l,u)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var r;const s=(r=this.hls)==null?void 0:r.media;if(s&&!s.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function bg(n,e,t,r){n&&Object.keys(e).forEach(s=>{const i=n.filter(o=>o.groupId===s).map(o=>{const a=Le({},o);return a.details=void 0,a.attrs=new De(a.attrs),a.url=a.attrs.URI=oE(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),a.groupId=a.attrs["GROUP-ID"]=e[s],a.attrs["PATHWAY-ID"]=r,a});n.push(...i)})}function oE(n,e,t,r){const{HOST:s,PARAMS:i,[t]:o}=r;let a;e&&(a=o==null?void 0:o[e],a&&(n=a));const l=new self.URL(n);return s&&!a&&(l.host=s),i&&Object.keys(i).sort().forEach(u=>{u&&l.searchParams.set(u,i[u])}),l.href}class Ds extends Zn{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=Ds.CDMCleanupPromise?[Ds.CDMCleanupPromise]:[],this.onMediaEncrypted=t=>{const{initDataType:r,initData:s}=t,i=`"${t.type}" event: init data type: "${r}"`;if(this.debug(i),s!==null){if(!this.keyFormatPromise){let o=Object.keys(this.keySystemAccessPromises);o.length||(o=zo(this.config));const a=o.map(ku).filter(l=>!!l);this.keyFormatPromise=this.getKeyFormatPromise(a)}this.keyFormatPromise.then(o=>{const a=_u(o);let l,u;if(r==="sinf"){if(a!==xe.FAIRPLAY){this.warn(`Ignoring unexpected "${t.type}" event with init data type: "${r}" for selected key-system ${a}`);return}const m=Ke(new Uint8Array(s));try{const g=kf(JSON.parse(m).sinf),p=lv(g);if(!p)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");l=new Uint8Array(p.subarray(8,24)),u=xe.FAIRPLAY}catch(g){this.warn(`${i} Failed to parse sinf: ${g}`);return}}else{if(a!==xe.WIDEVINE&&a!==xe.PLAYREADY){this.warn(`Ignoring unexpected "${t.type}" event with init data type: "${r}" for selected key-system ${a}`);return}const m=V1(s),g=m.filter(y=>!!y.systemId&&wu(y.systemId)===a);g.length>1&&this.warn(`${i} Using first of ${g.length} pssh found for selected key-system ${a}`);const p=g[0];if(!p){m.length===0||m.some(y=>!y.systemId)?this.warn(`${i} contains incomplete or invalid pssh data`):this.log(`ignoring ${i} for ${m.map(y=>wu(y.systemId)).join(",")} pssh data in favor of playlist keys`);return}if(u=wu(p.systemId),p.version===0&&p.data)if(u===xe.WIDEVINE){const y=p.data.length-22;l=new Uint8Array(p.data.subarray(y,y+16))}else u===xe.PLAYREADY&&(l=Av(p.data))}if(!u||!l)return;const c=Ln.hexDump(l),{keyIdToKeySessionPromise:d,mediaKeySessions:f}=this;let h=d[c];for(let m=0;m<f.length;m++){const g=f[m],p=g.decryptdata;if(!p.keyId)continue;const y=Ln.hexDump(p.keyId);if(c===y||p.uri.replace(/-/g,"").indexOf(c)!==-1){if(h=d[y],p.pssh)break;delete d[y],p.pssh=new Uint8Array(s),p.keyId=l,h=d[c]=h.then(()=>this.generateRequestWithPreferredKeySession(g,r,s,"encrypted-event-key-match")),h.catch(v=>this.handleError(v));break}}if(!h){if(u!==a){this.log(`Ignoring "${t.type}" event with ${u} init data for selected key-system ${a}`);return}h=d[c]=this.getKeySystemSelectionPromise([u]).then(({keySystem:m,mediaKeys:g})=>{var p;this.throwIfDestroyed();const y=new so("ISO-23001-7",c,(p=ku(m))!=null?p:"");return y.pssh=new Uint8Array(s),y.keyId=l,this.attemptSetMediaKeys(m,g).then(()=>{this.throwIfDestroyed();const v=this.createMediaKeySessionContext({decryptdata:y,keySystem:m,mediaKeys:g});return this.generateRequestWithPreferredKeySession(v,r,s,"encrypted-event-no-match")})}),h.catch(m=>this.handleError(m))}})}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){const e=this.media;this.unregisterListeners(),this.onMediaDetached(),this._clear(e);const t=this.config;t.requestMediaKeySystemAccessFunc=null,t.licenseXhrSetup=t.licenseResponseCallback=void 0,t.drmSystems=t.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(x.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(x.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(x.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(x.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(x.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(x.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:r}=this.config,s=t[e];if(s)return s.licenseUrl;if(e===xe.WIDEVINE&&r)return r}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,r=t[e];if(r)return r.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,r=(o,a,l)=>!!o&&l.indexOf(o)===a,s=t.map(o=>o.audioCodec).filter(r),i=t.map(o=>o.videoCodec).filter(r);return s.length+i.length===0&&i.push("avc1.42e01e"),new Promise((o,a)=>{const l=u=>{const c=u.shift();this.getMediaKeysPromise(c,s,i).then(d=>o({keySystem:c,mediaKeys:d})).catch(d=>{u.length?l(u):d instanceof Kt?a(d):a(new Kt({type:te.KEY_SYSTEM_ERROR,details:b.KEY_SYSTEM_NO_ACCESS,error:d,fatal:!0},d.message))})};l(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:r}=this.config;if(typeof r!="function"){let s=`Configured requestMediaKeySystemAccess is not a function ${r}`;return Tv===null&&self.location.protocol==="http:"&&(s=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(s))}return r(e,t)}getMediaKeysPromise(e,t,r){const s=OI(e,t,r,this.config.drmSystemOptions),i=this.keySystemAccessPromises[e];let o=i==null?void 0:i.keySystemAccess;if(!o){this.log(`Requesting encrypted media "${e}" key-system access with config: ${be(s)}`),o=this.requestMediaKeySystemAccess(e,s);const a=this.keySystemAccessPromises[e]={keySystemAccess:o};return o.catch(l=>{this.log(`Failed to obtain access to key-system "${e}": ${l}`)}),o.then(l=>{this.log(`Access for key-system "${l.keySystem}" obtained`);const u=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),a.mediaKeys=l.createMediaKeys().then(c=>(this.log(`Media-keys created for "${e}"`),u.then(d=>d?this.setMediaKeysServerCertificate(c,e,d):c))),a.mediaKeys.catch(c=>{this.error(`Failed to create media-keys for "${e}"}: ${c}`)}),a.mediaKeys})}return o.then(()=>i.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:r}){this.log(`Creating key-system session "${t}" keyId: ${Ln.hexDump(e.keyId||[])}`);const s=r.createSession(),i={decryptdata:e,keySystem:t,mediaKeys:r,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(i),i}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const r=this.createMediaKeySessionContext(e),s=this.getKeyIdString(t),i="cenc";this.keyIdToKeySessionPromise[s]=this.generateRequestWithPreferredKeySession(r,i,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return Ln.hexDump(e.keyId)}updateKeySession(e,t){var r;const s=e.mediaKeysSession;return this.log(`Updating key-session "${s.sessionId}" for keyID ${Ln.hexDump(((r=e.decryptdata)==null?void 0:r.keyId)||[])}
      } (data length: ${t&&t.byteLength})`),s.update(t)}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){return new Promise((t,r)=>{const s=zo(this.config),i=e.map(_u).filter(o=>!!o&&s.indexOf(o)!==-1);return this.getKeySystemSelectionPromise(i).then(({keySystem:o})=>{const a=ku(o);a?t(a):r(new Error(`Unable to find format for key-system "${o}"`))}).catch(r)})}loadKey(e){const t=e.keyInfo.decryptdata,r=this.getKeyIdString(t),s=`(keyId: ${r} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${s}`);let i=this.keyIdToKeySessionPromise[r];return i||(i=this.getKeySystemForKeyPromise(t).then(({keySystem:a,mediaKeys:l})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${s}`),this.attemptSetMediaKeys(a,l).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:a,mediaKeys:l,decryptdata:t}))))),(this.keyIdToKeySessionPromise[r]=i.then(a=>{const l="cenc",u=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(a,l,u,"playlist-key")})).catch(a=>this.handleError(a))),i}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof Kt?this.hls.trigger(x.ERROR,e.data):this.hls.trigger(x.ERROR,{type:te.KEY_SYSTEM_ERROR,details:b.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),r=this.keyIdToKeySessionPromise[t];if(!r){const s=_u(e.keyFormat),i=s?[s]:zo(this.config);return this.attemptKeySystemAccess(i)}return r}getKeySystemSelectionPromise(e){if(e.length||(e=zo(this.config)),e.length===0)throw new Kt({type:te.KEY_SYSTEM_ERROR,details:b.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${be({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){const r=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const s=Promise.all(r).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.setMediaKeysQueue.push(s),s.then(()=>{this.log(`Media-keys set for "${e}"`),r.push(s),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(i=>r.indexOf(i)===-1)})}generateRequestWithPreferredKeySession(e,t,r,s){var i,o;const a=(i=this.config.drmSystems)==null||(o=i[e.keySystem])==null?void 0:o.generateRequest;if(a)try{const m=a.call(this.hls,t,r,e);if(!m)throw new Error("Invalid response from configured generateRequest filter");t=m.initDataType,r=m.initData?m.initData:null,e.decryptdata.pssh=r?new Uint8Array(r):null}catch(m){var l;if(this.warn(m.message),(l=this.hls)!=null&&l.config.debug)throw m}if(r===null)return this.log(`Skipping key-session request for "${s}" (no initData)`),Promise.resolve(e);const u=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${s}": ${u} (init data type: ${t} length: ${r?r.byteLength:null})`);const c=new bf,d=e._onmessage=m=>{const g=e.mediaKeysSession;if(!g){c.emit("error",new Error("invalid state"));return}const{messageType:p,message:y}=m;this.log(`"${p}" message event for session "${g.sessionId}" message size: ${y.byteLength}`),p==="license-request"||p==="license-renewal"?this.renewLicense(e,y).catch(v=>{c.eventNames().length?c.emit("error",v):this.handleError(v)}):p==="license-release"?e.keySystem===xe.FAIRPLAY&&(this.updateKeySession(e,rd("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${p}"`)},f=e._onkeystatuseschange=m=>{if(!e.mediaKeysSession){c.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(e);const p=e.keyStatus;c.emit("keyStatus",p),p==="expired"&&(this.warn(`${e.keySystem} expired for key ${u}`),this.renewKeySession(e))};e.mediaKeysSession.addEventListener("message",d),e.mediaKeysSession.addEventListener("keystatuseschange",f);const h=new Promise((m,g)=>{c.on("error",g),c.on("keyStatus",p=>{p.startsWith("usable")?m():p==="output-restricted"?g(new Kt({type:te.KEY_SYSTEM_ERROR,details:b.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):p==="internal-error"?g(new Kt({type:te.KEY_SYSTEM_ERROR,details:b.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${p}"`)):p==="expired"?g(new Error("key expired while generating request")):this.warn(`unhandled key status change "${p}"`)})});return e.mediaKeysSession.generateRequest(t,r).then(()=>{var m;this.log(`Request generated for key-session "${(m=e.mediaKeysSession)==null?void 0:m.sessionId}" keyId: ${u}`)}).catch(m=>{throw new Kt({type:te.KEY_SYSTEM_ERROR,details:b.KEY_SYSTEM_NO_SESSION,error:m,fatal:!1},`Error generating key-session request: ${m}`)}).then(()=>h).catch(m=>{throw c.removeAllListeners(),this.removeSession(e),m}).then(()=>(c.removeAllListeners(),e))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach((t,r)=>{if(typeof r=="string"&&typeof t=="object"){const s=r;r=t,t=s}this.log(`key status change "${t}" for keyStatuses keyId: ${Ln.hexDump("buffer"in r?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r))} session keyId: ${Ln.hexDump(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t})}fetchServerCertificate(e){const t=this.config,r=t.loader,s=new r(t),i=this.getServerCertificateUrl(e);return i?(this.log(`Fetching server certificate for "${e}"`),new Promise((o,a)=>{const l={responseType:"arraybuffer",url:i},u=t.certLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,h,m,g)=>{o(f.data)},onError:(f,h,m,g)=>{a(new Kt({type:te.KEY_SYSTEM_ERROR,details:b.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:m,response:Ee({url:l.url,data:void 0},f)},`"${e}" certificate request failed (${i}). Status: ${f.code} (${f.text})`))},onTimeout:(f,h,m)=>{a(new Kt({type:te.KEY_SYSTEM_ERROR,details:b.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:m,response:{url:l.url,data:void 0}},`"${e}" certificate request timed out (${i})`))},onAbort:(f,h,m)=>{a(new Error("aborted"))}};s.load(l,c,d)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,r){return new Promise((s,i)=>{e.setServerCertificate(r).then(o=>{this.log(`setServerCertificate ${o?"success":"not supported by CDM"} (${r==null?void 0:r.byteLength}) on "${t}"`),s(e)}).catch(o=>{i(new Kt({type:te.KEY_SYSTEM_ERROR,details:b.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:o,fatal:!0},o.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(r=>this.updateKeySession(e,new Uint8Array(r)).catch(s=>{throw new Kt({type:te.KEY_SYSTEM_ERROR,details:b.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:s,fatal:!0},s.message)}))}unpackPlayReadyKeyMessage(e,t){const r=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!r.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const s=new DOMParser().parseFromString(r,"application/xml"),i=s.querySelectorAll("HttpHeader");if(i.length>0){let c;for(let d=0,f=i.length;d<f;d++){var o,a;c=i[d];const h=(o=c.querySelector("name"))==null?void 0:o.textContent,m=(a=c.querySelector("value"))==null?void 0:a.textContent;h&&m&&e.setRequestHeader(h,m)}}const l=s.querySelector("Challenge"),u=l==null?void 0:l.textContent;if(!u)throw new Error("Cannot find <Challenge> in key message");return rd(atob(u))}setupLicenseXHR(e,t,r,s){const i=this.config.licenseXhrSetup;return i?Promise.resolve().then(()=>{if(!r.decryptdata)throw new Error("Key removed");return i.call(this.hls,e,t,r,s)}).catch(o=>{if(!r.decryptdata)throw o;return e.open("POST",t,!0),i.call(this.hls,e,t,r,s)}).then(o=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:o||s})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:s}))}requestLicense(e,t){const r=this.config.keyLoadPolicy.default;return new Promise((s,i)=>{const o=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${o}`);const a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return i(new Error("invalid state"));if(a.readyState===4)if(a.status===200){this._requestLicenseFailureCount=0;let l=a.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);const u=this.config.licenseResponseCallback;if(u)try{l=u.call(this.hls,a,o,e)}catch(c){this.error(c)}s(l)}else{const l=r.errorRetry,u=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>u||a.status>=400&&a.status<500)i(new Kt({type:te.KEY_SYSTEM_ERROR,details:b.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:a,response:{url:o,data:void 0,code:a.status,text:a.statusText}},`License Request XHR failed (${o}). Status: ${a.status} (${a.statusText})`));else{const c=u-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${c} attempts left`),this.requestLicense(e,t).then(s,i)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=a,this.setupLicenseXHR(a,o,e,t).then(({xhr:l,licenseChallenge:u})=>{e.keySystem==xe.PLAYREADY&&(u=this.unpackPlayReadyKeyMessage(l,u)),l.send(u)})})}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const r=t.media;this.media=r,r.removeEventListener("encrypted",this.onMediaEncrypted),r.removeEventListener("waitingforkey",this.onWaitingForKey),r.addEventListener("encrypted",this.onMediaEncrypted),r.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media;e&&(e.removeEventListener("encrypted",this.onMediaEncrypted),e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null)}_clear(e){var t;const r=this.mediaKeySessions;this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},so.clearKeyUriToKeyIdMap();const s=r.length;Ds.CDMCleanupPromise=Promise.all(r.map(i=>this.removeSession(i)).concat(e==null||(t=e.setMediaKeys(null))==null?void 0:t.catch(i=>{var o;this.log(`Could not clear media keys: ${i}`),(o=this.hls)==null||o.trigger(x.ERROR,{type:te.OTHER_ERROR,details:b.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${i}`)})}))).then(()=>{s&&(this.log("finished closing key sessions and clearing media keys"),r.length=0)}).catch(i=>{var o;this.log(`Could not close sessions and clear media keys: ${i}`),(o=this.hls)==null||o.trigger(x.ERROR,{type:te.OTHER_ERROR,details:b.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${i}`)})})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const r=t.reduce((s,i)=>(s.indexOf(i.keyFormat)===-1&&s.push(i.keyFormat),s),[]);this.log(`Selecting key-system from session-keys ${r.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(r)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:r}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),r&&r.readyState!==XMLHttpRequest.DONE&&r.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const s=this.mediaKeySessions.indexOf(e);s>-1&&this.mediaKeySessions.splice(s,1);const{drmSystemOptions:i}=this.config;return(MI(i)?new Promise((a,l)=>{self.setTimeout(()=>l(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(a)}):Promise.resolve()).catch(a=>{var l;this.log(`Could not remove session: ${a}`),(l=this.hls)==null||l.trigger(x.ERROR,{type:te.OTHER_ERROR,details:b.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${a}`)})}).then(()=>t.close()).catch(a=>{var l;this.log(`Could not close session: ${a}`),(l=this.hls)==null||l.trigger(x.ERROR,{type:te.OTHER_ERROR,details:b.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${a}`)})})}}}Ds.CDMCleanupPromise=void 0;class Kt extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}class H_{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(x.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(x.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const r=this.hls.config;if(r.capLevelOnFPSDrop){const s=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=s,s&&typeof s.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,r){const s=performance.now();if(t){if(this.lastTime){const i=s-this.lastTime,o=r-this.lastDroppedFrames,a=t-this.lastDecodedFrames,l=1e3*o/i,u=this.hls;if(u.trigger(x.FPS_DROP,{currentDropped:o,currentDecoded:a,totalDroppedFrames:r}),l>0&&o>u.config.fpsDroppedMonitoringThreshold*a){let c=u.currentLevel;u.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(u.autoLevelCapping===-1||u.autoLevelCapping>=c)&&(c=c-1,u.trigger(x.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:u.currentLevel}),u.autoLevelCapping=c,this.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=r,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function aE(n,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=n,e.dispatchEvent(t)}function lE(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues&&!n.cues.getCueById(e.id))try{if(n.addCue(e),!n.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(r){pe.debug(`[texttrack-utils]: ${r}`);try{const s=new self.TextTrackCue(e.startTime,e.endTime,e.text);s.id=e.id,n.addCue(s)}catch(s){pe.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${s}`)}}t==="disabled"&&(n.mode=t)}function Ls(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues)for(let r=n.cues.length;r--;)e&&n.cues[r].removeEventListener("enter",e),n.removeCue(n.cues[r]);t==="disabled"&&(n.mode=t)}function dd(n,e,t,r){const s=n.mode;if(s==="disabled"&&(n.mode="hidden"),n.cues&&n.cues.length>0){const i=z_(n.cues,e,t);for(let o=0;o<i.length;o++)(!r||r(i[o]))&&n.removeCue(i[o])}s==="disabled"&&(n.mode=s)}function K_(n,e){if(e<=n[0].startTime)return 0;const t=n.length-1;if(e>n[t].endTime)return-1;let r=0,s=t,i;for(;r<=s;)if(i=Math.floor((s+r)/2),e<n[i].startTime)s=i-1;else if(e>n[i].startTime&&r<t)r=i+1;else return i;return n[r].startTime-e<e-n[s].startTime?r:s}function z_(n,e,t){const r=[],s=K_(n,e);if(s>-1)for(let i=s,o=n.length;i<o;i++){const a=n[i];if(a.startTime>=e&&a.endTime<=t)r.push(a);else if(a.startTime>t)return r}return r}function Ia(n){const e=[];for(let t=0;t<n.length;t++){const r=n[t];(r.kind==="subtitles"||r.kind==="captions")&&r.label&&e.push(n[t])}return e}class W_ extends Uf{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const r=Ia(this.media.textTracks);for(let i=0;i<r.length;i++)if(r[i].mode==="hidden")t=r[i];else if(r[i].mode==="showing"){t=r[i];break}const s=this.findTrackForTextTrack(t);this.subtitleTrack!==s&&this.setSubtitleTrack(s)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.LEVEL_LOADING,this.onLevelLoading,this),e.on(x.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(x.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(x.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.LEVEL_LOADING,this.onLevelLoading,this),e.off(x.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(x.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(x.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const r=this.media;if(!r)return;const s=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||r.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,s)return;Ia(r.textTracks).forEach(o=>{Ls(o)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:r,groupId:s,details:i}=t,o=this.tracksInGroup[r];if(!o||o.groupId!==s){this.warn(`Subtitle track with id:${r} and group:${s} not found in active group ${o==null?void 0:o.groupId}`);return}const a=o.details;o.details=t.details,this.log(`Subtitle track ${r} "${o.name}" lang:${o.lang} group:${s} loaded [${i.startSN}-${i.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.subtitleGroups||null,s=this.groupIds;let i=this.currentTrack;if(!r||(s==null?void 0:s.length)!==(r==null?void 0:r.length)||r!=null&&r.some(o=>(s==null?void 0:s.indexOf(o))===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(c=>!r||r.indexOf(c.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(c=>c.default)&&(this.selectDefaultTrack=!1),o.forEach((c,d)=>{c.id=d});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const a=this.hls.config.subtitlePreference;if(!i&&a){this.selectDefaultTrack=!1;const c=_n(a,o);if(c>-1)i=o[c];else{const d=_n(a,this.tracks);i=this.tracks[d]}}let l=this.findTrackId(i);l===-1&&i&&(l=this.findTrackId(null));const u={subtitleTracks:o};this.log(`Updating subtitle tracks, ${o.length} track(s) found in "${r==null?void 0:r.join(",")}" group-id`),this.hls.trigger(x.SUBTITLE_TRACKS_UPDATED,u),l!==-1&&this.trackId===-1&&this.setSubtitleTrack(l)}}findTrackId(e){const t=this.tracksInGroup,r=this.selectDefaultTrack;for(let s=0;s<t.length;s++){const i=t[s];if(!(r&&!i.default||!r&&!e)&&(!e||Wr(i,e)))return s}if(e){for(let s=0;s<t.length;s++){const i=t[s];if(lo(e.attrs,i.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return s}for(let s=0;s<t.length;s++){const i=t[s];if(lo(e.attrs,i.attrs,["LANGUAGE"]))return s}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const s=t[r];if(ld(s,e))return r}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===he.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const r=this.currentTrack;if(r&&Wr(e,r))return r;const s=_n(e,this.tracksInGroup);if(s>-1){const i=this.tracksInGroup[s];return this.setSubtitleTrack(s),i}else{if(r)return null;{const i=_n(e,t);if(i>-1)return t[i]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=e.id,s=e.groupId,i=this.getUrlWithDirectives(e.url,t),o=e.details,a=o==null?void 0:o.age;this.log(`Loading subtitle ${r} "${e.name}" lang:${e.lang} group:${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${i}`),this.hls.trigger(x.SUBTITLE_TRACK_LOADING,{url:i,id:r,groupId:s,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=Ia(e.textTracks),r=this.currentTrack;let s;if(r&&(s=t.filter(i=>ld(r,i))[0],s||this.warn(`Unable to find subtitle TextTrack with name "${r.name}" and language "${r.lang}"`)),[].slice.call(t).forEach(i=>{i.mode!=="disabled"&&i!==s&&(i.mode="disabled")}),s){const i=this.subtitleDisplay?"showing":"hidden";s.mode!==i&&(s.mode=i)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!K(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const r=this.currentTrack,s=t[e]||null;if(this.trackId=e,this.currentTrack=s,this.toggleTrackModes(),!s){this.hls.trigger(x.SUBTITLE_TRACK_SWITCH,{id:e});return}const i=!!s.details&&!s.details.live;if(e===this.trackId&&s===r&&i)return;this.log(`Switching to subtitle-track ${e}`+(s?` "${s.name}" lang:${s.lang} group:${s.groupId}`:""));const{id:o,groupId:a="",name:l,type:u,url:c}=s;this.hls.trigger(x.SUBTITLE_TRACK_SWITCH,{id:o,groupId:a,name:l,type:u,url:c});const d=this.switchParams(s.url,r==null?void 0:r.details,s.details);this.loadPlaylist(d)}}function Pi(n){let e=5381,t=n.length;for(;t;)e=e*33^n.charCodeAt(--t);return(e>>>0).toString()}const Ps=.025;let hl=function(n){return n[n.Point=0]="Point",n[n.Range=1]="Range",n}({});function Y_(n,e,t){return`${n.identifier}-${t+1}-${Pi(e)}`}class q_{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){if(e>=this.assetList.length)return!0;const t=this.playoutLimit;return e<=0||isNaN(t)?!1:this.assetList[e].startOffset>t}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Uu(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,r=Uu(t,e);return t-r<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=K(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Uu(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<Ps))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?hl.Range:hl.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return X_(this)}}function Uu(n,e){return n-e.start<e.duration/2&&!(Math.abs(n-(e.start+e.duration))<Ps)?e.start:e.start+e.duration}function uE(n,e,t){const r=new self.URL(n,t);return r.protocol!=="data:"&&r.searchParams.set("_HLS_primary_id",e),r}function X_(n){return`["${n.identifier}" ${n.cue.pre?"<pre>":n.cue.post?"<post>":""}${n.timelineStart.toFixed(2)}-${n.resumeTime.toFixed(2)}]`}function fd(n){const e=n.timelineStart,t=n.duration||0;return`["${n.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class Q_{constructor(e,t,r,s){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{const u=this.interstitial.playoutLimit,c=this.currentTime;this.startOffset+c>=u&&this.hls.trigger(x.PLAYOUT_LIMIT_REACHED,{})};const i=this.hls=new e(t);this.interstitial=r,this.assetItem=s;let o=s.uri;try{o=uE(o,i.sessionId).href}catch{}i.loadSource(o);const a=()=>{this.hasDetails=!0};i.once(x.LEVEL_LOADED,a),i.once(x.AUDIO_TRACK_LOADED,a),i.once(x.SUBTITLE_TRACK_LOADED,a),i.on(x.MEDIA_ATTACHING,(l,{media:u})=>{this.removeMediaListeners(),this.mediaAttached=u,this.interstitial.playoutLimit&&u.addEventListener("timeupdate",this.checkPlayout)})}bufferedInPlaceToEnd(e){var t;if(!this.interstitial.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e||!this._bufferedEosTime)return!1;const r=this.timelineOffset,s=fe.bufferInfo(e,r,0);return this.getAssetTime(s.end)>=this._bufferedEosTime-.02}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=fe.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;return e||0}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const r=e-t;if(Math.abs(r)>1/9e4){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,r=this.duration;return Math.min(Math.max(0,e-t),r)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls.destroy(),this.hls=this.interstitial=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){this.hls.attachMedia(e)}detachMedia(){this.removeMediaListeners(),this.mediaAttached=null,this.hls.detachMedia()}resumeBuffering(){this.hls.resumeBuffering()}pauseBuffering(){this.hls.pauseBuffering()}transferMedia(){return this.bufferSnapShot(),this.hls.transferMedia()}on(e,t,r){this.hls.on(e,t)}once(e,t,r){this.hls.once(e,t)}off(e,t,r){this.hls.off(e,t)}toString(){var e,t;return`HlsAssetPlayer: ${fd(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${(t=this.interstitial)!=null&&t.appendInPlace?"append-in-place":""}`}}const Dg=.033;class J_ extends Zn{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((r,s)=>e<=s.startOffset&&t>s.startOffset?(delete s.error,r+1):r,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let r=-1;e.nextEvent?r=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(r=this.findEventIndex(e.previousEvent.identifier)+1);const s=this.items;if(s)for(s[r]||(t===void 0&&(t=e.start),r=this.findItemIndexAtTime(t));r>=0&&(i=s[r])!=null&&i.event;){var i;r--}return r}findItemIndexAtTime(e,t){const r=this.items;if(r)for(let s=0;s<r.length;s++){let i=r[s];if(t&&t!=="primary"&&(i=i[t]),e===i.start||e>i.start&&e<i.end)return s}return-1}findJumpRestrictedIndex(e,t){const r=this.items;if(r)for(let s=e;s<=t&&r[s];s++){const i=r[s].event;if(i!=null&&i.restrictions.jump&&!i.appendInPlace)return s}return-1}findEventIndex(e){const t=this.items;if(t)for(let s=t.length;s--;){var r;if(((r=t[s].event)==null?void 0:r.identifier)===e)return s}return-1}findAssetIndex(e,t){const r=e.assetList,s=r.length;if(s>1)for(let i=0;i<s;i++){const o=r[i];if(!o.error){const a=o.timelineStart;if(t===a||t>a&&t<a+(o.duration||0))return i}}return 0}get assetIdAtEnd(){var e,t;const r=(e=this.items)==null||(t=e[this.length-1])==null?void 0:t.event;if(r){const s=r.assetList,i=s[s.length-1];if(i)return i.identifier}return null}parseInterstitialDateRanges(e,t){const r=e.main.details,{dateRanges:s}=r,i=this.events,o=this.parseDateRanges(s,{url:r.url},t),a=Object.keys(s),l=i?i.filter(u=>!a.includes(u.identifier)):[];o.length&&o.sort((u,c)=>{const d=u.cue.pre,f=u.cue.post,h=c.cue.pre,m=c.cue.post;if(d&&!h)return-1;if(h&&!d||f&&!m)return 1;if(m&&!f)return-1;if(!d&&!h&&!f&&!m){const g=u.startTime,p=c.startTime;if(g!==p)return g-p}return u.dateRange.tagOrder-c.dateRange.tagOrder}),this.events=o,l.forEach(u=>{this.removeEvent(u)}),this.updateSchedule(e,l)}updateSchedule(e,t=[]){const r=this.events||[];if(r.length||t.length||this.length<2){const s=this.items,i=this.parseSchedule(r,e);(t.length||(s==null?void 0:s.length)!==i.length||i.some((a,l)=>Math.abs(a.playout.start-s[l].playout.start)>.005||Math.abs(a.playout.end-s[l].playout.end)>.005))&&(this.items=i,this.onScheduleUpdate(t,s))}}parseDateRanges(e,t,r){const s=[],i=Object.keys(e);for(let o=0;o<i.length;o++){const a=i[o],l=e[a];if(l.isInterstitial){let u=this.eventMap[a];u?u.setDateRange(l):(u=new q_(l,t),this.eventMap[a]=u,r===!1&&(u.appendInPlace=r)),s.push(u)}}return s}parseSchedule(e,t){const r=[],s=t.main.details,i=s.live?1/0:s.edge;let o=0;if(e=e.filter(l=>!l.error&&!(l.cue.once&&l.hasPlayed)),e.length){this.resolveOffsets(e,t);let l=0,u=0;if(e.forEach((c,d)=>{const f=c.cue.pre,h=c.cue.post,m=e[d-1]||null,g=c.appendInPlace,p=h?i:c.startOffset,y=c.duration,v=c.timelineOccupancy===hl.Range?y:0,E=c.resumptionOffset,T=(m==null?void 0:m.startTime)===p,A=p+c.cumulativeDuration;let R=g?A+y:p+E;if(f||!h&&p<=0){const I=u;u+=v,c.timelineStart=A;const C=o;o+=y,r.push({event:c,start:A,end:R,playout:{start:C,end:o},integrated:{start:I,end:u}})}else if(p<=i){if(!T){const _=p-l;if(_>Dg){const F=l,B=u;u+=_;const ie=o;o+=_;const z={previousEvent:e[d-1]||null,nextEvent:c,start:F,end:F+_,playout:{start:ie,end:o},integrated:{start:B,end:u}};r.push(z)}else _>0&&m&&(m.cumulativeDuration+=_,r[r.length-1].end=p)}h&&(R=A),c.timelineStart=A;const I=u;u+=v;const C=o;o+=y,r.push({event:c,start:A,end:R,playout:{start:C,end:o},integrated:{start:I,end:u}})}else return;const L=c.resumeTime;h||L>i?l=i:l=L}),l<i){var a;const c=l,d=u,f=i-l;u+=f;const h=o;o+=f,r.push({previousEvent:((a=r[r.length-1])==null?void 0:a.event)||null,nextEvent:null,start:l,end:c+f,playout:{start:h,end:o},integrated:{start:d,end:u}})}this.setDurations(i,o,u)}else r.push({previousEvent:null,nextEvent:null,start:0,end:i,playout:{start:0,end:i},integrated:{start:0,end:i}}),this.setDurations(i,i,i);return r}setDurations(e,t,r){this.durations={primary:e,playout:t,integrated:r}}resolveOffsets(e,t){const r=t.main.details,s=r.live?1/0:r.edge;let i=0,o=-1;e.forEach((a,l)=>{const u=a.cue.pre,c=a.cue.post,d=u?0:c?s:a.startTime;this.updateAssetDurations(a),o===d?a.cumulativeDuration=i:(i=0,o=d),!c&&a.snapOptions.in&&(a.resumeAnchor=es(null,r.fragments,a.startOffset+a.resumptionOffset,0,0)||void 0),a.appendInPlace&&!a.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(a,t)||(a.appendInPlace=!1)),!a.appendInPlace&&l+1<e.length&&e[l+1].startTime-e[l].resumeTime<Dg&&(e[l+1].appendInPlace=!1,e[l+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${a}`));const h=K(a.resumeOffset)?a.resumeOffset:a.duration;i+=h})}primaryCanResumeInPlaceAt(e,t){const r=e.resumeTime,s=e.startTime+e.resumptionOffset;return Math.abs(r-s)>Ps?(this.log(`"${e.identifier}" resumption ${r} not aligned with estimated timeline end ${s}`),!1):t?!Object.keys(t).some(o=>{const a=t[o].details,l=a.edge;if(r>=l)return this.log(`"${e.identifier}" resumption ${r} past ${o} playlist end ${l}`),!1;const u=es(null,a.fragments,r);if(!u)return this.log(`"${e.identifier}" resumption ${r} does not align with any fragments in ${o} playlist (${a.fragStart}-${a.fragmentEnd})`),!0;const c=o==="audio"?.175:0;return Math.abs(u.start-r)<Ps+c||Math.abs(u.end-r)<Ps+c?!1:(this.log(`"${e.identifier}" resumption ${r} not aligned with ${o} fragment bounds (${u.start}-${u.end} sn: ${u.sn} cc: ${u.cc})`),!0)}):(this.log(`"${e.identifier}" resumption ${r} can not be aligned with media (none selected)`),!1)}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let r=0,s=!1,i=!1;e.assetList.forEach((o,a)=>{const l=t+r;o.startOffset=r,o.timelineStart=l,s||(s=o.duration===null),i||(i=!!o.error);const u=o.error?0:o.duration||0;r+=u}),s&&!i?e.duration=Math.max(r,e.duration):e.duration=r}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function ir(n){return`[${n.event?'"'+n.event.identifier+'"':"primary"}: ${n.start.toFixed(2)}-${n.end.toFixed(2)}]`}class Z_{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const r=e.assetListUrl;let s;try{s=uE(r,this.hls.sessionId,e.baseUrl)}catch(f){const h=this.assignAssetListError(e,b.ASSET_LIST_LOAD_ERROR,f,r);this.hls.trigger(x.ERROR,h);return}t&&s.protocol!=="data:"&&s.searchParams.set("_HLS_start_offset",""+t);const i=this.hls.config,o=i.loader,a=new o(i),l={responseType:"json",url:s.href},u=i.interstitialAssetListLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,h,m,g)=>{const p=f.data,y=p==null?void 0:p.ASSETS;if(!Array.isArray(y)){const v=this.assignAssetListError(e,b.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),m.url,h,g);this.hls.trigger(x.ERROR,v);return}e.assetListResponse=p,this.hls.trigger(x.ASSET_LIST_LOADED,{event:e,assetListResponse:p,networkDetails:g})},onError:(f,h,m,g)=>{const p=this.assignAssetListError(e,b.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${f.code} ${f.text} (${h.url})`),h.url,g,m);this.hls.trigger(x.ERROR,p)},onTimeout:(f,h,m)=>{const g=this.assignAssetListError(e,b.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${h.url})`),h.url,f,m);this.hls.trigger(x.ERROR,g)}};return a.load(l,c,d),this.hls.trigger(x.ASSET_LIST_LOADING,{event:e}),a}assignAssetListError(e,t,r,s,i,o){return e.error=r,{type:te.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:s,error:r,networkDetails:o,stats:i}}}function Kn(n,e,t){kn(n,e,t),n.addEventListener(e,t)}function kn(n,e,t){n.removeEventListener(e,t)}function Pg(n){n==null||n.play().catch(()=>{})}class ew extends Zn{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const r=this.currentTime;if(r===void 0||this.playbackDisabled)return;const s=r-this.timelinePos;if(Math.abs(s)<1/7056e5)return;const o=s<=-.01;this.timelinePos=r,this.bufferedPos=r;const a=this.playingItem;if(!a){this.checkBuffer();return}if(o&&this.schedule.resetErrorsInRange(r,r-s)&&this.updateSchedule(),this.checkBuffer(),o&&r<a.start||r>=a.end){var l;const f=this.schedule.findItemIndexAtTime(this.timelinePos);if(!this.isInterstitial(a)&&(l=this.media)!=null&&l.paused&&(this.shouldPlay=!1),!o){const h=this.findItemIndex(a);if(f>h){const m=this.schedule.findJumpRestrictedIndex(h+1,f);if(m>h){this.setSchedulePosition(m);return}}}this.setSchedulePosition(f);return}const u=this.playingAsset;if(!u){if(this.playingLastItem&&this.isInterstitial(a)){const f=a.event.assetList[0];f&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(r,f))}return}const c=u.timelineStart,d=u.duration||0;(o&&r<c||r>=c+d)&&this.setScheduleToAssetAtTime(r,u)},this.onTimeupdate=()=>{const r=this.currentTime;if(r===void 0||this.playbackDisabled)return;if(r>this.timelinePos)this.timelinePos=r,r>this.bufferedPos&&this.checkBuffer();else return;const s=this.playingItem;if(!s||this.playingLastItem)return;if(r>=s.end){this.timelinePos=s.end;const a=this.findItemIndex(s);this.setSchedulePosition(a+1)}const i=this.playingAsset;if(!i)return;const o=i.timelineStart+(i.duration||0);r>=o&&this.setScheduleToAssetAtTime(r,i)},this.onScheduleUpdate=(r,s)=>{const i=this.schedule,o=this.playingItem,a=i.events||[],l=i.items||[],u=i.durations,c=r.map(h=>h.identifier),d=!!(a.length||c.length);if(d&&this.log(`INTERSTITIALS_UPDATED (${a.length}): ${a}
Schedule: ${l.map(h=>ir(h))}`),c.length&&this.log(`Removed events ${c}`),this.playerQueue.forEach(h=>{if(h.interstitial.appendInPlace){const m=h.assetItem.timelineStart,g=h.timelineOffset-m;if(g)try{h.timelineOffset=m}catch(p){Math.abs(g)>Ps&&this.warn(`${p} ("${h.assetId}" ${h.timelineOffset}->${m})`)}}}),o){const h=this.updateItem(o,this.timelinePos);this.itemsMatch(o,h)&&(this.playingItem=h,this.waitingItem=this.endedItem=null)}else this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const f=this.bufferingItem;if(f){const h=this.updateItem(f,this.bufferedPos);this.itemsMatch(f,h)?this.bufferingItem=h:f.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(f.event,null))}if(r.forEach(h=>{h.assetList.forEach(m=>{this.clearAssetPlayer(m.identifier,null)})}),d||s){if(this.hls.trigger(x.INTERSTITIALS_UPDATED,{events:a.slice(0),schedule:l.slice(0),durations:u,removedIds:c}),this.isInterstitial(o)&&c.includes(o.event.identifier)){this.warn(`Interstitial "${o.event.identifier}" removed while playing`),this.primaryFallback(o.event);return}this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new Z_(e),this.schedule=new J_(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(x.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(x.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(x.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(x.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(x.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(x.BUFFER_APPENDED,this.onBufferAppended,this),e.on(x.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(x.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(x.MEDIA_ENDED,this.onMediaEnded,this),e.on(x.ERROR,this.onError,this),e.on(x.DESTROYING,this.onDestroying,this)}unregisterListeners(){const e=this.hls;e&&(e.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(x.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(x.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(x.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(x.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(x.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(x.BUFFER_CODECS,this.onBufferCodecs,this),e.off(x.BUFFER_APPENDED,this.onBufferAppended,this),e.off(x.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(x.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(x.MEDIA_ENDED,this.onMediaEnded,this),e.off(x.ERROR,this.onError,this),e.off(x.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.manager=null,this.hls=this.HlsPlayerClass=this.schedule=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){kn(e,"play",this.onPlay),kn(e,"pause",this.onPause),kn(e,"seeking",this.onSeeking),kn(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const r=this.media=t.media;Kn(r,"seeking",this.onSeeking),Kn(r,"timeupdate",this.onTimeupdate),Kn(r,"play",this.onPlay),Kn(r,"pause",this.onPause)}onMediaAttached(e,t){const r=this.effectivePlayingItem,s=this.detachedData;if(this.detachedData=null,r===null)this.checkStart();else if(!s){this.clearScheduleState();const i=this.findItemIndex(r);this.setSchedulePosition(i)}}clearScheduleState(){this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const r=!!t.transferMedia,s=this.media;if(this.media=null,!r&&(s&&this.removeMediaListeners(s),this.detachedData)){const i=this.getBufferingPlayer();i&&(this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,i.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.manager){if(!this.hls)return null;const e=this,t=()=>e.bufferingItem||e.waitingItem,r=d=>d&&e.getAssetPlayer(d.identifier),s=(d,f,h,m,g)=>{if(d){let p=d[f].start;const y=d.event;if(y){if(f==="playout"||y.timelineOccupancy!==hl.Point){const v=r(h);(v==null?void 0:v.interstitial)===y&&(p+=v.assetItem.startOffset+v[g])}}else{const v=m==="bufferedPos"?o():e[m];p+=v-d.start}return p}return 0},i=(d,f)=>{if(d!==0&&f!=="primary"&&e.schedule.length){var h;const m=e.schedule.findItemIndexAtTime(d),g=(h=e.schedule.items)==null?void 0:h[m];if(g){const p=g[f].start-g.start;return d+p}}return d},o=()=>{const d=e.bufferedPos;return d===Number.MAX_VALUE?a("primary"):Math.max(d,0)},a=d=>{var f;return(f=e.primaryDetails)!=null&&f.live?e.primaryDetails.edge:e.schedule.durations[d]},l=(d,f)=>{var h,m;const g=e.effectivePlayingItem;if(g!=null&&(h=g.event)!=null&&h.restrictions.skip)return;e.log(`seek to ${d} "${f}"`);const p=e.effectivePlayingItem,y=e.schedule.findItemIndexAtTime(d,f),v=(m=e.schedule.items)==null?void 0:m[y],E=e.getBufferingPlayer(),T=E==null?void 0:E.interstitial,A=T==null?void 0:T.appendInPlace,R=p&&e.itemsMatch(p,v);if(p&&(A||R)){const I=r(e.playingAsset),C=(I==null?void 0:I.media)||e.primaryMedia;if(C){const _=f==="primary"?C.currentTime:s(p,f,e.playingAsset,"timelinePos","currentTime"),F=d-_,B=(A?_:C.currentTime)+F;if(B>=0&&(!I||A||B<=I.duration)){C.currentTime=B;return}}}if(v){let I=d;if(f!=="primary"){const _=v[f].start,F=d-_;I=v.start+F}const C=!e.isInterstitial(v);if((!e.isInterstitial(p)||p.event.appendInPlace)&&(C||v.event.appendInPlace)){const _=e.media||(A?E==null?void 0:E.media:null);_&&(_.currentTime=I)}else if(p){const _=e.findItemIndex(p);if(y>_){const B=e.schedule.findJumpRestrictedIndex(_+1,y);if(B>_){e.setSchedulePosition(B);return}}let F=0;if(C)e.timelinePos=I,e.checkBuffer();else{var L;const B=v==null||(L=v.event)==null?void 0:L.assetList;if(B){const ie=d-(v[f]||v).start;for(let z=B.length;z--;){const Y=B[z];if(Y.duration&&ie>=Y.startOffset&&ie<Y.startOffset+Y.duration){F=z;break}}}}e.setSchedulePosition(y,F)}}},u=()=>{const d=e.effectivePlayingItem;if(e.isInterstitial(d))return d;const f=t();return e.isInterstitial(f)?f:null},c={get currentTime(){const d=u(),f=e.effectivePlayingItem;return f&&f===d?s(f,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-f.playout.start:0},set currentTime(d){const f=u(),h=e.effectivePlayingItem;h&&h===f&&l(d+h.playout.start,"playout")},get duration(){const d=u();return d?d.playout.end-d.playout.start:0},get assetPlayers(){var d;const f=(d=u())==null?void 0:d.event.assetList;return f?f.map(h=>e.getAssetPlayer(h.identifier)):[]},get playingIndex(){var d;const f=(d=u())==null?void 0:d.event;return f&&e.effectivePlayingAsset?f.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return u()}};this.manager={get events(){var d,f;return((d=e.schedule)==null||(f=d.events)==null?void 0:f.slice(0))||[]},get schedule(){var d,f;return((d=e.schedule)==null||(f=d.items)==null?void 0:f.slice(0))||[]},get interstitialPlayer(){return u()?c:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const d=t();return e.findItemIndex(d)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const d=e.effectivePlayingItem;return e.findItemIndex(d)},primary:{get bufferedEnd(){return o()},get currentTime(){const d=e.timelinePos;return d>0?d:0},set currentTime(d){l(d,"primary")},get duration(){return a("primary")},get seekableStart(){var d;return((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0}},integrated:{get bufferedEnd(){return s(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return s(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(d){l(d,"integrated")},get duration(){return a("integrated")},get seekableStart(){var d;return i(((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0,"integrated")}},skip:()=>{const d=e.effectivePlayingItem,f=d==null?void 0:d.event;if(f&&!f.restrictions.skip){const h=e.findItemIndex(d);if(f.appendInPlace){const m=d.playout.start+d.event.duration;l(m+.001,"playout")}else e.advanceAfterAssetEnded(f,h,1/0)}}}}return this.manager}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,r=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!r?!1:this.findItemIndex(t)===r.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t,r;if(this.mediaSelection===null)return;const s=this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&!s.event.appendInPlace)return;let i=this.media;!i&&(e=this.bufferingItem)!=null&&(t=e.event)!=null&&t.appendInPlace&&(i=this.primaryMedia);const o=(r=i)==null?void 0:r.currentTime;if(!(o===void 0||!K(o)))return o}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const r=this.getAssetPlayer(e);r&&this.transferMediaFromPlayer(r,t)}transferMediaFromPlayer(e,t){const r=e.interstitial.appendInPlace,s=e.media;if(r&&s===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&s){this.detachedData={media:s};return}const i=e.transferMedia();this.log(`transfer MediaSource from ${e} ${be(i)}`),this.detachedData=i}else t&&s&&(this.shouldPlay||(this.shouldPlay=!s.paused))}transferMediaTo(e,t){var r,s;if(e.media===t)return;let i=null;const o=this.hls,a=e!==o,l=a&&e.interstitial.appendInPlace,u=(r=this.detachedData)==null?void 0:r.mediaSource;let c;if(o.media)l&&(i=o.transferMedia(),this.detachedData=i),c="Primary";else if(u){const h=this.getBufferingPlayer();h?(i=h.transferMedia(),c=`${h}`):c="detached MediaSource"}else c="detached media";if(!i){if(u)i=this.detachedData,this.log(`using detachedData: MediaSource ${be(i)}`);else if(!this.detachedData||o.media===t){const h=this.playerQueue;h.length>1&&h.forEach(m=>{if(a&&m.interstitial.appendInPlace!==l){const g=m.interstitial;this.clearInterstitial(m.interstitial,null),g.appendInPlace=!1,g.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${g}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const d=i&&"mediaSource"in i&&((s=i.mediaSource)==null?void 0:s.readyState)!=="closed",f=d&&i?i:t;if(this.log(`${d?"transfering MediaSource":"attaching media"} to ${a?e:"Primary"} from ${c}`),f===i){const h=a&&e.assetId===this.schedule.assetIdAtEnd;f.overrides={duration:this.schedule.duration,endOfStream:!a||h,cueRemoval:!a}}e.attachMedia(f)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const r=this.timelinePos,s=this.effectivePlayingItem;if(r===-1){const i=this.hls.startPosition;if(this.timelinePos=i,t.length&&t[0].cue.pre){const o=e.findEventIndex(t[0].identifier);this.setSchedulePosition(o)}else if(i>=0||!this.primaryLive){const o=this.timelinePos=i>0?i:0,a=e.findItemIndexAtTime(o);this.setSchedulePosition(a)}}else if(s&&!this.playingItem){const i=e.findItemIndex(s);this.setSchedulePosition(i)}}advanceAfterAssetEnded(e,t,r){const s=r+1;if(!e.isAssetPastPlayoutLimit(s)&&!e.assetList[s].error)this.setSchedulePosition(t,s);else{const i=this.schedule.items;if(i){const o=t+1,a=i.length;if(o>=a){this.setSchedulePosition(-1);return}const l=e.resumeTime;this.timelinePos<l&&(this.timelinePos=l,this.checkBuffer()),this.setSchedulePosition(o)}}}setScheduleToAssetAtTime(e,t){const r=this.schedule,s=t.parentIdentifier,i=r.getEvent(s);if(i){const o=r.findEventIndex(s),a=r.findAssetIndex(i,e);this.setSchedulePosition(o,a)}}setSchedulePosition(e,t){const r=this.schedule.items;if(!r||this.playbackDisabled)return;this.log(`setSchedulePosition ${e}, ${t}`);const s=e>=0?r[e]:null,i=this.playingItem,o=this.playingLastItem;if(this.isInterstitial(i)){var a;const u=i.event,c=this.playingAsset,d=c==null?void 0:c.identifier,f=d?this.getAssetPlayer(d):null;if(f&&d&&(!this.eventItemsMatch(i,s)||t!==void 0&&d!==((a=u.assetList)==null?void 0:a[t].identifier))){var l;const h=u.findAssetIndex(c);this.log(`INTERSTITIAL_ASSET_ENDED ${h+1}/${u.assetList.length} ${fd(c)}`),this.endedAsset=c,this.playingAsset=null,this.hls.trigger(x.INTERSTITIAL_ASSET_ENDED,{asset:c,assetListIndex:h,event:u,schedule:r.slice(0),scheduleIndex:e,player:f}),this.retreiveMediaSource(d,s),f.media&&!((l=this.detachedData)!=null&&l.mediaSource)&&f.detachMedia()}if(!this.eventItemsMatch(i,s)&&(this.endedItem=i,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${u} ${ir(i)}`),u.hasPlayed=!0,this.hls.trigger(x.INTERSTITIAL_ENDED,{event:u,schedule:r.slice(0),scheduleIndex:e}),u.cue.once)){this.updateSchedule();const h=this.schedule.items;if(s&&h){const m=this.schedule.findItemIndex(s);this.advanceSchedule(m,h,t,i,o)}return}}this.advanceSchedule(e,r,t,i,o)}advanceSchedule(e,t,r,s,i){const o=e>=0?t[e]:null,a=this.primaryMedia,l=this.playerQueue;if(l.length&&l.forEach(u=>{const c=u.interstitial,d=this.schedule.findEventIndex(c.identifier);(d<e||d>e+1)&&this.clearInterstitial(c,o)}),this.isInterstitial(o)){this.timelinePos=Math.min(Math.max(this.timelinePos,o.start),o.end);const u=o.event;r===void 0&&(r=this.schedule.findAssetIndex(u,this.timelinePos));const c=this.waitingItem;this.assetsBuffered(o,a)||this.setBufferingItem(o);let d=this.preloadAssets(u,r);if(this.eventItemsMatch(o,c||s)||(this.waitingItem=o,this.log(`INTERSTITIAL_STARTED ${ir(o)} ${u.appendInPlace?"append in place":""}`),this.hls.trigger(x.INTERSTITIAL_STARTED,{event:u,schedule:t.slice(0),scheduleIndex:e})),!u.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${u}`);return}if(u.assetListLoader&&(u.assetListLoader.destroy(),u.assetListLoader=void 0),!a){this.log(`Waiting for attachMedia to start Interstitial ${u}`);return}this.waitingItem=this.endedItem=null,this.playingItem=o;const f=u.assetList[r];if(!f){const h=t[e+1],m=this.media;h&&m&&!this.isInterstitial(h)&&m.currentTime<h.start&&(m.currentTime=this.timelinePos=h.start),this.advanceAfterAssetEnded(u,e,r||0);return}if(d||(d=this.getAssetPlayer(f.identifier)),d===null||d.destroyed){const h=u.assetList.length;this.warn(`asset ${r+1}/${h} player destroyed ${u}`),d=this.createAssetPlayer(u,f,r)}if(!this.eventItemsMatch(o,this.bufferingItem)&&u.appendInPlace&&this.isAssetBuffered(f))return;this.startAssetPlayer(d,r,t,e,a),this.shouldPlay&&Pg(d.media)}else o!==null?(this.resumePrimary(o,e,s),this.shouldPlay&&Pg(this.hls.media)):i&&this.isInterstitial(s)&&(this.endedItem=null,this.playingItem=s,s.event.appendInPlace||this.attachPrimary(this.schedule.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e,t;return(e=this.mediaSelection)==null||(t=e.main)==null?void 0:t.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,r){var s;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${ir(e)}`),!((s=this.detachedData)!=null&&s.mediaSource)){let o=this.timelinePos;(o<e.start||o>=e.end)&&(o=this.getPrimaryResumption(e,t),this.timelinePos=o),this.attachPrimary(o,e)}if(!r)return;const i=this.schedule.items;i&&(this.log(`resumed ${ir(e)}`),this.hls.trigger(x.INTERSTITIALS_PRIMARY_RESUMED,{schedule:i.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const r=e.start;if(this.primaryLive){const s=this.primaryDetails;if(t===0)return this.hls.startPosition;if(s&&(r<s.fragmentStart||r>s.edge))return this.hls.liveSyncPosition||-1}return r}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:fe.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,r){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const s=this.primaryMedia;if(!s)return;const i=this.hls;i.media?this.checkBuffer():(this.transferMediaTo(i,s),r&&this.startLoadingPrimaryAt(e,r)),r||(this.timelinePos=e,this.startLoadingPrimaryAt(e,r))}startLoadingPrimaryAt(e,t){var r;const s=this.hls;!s.loadingEnabled||!s.media||Math.abs((((r=s.mainForwardBufferInfo)==null?void 0:r.start)||s.media.currentTime)-e)>.5?s.startLoad(e,t):s.bufferingEnabled||s.resumeBuffering()}onManifestLoading(){this.stopLoad(),this.schedule.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(x.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(x.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1)return;const r=this.hls.levels[t.level],s=Ee(Ee({},this.mediaSelection||this.altSelection),{},{main:r});this.mediaSelection=s,this.schedule.parseInterstitialDateRanges(s,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const r=this.hls.audioTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=Ee(Ee({},this.altSelection),{},{audio:r});return}const i=Ee(Ee({},s),{},{audio:r});this.mediaSelection=i}onSubtitleTrackUpdated(e,t){const r=this.hls.subtitleTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=Ee(Ee({},this.altSelection),{},{subtitles:r});return}const i=Ee(Ee({},s),{},{subtitles:r});this.mediaSelection=i}onAudioTrackSwitching(e,t){const r=Km(t);this.playerQueue.forEach(s=>s.hls.setAudioOption(t)||s.hls.setAudioOption(r))}onSubtitleTrackSwitch(e,t){const r=Km(t);this.playerQueue.forEach(s=>s.hls.setSubtitleOption(t)||t.id!==-1&&s.hls.setSubtitleOption(r))}onBufferCodecs(e,t){const r=t.tracks;r&&(this.requiredTracks=r)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const r=this.playingItem;if(r&&!this.itemsMatch(r,this.bufferingItem)&&!this.isInterstitial(r)){const s=this.timelinePos;this.bufferedPos=s,this.checkBuffer()}}onBufferedToEnd(e){const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let s=0;s<t.length;s++){const i=t[s];if(i.cue.post){var r;const o=this.schedule.findEventIndex(i.identifier),a=(r=this.schedule.items)==null?void 0:r[o];this.isInterstitial(a)&&this.eventItemsMatch(a,this.bufferingItem)&&this.bufferedToItem(a,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const r=this.findItemIndex(t);this.setSchedulePosition(r+1)}else this.shouldPlay=!1}updateItem(e,t){const r=this.schedule.items;if(e&&r){const s=this.findItemIndex(e,t);return r[s]||null}return null}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var r;return!!t&&(e===t||e.event.identifier===((r=t.event)==null?void 0:r.identifier))}findItemIndex(e,t){return e?this.schedule.findItemIndex(e,t):-1}updateSchedule(){const e=this.mediaSelection;e&&this.schedule.updateSchedule(e,[])}checkBuffer(e){const t=this.schedule.items;if(!t)return;const r=fe.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=r.len<1),this.updateBufferedPos(r.end,t,e)}updateBufferedPos(e,t,r){const s=this.schedule,i=this.bufferingItem;if(this.bufferedPos>e)return;if(t.length===1&&this.itemsMatch(t[0],i)){this.bufferedPos=e;return}const o=this.playingItem,a=this.findItemIndex(o);let l=s.findItemIndexAtTime(e);if(this.bufferedPos<e){var u,c;const d=this.findItemIndex(i),f=Math.min(d+1,t.length-1),h=t[f];if((l===-1&&i&&e>=i.end||(u=h.event)!=null&&u.appendInPlace&&e+.01>=h.start)&&(l=f),f-a>1&&(i==null||(c=i.event)==null?void 0:c.appendInPlace)===!1)return;if(this.bufferedPos=e,l>d&&l>a)this.bufferedToItem(h);else{const m=this.primaryDetails;this.primaryLive&&m&&e>m.edge-m.targetduration&&h.start<m.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(h)&&this.preloadAssets(h.event,0)}}else r&&o&&!this.itemsMatch(o,i)&&(l===a?this.bufferedToItem(o):l===a+1&&this.bufferedToItem(t[l]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(s=>{const i=this.getAssetPlayer(s.identifier);return!(i!=null&&i.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,r=this.schedule;if(this.itemsMatch(e,t))this.bufferingItem!==e&&(this.bufferingItem=e);else{const{items:s,events:i}=r;if(!s||!i)return t;const o=this.isInterstitial(e),a=this.getBufferingPlayer();if(this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos)),!this.playbackDisabled){const l=a?a.remaining:t?t.end-this.timelinePos:0;this.log(`buffered to boundary ${ir(e)}`+(t?` (${l.toFixed(2)} remaining)`:"")),o?e.event.assetList.forEach(u=>{const c=this.getAssetPlayer(u.identifier);c&&c.resumeBuffering()}):(this.hls.resumeBuffering(),this.playerQueue.forEach(u=>u.pauseBuffering()))}this.hls.trigger(x.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:i.slice(0),schedule:s.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}return t}bufferedToItem(e,t=0){const r=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(r!==null){this.bufferingAsset=null;const s=this.detachedData;s?s.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),r=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(r)}bufferedToEvent(e,t){const r=e.event,s=r.assetList.length===0&&!r.assetListLoader,i=r.cue.once;if(s||!i){const o=this.preloadAssets(r,t);if(o!=null&&o.interstitial.appendInPlace){const a=r.assetList[t],l=this.primaryMedia;a&&l&&this.bufferAssetPlayer(o,l)}}}preloadAssets(e,t){const r=e.assetUrl,s=e.assetList.length,i=s===0&&!e.assetListLoader,o=e.cue.once;if(i){const l=e.timelineStart;if(e.appendInPlace){var a;const f=this.playingItem;!this.isInterstitial(f)&&(f==null||(a=f.nextEvent)==null?void 0:a.identifier)===e.identifier&&this.flushFrontBuffer(l+.25)}let u,c=0;if(!this.playingItem&&this.primaryLive&&(c=this.hls.startPosition,c===-1&&(c=this.hls.liveSyncPosition||0)),c&&!(e.cue.pre||e.cue.post)){const f=c-l;f>0&&(u=Math.round(f*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${r?1:s} ${e}${u?` live-start: ${c} start-offset: ${u}`:""}`),r)return this.createAsset(e,0,0,l,e.duration,r);const d=this.assetListLoader.loadAssetList(e,u);d&&(e.assetListLoader=d)}else if(!o&&s){for(let l=t;l<s;l++){const u=e.assetList[l],c=this.getAssetPlayerQueueIndex(u.identifier);(c===-1||this.playerQueue[c].destroyed)&&!u.error&&this.createAssetPlayer(e,u,l)}return this.getAssetPlayer(e.assetList[t].identifier)}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(s=>{this.hls.trigger(x.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:s})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let r=0;r<t.length;r++)if(e===t[r].assetId)return r;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let r=0;r<e.length;r++)if(e[r].media===t)return e[r]}return null}createAsset(e,t,r,s,i,o){const a={parentIdentifier:e.identifier,identifier:Y_(e,o,t),duration:i,startOffset:r,timelineStart:s,uri:o};return this.createAssetPlayer(e,a,t)}createAssetPlayer(e,t,r){this.log(`create HLSAssetPlayer for ${fd(t)}`);const s=this.hls,i=s.userConfig;let o=i.videoPreference;const a=s.loadLevelObj||s.levels[s.currentLevel];(o||a)&&(o=Le({},o),a.videoCodec&&(o.videoCodec=a.videoCodec),a.videoRange&&(o.allowedVideoRanges=[a.videoRange]));const l=s.audioTracks[s.audioTrack],u=s.subtitleTracks[s.subtitleTrack];let c=0;if(this.primaryLive||e.appendInPlace){const E=this.timelinePos-t.timelineStart;if(E>1){const T=t.duration;T&&E<T&&(c=E)}}const d=t.identifier,f=Ee(Ee({},i),{},{autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:s.sessionId,assetPlayerId:d,abrEwmaDefaultEstimate:s.bandwidthEstimate,interstitialsController:void 0,startPosition:c,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:o,audioPreference:l||i.audioPreference,subtitlePreference:u||i.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(f.timelineOffset=t.timelineStart));const h=f.cmcd;h!=null&&h.sessionId&&h.contentId&&(f.cmcd=Le({},h,{contentId:Pi(t.uri)})),this.getAssetPlayer(d)&&this.warn(`Duplicate date range identifier ${e} and asset ${d}`);const m=new Q_(this.HlsPlayerClass,f,e,t);this.playerQueue.push(m),e.assetList[r]=t;const g=E=>{if(E.live){const R=new Error(`Interstitials MUST be VOD assets ${e}`),L={fatal:!0,type:te.OTHER_ERROR,details:b.INTERSTITIAL_ASSET_ITEM_ERROR,error:R};this.handleAssetItemError(L,e,this.schedule.findEventIndex(e.identifier),r,R.message);return}const T=E.edge-E.fragmentStart,A=t.duration;(A===null||T>A)&&(this.log(`Interstitial asset "${d}" duration change ${A} > ${T}`),t.duration=T,this.updateSchedule())};m.on(x.LEVEL_UPDATED,(E,{details:T})=>g(T)),m.on(x.LEVEL_PTS_UPDATED,(E,{details:T})=>g(T));const p=(E,T)=>{const A=this.getAssetPlayer(d);if(A&&T.tracks){A.off(x.BUFFER_CODECS,p),A.tracks=T.tracks;const R=this.primaryMedia;this.bufferingAsset===A.assetItem&&R&&!A.media&&this.bufferAssetPlayer(A,R)}};m.on(x.BUFFER_CODECS,p);const y=()=>{var E;const T=this.getAssetPlayer(d);if(this.log(`buffered to end of asset ${T}`),!T)return;const A=this.schedule.findEventIndex(e.identifier),R=e.findAssetIndex(t),L=R+1,I=(E=this.schedule.items)==null?void 0:E[A];if(this.isInterstitial(I))if(R!==-1&&!e.isAssetPastPlayoutLimit(L)&&!e.assetList[L].error)this.bufferedToItem(I,L);else{var C;const _=(C=this.schedule.items)==null?void 0:C[A+1];_&&this.bufferedToItem(_)}};m.on(x.BUFFERED_TO_END,y);const v=E=>()=>{if(!this.getAssetPlayer(d))return;this.shouldPlay=!0;const A=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,A,E)};return m.once(x.MEDIA_ENDED,v(r)),m.once(x.PLAYOUT_LIMIT_REACHED,v(1/0)),m.on(x.ERROR,(E,T)=>{const A=this.getAssetPlayer(d);if(T.details===b.BUFFER_STALLED_ERROR){if(A!=null&&A.media){const R=A.currentTime,L=A.duration-R;R&&e.appendInPlace&&L/A.media.playbackRate<.5?(this.log(`Advancing buffer past end of asset ${d} ${e} at ${A.media.currentTime}`),y()):(this.warn(`Stalled at ${R} of ${R+L} in asset ${d} ${e}`),this.onTimeupdate(),this.checkBuffer(!0))}return}this.handleAssetItemError(T,e,this.schedule.findEventIndex(e.identifier),r,`Asset player error ${T.error} ${e}`)}),m.on(x.DESTROYING,()=>{if(!this.getAssetPlayer(d))return;const T=new Error(`Asset player destroyed unexpectedly ${d}`),A={fatal:!0,type:te.OTHER_ERROR,details:b.INTERSTITIAL_ASSET_ITEM_ERROR,error:T};this.handleAssetItemError(A,e,this.schedule.findEventIndex(e.identifier),r,T.message)}),this.hls.trigger(x.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:r,event:e,player:m}),m}clearInterstitial(e,t){e.assetList.forEach(r=>{this.clearAssetPlayer(r.identifier,t)}),e.reset()}clearAssetPlayer(e,t){const r=this.getAssetPlayerQueueIndex(e);if(r!==-1){this.log(`clearAssetPlayer "${e}" toSegment: ${t&&ir(t)}`);const s=this.playerQueue[r];this.transferMediaFromPlayer(s,t),this.playerQueue.splice(r,1),s.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,r,s,i){const{interstitial:o,assetItem:a,assetId:l}=e,u=o.assetList.length,c=this.playingAsset;this.endedAsset=null,this.playingAsset=a,(!c||c.identifier!==l)&&(c&&(this.clearAssetPlayer(c.identifier,r[s]),delete c.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${u} ${e}`),this.hls.trigger(x.INTERSTITIAL_ASSET_STARTED,{asset:a,assetListIndex:t,event:o,schedule:r.slice(0),scheduleIndex:s,player:e})),this.bufferAssetPlayer(e,i)}bufferAssetPlayer(e,t){var r,s;const{interstitial:i,assetItem:o,assetId:a}=e,l=this.schedule.findEventIndex(i.identifier),u=(r=this.schedule.items)==null?void 0:r[l];if(!u)return;this.setBufferingItem(u),this.bufferingAsset=o;const c=this.getBufferingPlayer();if(c===e)return;const d=i.appendInPlace;if(d&&(c==null?void 0:c.interstitial.appendInPlace)===!1)return;const f=(c==null?void 0:c.tracks)||((s=this.detachedData)==null?void 0:s.tracks)||this.requiredTracks;if(d&&o!==this.playingAsset){if(!e.tracks)return;if(f&&!tv(f,e.tracks)){const h=new Error(`Asset "${a}" SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(f)}')`),m={fatal:!0,type:te.OTHER_ERROR,details:b.INTERSTITIAL_ASSET_ITEM_ERROR,error:h},g=i.findAssetIndex(o);this.handleAssetItemError(m,i,l,g,h.message);return}}this.transferMediaTo(e,t)}handleAssetItemError(e,t,r,s,i){if(e.details===b.BUFFER_STALLED_ERROR)return;const o=t.assetList[s]||null;let a=null;if(o){const d=this.getAssetPlayerQueueIndex(o.identifier);a=this.playerQueue[d]||null}const l=this.schedule.items,u=Le({},e,{fatal:!1,errorAction:ro(!0),asset:o,assetListIndex:s,event:t,schedule:l,scheduleIndex:r,player:a});if(this.warn(`Asset item error: ${e.error}`),this.hls.trigger(x.INTERSTITIAL_ASSET_ERROR,u),!e.fatal)return;const c=new Error(i);o&&(this.playingAsset!==o&&this.clearAssetPlayer(o.identifier,null),o.error=c),t.assetList.some(d=>!d.error)?t.appendInPlace&&(t.error=c):t.error=c,this.primaryFallback(t)}primaryFallback(e){const t=e.timelineStart,r=this.effectivePlayingItem;if(this.updateSchedule(),r){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${this.timelinePos} playing: ${r?ir(r):"<none>"} error: ${e.error}`),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t));let s=this.timelinePos;s===-1&&(s=this.hls.startPosition);const i=this.updateItem(r,s);if(this.itemsMatch(r,i))this.clearInterstitial(e,null);else{const o=this.schedule.findItemIndexAtTime(s);this.setSchedulePosition(o)}}else this.checkStart()}onAssetListLoaded(e,t){var r;const s=t.event,i=s.identifier,o=t.assetListResponse.ASSETS;if(!this.schedule.hasEvent(i))return;const a=s.timelineStart,l=s.duration;let u=0;o.forEach((m,g)=>{const p=parseFloat(m.DURATION);this.createAsset(s,g,u,a+u,p,m.URI),u+=p}),s.duration=u,this.log(`Loaded asset-list with duration: ${u} (was: ${l}) ${s}`);const c=this.waitingItem,d=(c==null?void 0:c.event.identifier)===i;this.updateSchedule();const f=(r=this.bufferingItem)==null?void 0:r.event;if(d){var h;const m=this.schedule.findEventIndex(i),g=(h=this.schedule.items)==null?void 0:h[m];if(g){if(!this.playingItem&&this.timelinePos>g.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==m){s.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${s}`),this.primaryFallback(s);return}this.setBufferingItem(g)}this.setSchedulePosition(m)}else if((f==null?void 0:f.identifier)===i&&f.appendInPlace){const m=s.assetList[0],g=this.getAssetPlayer(m.identifier),p=this.primaryMedia;m&&g&&p&&this.bufferAssetPlayer(g,p)}}onError(e,t){switch(t.details){case b.ASSET_LIST_PARSING_ERROR:case b.ASSET_LIST_LOAD_ERROR:case b.ASSET_LIST_LOAD_TIMEOUT:{const r=t.interstitial;r&&this.primaryFallback(r);break}case b.BUFFER_STALLED_ERROR:{this.onTimeupdate(),this.checkBuffer(!0);break}}}}const Og=500;class tw extends Cf{constructor(e,t,r){super(e,t,r,"subtitle-stream-controller",Z.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(x.LEVEL_LOADED,this.onLevelLoaded,this),e.on(x.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(x.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(x.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(x.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(x.LEVEL_LOADED,this.onLevelLoaded,this),e.off(x.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(x.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(x.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(x.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=U.IDLE,this.setInterval(Og),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:r,success:s}=t;if(Ze(r)&&(this.fragPrevious=r),this.state=U.IDLE,!s)return;const i=this.tracksBuffered[this.currentTrackId];if(!i)return;let o;const a=r.start;for(let u=0;u<i.length;u++)if(a>=i[u].start&&a<=i[u].end){o=i[u];break}const l=r.start+r.duration;o?o.end=l:(o={start:a,end:l},i.push(o)),this.fragmentTracker.fragBuffered(r),this.fragBufferedComplete(r,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:r,endOffset:s}=t;if(r===0&&s!==Number.POSITIVE_INFINITY){const i=s-1;if(i<=0)return;t.endOffsetSubtitles=Math.max(0,i),this.tracksBuffered.forEach(o=>{for(let a=0;a<o.length;){if(o[a].end<=i){o.shift();continue}else if(o[a].start<i)o[a].start=i;else break;a++}}),this.fragmentTracker.removeFragmentsInRange(r,i,Z.SUBTITLE)}}onError(e,t){const r=t.frag;(r==null?void 0:r.type)===Z.SUBTITLE&&(t.details===b.FRAG_GAP&&this.fragmentTracker.fragBuffered(r,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==U.STOPPED&&(this.state=U.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&eE(this.levels,t)){this.levels=t.map(r=>new no(r));return}this.tracksBuffered=[],this.levels=t.map(r=>{const s=new no(r);return this.tracksBuffered[s.id]=[],s}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Z.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var r;if(this.currentTrackId=t.id,!((r=this.levels)!=null&&r.length)||this.currentTrackId===-1){this.clearInterval();return}const s=this.levels[this.currentTrackId];s!=null&&s.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,s&&this.state!==U.STOPPED&&this.setInterval(Og)}onSubtitleTrackLoaded(e,t){var r;const{currentTrackId:s,levels:i}=this,{details:o,id:a}=t;if(!i){this.warn(`Subtitle tracks were reset while loading level ${a}`);return}const l=i[a];if(a>=i.length||!l)return;this.log(`Subtitle track ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let u=0;if(o.live||(r=l.details)!=null&&r.live){const d=this.mainDetails;if(o.deltaUpdateFailed||!d)return;const f=d.fragments[0];if(!l.details)o.hasProgramDateTime&&d.hasProgramDateTime?(dl(o,d),u=o.fragmentStart):f&&(u=f.start,id(o,u));else{var c;u=this.alignPlaylists(o,l.details,(c=this.levelLastLoaded)==null?void 0:c.details),u===0&&f&&(u=f.start,id(o,u))}}l.details=o,this.levelLastLoaded=l,a===s&&(this.hls.trigger(x.SUBTITLE_TRACK_UPDATED,{details:o,id:a,groupId:t.groupId}),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===U.IDLE&&(es(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:r}=e,s=t.decryptdata,i=this.hls;if(!this.fragContextChanged(t)&&r&&r.byteLength>0&&s!=null&&s.key&&s.iv&&bs(s.method)){const o=performance.now();this.decrypter.decrypt(new Uint8Array(r),s.key.buffer,s.iv.buffer,wf(s.method)).catch(a=>{throw i.trigger(x.ERROR,{type:te.MEDIA_ERROR,details:b.FRAG_DECRYPT_ERROR,fatal:!1,error:a,reason:a.message,frag:t}),a}).then(a=>{const l=performance.now();i.trigger(x.FRAG_DECRYPTED,{frag:t,payload:a,stats:{tstart:o,tdecrypt:l}})}).catch(a=>{this.warn(`${a.name}: ${a.message}`),this.state=U.IDLE})}}doTick(){if(!this.media){this.state=U.IDLE;return}if(this.state===U.IDLE){const{currentTrackId:e,levels:t}=this,r=t==null?void 0:t[e];if(!r||!t.length||!r.details||this.waitForLive(r))return;const{config:s}=this,i=this.getLoadPosition(),o=fe.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],i,s.maxBufferHole),{end:a,len:l}=o,u=r.details,c=this.hls.maxBufferLength+u.levelTargetDuration;if(l>c)return;const d=u.fragments,f=d.length,h=u.edge;let m=null;const g=this.fragPrevious;if(a<h){const v=s.maxFragLookUpTolerance,E=a>h-v?0:v;m=es(g,d,Math.max(d[0].start,a),E),!m&&g&&g.start<d[0].start&&(m=d[0])}else m=d[f-1];if(m=this.filterReplacedPrimary(m,r.details),!m)return;const p=m.sn-u.startSN,y=d[p-1];if(y&&y.cc===m.cc&&this.fragmentTracker.getState(y)===We.NOT_LOADED&&(m=y),this.fragmentTracker.getState(m)===We.NOT_LOADED){const v=this.mapToInitFragWhenRequired(m);v&&this.loadFragment(v,r,a)}}}loadFragment(e,t,r){Ze(e)?super.loadFragment(e,t,r):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new nw(this.tracksBuffered[this.currentTrackId]||[])}}class nw{constructor(e){this.buffered=void 0;const t=(r,s,i)=>{if(s=s>>>0,s>i-1)throw new DOMException(`Failed to execute '${r}' on 'TimeRanges': The index provided (${s}) is greater than the maximum bound (${i})`);return e[s][r]};this.buffered={get length(){return e.length},end(r){return t("end",r,e.length)},start(r){return t("start",r,e.length)}}}}const rw={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},cE=n=>String.fromCharCode(rw[n]||n),nn=15,Un=100,sw={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},iw={17:2,18:4,21:6,22:8,23:10,19:13,20:15},ow={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},aw={25:2,26:4,29:6,30:8,31:10,27:13,28:15},lw=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class uw{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const r=typeof t=="function"?t():t;pe.log(`${this.time} [${e}] ${r}`)}}}const Pr=function(e){const t=[];for(let r=0;r<e.length;r++)t.push(e[r].toString(16));return t};class dE{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let r=0;r<t.length;r++){const s=t[r];e.hasOwnProperty(s)&&(this[s]=e[s])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class cw{constructor(){this.uchar=" ",this.penState=new dE}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class dw{constructor(e){this.chars=[],this.pos=0,this.currPenState=new dE,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Un;t++)this.chars.push(new cw);this.logger=e}equals(e){for(let t=0;t<Un;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Un;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Un;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Un&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Un)}moveCursor(e){const t=this.pos+e;if(e>1)for(let r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=cE(e);if(this.pos>=Un){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<Un;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let r=0;r<Un;r++){const s=this.chars[r].uchar;s!==" "&&(t=!1),e.push(s)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Bu{constructor(e){this.rows=[],this.currRow=nn-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<nn;t++)this.rows.push(new dw(e));this.logger=e}reset(){for(let e=0;e<nn;e++)this.rows[e].clear();this.currRow=nn-1}equals(e){let t=!0;for(let r=0;r<nn;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t}copy(e){for(let t=0;t<nn;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<nn;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+be(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let a=0;a<nn;a++)this.rows[a].clear();const i=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){const a=o.rows[i].cueStartTime,l=this.logger.time;if(a!==null&&l!==null&&a<l)for(let u=0;u<this.nrRollUpRows;u++)this.rows[t-this.nrRollUpRows+u+1].copy(o.rows[i+u])}}this.currRow=t;const r=this.rows[this.currRow];if(e.indent!==null){const i=e.indent,o=Math.max(i-1,0);r.setCursor(e.indent),e.color=r.chars[o].penState.foreground}const s={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(s)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+be(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let r="",s=-1;for(let i=0;i<nn;i++){const o=this.rows[i].getTextString();o&&(s=i+1,e?t.push("Row "+s+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(e?r="["+t.join(" | ")+"]":r=t.join(`
`)),r}getTextAndFormat(){return this.rows}}class Ng{constructor(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Bu(r),this.nonDisplayedMemory=new Bu(r),this.lastOutputScreen=new Bu(r),this.currRollUpRow=this.displayedMemory.rows[nn-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[nn-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let r=0;r<e.length;r++)this.writeScreen.insertChar(e[r]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const r=Math.floor(e/2)-16,s=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=s[r]}this.logger.log(2,"MIDROW: "+be(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Mg{constructor(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=hw(),this.logger=void 0;const s=this.logger=new uw;this.channels=[null,new Ng(e,t,s),new Ng(e+1,r,s)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let r=0;r<t.length;r+=2){const s=t[r]&127,i=t[r+1]&127;let o=!1,a=null;if(s===0&&i===0)continue;this.logger.log(3,()=>"["+Pr([t[r],t[r+1]])+"] -> ("+Pr([s,i])+")");const l=this.cmdHistory;if(s>=16&&s<=31){if(fw(s,i,l)){Qo(null,null,l),this.logger.log(3,()=>"Repeated command ("+Pr([s,i])+") is dropped");continue}Qo(s,i,this.cmdHistory),o=this.parseCmd(s,i),o||(o=this.parseMidrow(s,i)),o||(o=this.parsePAC(s,i)),o||(o=this.parseBackgroundAttributes(s,i))}else Qo(null,null,l);if(!o&&(a=this.parseChars(s,i),a)){const c=this.currentChannel;c&&c>0?this.channels[c].insertChars(a):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!o&&!a&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Pr([s,i])+" orig: "+Pr([t[r],t[r+1]]))}}parseCmd(e,t){const r=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=33&&t<=35;if(!(r||s))return!1;const i=e===20||e===21||e===23?1:2,o=this.channels[i];return e===20||e===21||e===28||e===29?t===32?o.ccRCL():t===33?o.ccBS():t===34?o.ccAOF():t===35?o.ccAON():t===36?o.ccDER():t===37?o.ccRU(2):t===38?o.ccRU(3):t===39?o.ccRU(4):t===40?o.ccFON():t===41?o.ccRDC():t===42?o.ccTR():t===43?o.ccRTD():t===44?o.ccEDM():t===45?o.ccCR():t===46?o.ccENM():t===47&&o.ccEOC():o.ccTO(t-32),this.currentChannel=i,!0}parseMidrow(e,t){let r=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?r=1:r=2,r!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const s=this.channels[r];return s?(s.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Pr([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let r;const s=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,i=(e===16||e===24)&&t>=64&&t<=95;if(!(s||i))return!1;const o=e<=23?1:2;t>=64&&t<=95?r=o===1?sw[e]:ow[e]:r=o===1?iw[e]:aw[e];const a=this.channels[o];return a?(a.setPAC(this.interpretPAC(r,t)),this.currentChannel=o,!0):!1}interpretPAC(e,t){let r;const s={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?r=t-96:r=t-64,s.underline=(r&1)===1,r<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(s.italics=!0,s.color="white"):s.indent=Math.floor((r-16)/2)*4,s}parseChars(e,t){let r,s=null,i=null;if(e>=25?(r=2,i=e-8):(r=1,i=e),i>=17&&i<=19){let o;i===17?o=t+80:i===18?o=t+112:o=t+144,this.logger.log(2,()=>"Special char '"+cE(o)+"' in channel "+r),s=[o]}else e>=32&&e<=127&&(s=t===0?[e]:[e,t]);return s&&this.logger.log(3,()=>"Char codes =  "+Pr(s).join(",")),s}parseBackgroundAttributes(e,t){const r=(e===16||e===24)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=45&&t<=47;if(!(r||s))return!1;let i;const o={};e===16||e===24?(i=Math.floor((t-32)/2),o.background=lw[i],t%2===1&&(o.background=o.background+"_semi")):t===45?o.background="transparent":(o.foreground="black",t===47&&(o.underline=!0));const a=e<=23?1:2;return this.channels[a].setBkgData(o),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Qo(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const r=this.channels[t];r&&r.cueSplitAtTime(e)}}}function Qo(n,e,t){t.a=n,t.b=e}function fw(n,e,t){return t.a===n&&t.b===e}function hw(){return{a:null,b:null}}var jf=function(){if(cl!=null&&cl.VTTCue)return self.VTTCue;const n=["","lr","rl"],e=["start","middle","end","left","right"];function t(a,l){if(typeof l!="string"||!Array.isArray(a))return!1;const u=l.toLowerCase();return~a.indexOf(u)?u:!1}function r(a){return t(n,a)}function s(a){return t(e,a)}function i(a,...l){let u=1;for(;u<arguments.length;u++){const c=arguments[u];for(const d in c)a[d]=c[d]}return a}function o(a,l,u){const c=this,d={enumerable:!0};c.hasBeenReset=!1;let f="",h=!1,m=a,g=l,p=u,y=null,v="",E=!0,T="auto",A="start",R=50,L="middle",I=50,C="middle";Object.defineProperty(c,"id",i({},d,{get:function(){return f},set:function(_){f=""+_}})),Object.defineProperty(c,"pauseOnExit",i({},d,{get:function(){return h},set:function(_){h=!!_}})),Object.defineProperty(c,"startTime",i({},d,{get:function(){return m},set:function(_){if(typeof _!="number")throw new TypeError("Start time must be set to a number.");m=_,this.hasBeenReset=!0}})),Object.defineProperty(c,"endTime",i({},d,{get:function(){return g},set:function(_){if(typeof _!="number")throw new TypeError("End time must be set to a number.");g=_,this.hasBeenReset=!0}})),Object.defineProperty(c,"text",i({},d,{get:function(){return p},set:function(_){p=""+_,this.hasBeenReset=!0}})),Object.defineProperty(c,"region",i({},d,{get:function(){return y},set:function(_){y=_,this.hasBeenReset=!0}})),Object.defineProperty(c,"vertical",i({},d,{get:function(){return v},set:function(_){const F=r(_);if(F===!1)throw new SyntaxError("An invalid or illegal string was specified.");v=F,this.hasBeenReset=!0}})),Object.defineProperty(c,"snapToLines",i({},d,{get:function(){return E},set:function(_){E=!!_,this.hasBeenReset=!0}})),Object.defineProperty(c,"line",i({},d,{get:function(){return T},set:function(_){if(typeof _!="number"&&_!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");T=_,this.hasBeenReset=!0}})),Object.defineProperty(c,"lineAlign",i({},d,{get:function(){return A},set:function(_){const F=s(_);if(!F)throw new SyntaxError("An invalid or illegal string was specified.");A=F,this.hasBeenReset=!0}})),Object.defineProperty(c,"position",i({},d,{get:function(){return R},set:function(_){if(_<0||_>100)throw new Error("Position must be between 0 and 100.");R=_,this.hasBeenReset=!0}})),Object.defineProperty(c,"positionAlign",i({},d,{get:function(){return L},set:function(_){const F=s(_);if(!F)throw new SyntaxError("An invalid or illegal string was specified.");L=F,this.hasBeenReset=!0}})),Object.defineProperty(c,"size",i({},d,{get:function(){return I},set:function(_){if(_<0||_>100)throw new Error("Size must be between 0 and 100.");I=_,this.hasBeenReset=!0}})),Object.defineProperty(c,"align",i({},d,{get:function(){return C},set:function(_){const F=s(_);if(!F)throw new SyntaxError("An invalid or illegal string was specified.");C=F,this.hasBeenReset=!0}})),c.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o}();class mw{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function fE(n){function e(r,s,i,o){return(r|0)*3600+(s|0)*60+(i|0)+parseFloat(o||0)}const t=n.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class gw{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,r){for(let s=0;s<r.length;++s)if(t===r[s]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1}}function hE(n,e,t,r){const s=r?n.split(r):[n];for(const i in s){if(typeof s[i]!="string")continue;const o=s[i].split(t);if(o.length!==2)continue;const a=o[0],l=o[1];e(a,l)}}const hd=new jf(0,0,""),Jo=hd.align==="middle"?"middle":"center";function pw(n,e,t){const r=n;function s(){const a=fE(n);if(a===null)throw new Error("Malformed timestamp: "+r);return n=n.replace(/^[^\sa-zA-Z-]+/,""),a}function i(a,l){const u=new gw;hE(a,function(f,h){let m;switch(f){case"region":for(let g=t.length-1;g>=0;g--)if(t[g].id===h){u.set(f,t[g].region);break}break;case"vertical":u.alt(f,h,["rl","lr"]);break;case"line":m=h.split(","),u.integer(f,m[0]),u.percent(f,m[0])&&u.set("snapToLines",!1),u.alt(f,m[0],["auto"]),m.length===2&&u.alt("lineAlign",m[1],["start",Jo,"end"]);break;case"position":m=h.split(","),u.percent(f,m[0]),m.length===2&&u.alt("positionAlign",m[1],["start",Jo,"end","line-left","line-right","auto"]);break;case"size":u.percent(f,h);break;case"align":u.alt(f,h,["start",Jo,"end","left","right"]);break}},/:/,/\s/),l.region=u.get("region",null),l.vertical=u.get("vertical","");let c=u.get("line","auto");c==="auto"&&hd.line===-1&&(c=-1),l.line=c,l.lineAlign=u.get("lineAlign","start"),l.snapToLines=u.get("snapToLines",!0),l.size=u.get("size",100),l.align=u.get("align",Jo);let d=u.get("position","auto");d==="auto"&&hd.position===50&&(d=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=d}function o(){n=n.replace(/^\s+/,"")}if(o(),e.startTime=s(),o(),n.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+r);n=n.slice(3),o(),e.endTime=s(),o(),i(n,e)}function mE(n){return n.replace(/<br(?: \/)?>/gi,`
`)}class yw{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new mw,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function r(){let i=t.buffer,o=0;for(i=mE(i);o<i.length&&i[o]!=="\r"&&i[o]!==`
`;)++o;const a=i.slice(0,o);return i[o]==="\r"&&++o,i[o]===`
`&&++o,t.buffer=i.slice(o),a}function s(i){hE(i,function(o,a){},/:/)}try{let i="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;i=r();const a=i.match(/^()?WEBVTT([ \t].*)?$/);if(!(a!=null&&a[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let o=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:i=r(),t.state){case"HEADER":/:/.test(i)?s(i):i||(t.state="ID");continue;case"NOTE":i||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){t.state="NOTE";break}if(!i)continue;if(t.cue=new jf(0,0,""),t.state="CUE",i.indexOf("-->")===-1){t.cue.id=i;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{pw(i,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const a=i.indexOf("-->")!==-1;if(!i||a&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=i}continue;case"BADCUE":i||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const vw=/\r\n|\n\r|\n|\r/g,$u=function(e,t,r=0){return e.slice(r,r+t.length)===t},Ew=function(e){let t=parseInt(e.slice(-3));const r=parseInt(e.slice(-6,-4)),s=parseInt(e.slice(-9,-7)),i=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!K(t)||!K(r)||!K(s)||!K(i))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*r,t+=60*1e3*s,t+=60*60*1e3*i,t};function Gf(n,e,t){return Pi(n.toString())+Pi(e.toString())+Pi(t)}const xw=function(e,t,r){let s=e[t],i=e[s.prevCC];if(!i||!i.new&&s.new){e.ccOffset=e.presentationOffset=s.start,s.new=!1;return}for(;(o=i)!=null&&o.new;){var o;e.ccOffset+=s.start-i.start,s.new=!1,s=i,i=e[s.prevCC]}e.presentationOffset=r};function Sw(n,e,t,r,s,i,o){const a=new yw,l=Bt(new Uint8Array(n)).trim().replace(vw,`
`).split(`
`),u=[],c=e?BR(e.baseTime,e.timescale):0;let d="00:00.000",f=0,h=0,m,g=!0;a.oncue=function(p){const y=t[r];let v=t.ccOffset;const E=(f-c)/9e4;if(y!=null&&y.new&&(h!==void 0?v=t.ccOffset=y.start:xw(t,r,E)),E){if(!e){m=new Error("Missing initPTS for VTT MPEGTS");return}v=E-t.presentationOffset}const T=p.endTime-p.startTime,A=zt((p.startTime+v-h)*9e4,s*9e4)/9e4;p.startTime=Math.max(A,0),p.endTime=Math.max(A+T,0);const R=p.text.trim();p.text=decodeURIComponent(encodeURIComponent(R)),p.id||(p.id=Gf(p.startTime,p.endTime,R)),p.endTime>0&&u.push(p)},a.onparsingerror=function(p){m=p},a.onflush=function(){if(m){o(m);return}i(u)},l.forEach(p=>{if(g)if($u(p,"X-TIMESTAMP-MAP=")){g=!1,p.slice(16).split(",").forEach(y=>{$u(y,"LOCAL:")?d=y.slice(6):$u(y,"MPEGTS:")&&(f=parseInt(y.slice(7)))});try{h=Ew(d)/1e3}catch(y){m=y}return}else p===""&&(g=!1);a.parse(p+`
`)}),a.flush()}const ju="stpp.ttml.im1t",gE=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,pE=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,Tw={left:"start",center:"center",right:"end",start:"start",end:"end"};function Fg(n,e,t,r){const s=le(new Uint8Array(n),["mdat"]);if(s.length===0){r(new Error("Could not parse IMSC1 mdat"));return}const i=s.map(a=>Bt(a)),o=UR(e.baseTime,1,e.timescale);try{i.forEach(a=>t(Aw(a,o)))}catch(a){r(a)}}function Aw(n,e){const s=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("tt")[0];if(!s)throw new Error("Invalid ttml");const i={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(i).reduce((d,f)=>(d[f]=s.getAttribute(`ttp:${f}`)||i[f],d),{}),a=s.getAttribute("xml:space")!=="preserve",l=Ug(Gu(s,"styling","style")),u=Ug(Gu(s,"layout","region")),c=Gu(s,"body","[begin]");return[].map.call(c,d=>{const f=yE(d,a);if(!f||!d.hasAttribute("begin"))return null;const h=Hu(d.getAttribute("begin"),o),m=Hu(d.getAttribute("dur"),o);let g=Hu(d.getAttribute("end"),o);if(h===null)throw Bg(d);if(g===null){if(m===null)throw Bg(d);g=h+m}const p=new jf(h-e,g-e,f);p.id=Gf(p.startTime,p.endTime,p.text);const y=u[d.getAttribute("region")],v=l[d.getAttribute("style")],E=Lw(y,v,l),{textAlign:T}=E;if(T){const A=Tw[T];A&&(p.lineAlign=A),p.align=T}return Le(p,E),p}).filter(d=>d!==null)}function Gu(n,e,t){const r=n.getElementsByTagName(e)[0];return r?[].slice.call(r.querySelectorAll(t)):[]}function Ug(n){return n.reduce((e,t)=>{const r=t.getAttribute("xml:id");return r&&(e[r]=t),e},{})}function yE(n,e){return[].slice.call(n.childNodes).reduce((t,r,s)=>{var i;return r.nodeName==="br"&&s?t+`
`:(i=r.childNodes)!=null&&i.length?yE(r,e):e?t+r.textContent.trim().replace(/\s+/g," "):t+r.textContent},"")}function Lw(n,e,t){const r="http://www.w3.org/ns/ttml#styling";let s=null;const i=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],o=n!=null&&n.hasAttribute("style")?n.getAttribute("style"):null;return o&&t.hasOwnProperty(o)&&(s=t[o]),i.reduce((a,l)=>{const u=Vu(e,r,l)||Vu(n,r,l)||Vu(s,r,l);return u&&(a[l]=u),a},{})}function Vu(n,e,t){return n&&n.hasAttributeNS(e,t)?n.getAttributeNS(e,t):null}function Bg(n){return new Error(`Could not parse ttml timestamp ${n}`)}function Hu(n,e){if(!n)return null;let t=fE(n);return t===null&&(gE.test(n)?t=Iw(n,e):pE.test(n)&&(t=Rw(n,e))),t}function Iw(n,e){const t=gE.exec(n),r=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+r/e.frameRate}function Rw(n,e){const t=pE.exec(n),r=Number(t[1]);switch(t[2]){case"h":return r*3600;case"m":return r*60;case"ms":return r*1e3;case"f":return r/e.frameRate;case"t":return r/e.tickRate}return r}class Zo{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,r){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class _w{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=jg(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(x.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(x.FRAG_LOADING,this.onFragLoading,this),e.on(x.FRAG_LOADED,this.onFragLoaded,this),e.on(x.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(x.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(x.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(x.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(x.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(x.FRAG_LOADING,this.onFragLoading,this),e.off(x.FRAG_LOADED,this.onFragLoaded,this),e.off(x.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(x.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(x.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(x.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Zo(this,"textTrack1"),t=new Zo(this,"textTrack2"),r=new Zo(this,"textTrack3"),s=new Zo(this,"textTrack4");this.cea608Parser1=new Mg(1,e,t),this.cea608Parser2=new Mg(3,r,s)}addCues(e,t,r,s,i){let o=!1;for(let a=i.length;a--;){const l=i[a],u=ww(l[0],l[1],t,r);if(u>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],r),o=!0,u/(r-t)>.5))return}if(o||i.push([t,r]),this.config.renderTextTracksNatively){const a=this.captionsTracks[e];this.Cues.newCue(a,t,r,s)}else{const a=this.Cues.newCue(null,t,r,s);this.hls.trigger(x.CUES_PARSED,{type:"captions",cues:a,track:e})}}onInitPtsFound(e,{frag:t,id:r,initPTS:s,timescale:i}){const{unparsedVttFrags:o}=this;r===Z.MAIN&&(this.initPTS[t.cc]={baseTime:s,timescale:i}),o.length&&(this.unparsedVttFrags=[],o.forEach(a=>{this.onFragLoaded(x.FRAG_LOADED,a)}))}getExistingTrack(e,t){const{media:r}=this;if(r)for(let s=0;s<r.textTracks.length;s++){const i=r.textTracks[s];if($g(i,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return i}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:r,media:s}=this,{label:i,languageCode:o}=t[e],a=this.getExistingTrack(i,o);if(a)r[e]=a,Ls(r[e]),aE(r[e],s);else{const l=this.createTextTrack("captions",i,o);l&&(l[e]=!0,r[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const r=t.label,s={_id:e,label:r,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=s,this.hls.trigger(x.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}createTextTrack(e,t,r){const s=this.media;if(s)return s.addTextTrack(e,t,r)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const r=!!t.transferMedia;if(this.media=null,r)return;const{captionsTracks:s}=this;Object.keys(s).forEach(i=>{Ls(s[i]),delete s[i]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=jg(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let r=0;r<t.length;r++)Ls(t[r])}onSubtitleTracksUpdated(e,t){const r=t.subtitleTracks||[],s=r.some(i=>i.textCodec===ju);if(this.config.enableWebVTT||s&&this.config.enableIMSC1){if(eE(this.tracks,r)){this.tracks=r;return}if(this.textTracks=[],this.tracks=r,this.config.renderTextTracksNatively){const o=this.media,a=o?Ia(o.textTracks):null;if(this.tracks.forEach((l,u)=>{let c;if(a){let d=null;for(let f=0;f<a.length;f++)if(a[f]&&$g(a[f],l)){d=a[f],a[f]=null;break}d&&(c=d)}if(c)Ls(c);else{const d=vE(l);c=this.createTextTrack(d,l.name,l.lang),c&&(c.mode="disabled")}c&&this.textTracks.push(c)}),a!=null&&a.length){const l=a.filter(u=>u!==null).map(u=>u.label);l.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${l.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const o=this.tracks.map(a=>({label:a.name,kind:a.type.toLowerCase(),default:a.default,subtitleTrack:a}));this.hls.trigger(x.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(r=>{const s=/(?:CC|SERVICE)([1-4])/.exec(r.instreamId);if(!s)return;const i=`textTrack${s[1]}`,o=this.captionsProperties[i];o&&(o.label=r.name,r.lang&&(o.languageCode=r.lang),o.media=r)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===Z.MAIN){var r,s;const{cea608Parser1:i,cea608Parser2:o,lastSn:a}=this,{cc:l,sn:u}=t.frag,c=(r=(s=t.part)==null?void 0:s.index)!=null?r:-1;i&&o&&(u!==a+1||u===a&&c!==this.lastPartIndex+1||l!==this.lastCc)&&(i.reset(),o.reset()),this.lastCc=l,this.lastSn=u,this.lastPartIndex=c}}onFragLoaded(e,t){const{frag:r,payload:s}=t;if(r.type===Z.SUBTITLE)if(s.byteLength){const i=r.decryptdata,o="stats"in t;if(i==null||!i.encrypted||o){const a=this.tracks[r.level],l=this.vttCCs;l[r.cc]||(l[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),a&&a.textCodec===ju?this._parseIMSC1(r,s):this._parseVTTs(t)}}else this.hls.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const r=this.hls;Fg(t,this.initPTS[e.cc],s=>{this._appendCues(s,e.level),r.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},s=>{r.logger.log(`Failed to parse IMSC1: ${s}`),r.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:s})})}_parseVTTs(e){var t;const{frag:r,payload:s}=e,{initPTS:i,unparsedVttFrags:o}=this,a=i.length-1;if(!i[r.cc]&&a===-1){o.push(e);return}const l=this.hls,u=(t=r.initSegment)!=null&&t.data?Zt(r.initSegment.data,new Uint8Array(s)).buffer:s;Sw(u,this.initPTS[r.cc],this.vttCCs,r.cc,r.start,c=>{this._appendCues(c,r.level),l.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},c=>{const d=c.message==="Missing initPTS for VTT MPEGTS";d?o.push(e):this._fallbackToIMSC1(r,s),l.logger.log(`Failed to parse VTT cue: ${c}`),!(d&&a>r.cc)&&l.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:c})})}_fallbackToIMSC1(e,t){const r=this.tracks[e.level];r.textCodec||Fg(t,this.initPTS[e.cc],()=>{r.textCodec=ju,this._parseIMSC1(e,t)},()=>{r.textCodec="wvtt"})}_appendCues(e,t){const r=this.hls;if(this.config.renderTextTracksNatively){const s=this.textTracks[t];if(!s||s.mode==="disabled")return;e.forEach(i=>lE(s,i))}else{const s=this.tracks[t];if(!s)return;const i=s.default?"default":"subtitles"+t;r.trigger(x.CUES_PARSED,{type:"subtitles",cues:e,track:i})}}onFragDecrypted(e,t){const{frag:r}=t;r.type===Z.SUBTITLE&&this.onFragLoaded(x.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:r,samples:s}=t;if(!(r.type===Z.MAIN&&this.closedCaptionsForLevel(r)==="NONE"))for(let i=0;i<s.length;i++){const o=s[i].bytes;if(o){this.cea608Parser1||this.initCea608Parsers();const a=this.extractCea608Data(o);this.cea608Parser1.addData(s[i].pts,a[0]),this.cea608Parser2.addData(s[i].pts,a[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:r,endOffsetSubtitles:s,type:i}){const{media:o}=this;if(!(!o||o.currentTime<r)){if(!i||i==="video"){const{captionsTracks:a}=this;Object.keys(a).forEach(l=>dd(a[l],t,r))}if(this.config.renderTextTracksNatively&&t===0&&s!==void 0){const{textTracks:a}=this;Object.keys(a).forEach(l=>dd(a[l],t,s))}}}extractCea608Data(e){const t=[[],[]],r=e[0]&31;let s=2;for(let i=0;i<r;i++){const o=e[s++],a=127&e[s++],l=127&e[s++];if(a===0&&l===0)continue;if((4&o)!==0){const c=3&o;(c===0||c===1)&&(t[c].push(a),t[c].push(l))}}return t}}function vE(n){return n.characteristics&&/transcribes-spoken-dialog/gi.test(n.characteristics)&&/describes-music-and-sound/gi.test(n.characteristics)?"captions":"subtitles"}function $g(n,e){return!!n&&n.kind===vE(e)&&ld(e,n)}function ww(n,e,t,r){return Math.min(e,r)-Math.max(n,t)}function jg(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const kw=/\s/,Cw={newCue(n,e,t,r){const s=[];let i,o,a,l,u;const c=self.VTTCue||self.TextTrackCue;for(let f=0;f<r.rows.length;f++)if(i=r.rows[f],a=!0,l=0,u="",!i.isEmpty()){var d;for(let g=0;g<i.chars.length;g++)kw.test(i.chars[g].uchar)&&a?l++:(u+=i.chars[g].uchar,a=!1);i.cueStartTime=e,e===t&&(t+=1e-4),l>=16?l--:l++;const h=mE(u.trim()),m=Gf(e,t,h);n!=null&&(d=n.cues)!=null&&d.getCueById(m)||(o=new c(e,t,h),o.id=m,o.line=f+1,o.align="left",o.position=10+Math.min(80,Math.floor(l*8/32)*10),s.push(o))}return n&&s.length&&(s.sort((f,h)=>f.line==="auto"||h.line==="auto"?0:f.line>8&&h.line>8?h.line-f.line:f.line-h.line),s.forEach(f=>lE(n,f))),s}};function bw(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const Dw=/(\d+)-(\d+)\/(\d+)/;class Gg{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||Mw,this.controller=new self.AbortController,this.stats=new Tf}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,r){const s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();const i=Pw(e,this.controller.signal),o=e.responseType==="arraybuffer",a=o?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:u}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,i),self.clearTimeout(this.requestTimeout),t.timeout=l&&K(l)?l:u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},t.timeout),(ao(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(d=>{var f;this.response=this.loader=d;const h=Math.max(self.performance.now(),s.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},u-(h-s.loading.start)),!d.ok){const{status:g,statusText:p}=d;throw new Fw(p||"fetch, bad network response",g,d)}s.loading.first=h,s.total=Nw(d.headers)||s.total;const m=(f=this.callbacks)==null?void 0:f.onProgress;return m&&K(t.highWaterMark)?this.loadProgressively(d,s,e,t.highWaterMark,m):o?d.arrayBuffer():e.responseType==="json"?d.json():d.text()}).then(d=>{var f,h;const m=this.response;if(!m)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);const g=d[a];g&&(s.loaded=s.total=g);const p={url:m.url,data:d,code:m.status},y=(f=this.callbacks)==null?void 0:f.onProgress;y&&!K(t.highWaterMark)&&y(s,e,d,m),(h=this.callbacks)==null||h.onSuccess(p,s,e,m)}).catch(d=>{var f;if(self.clearTimeout(this.requestTimeout),s.aborted)return;const h=d&&d.code||0,m=d?d.message:null;(f=this.callbacks)==null||f.onError({code:h,text:m},e,d?d.details:null,s)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,r,s=0,i){const o=new Pv,a=e.body.getReader(),l=()=>a.read().then(u=>{if(u.done)return o.dataLength&&i(t,r,o.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const c=u.value,d=c.length;return t.loaded+=d,d<s||o.dataLength?(o.push(c),o.dataLength>=s&&i(t,r,o.flush().buffer,e)):i(t,r,c.buffer,e),l()}).catch(()=>Promise.reject());return l()}}function Pw(n,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Le({},n.headers))};return n.rangeEnd&&t.headers.set("Range","bytes="+n.rangeStart+"-"+String(n.rangeEnd-1)),t}function Ow(n){const e=Dw.exec(n);if(e)return parseInt(e[2])-parseInt(e[1])+1}function Nw(n){const e=n.get("Content-Range");if(e){const r=Ow(e);if(K(r))return r}const t=n.get("Content-Length");if(t)return parseInt(t)}function Mw(n,e){return new self.Request(n.url,e)}class Fw extends Error{constructor(e,t,r){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=r}}const Uw=/^age:\s*[\d.]+\s*$/im;class EE{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Tf,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const r=this.loader=new self.XMLHttpRequest,s=this.stats;s.loading.first=0,s.loaded=0,s.aborted=!1;const i=this.xhrSetup;i?Promise.resolve().then(()=>{if(!(this.loader!==r||this.stats.aborted))return i(r,t.url)}).catch(o=>{if(!(this.loader!==r||this.stats.aborted))return r.open("GET",t.url,!0),i(r,t.url)}).then(()=>{this.loader!==r||this.stats.aborted||this.openAndSendXhr(r,t,e)}).catch(o=>{var a;(a=this.callbacks)==null||a.onError({code:r.status,text:o.message},t,r,s)}):this.openAndSendXhr(r,t,e)}openAndSendXhr(e,t,r){e.readyState||e.open("GET",t.url,!0);const s=t.headers,{maxTimeToFirstByteMs:i,maxLoadTimeMs:o}=r.loadPolicy;if(s)for(const a in s)e.setRequestHeader(a,s[a]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=i&&K(i)?i:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:r}=this;if(!e||!t)return;const s=t.readyState,i=this.config;if(!r.aborted&&s>=2&&(r.loading.first===0&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),i.timeout!==i.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),i.timeout=i.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),s===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const u=t.status,c=t.responseType==="text"?t.responseText:null;if(u>=200&&u<300){const m=c??t.response;if(m!=null){var o,a;r.loading.end=Math.max(self.performance.now(),r.loading.first);const g=t.responseType==="arraybuffer"?m.byteLength:m.length;r.loaded=r.total=g,r.bwEstimate=r.total*8e3/(r.loading.end-r.loading.first);const p=(o=this.callbacks)==null?void 0:o.onProgress;p&&p(r,e,m,t);const y={url:t.responseURL,data:m,code:u};(a=this.callbacks)==null||a.onSuccess(y,r,e,t);return}}const d=i.loadPolicy.errorRetry,f=r.retry,h={url:e.url,data:void 0,code:u};if(ul(d,f,!1,h))this.retry(d);else{var l;pe.error(`${u} while loading ${e.url}`),(l=this.callbacks)==null||l.onError({code:u,text:t.statusText},e,t,r)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(ul(e,t,!0))this.retry(e);else{var r;pe.warn(`timeout while loading ${(r=this.context)==null?void 0:r.url}`);const s=this.callbacks;s&&(this.abortInternal(),s.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:r}=this;this.retryDelay=If(e,r.retry),r.retry++,pe.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${r.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&Uw.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const Bw={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},$w=Ee(Ee({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:EE,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:lI,bufferController:e_,capLevelController:Bf,errorController:mI,fpsController:H_,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:Tv,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,certLoadPolicy:{default:Bw},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},jw()),{},{subtitleStreamController:tw,subtitleTrackController:W_,timelineController:_w,audioStreamController:XR,audioTrackController:QR,emeController:Ds,cmcdController:j_,contentSteeringController:V_,interstitialsController:ew});function jw(){return{cueHandler:Cw,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function Gw(n,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const r=md(n),s=["manifest","level","frag"],i=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return s.forEach(o=>{const a=`${o==="level"?"playlist":o}LoadPolicy`,l=e[a]===void 0,u=[];i.forEach(c=>{const d=`${o}Loading${c}`,f=e[d];if(f!==void 0&&l){u.push(d);const h=r[a].default;switch(e[a]={default:h},c){case"TimeOut":h.maxLoadTimeMs=f,h.maxTimeToFirstByteMs=f;break;case"MaxRetry":h.errorRetry.maxNumRetry=f,h.timeoutRetry.maxNumRetry=f;break;case"RetryDelay":h.errorRetry.retryDelayMs=f,h.timeoutRetry.retryDelayMs=f;break;case"MaxRetryTimeout":h.errorRetry.maxRetryDelayMs=f,h.timeoutRetry.maxRetryDelayMs=f;break}}}),u.length&&t.warn(`hls.js config: "${u.join('", "')}" setting(s) are deprecated, use "${a}": ${be(e[a])}`)}),Ee(Ee({},r),e)}function md(n){return n&&typeof n=="object"?Array.isArray(n)?n.map(md):Object.keys(n).reduce((e,t)=>(e[t]=md(n[t]),e),{}):n}function Vw(n,e){const t=n.loader;t!==Gg&&t!==EE?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),n.progressive=!1):bw()&&(n.loader=Gg,n.progressive=!0,n.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const Ra=2,Hw=.1,Kw=.05,zw=100;class Ww extends Ev{constructor(e,t){super("gap-controller",e.logger),this.hls=null,this.fragmentTracker=null,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var r;(r=this.media)!=null&&r.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var r;this.ended=((r=this.media)==null?void 0:r.currentTime)||1,this.hls.trigger(x.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(zw),this.mediaSource=t.mediaSource;const r=this.media=t.media;Kn(r,"playing",this.onMediaPlaying),Kn(r,"waiting",this.onMediaWaiting),Kn(r,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:r}=this;r&&(kn(r,"playing",this.onMediaPlaying),kn(r,"waiting",this.onMediaWaiting),kn(r,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var r,s;const i=(r=this.hls)==null?void 0:r.config;if(!i)return;const{media:o,stalled:a}=this;if(!o)return;const{seeking:l}=o,u=this.seeking&&!l,c=!this.seeking&&l,d=o.paused&&!l||o.ended||o.playbackRate===0;if(this.seeking=l,e!==t){t&&(this.ended=0),this.moved=!0,l||(this.nudgeRetry=0,i.nudgeOnVideoHole&&!d&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(c||u){u&&this.stallResolved(e);return}if(d){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&o.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(x.MEDIA_ENDED,{stalled:!1}));return}if(!fe.getBuffered(o).length){this.nudgeRetry=0;return}const f=fe.bufferInfo(o,e,0),h=f.nextStart||0,m=this.fragmentTracker;if(l&&m&&this.hls){const R=Vg(this.hls.inFlightFragments,e),L=f.len>Ra,I=!h||R||h-e>Ra&&!m.getPartialFragment(e);if(L||I)return;this.moved=!1}const g=(s=this.hls)==null?void 0:s.latestLevelDetails;if(!this.moved&&this.stalled!==null&&m){if(!(f.len>0)&&!h)return;const L=Math.max(h,f.start||0)-e,C=!!(g!=null&&g.live)?g.targetduration*2:Ra,_=m.getPartialFragment(e);if(L>0&&(L<=C||_)){o.paused||this._trySkipBufferHole(_);return}}const p=i.detectStallWithCurrentTimeMs,y=self.performance.now(),v=this.waiting;if(a===null){v>0&&y-v<p?this.stalled=v:this.stalled=y;return}const E=y-a;if(!l&&(E>=p||v)&&this.hls){var T;if(((T=this.mediaSource)==null?void 0:T.readyState)==="ended"&&!(g!=null&&g.live)&&Math.abs(e-((g==null?void 0:g.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(x.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(f),!this.media||!this.hls)return}const A=fe.bufferInfo(o,e,i.maxBufferHole);this._tryFixBufferStall(A,E)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const r=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(r)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(x.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var r;const s=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(r=this.buffered.audio)!=null&&r.length&&s&&s.length>1&&e>s.end(0)){const i=fe.bufferedInfo(fe.timeRangesToArray(this.buffered.audio),e,0);if(i.len>1&&t>=i.start){const o=fe.timeRangesToArray(s),a=fe.bufferedInfo(o,t,0).bufferedIndex;if(a>-1&&a<o.length-1){const l=fe.bufferedInfo(o,e,0).bufferedIndex,u=o[a].end,c=o[a+1].start;if((l===-1||l>a)&&c-u<1&&e-u<2){const d=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${u} -> ${c} buffered index: ${l}`);this.warn(d.message),this.media.currentTime+=1e-6;const f=this.fragmentTracker.getPartialFragment(e)||void 0,h=fe.bufferInfo(this.media,e,0);this.hls.trigger(x.ERROR,{type:te.MEDIA_ERROR,details:b.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:d,reason:d.message,frag:f,buffer:h.len,bufferInfo:h})}}}}}_tryFixBufferStall(e,t){var r,s;const{fragmentTracker:i,media:o}=this,a=(r=this.hls)==null?void 0:r.config;if(!o||!i||!a)return;const l=o.currentTime,u=(s=this.hls)==null?void 0:s.latestLevelDetails,c=i.getPartialFragment(l);if((c||u!=null&&u.live&&l<u.fragmentStart)&&(this._trySkipBufferHole(c)||!this.media))return;const d=e.buffered;(d&&d.length>1&&e.len>a.maxBufferHole||e.nextStart&&e.nextStart-l<a.maxBufferHole)&&(t>a.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}_reportStall(e){const{hls:t,media:r,stallReported:s,stalled:i}=this;if(!s&&i!==null&&r&&t){this.stallReported=!0;const o=new Error(`Playback stalling at @${r.currentTime} due to low buffer (${be(e)})`);this.warn(o.message),t.trigger(x.ERROR,{type:te.MEDIA_ERROR,details:b.BUFFER_STALLED_ERROR,fatal:!1,error:o,buffer:e.len,bufferInfo:e,stalled:{start:i}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:r,media:s}=this,i=(t=this.hls)==null?void 0:t.config;if(!s||!r||!i)return 0;const o=s.currentTime,a=fe.bufferInfo(s,o,0),l=o<a.start?a.start:a.nextStart;if(l&&this.hls){const c=a.len<=i.maxBufferHole,d=a.len>0&&a.len<1&&s.readyState<3,f=l-o;if(f>0&&(c||d)){if(f>i.maxBufferHole){let m=!1;if(o===0){const g=r.getAppendedFrag(0,Z.MAIN);g&&l<g.end&&(m=!0)}if(!m){const g=e||r.getAppendedFrag(o,Z.MAIN);if(g){var u;if(!((u=this.hls.loadLevelObj)!=null&&u.details)||Vg(this.hls.inFlightFragments,l))return 0;let y=!1,v=g.end;for(;v<l;){const E=r.getPartialFragment(v);if(E)v+=E.duration;else{y=!0;break}}if(y)return 0}}}const h=Math.max(l+Kw,o+Hw);if(this.warn(`skipping hole, adjusting currentTime from ${o} to ${h}`),this.moved=!0,s.currentTime=h,!(e!=null&&e.gap)){const m=new Error(`fragment loaded with buffer holes, seeking from ${o} to ${h}`);this.hls.trigger(x.ERROR,{type:te.MEDIA_ERROR,details:b.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:m,reason:m.message,frag:e||void 0,buffer:a.len,bufferInfo:a})}return h}}return 0}_tryNudgeBuffer(e){const{hls:t,media:r,nudgeRetry:s}=this,i=t==null?void 0:t.config;if(!r||!i)return 0;const o=r.currentTime;if(this.nudgeRetry++,s<i.nudgeMaxRetry){const a=o+(s+1)*i.nudgeOffset,l=new Error(`Nudging 'currentTime' from ${o} to ${a}`);this.warn(l.message),r.currentTime=a,t.trigger(x.ERROR,{type:te.MEDIA_ERROR,details:b.BUFFER_NUDGE_ON_STALL,error:l,fatal:!1,buffer:e.len,bufferInfo:e})}else{const a=new Error(`Playhead still not moving while enough data buffered @${o} after ${i.nudgeMaxRetry} nudges`);this.error(a.message),t.trigger(x.ERROR,{type:te.MEDIA_ERROR,details:b.BUFFER_STALLED_ERROR,error:a,fatal:!0,buffer:e.len,bufferInfo:e})}}}function Vg(n,e){const t=Hg(n.main);if(t&&t.start<=e)return t;const r=Hg(n.audio);return r&&r.start<=e?r:null}function Hg(n){if(!n)return null;switch(n.state){case U.IDLE:case U.STOPPED:case U.ENDED:case U.ERROR:return null}return n.frag}const Yw=.25;function gd(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function Kg(n,e,t,r,s){let i=new n(e,t,"");try{i.value=r,s&&(i.type=s)}catch{i=new n(e,t,be(s?Ee({type:s},r):r))}return i}const ea=(()=>{const n=gd();try{n&&new n(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function qw(n){return Uint8Array.from(n.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class Xw{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(x.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(x.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(x.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}onMediaAttaching(e,t){var r;this.media=t.media,((r=t.overrides)==null?void 0:r.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){const e=this.hls.latestLevelDetails;e&&this.updateDateRangeCues(e)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&Ls(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const r=e[t];if(r.kind==="metadata"&&r.label==="id3")return aE(r,this.media),r}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:r,enableID3MetadataCues:s}}}=this;if(!r&&!s)return;const{samples:i}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=gd();if(o)for(let a=0;a<i.length;a++){const l=i[a].type;if(l===Mt.emsg&&!r||!s)continue;const u=jv(i[a].data);if(u){const c=i[a].pts;let d=c+i[a].duration;d>ea&&(d=ea),d-c<=0&&(d=c+Yw);for(let h=0;h<u.length;h++){const m=u[h];if(!Gv(m)){this.updateId3CueEnds(c,l);const g=Kg(o,c,d,m,l);g&&this.id3Track.addCue(g)}}}}}updateId3CueEnds(e,t){var r;const s=(r=this.id3Track)==null?void 0:r.cues;if(s)for(let i=s.length;i--;){const o=s[i];o.type===t&&o.startTime<e&&o.endTime===ea&&(o.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:r,type:s}){const{id3Track:i,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:a,enableID3MetadataCues:l}}=o;if(i&&(a||l)){let u;s==="audio"?u=c=>c.type===Mt.audioId3&&l:s==="video"?u=c=>c.type===Mt.emsg&&a:u=c=>c.type===Mt.audioId3&&l||c.type===Mt.emsg&&a,dd(i,t,r,u)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.media||!e.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{id3Track:r}=this,{dateRanges:s}=e,i=Object.keys(s);let o=this.dateRangeCuesAppended;if(r&&t){var a;if((a=r.cues)!=null&&a.length){const c=Object.keys(o).filter(d=>!i.includes(d));for(let d=c.length;d--;){const f=c[d],h=o[f].cues;delete o[f],Object.keys(h).forEach(m=>{try{const g=h[m];g.removeEventListener("enter",this.onEventCueEnter),r.removeCue(g)}catch{}})}}else o=this.dateRangeCuesAppended={}}const l=e.fragments[e.fragments.length-1];if(i.length===0||!K(l==null?void 0:l.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const u=gd();for(let c=0;c<i.length;c++){const d=i[c],f=s[d],h=f.startTime,m=o[d],g=(m==null?void 0:m.cues)||{};let p=(m==null?void 0:m.durationKnown)||!1,y=ea;const{duration:v,endDate:E}=f;if(E&&v!==null)y=h+v,p=!0;else if(f.endOnNext&&!p){const A=i.reduce((R,L)=>{if(L!==f.id){const I=s[L];if(I.class===f.class&&I.startDate>f.startDate&&(!R||f.startDate<R.startDate))return I}return R},null);A&&(y=A.startTime,p=!0)}const T=Object.keys(f.attr);for(let A=0;A<T.length;A++){const R=T[A];if(!_I(R))continue;const L=g[R];if(L)p&&!m.durationKnown?L.endTime=y:Math.abs(L.startTime-h)>.01&&(L.startTime=h,L.endTime=y);else if(u){let I=f.attr[R];wI(R)&&(I=qw(I));const _=Kg(u,h,y,{key:R,data:I},Mt.dateRange);_&&(_.id=d,this.id3Track.addCue(_),g[R]=_,this.hls.config.interstitialsController&&(R==="X-ASSET-LIST"||R==="X-ASSET-URL")&&_.addEventListener("enter",this.onEventCueEnter))}}o[d]={cues:g,dateRange:f,durationKnown:p}}}}class Qw{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,r=this.levelDetails;if(!t||!r)return;this.currentTime=t.currentTime;const s=this.computeLatency();if(s===null)return;this._latency=s;const{lowLatencyMode:i,maxLiveSyncPlaybackRate:o}=this.config;if(!i||o===1||!r.live)return;const a=this.targetLatency;if(a===null)return;const l=s-a,u=Math.min(this.maxLatency,a+r.targetduration);if(l<u&&l>.05&&this.forwardBufferLength>1){const d=Math.min(2,Math.max(1,o)),f=Math.round(2/(1+Math.exp(-.75*l-this.edgeStalled))*20)/20,h=Math.min(d,Math.max(1,f));this.changeMediaPlaybackRate(t,h)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:r,targetduration:s}=e,{liveSyncDuration:i,liveSyncDurationCount:o,lowLatencyMode:a}=this.config,l=this.hls.userConfig;let u=a&&r||t;(this._targetLatencyUpdated||l.liveSyncDuration||l.liveSyncDurationCount||u===0)&&(u=i!==void 0?i:o*s);const c=s;return u+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,c)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const r=this.levelDetails;if(r===null)return null;const s=r.edge,i=e-t-this.edgeStalled,o=s-r.totalduration,a=s-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(o,i),a)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(x.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(x.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var r;t.details===b.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(r=this.levelDetails)!=null&&r.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var r,s;e.playbackRate!==t&&((r=this.hls)==null||r.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(s=this.targetLatency)==null?void 0:s.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class Jw extends Uf{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(x.LEVEL_LOADED,this.onLevelLoaded,this),e.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(x.FRAG_BUFFERED,this.onFragBuffered,this),e.on(x.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(x.LEVEL_LOADED,this.onLevelLoaded,this),e.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(x.FRAG_BUFFERED,this.onFragBuffered,this),e.off(x.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const r=this.hls.config.preferManagedMediaSource,s=[],i={},o={};let a=!1,l=!1,u=!1;t.levels.forEach(c=>{var d;const f=c.attrs;let{audioCodec:h,videoCodec:m}=c;h&&(c.audioCodec=h=il(h,r)||void 0),((d=m)==null?void 0:d.indexOf("avc1"))===0&&(m=c.videoCodec=Y1(m));const{width:g,height:p,unknownCodecs:y}=c;let v=y?y.length:0;if(y)for(let F=v;F--;){const B=y[F];this.isAudioSupported(B)?(c.audioCodec=h=h?`${h},${B}`:B,v--,js.audio[h.substring(0,4)]=2):this.isVideoSupported(B)&&(c.videoCodec=m=m?`${m},${B}`:B,v--,js.video[m.substring(0,4)]=2)}if(a||(a=!!(g&&p)),l||(l=!!m),u||(u=!!h),v||h&&!this.isAudioSupported(h)||m&&!this.isVideoSupported(m)){this.log(`Some or all CODECS not supported "${f.CODECS}"`);return}const{CODECS:E,"FRAME-RATE":T,"HDCP-LEVEL":A,"PATHWAY-ID":R,RESOLUTION:L,"VIDEO-RANGE":I}=f,_=`${`${R||"."}-`}${c.bitrate}-${L}-${T}-${E}-${I}-${A}`;if(i[_])if(i[_].uri!==c.url&&!c.attrs["PATHWAY-ID"]){const F=o[_]+=1;c.attrs["PATHWAY-ID"]=new Array(F+1).join(".");const B=this.createLevel(c);i[_]=B,s.push(B)}else i[_].addGroupId("audio",f.AUDIO),i[_].addGroupId("text",f.SUBTITLES);else{const F=this.createLevel(c);i[_]=F,o[_]=1,s.push(F)}}),this.filterAndSortMediaOptions(s,t,a,l,u)}createLevel(e){const t=new no(e),r=e.supplemental;if(r!=null&&r.videoCodec&&!this.isVideoSupported(r.videoCodec)){const s=new Error(`SUPPLEMENTAL-CODECS not supported "${r.videoCodec}"`);this.log(s.message),t.supportedResult=gv(s,[])}return t}isAudioSupported(e){return ed(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return ed(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,r,s,i){let o=[],a=[],l=e;if((r||s)&&i&&(l=l.filter(({videoCodec:p,videoRange:y,width:v,height:E})=>(!!p||!!(v&&E))&&Z1(y))),l.length===0){Promise.resolve().then(()=>{if(this.hls){let p="no level with compatible codecs found in manifest",y=p;t.levels.length&&(y=`one or more CODECS in variant not supported: ${be(t.levels.map(E=>E.attrs.CODECS).filter((E,T,A)=>A.indexOf(E)===T))}`,this.warn(y),p+=` (${y})`);const v=new Error(p);this.hls.trigger(x.ERROR,{type:te.MEDIA_ERROR,details:b.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:v,reason:y})}});return}t.audioTracks&&(o=t.audioTracks.filter(p=>!p.audioCodec||this.isAudioSupported(p.audioCodec)),zg(o)),t.subtitles&&(a=t.subtitles,zg(a));const u=l.slice(0);l.sort((p,y)=>{if(p.attrs["HDCP-LEVEL"]!==y.attrs["HDCP-LEVEL"])return(p.attrs["HDCP-LEVEL"]||"")>(y.attrs["HDCP-LEVEL"]||"")?1:-1;if(r&&p.height!==y.height)return p.height-y.height;if(p.frameRate!==y.frameRate)return p.frameRate-y.frameRate;if(p.videoRange!==y.videoRange)return ol.indexOf(p.videoRange)-ol.indexOf(y.videoRange);if(p.videoCodec!==y.videoCodec){const v=Bm(p.videoCodec),E=Bm(y.videoCodec);if(v!==E)return E-v}if(p.uri===y.uri&&p.codecSet!==y.codecSet){const v=sl(p.codecSet),E=sl(y.codecSet);if(v!==E)return E-v}return p.averageBitrate!==y.averageBitrate?p.averageBitrate-y.averageBitrate:0});let c=u[0];if(this.steering&&(l=this.steering.filterParsedLevels(l),l.length!==u.length)){for(let p=0;p<u.length;p++)if(u[p].pathwayId===l[0].pathwayId){c=u[p];break}}this._levels=l;for(let p=0;p<l.length;p++)if(l[p]===c){var d;this._firstLevel=p;const y=c.bitrate,v=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${l.length} level(s) found, first bitrate: ${y}`),((d=this.hls.userConfig)==null?void 0:d.abrEwmaDefaultEstimate)===void 0){const E=Math.min(y,this.hls.config.abrEwmaDefaultEstimateMax);E>v&&v===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=E)}break}const f=i&&!s,h=this.hls.config,m=!!(h.audioStreamController&&h.audioTrackController),g={levels:l,audioTracks:o,subtitleTracks:a,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:i,video:s,altAudio:m&&!f&&o.some(p=>!!p.url)};this.hls.trigger(x.MANIFEST_PARSED,g)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const c=new Error("invalid level idx"),d=e<0;if(this.hls.trigger(x.ERROR,{type:te.OTHER_ERROR,details:b.LEVEL_SWITCH_ERROR,level:e,fatal:d,error:c,reason:c.message}),d)return;e=Math.min(e,t.length-1)}const r=this.currentLevelIndex,s=this.currentLevel,i=s?s.attrs["PATHWAY-ID"]:void 0,o=t[e],a=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,r===e&&s&&i===a)return;this.log(`Switching to level ${e} (${o.height?o.height+"p ":""}${o.videoRange?o.videoRange+" ":""}${o.codecSet?o.codecSet+" ":""}@${o.bitrate})${a?" with Pathway "+a:""} from level ${r}${i?" with Pathway "+i:""}`);const l={level:e,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds};this.hls.trigger(x.LEVEL_SWITCHING,l);const u=o.details;if(!u||u.live){const c=this.switchParams(o.uri,s==null?void 0:s.details,u);this.loadPlaylist(c)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),r=e.filter(s=>t.indexOf(s)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=r}}onError(e,t){t.fatal||!t.context||t.context.type===he.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===Z.MAIN){const r=t.elementaryStreams;if(!Object.keys(r).some(i=>!!r[i]))return;const s=this._levels[t.level];s!=null&&s.loadError&&(this.log(`Resetting level error count of ${s.loadError} on frag buffered`),s.loadError=0)}}onLevelLoaded(e,t){var r;const{level:s,details:i}=t,o=t.levelInfo;if(!o){var a;this.warn(`Invalid level index ${s}`),(a=t.deliveryDirectives)!=null&&a.skip&&(i.deltaUpdateFailed=!0);return}if(o===this.currentLevel||t.withoutMultiVariant){o.fragmentError===0&&(o.loadError=0);let l=o.details;l===t.details&&l.advanced&&(l=void 0),this.playlistLoaded(s,t,l)}else(r=t.deliveryDirectives)!=null&&r.skip&&(i.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=this.getUrlWithDirectives(e.uri,t),s=this.currentLevelIndex,i=e.attrs["PATHWAY-ID"],o=e.details,a=o==null?void 0:o.age;this.log(`Loading level index ${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${i?" Pathway "+i:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${r}`),this.hls.trigger(x.LEVEL_LOADING,{url:r,level:s,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const r=this._levels.filter((i,o)=>o!==e?!0:(this.steering&&this.steering.removeLevel(i),i===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,i.details&&i.details.fragments.forEach(a=>a.level=-1)),!1));Cv(r),this._levels=r,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const s=r.length-1;this._firstLevel=Math.min(this._firstLevel,s),this._startLevel&&(this._startLevel=Math.min(this._startLevel,s)),this.hls.trigger(x.LEVELS_UPDATED,{levels:r})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:r}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(x.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:r}))}}function zg(n){const e={};n.forEach(t=>{const r=t.groupId||"";t.id=e[r]=e[r]||0,e[r]++})}function xE(){return self.SourceBuffer||self.WebKitSourceBuffer}function SE(){if(!_r())return!1;const e=xE();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function Zw(){if(!SE())return!1;const n=_r();return typeof(n==null?void 0:n.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>n.isTypeSupported(to(e,"video")))||["mp4a.40.2","fLaC"].some(e=>n.isTypeSupported(to(e,"audio"))))}function ek(){var n;const e=xE();return typeof(e==null||(n=e.prototype)==null?void 0:n.changeType)=="function"}const tk=100;class nk extends Cf{constructor(e,t,r){super(e,t,r,"stream-controller",Z.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const s=this.media,i=s?s.currentTime:null;if(i===null||!K(i)||(this.log(`Media seeked to ${i.toFixed(3)}`),!this.getBufferedFrag(i)))return;const o=this.getFwdBufferInfoAtPos(s,i,Z.MAIN,0);if(o===null||o.len===0){this.warn(`Main forward buffer length at ${i} on "seeked" event ${o?o.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.LEVEL_LOADING,this.onLevelLoading,this),e.on(x.LEVEL_LOADED,this.onLevelLoaded,this),e.on(x.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(x.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(x.BUFFER_CREATED,this.onBufferCreated,this),e.on(x.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(x.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.LEVEL_LOADED,this.onLevelLoaded,this),e.off(x.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(x.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(x.BUFFER_CREATED,this.onBufferCreated,this),e.off(x.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(x.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:r,hls:s}=this;if(this.stopLoad(),this.setInterval(tk),this.level=-1,!this.startFragRequested){let i=s.startLevel;i===-1&&(s.config.testBandwidth&&this.levels.length>1?(i=0,this.bitrateTest=!0):i=s.firstAutoLevel),s.nextLoadLevel=i,this.level=s.loadLevel,this._hasEnoughToStart=!!t}r>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${r.toFixed(3)}`),e=r),this.state=U.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=U.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case U.WAITING_LEVEL:{const{levels:t,level:r}=this,s=t==null?void 0:t[r],i=s==null?void 0:s.details;if(i&&(!i.live||this.levelLastLoaded===s&&!this.waitForLive(s))){if(this.waitForCdnTuneIn(i))break;this.state=U.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=U.IDLE;break}break}case U.FRAG_LOADING_WAITING_RETRY:{var e;const t=self.performance.now(),r=this.retryDate;if(!r||t>=r||(e=this.media)!=null&&e.seeking){const{levels:s,level:i}=this,o=s==null?void 0:s[i];this.resetStartWhenNotLoaded(o||null),this.state=U.IDLE}}break}this.state===U.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:r,media:s}=this;if(t===null||!s&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const i=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(r!=null&&r[i]))return;const o=r[i],a=this.getMainFwdBufferInfo();if(a===null)return;const l=this.getLevelDetails();if(l&&this._streamEnded(a,l)){const g={};this.altAudio===2&&(g.type="video"),this.hls.trigger(x.BUFFER_EOS,g),this.state=U.ENDED;return}if(!this.buffering)return;e.loadLevel!==i&&e.manualLevel===-1&&this.log(`Adapting to level ${i} from level ${this.level}`),this.level=e.nextLoadLevel=i;const u=o.details;if(!u||this.state===U.WAITING_LEVEL||this.waitForLive(o)){this.level=i,this.state=U.WAITING_LEVEL,this.startFragRequested=!1;return}const c=a.len,d=this.getMaxBufferLength(o.maxBitrate);if(c>=d)return;this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);const f=this.backtrackFragment?this.backtrackFragment.start:a.end;let h=this.getNextFragment(f,u);if(this.couldBacktrack&&!this.fragPrevious&&h&&Ze(h)&&this.fragmentTracker.getState(h)!==We.OK){var m;const p=((m=this.backtrackFragment)!=null?m:h).sn-u.startSN,y=u.fragments[p-1];y&&h.cc===y.cc&&(h=y,this.fragmentTracker.removeFragment(y))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(h&&this.isLoopLoading(h,f)){if(!h.gap){const p=this.audioOnly&&!this.altAudio?Te.AUDIO:Te.VIDEO,y=(p===Te.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;y&&this.afterBufferFlushed(y,p,Z.MAIN)}h=this.getNextFragmentLoopLoading(h,u,a,Z.MAIN,d)}h&&(h.initSegment&&!h.initSegment.data&&!this.bitrateTest&&(h=h.initSegment),this.loadFragment(h,o,f))}loadFragment(e,t,r){const s=this.fragmentTracker.getState(e);s===We.NOT_LOADED||s===We.PARTIAL?Ze(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,r):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,Z.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let r;const s=this.getAppendedFrag(t.currentTime);s&&s.start>1&&this.flushMainBuffer(0,s.start-1);const i=this.getLevelDetails();if(i!=null&&i.live){const a=this.getMainFwdBufferInfo();if(!a||a.len<i.targetduration*2)return}if(!t.paused&&e){const a=this.hls.nextLoadLevel,l=e[a],u=this.fragLastKbps;u&&this.fragCurrent?r=this.fragCurrent.duration*l.maxBitrate/(1e3*u)+1:r=0}else r=0;const o=this.getBufferedFrag(t.currentTime+r);if(o){const a=this.followingBufferedFrag(o);if(a){this.abortCurrentFrag();const l=a.maxStartPTS?a.maxStartPTS:a.start,u=a.duration,c=Math.max(o.end,l+Math.min(Math.max(u-this.config.maxFragLookUpTolerance,u*(this.couldBacktrack?.5:.125)),u*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(c,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case U.KEY_LOADING:case U.FRAG_LOADING:case U.FRAG_LOADING_WAITING_RETRY:case U.PARSING:case U.PARSED:this.state=U.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const r=t.media;Kn(r,"playing",this.onMediaPlaying),Kn(r,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:r}=this;r&&(kn(r,"playing",this.onMediaPlaying),kn(r,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(x.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let r=!1,s=!1;t.levels.forEach(i=>{const o=i.audioCodec;o&&(r=r||o.indexOf("mp4a.40.2")!==-1,s=s||o.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=r&&s&&!ek(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:r}=this;if(!r||this.state!==U.IDLE)return;const s=t.levelInfo;(!s.details||s.details.live&&(this.levelLastLoaded!==s||s.details.expired)||this.waitForCdnTuneIn(s.details))&&(this.state=U.WAITING_LEVEL)}onLevelLoaded(e,t){var r;const{levels:s,startFragRequested:i}=this,o=t.level,a=t.details,l=a.totalduration;if(!s){this.warn(`Levels were reset while loading level ${o}`);return}this.log(`Level ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""}, cc [${a.startCC}, ${a.endCC}] duration:${l}`);const u=t.levelInfo,c=this.fragCurrent;c&&(this.state===U.FRAG_LOADING||this.state===U.FRAG_LOADING_WAITING_RETRY)&&c.level!==t.level&&c.loader&&this.abortCurrentFrag();let d=0;if(a.live||(r=u.details)!=null&&r.live){var f;if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;d=this.alignPlaylists(a,u.details,(f=this.levelLastLoaded)==null?void 0:f.details)}if(u.details=a,this.levelLastLoaded=u,i||this.setStartPosition(a,d),this.hls.trigger(x.LEVEL_UPDATED,{details:a,level:o}),this.state===U.WAITING_LEVEL){if(this.waitForCdnTuneIn(a))return;this.state=U.IDLE}i&&a.live&&this.synchronizeToLiveEdge(a),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:r}=this;if(!r)return;const s=this.hls.liveSyncPosition,i=this.getLoadPosition(),o=e.fragmentStart,a=e.edge,l=i>=o-t.maxFragLookUpTolerance&&i<=a;if(s!==null&&r.duration>s&&(i<s||!l)){const u=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!l&&r.readyState<4||i<a-u)&&(this._hasEnoughToStart||(this.nextLoadPosition=s),r.readyState&&(this.warn(`Playback: ${i.toFixed(3)} is located too far from the end of live sliding playlist: ${a}, reset currentTime to : ${s.toFixed(3)}`),r.currentTime=s))}}_handleFragmentLoadProgress(e){var t;const r=e.frag,{part:s,payload:i}=e,{levels:o}=this;if(!o){this.warn(`Levels were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const a=o[r.level];if(!a){this.warn(`Level ${r.level} not found on progress`);return}const l=a.details;if(!l){this.warn(`Dropping fragment ${r.sn} of level ${r.level} after level details were reset`),this.fragmentTracker.removeFragment(r);return}const u=a.videoCodec,c=l.PTSKnown||!l.live,d=(t=r.initSegment)==null?void 0:t.data,f=this._getAudioCodec(a),h=this.transmuxer=this.transmuxer||new Zv(this.hls,Z.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),m=s?s.index:-1,g=m!==-1,p=new _f(r.level,r.sn,r.stats.chunkCount,i.byteLength,m,g),y=this.initPTS[r.cc];h.push(i,d,f,u,r,s,l.totalduration,c,p,y)}onAudioTrackSwitching(e,t){const r=this.hls,s=this.altAudio===2;if(al(t.url,r))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(s){this.fragmentTracker.removeAllFragments(),r.once(x.BUFFER_FLUSHED,()=>{var o;(o=this.hls)==null||o.trigger(x.AUDIO_TRACK_SWITCHED,t)}),r.trigger(x.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}r.trigger(x.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const r=al(t.url,this.hls);if(r){const s=this.videoBuffer;s&&this.mediaBuffer!==s&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=r?2:0,this.tick()}onBufferCreated(e,t){const r=t.tracks;let s,i,o=!1;for(const a in r){const l=r[a];if(l.id==="main"){if(i=a,s=l,a==="video"){const u=r[a];u&&(this.videoBuffer=u.buffer)}}else o=!0}o&&s?(this.log(`Alternate track found, use ${i}.buffered to schedule main fragment loading`),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:r,part:s}=t,i=r.type===Z.MAIN;if(i){if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${s?" p: "+s.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}`),this.state===U.PARSED&&(this.state=U.IDLE);return}const a=s?s.stats:r.stats;this.fragLastKbps=Math.round(8*a.total/(a.buffering.end-a.loading.first)),Ze(r)&&(this.fragPrevious=r),this.fragBufferedComplete(r,s)}const o=this.media;o&&(!this._hasEnoughToStart&&fe.getBuffered(o).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),i&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var r;if(t.fatal){this.state=U.ERROR;return}switch(t.details){case b.FRAG_GAP:case b.FRAG_PARSING_ERROR:case b.FRAG_DECRYPT_ERROR:case b.FRAG_LOAD_ERROR:case b.FRAG_LOAD_TIMEOUT:case b.KEY_LOAD_ERROR:case b.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Z.MAIN,t);break;case b.LEVEL_LOAD_ERROR:case b.LEVEL_LOAD_TIMEOUT:case b.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===U.WAITING_LEVEL&&((r=t.context)==null?void 0:r.type)===he.LEVEL&&(this.state=U.IDLE);break;case b.BUFFER_ADD_CODEC_ERROR:case b.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.resetLoadingState();break;case b.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case b.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=U.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==Te.AUDIO||!this.altAudio){const r=(t===Te.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;r&&(this.afterBufferFlushed(r,t,Z.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let r=this.startPosition;if(r>=0&&t<r){if(e.seeking){this.log(`could not seek to ${r}, already seeking at ${t}`);return}const s=this.timelineOffset;s&&r&&(r+=s);const i=this.getLevelDetails(),o=fe.getBuffered(e),a=o.length?o.start(0):0,l=a-r,u=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);l>0&&(l<u||this.loadingParts&&l<2*((i==null?void 0:i.partTarget)||0))&&(this.log(`adjusting start position by ${l} to match buffer start`),r+=l,this.startPosition=r),t<r&&(this.log(`seek to target start position ${r} from current time ${t} buffer start ${a}`),e.currentTime=r)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(r=>{const{hls:s}=this,i=r==null?void 0:r.frag;if(!i||this.fragContextChanged(i))return;t.fragmentError=0,this.state=U.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const o=i.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),s.trigger(x.FRAG_LOADED,r),i.bitrateTest=!1})}_handleTransmuxComplete(e){var t;const r=this.playlistType,{hls:s}=this,{remuxResult:i,chunkMeta:o}=e,a=this.getCurrentContext(o);if(!a){this.resetWhenMissingContext(o);return}const{frag:l,part:u,level:c}=a,{video:d,text:f,id3:h,initSegment:m}=i,{details:g}=c,p=this.altAudio?void 0:i.audio;if(this.fragContextChanged(l)){this.fragmentTracker.removeFragment(l);return}if(this.state=U.PARSING,m){if(m!=null&&m.tracks){const E=l.initSegment||l;this._bufferInitSegment(c,m.tracks,E,o),s.trigger(x.FRAG_PARSING_INIT_SEGMENT,{frag:E,id:r,tracks:m.tracks})}const y=m.initPTS,v=m.timescale;K(y)&&(this.initPTS[l.cc]={baseTime:y,timescale:v},s.trigger(x.INIT_PTS_FOUND,{frag:l,id:r,initPTS:y,timescale:v}))}if(d&&g){p&&d.type==="audiovideo"&&this.logMuxedErr(l);const y=g.fragments[l.sn-1-g.startSN],v=l.sn===g.startSN,E=!y||l.cc>y.cc;if(i.independent!==!1){const{startPTS:T,endPTS:A,startDTS:R,endDTS:L}=d;if(u)u.elementaryStreams[d.type]={startPTS:T,endPTS:A,startDTS:R,endDTS:L};else if(d.firstKeyFrame&&d.independent&&o.id===1&&!E&&(this.couldBacktrack=!0),d.dropped&&d.independent){const I=this.getMainFwdBufferInfo(),C=(I?I.end:this.getLoadPosition())+this.config.maxBufferHole,_=d.firstKeyFramePTS?d.firstKeyFramePTS:T;if(!v&&C<_-this.config.maxBufferHole&&!E){this.backtrack(l);return}else E&&(l.gap=!0);l.setElementaryStreamInfo(d.type,l.start,A,l.start,L,!0)}else v&&T-(g.appliedTimelineOffset||0)>Ra&&(l.gap=!0);l.setElementaryStreamInfo(d.type,T,A,R,L),this.backtrackFragment&&(this.backtrackFragment=l),this.bufferFragmentData(d,l,u,o,v||E)}else if(v||E)l.gap=!0;else{this.backtrack(l);return}}if(p){const{startPTS:y,endPTS:v,startDTS:E,endDTS:T}=p;u&&(u.elementaryStreams[Te.AUDIO]={startPTS:y,endPTS:v,startDTS:E,endDTS:T}),l.setElementaryStreamInfo(Te.AUDIO,y,v,E,T),this.bufferFragmentData(p,l,u,o)}if(g&&h!=null&&(t=h.samples)!=null&&t.length){const y={id:r,frag:l,details:g,samples:h.samples};s.trigger(x.FRAG_PARSING_METADATA,y)}if(g&&f){const y={id:r,frag:l,details:g,samples:f.samples};s.trigger(x.FRAG_PARSING_USERDATA,y)}}logMuxedErr(e){this.warn(`${Ze(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,r,s){if(this.state!==U.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(r));const{audio:i,video:o,audiovideo:a}=t;if(i){let u=xa(i.codec,e.audioCodec);u==="mp4a"&&(u="mp4a.40.5");const c=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){u&&(u.indexOf("mp4a.40.5")!==-1?u="mp4a.40.2":u="mp4a.40.5");const d=i.metadata;d&&"channelCount"in d&&(d.channelCount||1)!==1&&c.indexOf("firefox")===-1&&(u="mp4a.40.5")}u&&u.indexOf("mp4a.40.5")!==-1&&c.indexOf("android")!==-1&&i.container!=="audio/mpeg"&&(u="mp4a.40.2",this.log(`Android: force audio codec to ${u}`)),e.audioCodec&&e.audioCodec!==u&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${u}"`),i.levelCodec=u,i.id=Z.MAIN,this.log(`Init audio buffer, container:${i.container}, codecs[selected/level/parsed]=[${u||""}/${e.audioCodec||""}/${i.codec}]`),delete t.audiovideo}if(o){o.levelCodec=e.videoCodec,o.id=Z.MAIN;const u=o.codec;if((u==null?void 0:u.length)===4)switch(u){case"hvc1":case"hev1":o.codec="hvc1.1.6.L120.90";break;case"av01":o.codec="av01.0.04M.08";break;case"avc1":o.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${e.videoCodec||""}/${u}]${o.codec!==u?" parsed-corrected="+o.codec:""}${o.supplemental?" supplemental="+o.supplemental:""}`),delete t.audiovideo}a&&(this.log(`Init audiovideo buffer, container:${a.container}, codecs[level/parsed]=[${e.codecs}/${a.codec}]`),delete t.video,delete t.audio);const l=Object.keys(t);if(l.length){if(this.hls.trigger(x.BUFFER_CODECS,t),!this.hls)return;l.forEach(u=>{const d=t[u].initSegment;d!=null&&d.byteLength&&this.hls.trigger(x.BUFFER_APPENDING,{type:u,data:d,frag:r,part:null,chunkMeta:s,parent:r.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,Z.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,r=e==null?void 0:e[t];return r?this.getMaxBufferLength(r.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=U.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const r=e.currentTime;if(fe.isBuffered(e,r)?t=this.getAppendedFrag(r):fe.isBuffered(e,r+.1)&&(t=this.getAppendedFrag(r+.1)),t){this.backtrackFragment=null;const s=this.fragPlaying,i=t.level;(!s||t.sn!==s.sn||s.level!==i)&&(this.fragPlaying=t,this.hls.trigger(x.FRAG_CHANGED,{frag:t}),(!s||s.level!==i)&&this.hls.trigger(x.LEVEL_SWITCHED,{level:i}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return K(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(K(t)){const r=this.getLevelDetails(),s=this.currentFrag||(r?es(null,r.fragments,t):null);if(s){const i=s.programDateTime;if(i!==null){const o=i+(t-s.start)*1e3;return new Date(o)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class rk{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const r in this.keyUriToKeyInfo){const s=this.keyUriToKeyInfo[r].loader;if(s){var t;if(e&&e!==((t=s.context)==null?void 0:t.frag.type))return;s.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=b.KEY_LOAD_ERROR,r,s,i){return new $n({type:te.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:i,error:r,networkDetails:s})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled){const{sn:r,cc:s}=e;for(let i=0;i<t.length;i++){const o=t[i];if(s<=o.cc&&(r==="initSegment"||o.sn==="initSegment"||r<o.sn)){this.emeController.selectKeySystemFormat(o).then(a=>{o.setKeyFormat(a)});break}}}}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var r,s;t&&e.setKeyFormat(t);const i=e.decryptdata;if(!i){const u=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,b.KEY_LOAD_ERROR,u))}const o=i.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,b.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));let a=this.keyUriToKeyInfo[o];if((r=a)!=null&&r.decryptdata.key)return i.key=a.decryptdata.key,Promise.resolve({frag:e,keyInfo:a});if((s=a)!=null&&s.keyLoadPromise){var l;switch((l=a.mediaKeySessionContext)==null?void 0:l.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return a.keyLoadPromise.then(u=>(i.key=u.keyInfo.decryptdata.key,{frag:e,keyInfo:a}))}}switch(a=this.keyUriToKeyInfo[o]={decryptdata:i,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},i.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return i.keyFormat==="identity"?this.loadKeyHTTP(a,e):this.loadKeyEME(a,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(a,e);default:return Promise.reject(this.createKeyLoadError(e,b.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${i.method}"`)))}}loadKeyEME(e,t){const r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const s=this.emeController.loadKey(r);if(s)return(e.keyLoadPromise=s.then(i=>(e.mediaKeySessionContext=i,r))).catch(i=>{throw e.keyLoadPromise=null,i})}return Promise.resolve(r)}loadKeyHTTP(e,t){const r=this.config,s=r.loader,i=new s(r);return t.keyLoader=e.loader=i,e.keyLoadPromise=new Promise((o,a)=>{const l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},u=r.keyLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,h,m,g)=>{const{frag:p,keyInfo:y,url:v}=m;if(!p.decryptdata||y!==this.keyUriToKeyInfo[v])return a(this.createKeyLoadError(p,b.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),g));y.decryptdata.key=p.decryptdata.key=new Uint8Array(f.data),p.keyLoader=null,y.loader=null,o({frag:p,keyInfo:y})},onError:(f,h,m,g)=>{this.resetLoader(h),a(this.createKeyLoadError(t,b.KEY_LOAD_ERROR,new Error(`HTTP Error ${f.code} loading key ${f.text}`),m,Ee({url:l.url,data:void 0},f)))},onTimeout:(f,h,m)=>{this.resetLoader(h),a(this.createKeyLoadError(t,b.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),m))},onAbort:(f,h,m)=>{this.resetLoader(h),a(this.createKeyLoadError(t,b.INTERNAL_ABORTED,new Error("key loading aborted"),m))}};i.load(l,c,d)})}resetLoader(e){const{frag:t,keyInfo:r,url:s}=e,i=r.loader;t.keyLoader===i&&(t.keyLoader=null,r.loader=null),delete this.keyUriToKeyInfo[s],i&&i.destroy()}}function Wg(n){const{type:e}=n;switch(e){case he.AUDIO_TRACK:return Z.AUDIO;case he.SUBTITLE_TRACK:return Z.SUBTITLE;default:return Z.MAIN}}function Ku(n,e){let t=n.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class sk{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.LEVEL_LOADING,this.onLevelLoading,this),e.on(x.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(x.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.LEVEL_LOADING,this.onLevelLoading,this),e.off(x.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(x.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,r=t.pLoader,s=t.loader,i=r||s,o=new i(t);return this.loaders[e.type]=o,o}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:r}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:he.MANIFEST,url:r,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:r,level:s,pathwayId:i,url:o,deliveryDirectives:a,levelInfo:l}=t;this.load({id:r,level:s,pathwayId:i,responseType:"text",type:he.LEVEL,url:o,deliveryDirectives:a,levelOrTrack:l})}onAudioTrackLoading(e,t){const{id:r,groupId:s,url:i,deliveryDirectives:o,track:a}=t;this.load({id:r,groupId:s,level:null,responseType:"text",type:he.AUDIO_TRACK,url:i,deliveryDirectives:o,levelOrTrack:a})}onSubtitleTrackLoading(e,t){const{id:r,groupId:s,url:i,deliveryDirectives:o,track:a}=t;this.load({id:r,groupId:s,level:null,responseType:"text",type:he.SUBTITLE_TRACK,url:i,deliveryDirectives:o,levelOrTrack:a})}onLevelsUpdated(e,t){const r=this.loaders[he.LEVEL];if(r){const s=r.context;s&&!t.levels.some(i=>i===s.levelOrTrack)&&(r.abort(),delete this.loaders[he.LEVEL])}}load(e){var t;const r=this.hls.config;let s=this.getInternalLoader(e);if(s){const u=this.hls.logger,c=s.context;if(c&&c.levelOrTrack===e.levelOrTrack&&(c.url===e.url||c.deliveryDirectives&&!e.deliveryDirectives)){c.url===e.url?u.log(`[playlist-loader]: ignore ${e.url} ongoing request`):u.log(`[playlist-loader]: ignore ${e.url} in favor of ${c.url}`);return}u.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),s.abort()}let i;if(e.type===he.MANIFEST?i=r.manifestLoadPolicy.default:i=Le({},r.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(e),K((t=e.deliveryDirectives)==null?void 0:t.part)){let u;if(e.type===he.LEVEL&&e.level!==null?u=this.hls.levels[e.level].details:e.type===he.AUDIO_TRACK&&e.id!==null?u=this.hls.audioTracks[e.id].details:e.type===he.SUBTITLE_TRACK&&e.id!==null&&(u=this.hls.subtitleTracks[e.id].details),u){const c=u.partTarget,d=u.targetduration;if(c&&d){const f=Math.max(c*3,d*.8)*1e3;i=Le({},i,{maxTimeToFirstByteMs:Math.min(f,i.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(f,i.maxTimeToFirstByteMs)})}}}const o=i.errorRetry||i.timeoutRetry||{},a={loadPolicy:i,timeout:i.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},l={onSuccess:(u,c,d,f)=>{const h=this.getInternalLoader(d);this.resetInternalLoader(d.type);const m=u.data;if(m.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(u,d,new Error("no EXTM3U delimiter"),f||null,c);return}c.parsing.start=performance.now(),wn.isMediaPlaylist(m)||d.type!==he.MANIFEST?this.handleTrackOrLevelPlaylist(u,c,d,f||null,h):this.handleMasterPlaylist(u,c,d,f)},onError:(u,c,d,f)=>{this.handleNetworkError(c,d,!1,u,f)},onTimeout:(u,c,d)=>{this.handleNetworkError(c,d,!0,void 0,u)}};s.load(e,a,l)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:r}=this.hls;(e||r)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,r,s){const i=this.hls,o=e.data,a=Ku(e,r),l=wn.parseMasterPlaylist(o,a);if(l.playlistParsingError){this.handleManifestParsingError(e,r,l.playlistParsingError,s,t);return}const{contentSteering:u,levels:c,sessionData:d,sessionKeys:f,startTimeOffset:h,variableList:m}=l;this.variableList=m;const{AUDIO:g=[],SUBTITLES:p,"CLOSED-CAPTIONS":y}=wn.parseMasterPlaylistMedia(o,a,l);g.length&&!g.some(E=>!E.url)&&c[0].audioCodec&&!c[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),g.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new De({}),bitrate:0,url:""})),i.trigger(x.MANIFEST_LOADED,{levels:c,audioTracks:g,subtitles:p,captions:y,contentSteering:u,url:a,stats:t,networkDetails:s,sessionData:d,sessionKeys:f,startTimeOffset:h,variableList:m})}handleTrackOrLevelPlaylist(e,t,r,s,i){const o=this.hls,{id:a,level:l,type:u}=r,c=Ku(e,r),d=K(l)?l:K(a)?a:0,f=Wg(r),h=wn.parseLevelPlaylist(e.data,c,d,f,0,this.variableList);if(u===he.MANIFEST){const m={attrs:new De({}),bitrate:0,details:h,name:"",url:c};h.requestScheduled=t.loading.start+_v(h,0),o.trigger(x.MANIFEST_LOADED,{levels:[m],audioTracks:[],url:c,stats:t,networkDetails:s,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=h,this.handlePlaylistLoaded(h,e,t,r,s,i)}handleManifestParsingError(e,t,r,s,i){this.hls.trigger(x.ERROR,{type:te.NETWORK_ERROR,details:b.MANIFEST_PARSING_ERROR,fatal:t.type===he.MANIFEST,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:s,stats:i})}handleNetworkError(e,t,r=!1,s,i){let o=`A network ${r?"timeout":"error"+(s?" (status "+s.code+")":"")} occurred while loading ${e.type}`;e.type===he.LEVEL?o+=`: ${e.level} id: ${e.id}`:(e.type===he.AUDIO_TRACK||e.type===he.SUBTITLE_TRACK)&&(o+=` id: ${e.id} group-id: "${e.groupId}"`);const a=new Error(o);this.hls.logger.warn(`[playlist-loader]: ${o}`);let l=b.UNKNOWN,u=!1;const c=this.getInternalLoader(e);switch(e.type){case he.MANIFEST:l=r?b.MANIFEST_LOAD_TIMEOUT:b.MANIFEST_LOAD_ERROR,u=!0;break;case he.LEVEL:l=r?b.LEVEL_LOAD_TIMEOUT:b.LEVEL_LOAD_ERROR,u=!1;break;case he.AUDIO_TRACK:l=r?b.AUDIO_TRACK_LOAD_TIMEOUT:b.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case he.SUBTITLE_TRACK:l=r?b.SUBTITLE_TRACK_LOAD_TIMEOUT:b.SUBTITLE_LOAD_ERROR,u=!1;break}c&&this.resetInternalLoader(e.type);const d={type:te.NETWORK_ERROR,details:l,fatal:u,url:e.url,loader:c,context:e,error:a,networkDetails:t,stats:i};if(s){const f=(t==null?void 0:t.url)||e.url;d.response=Ee({url:f,data:void 0},s)}this.hls.trigger(x.ERROR,d)}handlePlaylistLoaded(e,t,r,s,i,o){const a=this.hls,{type:l,level:u,id:c,groupId:d,deliveryDirectives:f}=s,h=Ku(t,s),m=Wg(s),g=typeof s.level=="number"&&m===Z.MAIN?u:void 0;if(!e.fragments.length){const y=e.playlistParsingError=new Error("No Segments found in Playlist");a.trigger(x.ERROR,{type:te.NETWORK_ERROR,details:b.LEVEL_EMPTY_ERROR,fatal:!1,url:h,error:y,reason:y.message,response:t,context:s,level:g,parent:m,networkDetails:i,stats:r});return}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const p=e.playlistParsingError;if(p){if(this.hls.logger.warn(p),!a.config.ignorePlaylistParsingErrors){a.trigger(x.ERROR,{type:te.NETWORK_ERROR,details:b.LEVEL_PARSING_ERROR,fatal:!1,url:h,error:p,reason:p.message,response:t,context:s,level:g,parent:m,networkDetails:i,stats:r});return}e.playlistParsingError=null}switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case he.MANIFEST:case he.LEVEL:a.trigger(x.LEVEL_LOADED,{details:e,levelInfo:s.levelOrTrack||a.levels[0],level:g||0,id:c||0,stats:r,networkDetails:i,deliveryDirectives:f,withoutMultiVariant:l===he.MANIFEST});break;case he.AUDIO_TRACK:a.trigger(x.AUDIO_TRACK_LOADED,{details:e,track:s.levelOrTrack,id:c||0,groupId:d||"",stats:r,networkDetails:i,deliveryDirectives:f});break;case he.SUBTITLE_TRACK:a.trigger(x.SUBTITLE_TRACK_LOADED,{details:e,track:s.levelOrTrack,id:c||0,groupId:d||"",stats:r,networkDetails:i,deliveryDirectives:f});break}}}class un{static get version(){return io}static isMSESupported(){return SE()}static isSupported(){return Zw()}static getMediaSource(){return _r()}static get Events(){return x}static get MetadataSchema(){return Mt}static get ErrorTypes(){return te}static get ErrorDetails(){return b}static get DefaultConfig(){return un.defaultConfig?un.defaultConfig:$w}static set DefaultConfig(e){un.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new bf,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=A1(e.debug||!1,"Hls instance",e.assetPlayerId),r=this.config=Gw(un.DefaultConfig,e,t);this.userConfig=e,r.progressive&&Vw(r,t);const{abrController:s,bufferController:i,capLevelController:o,errorController:a,fpsController:l}=r,u=new a(this),c=this.abrController=new s(this),d=new gI(this),f=r.interstitialsController,h=f?this.interstitialsController=new f(this,un):null,m=this.bufferController=new i(this,d),g=this.capLevelController=new o(this),p=new l(this),y=new sk(this),v=r.contentSteeringController,E=v?new v(this):null,T=this.levelController=new Jw(this,E),A=new Xw(this),R=new rk(this.config),L=this.streamController=new nk(this,d,R),I=this.gapController=new Ww(this,d);g.setStreamController(L),p.setStreamController(L);const C=[y,T,L];h&&C.splice(1,0,h),E&&C.splice(1,0,E),this.networkControllers=C;const _=[c,m,I,g,p,A,d];this.audioTrackController=this.createController(r.audioTrackController,C);const F=r.audioStreamController;F&&C.push(this.audioStreamController=new F(this,d,R)),this.subtitleTrackController=this.createController(r.subtitleTrackController,C);const B=r.subtitleStreamController;B&&C.push(this.subtititleStreamController=new B(this,d,R)),this.createController(r.timelineController,_),R.emeController=this.emeController=this.createController(r.emeController,_),this.cmcdController=this.createController(r.cmcdController,_),this.latencyController=this.createController(Qw,_),this.coreComponents=_,C.push(u);const ie=u.onErrorOut;typeof ie=="function"&&this.on(x.ERROR,ie,u),this.on(x.MANIFEST_LOADED,y.onManifestLoaded,y)}createController(e,t){if(e){const r=new e(this);return t&&t.push(r),r}return null}on(e,t,r=this){this._emitter.on(e,t,r)}once(e,t,r=this){this._emitter.once(e,t,r)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,r=this,s){this._emitter.off(e,t,r,s)}listeners(e){return this._emitter.listeners(e)}emit(e,t,r){return this._emitter.emit(e,t,r)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(r){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+r.message+'". Here is a stacktrace:',r),!this.triggeringException){this.triggeringException=!0;const s=e===x.ERROR;this.trigger(x.ERROR,{type:te.OTHER_ERROR,details:b.INTERNAL_EXCEPTION,fatal:s,event:e,error:r}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(x.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const i=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(x.ERROR,{type:te.OTHER_ERROR,details:b.ATTACH_MEDIA_ERROR,fatal:!0,error:i});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,r=t?e.media:e,s=t?e:{media:r};this._media=r,this.trigger(x.MEDIA_ATTACHING,s)}detachMedia(){this.logger.log("detachMedia"),this.trigger(x.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(x.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,r=this._url,s=this._url=Sf.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${s}`),t&&r&&(r!==s||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(x.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let r=0;r<this.networkControllers.length&&(this.networkControllers[r].startLoad(e,t),!(!this.started||!this.networkControllers));r++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[Z.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[Z.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[Z.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=hR()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){J1(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const r=e.length;for(let s=0;s<r;s++)if(e[s].maxBitrate>=t)return s;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:r}=this;let s;if(t===-1&&e!=null&&e.length?s=e.length-1:s=t,r)for(let i=s;i--;){const o=e[i].attrs["HDCP-LEVEL"];if(o&&o<=r)return i}return s}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const r=yv(t);return pv(e,r,navigator.mediaCapabilities)}}un.defaultConfig=void 0;/*! @license DOMPurify 3.2.5 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.5/LICENSE */const{entries:TE,setPrototypeOf:Yg,isFrozen:ik,getPrototypeOf:ok,getOwnPropertyDescriptor:ak}=Object;let{freeze:vt,seal:en,create:AE}=Object,{apply:pd,construct:yd}=typeof Reflect<"u"&&Reflect;vt||(vt=function(e){return e});en||(en=function(e){return e});pd||(pd=function(e,t,r){return e.apply(t,r)});yd||(yd=function(e,t){return new e(...t)});const ta=Et(Array.prototype.forEach),lk=Et(Array.prototype.lastIndexOf),qg=Et(Array.prototype.pop),di=Et(Array.prototype.push),uk=Et(Array.prototype.splice),_a=Et(String.prototype.toLowerCase),zu=Et(String.prototype.toString),Xg=Et(String.prototype.match),fi=Et(String.prototype.replace),ck=Et(String.prototype.indexOf),dk=Et(String.prototype.trim),rn=Et(Object.prototype.hasOwnProperty),gt=Et(RegExp.prototype.test),hi=fk(TypeError);function Et(n){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];return pd(n,e,r)}}function fk(n){return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return yd(n,t)}}function me(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:_a;Yg&&Yg(n,null);let r=e.length;for(;r--;){let s=e[r];if(typeof s=="string"){const i=t(s);i!==s&&(ik(e)||(e[r]=i),s=i)}n[s]=!0}return n}function hk(n){for(let e=0;e<n.length;e++)rn(n,e)||(n[e]=null);return n}function Ur(n){const e=AE(null);for(const[t,r]of TE(n))rn(n,t)&&(Array.isArray(r)?e[t]=hk(r):r&&typeof r=="object"&&r.constructor===Object?e[t]=Ur(r):e[t]=r);return e}function mi(n,e){for(;n!==null;){const r=ak(n,e);if(r){if(r.get)return Et(r.get);if(typeof r.value=="function")return Et(r.value)}n=ok(n)}function t(){return null}return t}const Qg=vt(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Wu=vt(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Yu=vt(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),mk=vt(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),qu=vt(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),gk=vt(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Jg=vt(["#text"]),Zg=vt(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Xu=vt(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),ep=vt(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),na=vt(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),pk=en(/\{\{[\w\W]*|[\w\W]*\}\}/gm),yk=en(/<%[\w\W]*|[\w\W]*%>/gm),vk=en(/\$\{[\w\W]*/gm),Ek=en(/^data-[\-\w.\u00B7-\uFFFF]+$/),xk=en(/^aria-[\-\w]+$/),LE=en(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Sk=en(/^(?:\w+script|data):/i),Tk=en(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),IE=en(/^html$/i),Ak=en(/^[a-z][.\w]*(-[.\w]+)+$/i);var tp=Object.freeze({__proto__:null,ARIA_ATTR:xk,ATTR_WHITESPACE:Tk,CUSTOM_ELEMENT:Ak,DATA_ATTR:Ek,DOCTYPE_NAME:IE,ERB_EXPR:yk,IS_ALLOWED_URI:LE,IS_SCRIPT_OR_DATA:Sk,MUSTACHE_EXPR:pk,TMPLIT_EXPR:vk});const gi={element:1,attribute:2,text:3,cdataSection:4,entityReference:5,entityNode:6,progressingInstruction:7,comment:8,document:9,documentType:10,documentFragment:11,notation:12},Lk=function(){return typeof window>"u"?null:window},Ik=function(e,t){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let r=null;const s="data-tt-policy-suffix";t&&t.hasAttribute(s)&&(r=t.getAttribute(s));const i="dompurify"+(r?"#"+r:"");try{return e.createPolicy(i,{createHTML(o){return o},createScriptURL(o){return o}})}catch{return console.warn("TrustedTypes policy "+i+" could not be created."),null}},np=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function RE(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Lk();const e=se=>RE(se);if(e.version="3.2.5",e.removed=[],!n||!n.document||n.document.nodeType!==gi.document||!n.Element)return e.isSupported=!1,e;let{document:t}=n;const r=t,s=r.currentScript,{DocumentFragment:i,HTMLTemplateElement:o,Node:a,Element:l,NodeFilter:u,NamedNodeMap:c=n.NamedNodeMap||n.MozNamedAttrMap,HTMLFormElement:d,DOMParser:f,trustedTypes:h}=n,m=l.prototype,g=mi(m,"cloneNode"),p=mi(m,"remove"),y=mi(m,"nextSibling"),v=mi(m,"childNodes"),E=mi(m,"parentNode");if(typeof o=="function"){const se=t.createElement("template");se.content&&se.content.ownerDocument&&(t=se.content.ownerDocument)}let T,A="";const{implementation:R,createNodeIterator:L,createDocumentFragment:I,getElementsByTagName:C}=t,{importNode:_}=r;let F=np();e.isSupported=typeof TE=="function"&&typeof E=="function"&&R&&R.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:B,ERB_EXPR:ie,TMPLIT_EXPR:z,DATA_ATTR:Y,ARIA_ATTR:V,IS_SCRIPT_OR_DATA:W,ATTR_WHITESPACE:M,CUSTOM_ELEMENT:P}=tp;let{IS_ALLOWED_URI:N}=tp,j=null;const H=me({},[...Qg,...Wu,...Yu,...qu,...Jg]);let Q=null;const ae=me({},[...Zg,...Xu,...ep,...na]);let J=Object.seal(AE(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),ue=null,Ie=null,He=!0,tt=!0,er=!1,Vt=!0,gn=!1,Pn=!0,ne=!1,X=!1,re=!1,de=!1,ye=!1,Ue=!1,Ge=!0,qe=!1;const Tt="user-content-";let On=!0,Ot=!1,Ht={},ht=null;const tr=me({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let vo=null;const Qs=me({},["audio","video","img","source","image","track"]);let ss=null;const nr=me({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Eo="http://www.w3.org/1998/Math/MathML",xo="http://www.w3.org/2000/svg",Nn="http://www.w3.org/1999/xhtml";let is=Nn,jl=!1,Gl=null;const _E=me({},[Eo,xo,Nn],zu);let So=me({},["mi","mo","mn","ms","mtext"]),To=me({},["annotation-xml"]);const wE=me({},["title","style","font","a","script"]);let Js=null;const kE=["application/xhtml+xml","text/html"],CE="text/html";let Xe=null,os=null;const bE=t.createElement("form"),Vf=function(w){return w instanceof RegExp||w instanceof Function},Vl=function(){let w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(os&&os===w)){if((!w||typeof w!="object")&&(w={}),w=Ur(w),Js=kE.indexOf(w.PARSER_MEDIA_TYPE)===-1?CE:w.PARSER_MEDIA_TYPE,Xe=Js==="application/xhtml+xml"?zu:_a,j=rn(w,"ALLOWED_TAGS")?me({},w.ALLOWED_TAGS,Xe):H,Q=rn(w,"ALLOWED_ATTR")?me({},w.ALLOWED_ATTR,Xe):ae,Gl=rn(w,"ALLOWED_NAMESPACES")?me({},w.ALLOWED_NAMESPACES,zu):_E,ss=rn(w,"ADD_URI_SAFE_ATTR")?me(Ur(nr),w.ADD_URI_SAFE_ATTR,Xe):nr,vo=rn(w,"ADD_DATA_URI_TAGS")?me(Ur(Qs),w.ADD_DATA_URI_TAGS,Xe):Qs,ht=rn(w,"FORBID_CONTENTS")?me({},w.FORBID_CONTENTS,Xe):tr,ue=rn(w,"FORBID_TAGS")?me({},w.FORBID_TAGS,Xe):{},Ie=rn(w,"FORBID_ATTR")?me({},w.FORBID_ATTR,Xe):{},Ht=rn(w,"USE_PROFILES")?w.USE_PROFILES:!1,He=w.ALLOW_ARIA_ATTR!==!1,tt=w.ALLOW_DATA_ATTR!==!1,er=w.ALLOW_UNKNOWN_PROTOCOLS||!1,Vt=w.ALLOW_SELF_CLOSE_IN_ATTR!==!1,gn=w.SAFE_FOR_TEMPLATES||!1,Pn=w.SAFE_FOR_XML!==!1,ne=w.WHOLE_DOCUMENT||!1,de=w.RETURN_DOM||!1,ye=w.RETURN_DOM_FRAGMENT||!1,Ue=w.RETURN_TRUSTED_TYPE||!1,re=w.FORCE_BODY||!1,Ge=w.SANITIZE_DOM!==!1,qe=w.SANITIZE_NAMED_PROPS||!1,On=w.KEEP_CONTENT!==!1,Ot=w.IN_PLACE||!1,N=w.ALLOWED_URI_REGEXP||LE,is=w.NAMESPACE||Nn,So=w.MATHML_TEXT_INTEGRATION_POINTS||So,To=w.HTML_INTEGRATION_POINTS||To,J=w.CUSTOM_ELEMENT_HANDLING||{},w.CUSTOM_ELEMENT_HANDLING&&Vf(w.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(J.tagNameCheck=w.CUSTOM_ELEMENT_HANDLING.tagNameCheck),w.CUSTOM_ELEMENT_HANDLING&&Vf(w.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(J.attributeNameCheck=w.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),w.CUSTOM_ELEMENT_HANDLING&&typeof w.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(J.allowCustomizedBuiltInElements=w.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),gn&&(tt=!1),ye&&(de=!0),Ht&&(j=me({},Jg),Q=[],Ht.html===!0&&(me(j,Qg),me(Q,Zg)),Ht.svg===!0&&(me(j,Wu),me(Q,Xu),me(Q,na)),Ht.svgFilters===!0&&(me(j,Yu),me(Q,Xu),me(Q,na)),Ht.mathMl===!0&&(me(j,qu),me(Q,ep),me(Q,na))),w.ADD_TAGS&&(j===H&&(j=Ur(j)),me(j,w.ADD_TAGS,Xe)),w.ADD_ATTR&&(Q===ae&&(Q=Ur(Q)),me(Q,w.ADD_ATTR,Xe)),w.ADD_URI_SAFE_ATTR&&me(ss,w.ADD_URI_SAFE_ATTR,Xe),w.FORBID_CONTENTS&&(ht===tr&&(ht=Ur(ht)),me(ht,w.FORBID_CONTENTS,Xe)),On&&(j["#text"]=!0),ne&&me(j,["html","head","body"]),j.table&&(me(j,["tbody"]),delete ue.tbody),w.TRUSTED_TYPES_POLICY){if(typeof w.TRUSTED_TYPES_POLICY.createHTML!="function")throw hi('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof w.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw hi('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');T=w.TRUSTED_TYPES_POLICY,A=T.createHTML("")}else T===void 0&&(T=Ik(h,s)),T!==null&&typeof A=="string"&&(A=T.createHTML(""));vt&&vt(w),os=w}},Hf=me({},[...Wu,...Yu,...mk]),Kf=me({},[...qu,...gk]),DE=function(w){let G=E(w);(!G||!G.tagName)&&(G={namespaceURI:is,tagName:"template"});const ee=_a(w.tagName),ke=_a(G.tagName);return Gl[w.namespaceURI]?w.namespaceURI===xo?G.namespaceURI===Nn?ee==="svg":G.namespaceURI===Eo?ee==="svg"&&(ke==="annotation-xml"||So[ke]):!!Hf[ee]:w.namespaceURI===Eo?G.namespaceURI===Nn?ee==="math":G.namespaceURI===xo?ee==="math"&&To[ke]:!!Kf[ee]:w.namespaceURI===Nn?G.namespaceURI===xo&&!To[ke]||G.namespaceURI===Eo&&!So[ke]?!1:!Kf[ee]&&(wE[ee]||!Hf[ee]):!!(Js==="application/xhtml+xml"&&Gl[w.namespaceURI]):!1},pn=function(w){di(e.removed,{element:w});try{E(w).removeChild(w)}catch{p(w)}},Ao=function(w,G){try{di(e.removed,{attribute:G.getAttributeNode(w),from:G})}catch{di(e.removed,{attribute:null,from:G})}if(G.removeAttribute(w),w==="is")if(de||ye)try{pn(G)}catch{}else try{G.setAttribute(w,"")}catch{}},zf=function(w){let G=null,ee=null;if(re)w="<remove></remove>"+w;else{const nt=Xg(w,/^[\r\n\t ]+/);ee=nt&&nt[0]}Js==="application/xhtml+xml"&&is===Nn&&(w='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+w+"</body></html>");const ke=T?T.createHTML(w):w;if(is===Nn)try{G=new f().parseFromString(ke,Js)}catch{}if(!G||!G.documentElement){G=R.createDocument(is,"template",null);try{G.documentElement.innerHTML=jl?A:ke}catch{}}const ot=G.body||G.documentElement;return w&&ee&&ot.insertBefore(t.createTextNode(ee),ot.childNodes[0]||null),is===Nn?C.call(G,ne?"html":"body")[0]:ne?G.documentElement:ot},Wf=function(w){return L.call(w.ownerDocument||w,w,u.SHOW_ELEMENT|u.SHOW_COMMENT|u.SHOW_TEXT|u.SHOW_PROCESSING_INSTRUCTION|u.SHOW_CDATA_SECTION,null)},Hl=function(w){return w instanceof d&&(typeof w.nodeName!="string"||typeof w.textContent!="string"||typeof w.removeChild!="function"||!(w.attributes instanceof c)||typeof w.removeAttribute!="function"||typeof w.setAttribute!="function"||typeof w.namespaceURI!="string"||typeof w.insertBefore!="function"||typeof w.hasChildNodes!="function")},Yf=function(w){return typeof a=="function"&&w instanceof a};function Mn(se,w,G){ta(se,ee=>{ee.call(e,w,G,os)})}const qf=function(w){let G=null;if(Mn(F.beforeSanitizeElements,w,null),Hl(w))return pn(w),!0;const ee=Xe(w.nodeName);if(Mn(F.uponSanitizeElement,w,{tagName:ee,allowedTags:j}),w.hasChildNodes()&&!Yf(w.firstElementChild)&&gt(/<[/\w!]/g,w.innerHTML)&&gt(/<[/\w!]/g,w.textContent)||w.nodeType===gi.progressingInstruction||Pn&&w.nodeType===gi.comment&&gt(/<[/\w]/g,w.data))return pn(w),!0;if(!j[ee]||ue[ee]){if(!ue[ee]&&Qf(ee)&&(J.tagNameCheck instanceof RegExp&&gt(J.tagNameCheck,ee)||J.tagNameCheck instanceof Function&&J.tagNameCheck(ee)))return!1;if(On&&!ht[ee]){const ke=E(w)||w.parentNode,ot=v(w)||w.childNodes;if(ot&&ke){const nt=ot.length;for(let At=nt-1;At>=0;--At){const yn=g(ot[At],!0);yn.__removalCount=(w.__removalCount||0)+1,ke.insertBefore(yn,y(w))}}}return pn(w),!0}return w instanceof l&&!DE(w)||(ee==="noscript"||ee==="noembed"||ee==="noframes")&&gt(/<\/no(script|embed|frames)/i,w.innerHTML)?(pn(w),!0):(gn&&w.nodeType===gi.text&&(G=w.textContent,ta([B,ie,z],ke=>{G=fi(G,ke," ")}),w.textContent!==G&&(di(e.removed,{element:w.cloneNode()}),w.textContent=G)),Mn(F.afterSanitizeElements,w,null),!1)},Xf=function(w,G,ee){if(Ge&&(G==="id"||G==="name")&&(ee in t||ee in bE))return!1;if(!(tt&&!Ie[G]&&gt(Y,G))){if(!(He&&gt(V,G))){if(!Q[G]||Ie[G]){if(!(Qf(w)&&(J.tagNameCheck instanceof RegExp&&gt(J.tagNameCheck,w)||J.tagNameCheck instanceof Function&&J.tagNameCheck(w))&&(J.attributeNameCheck instanceof RegExp&&gt(J.attributeNameCheck,G)||J.attributeNameCheck instanceof Function&&J.attributeNameCheck(G))||G==="is"&&J.allowCustomizedBuiltInElements&&(J.tagNameCheck instanceof RegExp&&gt(J.tagNameCheck,ee)||J.tagNameCheck instanceof Function&&J.tagNameCheck(ee))))return!1}else if(!ss[G]){if(!gt(N,fi(ee,M,""))){if(!((G==="src"||G==="xlink:href"||G==="href")&&w!=="script"&&ck(ee,"data:")===0&&vo[w])){if(!(er&&!gt(W,fi(ee,M,"")))){if(ee)return!1}}}}}}return!0},Qf=function(w){return w!=="annotation-xml"&&Xg(w,P)},Jf=function(w){Mn(F.beforeSanitizeAttributes,w,null);const{attributes:G}=w;if(!G||Hl(w))return;const ee={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:Q,forceKeepAttr:void 0};let ke=G.length;for(;ke--;){const ot=G[ke],{name:nt,namespaceURI:At,value:yn}=ot,Zs=Xe(nt);let mt=nt==="value"?yn:dk(yn);if(ee.attrName=Zs,ee.attrValue=mt,ee.keepAttr=!0,ee.forceKeepAttr=void 0,Mn(F.uponSanitizeAttribute,w,ee),mt=ee.attrValue,qe&&(Zs==="id"||Zs==="name")&&(Ao(nt,w),mt=Tt+mt),Pn&&gt(/((--!?|])>)|<\/(style|title)/i,mt)){Ao(nt,w);continue}if(ee.forceKeepAttr||(Ao(nt,w),!ee.keepAttr))continue;if(!Vt&&gt(/\/>/i,mt)){Ao(nt,w);continue}gn&&ta([B,ie,z],eh=>{mt=fi(mt,eh," ")});const Zf=Xe(w.nodeName);if(Xf(Zf,Zs,mt)){if(T&&typeof h=="object"&&typeof h.getAttributeType=="function"&&!At)switch(h.getAttributeType(Zf,Zs)){case"TrustedHTML":{mt=T.createHTML(mt);break}case"TrustedScriptURL":{mt=T.createScriptURL(mt);break}}try{At?w.setAttributeNS(At,nt,mt):w.setAttribute(nt,mt),Hl(w)?pn(w):qg(e.removed)}catch{}}}Mn(F.afterSanitizeAttributes,w,null)},PE=function se(w){let G=null;const ee=Wf(w);for(Mn(F.beforeSanitizeShadowDOM,w,null);G=ee.nextNode();)Mn(F.uponSanitizeShadowNode,G,null),qf(G),Jf(G),G.content instanceof i&&se(G.content);Mn(F.afterSanitizeShadowDOM,w,null)};return e.sanitize=function(se){let w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},G=null,ee=null,ke=null,ot=null;if(jl=!se,jl&&(se="<!-->"),typeof se!="string"&&!Yf(se))if(typeof se.toString=="function"){if(se=se.toString(),typeof se!="string")throw hi("dirty is not a string, aborting")}else throw hi("toString is not a function");if(!e.isSupported)return se;if(X||Vl(w),e.removed=[],typeof se=="string"&&(Ot=!1),Ot){if(se.nodeName){const yn=Xe(se.nodeName);if(!j[yn]||ue[yn])throw hi("root node is forbidden and cannot be sanitized in-place")}}else if(se instanceof a)G=zf("<!---->"),ee=G.ownerDocument.importNode(se,!0),ee.nodeType===gi.element&&ee.nodeName==="BODY"||ee.nodeName==="HTML"?G=ee:G.appendChild(ee);else{if(!de&&!gn&&!ne&&se.indexOf("<")===-1)return T&&Ue?T.createHTML(se):se;if(G=zf(se),!G)return de?null:Ue?A:""}G&&re&&pn(G.firstChild);const nt=Wf(Ot?se:G);for(;ke=nt.nextNode();)qf(ke),Jf(ke),ke.content instanceof i&&PE(ke.content);if(Ot)return se;if(de){if(ye)for(ot=I.call(G.ownerDocument);G.firstChild;)ot.appendChild(G.firstChild);else ot=G;return(Q.shadowroot||Q.shadowrootmode)&&(ot=_.call(r,ot,!0)),ot}let At=ne?G.outerHTML:G.innerHTML;return ne&&j["!doctype"]&&G.ownerDocument&&G.ownerDocument.doctype&&G.ownerDocument.doctype.name&&gt(IE,G.ownerDocument.doctype.name)&&(At="<!DOCTYPE "+G.ownerDocument.doctype.name+`>
`+At),gn&&ta([B,ie,z],yn=>{At=fi(At,yn," ")}),T&&Ue?T.createHTML(At):At},e.setConfig=function(){let se=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Vl(se),X=!0},e.clearConfig=function(){os=null,X=!1},e.isValidAttribute=function(se,w,G){os||Vl({});const ee=Xe(se),ke=Xe(w);return Xf(ee,ke,G)},e.addHook=function(se,w){typeof w=="function"&&di(F[se],w)},e.removeHook=function(se,w){if(w!==void 0){const G=lk(F[se],w);return G===-1?void 0:uk(F[se],G,1)[0]}return qg(F[se])},e.removeHooks=function(se){F[se]=[]},e.removeAllHooks=function(){F=np()},e}var Rk=RE();const _k=({subtitleTracks:n,selectedSubtitleIndex:e,itemId:t,currentTime:r})=>{const[s,i]=D.useState(null),{api:o}=mn();D.useEffect(()=>{(async()=>{if(!o||!t||e===null||!(n!=null&&n.length)){i(null);return}const d=n.find(f=>f.Index===e);if(!d){i(null);return}try{const f=await o.fetchSelectedSubtitle(t,d.Index);i(f??null)}catch{i(null)}})()},[o,t,e,n]);const a=r*1e7,l=D.useMemo(()=>{if(!s)return null;const c=s.filter(d=>d.StartPositionTicks).sort((d,f)=>d.StartPositionTicks-f.StartPositionTicks);for(let d=0;d<c.length;d++){const f=c[d],h=c[d+1],m=f.EndPositionTicks??(h==null?void 0:h.StartPositionTicks)??f.StartPositionTicks+5e7;if(a>=f.StartPositionTicks&&a<m)return f}return null},[a,s]),u=c=>{const d=c.replace(/\r\n/g,"<br>");return Rk.sanitize(d,{ALLOWED_TAGS:["i","em","b","strong","br"],ALLOWED_ATTR:[]})};return l?S.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:S.jsx("div",{className:"absolute bottom-10 w-auto text-center text-white text-xl bg-black/50 p-2",children:S.jsx("div",{dangerouslySetInnerHTML:{__html:u(l.Text)}})})}):null},wk=({audioTracks:n,selectedAudioTrack:e,setSelectedAudioTrack:t,subtitleTracks:r,selectedSubtitleIndex:s,setSelectedSubtitleIndex:i,isOpen:o,setIsOpen:a})=>{const l=D.useRef(null);return D.useEffect(()=>{const u=c=>{l.current&&!l.current.contains(c.target)&&a(!1)};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[a]),n.length<=1&&r.length===0?null:S.jsxs("div",{className:"relative inline-block text-left",ref:l,children:[S.jsx("button",{onClick:()=>a(!o),className:"text-white hover:text-gray-300 transition-colors mr-2 mt-2",title:"Tracks",children:S.jsx("span",{className:"flex items-center gap-1",children:S.jsx(n1,{size:24})})}),o&&S.jsxs("div",{className:"absolute right-0 bottom-10 w-[420px] bg-neutral-900 text-white text-sm rounded shadow-lg p-2 z-50 flex flex-row gap-4",children:[n.length>1&&S.jsxs("div",{className:"flex-1 min-w-[180px]",children:[S.jsx("h3",{className:"text-xs uppercase tracking-wide text-neutral-400 px-2 pb-2 border-b border-neutral-700",children:"Audio Tracks"}),S.jsx("ul",{className:"py-1 max-h-40 overflow-y-auto",children:n.map(u=>S.jsx("li",{children:S.jsxs("button",{type:"button",onClick:()=>{t(u.id),a(!1)},className:Be("w-full flex items-center justify-between px-3 py-2 cursor-pointer hover:bg-white/10 rounded text-left",e===u.id&&"font-semibold"),"aria-pressed":e===u.id,children:[S.jsxs("span",{children:[u.label," ",u.language?`(${u.language})`:""]}),e===u.id&&S.jsx(Su,{size:16})]})},u.id))})]}),r.length>0&&S.jsxs("div",{className:"flex-1 min-w-[180px]",children:[S.jsx("h3",{className:"text-xs uppercase tracking-wide text-neutral-400 px-2 pb-2 border-b border-neutral-700",children:"Subtitles"}),S.jsxs("ul",{className:"py-1 max-h-40 overflow-y-auto",children:[S.jsx("li",{children:S.jsxs("button",{type:"button",onClick:()=>{i(null),a(!1)},className:Be("w-full flex items-center justify-between px-3 py-2 cursor-pointer hover:bg-white/10 rounded text-left",s===null&&"font-semibold"),"aria-pressed":s===null,children:[S.jsx("span",{children:"Off"}),s===null&&S.jsx(Su,{size:16})]})}),r.map(u=>S.jsx("li",{children:S.jsxs("button",{type:"button",onClick:()=>{i(u.Index),a(!1)},className:Be("w-full flex items-center justify-between px-3 py-2 cursor-pointer hover:bg-white/10 rounded text-left",s===u.Index&&"font-semibold"),"aria-pressed":s===u.Index,children:[S.jsx("span",{children:u.Title??`Subtitle ${u.Index}`}),s===u.Index&&S.jsx(Su,{size:16})]})},u.Index))]})]})]})]})},kk=()=>{const{itemId:n}=Ty(),{item:e,isLoading:t}=ev(n),{api:r}=mn(),s=go(),i=D.useRef(null),o=D.useRef(null),a=D.useRef(null),[l,u]=D.useState(!1),[c,d]=D.useState(1),[f,h]=D.useState(!1),[m,g]=D.useState(0),[p,y]=D.useState(0),[v,E]=D.useState(!1),[T,A]=D.useState(!0),[R,L]=D.useState([]),[I,C]=D.useState(!1),[_,F]=D.useState([]),[B,ie]=D.useState(0),[z,Y]=D.useState(null),[V,W]=D.useState(!1),[M,P]=D.useState(!1),[N,j]=D.useState(!1);function H(ne,X,re){const de=new Date(Date.now()+re*864e5).toUTCString();document.cookie=`${ne}=${encodeURIComponent(X)}; expires=${de}; path=/`}function Q(ne){var X;return((X=document.cookie.split("; ").find(re=>re.startsWith(ne+"=")))==null?void 0:X.split("=")[1])||null}D.useEffect(()=>{var ht,tr;let ne=null;if(!r||!e)return;const X=i.current;if(!X)return;let re=0;N||(ht=e.UserData)!=null&&ht.PlaybackPositionTicks&&(re=Math.floor(e.UserData.PlaybackPositionTicks/1e7));const de=!N&&re>0?re:m||X.currentTime||0,ye=l||!X.paused;P(!0),X.__hlsInstance&&(X.__hlsInstance.destroy(),X.__hlsInstance=null),X.onloadedmetadata=null;const Ue=()=>{if(de>0&&Math.abs(X.currentTime-de)>.5)try{X.currentTime=de}catch{}j(!0),ye?setTimeout(()=>{X.play().catch(()=>{}),P(!1)},0):P(!1)},Ge=r.getPlaybackUrl(e.Id,B),qe=`${r.deviceId}-${Date.now()}`;(tr=r.reportPlaying)==null||tr.call(r,{itemId:e.Id,mediaSourceId:e.Id,playSessionId:qe,audioStreamIndex:B,subtitleStreamIndex:z??0,positionTicks:Math.floor((re||0)*1e7),volumeLevel:100,isMuted:!1,isPaused:!1,repeatMode:"RepeatNone",shuffleMode:"Sorted",maxStreamingBitrate:14e7,playbackStartTimeTicks:Date.now()*1e4,playbackRate:1,secondarySubtitleStreamIndex:-1,bufferedRanges:[],playMethod:"DirectPlay",nowPlayingQueue:[{Id:e.Id,PlaylistItemId:"playlistItem0"}],canSeek:!0});const Tt=()=>g(X.currentTime),On=()=>y(X.duration),Ot=()=>u(!0),Ht=()=>u(!1);return X.addEventListener("timeupdate",Tt),X.addEventListener("durationchange",On),X.addEventListener("play",Ot),X.addEventListener("pause",Ht),un.isSupported()?(ne=new un,X.__hlsInstance=ne,ne.loadSource(Ge),ne.attachMedia(X),ne.on(un.Events.MANIFEST_PARSED,()=>{Ue()}),ne.on(un.Events.ERROR,()=>{P(!1)})):(X.src=Ge,X.addEventListener("loadedmetadata",Ue,{once:!0}),X.addEventListener("error",()=>P(!1),{once:!0})),ae(),()=>{X.removeEventListener("timeupdate",Tt),X.removeEventListener("durationchange",On),X.removeEventListener("play",Ot),X.removeEventListener("pause",Ht),X.removeEventListener("loadedmetadata",Ue),X.removeEventListener("error",()=>P(!1)),X.__hlsInstance&&(X.__hlsInstance.destroy(),X.__hlsInstance=null),ne&&ne.destroy()}},[r,e,B]),D.useEffect(()=>{if(!r||!e||!l)return;let ne=-1,X;const re=()=>{var ye;if(!i.current)return;const de=Math.floor(i.current.currentTime);de!==ne&&(de%2===0||de===Math.floor(p))&&(ne=de,(ye=r.reportPlaybackProgress)==null||ye.call(r,e.Id,de,B,z??0)),X=requestAnimationFrame(re)};return X=requestAnimationFrame(re),()=>{cancelAnimationFrame(X)}},[r,e,l,p,B,z]),D.useEffect(()=>{const ne=()=>{l&&!I&&A(!1)};return a.current&&clearTimeout(a.current),T&&(a.current=setTimeout(ne,3e3)),()=>{a.current&&clearTimeout(a.current)}},[T,l,I]),D.useEffect(()=>{const ne=()=>{E(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",ne),()=>{document.removeEventListener("fullscreenchange",ne)}},[]);const ae=async()=>{if(!(!r||!e))try{const ne=await r.fetchSubtitleTracks(e);ne&&L(ne)}catch(ne){console.error("Error fetching subtitles:",ne)}},J=oa.useCallback(()=>{i.current&&(l?i.current.pause():i.current.play())},[l]),ue=()=>{i.current&&(h(!f),i.current.muted=!f)},Ie=ne=>{if(!i.current)return;const X=parseFloat(ne.target.value);d(X),i.current.volume=X,X===0?(h(!0),i.current.muted=!0):f&&(h(!1),i.current.muted=!1)},He=ne=>{if(!i.current)return;const X=parseFloat(ne.target.value);g(X),i.current.currentTime=X},tt=oa.useCallback(()=>{o.current&&(v?document.exitFullscreen():o.current.requestFullscreen())},[v]),er=ne=>{const X=Math.floor(ne/60),re=Math.floor(ne%60);return`${X}:${re<10?"0":""}${re}`},Vt=oa.useCallback(ne=>{if(!i.current)return;const X=i.current.currentTime+ne;i.current.currentTime=Math.max(0,Math.min(X,i.current.duration))},[]),gn=()=>{A(!0)},Pn=()=>{A(!0)};return D.useEffect(()=>{const ne=X=>{var de,ye;const re=(ye=(de=X.target)==null?void 0:de.tagName)==null?void 0:ye.toLowerCase();if(!(re==="input"||re==="textarea"))switch(X.code){case"Space":X.preventDefault(),J();break;case"ArrowRight":X.preventDefault(),Vt(10);break;case"ArrowLeft":X.preventDefault(),Vt(-10);break;case"KeyF":X.preventDefault(),tt();break}};return window.addEventListener("keydown",ne),()=>window.removeEventListener("keydown",ne)},[J,Vt,tt]),D.useEffect(()=>{var X,re,de;if(!e){F([]),ie(0),Y(null),W(!1);return}const ne=((re=(X=e.MediaStreams)==null?void 0:X.filter(ye=>ye.Type==="Audio"))==null?void 0:re.map((ye,Ue)=>({id:ye.Index,label:ye.DisplayTitle||`Track ${Ue+1}`,language:ye.Language||""})))||[];if(F(ne),!V){const ye=Q(`jellyfin_media_${e.Id}`);let Ue=((de=ne[0])==null?void 0:de.id)??0,Ge=null;if(ye)try{const qe=JSON.parse(decodeURIComponent(ye));typeof qe.audio=="number"&&ne.some(Tt=>Tt.id===qe.audio)&&(Ue=qe.audio),(qe.subtitle===null||typeof qe.subtitle=="number")&&(Ge=qe.subtitle)}catch{}ie(Ue),Y(Ge),W(!0)}},[e,V]),D.useEffect(()=>{!e||!V||(console.log(B),H(`jellyfin_media_${e.Id}`,JSON.stringify({audio:B,subtitle:z}),7))},[e,B,z,V]),t||!e||!r?S.jsx("div",{className:"flex items-center justify-center h-screen bg-black",children:S.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-600"})}):S.jsxs("div",{ref:o,className:"relative w-full h-screen bg-black text-white overflow-hidden",onClick:gn,onMouseMove:Pn,children:[M&&S.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-black/60",children:S.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-red-600"})}),S.jsx("video",{ref:i,className:"w-full h-full",autoPlay:!0,onClick:J}),z!==null&&S.jsx(_k,{subtitleTracks:R,selectedSubtitleIndex:z,itemId:e.Id,currentTime:m}),S.jsxs("div",{role:"button",tabIndex:0,className:Be("absolute inset-0 bg-gradient-to-b from-black/40 via-transparent to-black/80 transition-opacity duration-300 select-none cursor-default",T?"opacity-100":"opacity-0 pointer-events-none"),onDoubleClick:tt,children:[S.jsxs("div",{className:"absolute top-0 left-0 right-0 p-4 flex items-center",children:[S.jsx("button",{onClick:()=>s(-1),className:"flex items-center gap-2 text-white bg-black/40 rounded-full p-2 hover:bg-black/60 transition-colors",children:S.jsx(GL,{size:20})}),S.jsx("h1",{className:"text-xl font-medium text-white",children:e.Name})]}),S.jsxs("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2",children:[S.jsx("button",{onClick:()=>Vt(-10),className:"bg-white/20 hover:bg-white/30 rounded-full p-4 mr-10 transition-colors",children:S.jsx(YL,{size:24})}),S.jsx("button",{onClick:J,className:"bg-white/20 hover:bg-white/30 rounded-full p-6 transition-colors",children:l?S.jsx(Dm,{size:32}):S.jsx(eo,{size:32})}),S.jsx("button",{onClick:()=>Vt(10),className:"bg-white/20 hover:bg-white/30 rounded-full p-4 ml-10 transition-colors",children:S.jsx(qL,{size:24})})]}),S.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-4 space-y-2",children:[S.jsxs("div",{className:"flex items-center gap-2",children:[S.jsx("span",{className:"text-sm",children:er(m)}),S.jsx("input",{type:"range",min:"0",max:p||0,value:m,onChange:He,className:"video-progress w-full h-1 bg-white/30 rounded-full appearance-none cursor-pointer",style:{...p?{"--progress":`${m/p*100}%`}:{}}}),S.jsx("span",{className:"text-sm",children:er(p)})]}),S.jsxs("div",{className:"flex items-center justify-between",children:[S.jsxs("div",{className:"flex items-center gap-4",children:[S.jsx("button",{onClick:J,className:"text-white hover:text-gray-300 transition-colors",children:l?S.jsx(Dm,{size:24}):S.jsx(eo,{size:24})}),S.jsx("button",{onClick:()=>Vt(-10),className:"text-white hover:text-gray-300 transition-colors",children:S.jsx(r1,{size:24})}),S.jsx("button",{onClick:()=>Vt(10),className:"text-white hover:text-gray-300 transition-colors",children:S.jsx(s1,{size:24})}),S.jsxs("div",{className:"flex items-center gap-2",children:[S.jsx("button",{onClick:ue,className:"text-white hover:text-gray-300 transition-colors",children:(()=>{let ne;return f?ne=S.jsx(u1,{size:24}):c>.5?ne=S.jsx(l1,{size:24}):ne=S.jsx(a1,{size:24}),ne})()}),S.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:c,onChange:Ie,className:"volume-slider w-20 h-1 bg-white/30 rounded-full appearance-none cursor-pointer",style:{...typeof c=="number"?{"--volume-progress":`${c*100}%`}:{}}})]})]}),S.jsxs("div",{className:"flex items-center gap-2",children:[S.jsx(wk,{audioTracks:_,selectedAudioTrack:B,setSelectedAudioTrack:ie,subtitleTracks:R,selectedSubtitleIndex:z,setSelectedSubtitleIndex:Y,isOpen:I,setIsOpen:C}),S.jsx("button",{onClick:tt,className:"text-white hover:text-gray-300 transition-colors",children:v?S.jsx(t1,{size:24}):S.jsx(ZL,{size:24})})]})]})]})]})]})},Ck=()=>{const n=rs(),e=new URLSearchParams(n.search),t=e.get("q")||"",[r,s]=D.useState(t),{results:i,isLoading:o,totalResults:a}=f1(r);D.useEffect(()=>{const u=e.get("q")||"";s(u)},[n.search]);const l=u=>{u.preventDefault()};return S.jsxs("div",{className:"min-h-screen bg-neutral-900 text-white",children:[S.jsx(zr,{}),S.jsxs("div",{className:"container mx-auto px-4 pt-24 pb-16",children:[S.jsx("div",{className:"mb-8",children:S.jsxs("form",{onSubmit:l,className:"flex items-center max-w-2xl mx-auto",children:[S.jsxs("div",{className:"relative flex-1",children:[S.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:S.jsx(nl,{size:20,className:"text-gray-400"})}),S.jsx("input",{type:"text",placeholder:"Search for movies, TV shows, people...",value:r,onChange:u=>s(u.target.value),className:"bg-gray-800 w-full pl-10 pr-4 py-3 rounded-l-md text-white focus:outline-none focus:ring-2 focus:ring-red-600"})]}),S.jsx("button",{type:"submit",className:"bg-red-600 text-white px-6 py-3 rounded-r-md hover:bg-red-700 transition-colors",children:"Search"})]})}),S.jsxs("div",{className:"space-y-8",children:[r&&S.jsxs("div",{className:"flex items-center justify-between",children:[S.jsx("h2",{className:"text-2xl font-medium",children:o?"Searching...":`Results for "${r}"`}),!o&&a>0&&S.jsxs("p",{className:"text-gray-400",children:[a," results found"]})]}),o?S.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:Array.from({length:12}).map((u,c)=>S.jsx("div",{className:"w-full aspect-[2/3] bg-gray-800 animate-pulse rounded-md"},c))}):i.length>0?S.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:i.map(u=>S.jsx(Ul,{item:u},u.Id))}):r?S.jsxs("div",{className:"text-center py-12",children:[S.jsxs("p",{className:"text-gray-400",children:['No results found for "',r,'"']}),S.jsx("p",{className:"text-sm mt-2",children:"Try a different search term or browse categories"})]}):S.jsxs("div",{className:"text-center py-12",children:[S.jsx(nl,{size:48,className:"mx-auto text-gray-600 mb-4"}),S.jsx("p",{className:"text-gray-400",children:"Enter a search term to find movies, TV shows, and more"})]})]})]})]})},ra=24,bk=()=>{const[n,e]=D.useState(0),{items:t,isLoading:r,totalItems:s}=lr("movies",{limit:ra,startIndex:n*ra}),i=Math.ceil(s/ra);return S.jsxs("div",{className:"min-h-screen bg-neutral-900 text-white",children:[S.jsx(zr,{}),S.jsx("div",{className:"container mx-auto px-4 pt-24 pb-16 pl-16 pr-16",children:r?S.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:Array.from({length:ra}).map((o,a)=>{const l=`skeleton-${n}-${a}`;return S.jsx("div",{className:"w-full aspect-[2/3] bg-gray-800 animate-pulse rounded-md"},l)})}):t.length>0?S.jsxs(S.Fragment,{children:[S.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-6",children:t.map(o=>S.jsx(Ul,{item:o},o.Id))}),i>1&&S.jsxs("div",{className:"flex justify-center mt-8 gap-2",children:[S.jsx("button",{className:"px-4 py-2 rounded bg-gray-800 text-gray-200 hover:bg-gray-700 disabled:opacity-50",onClick:()=>e(o=>Math.max(0,o-1)),disabled:n===0,children:"Previous"}),S.jsxs("span",{className:"px-4 py-2",children:[n+1," / ",i]}),S.jsx("button",{className:"px-4 py-2 rounded bg-gray-800 text-gray-200 hover:bg-gray-700 disabled:opacity-50",onClick:()=>e(o=>Math.min(i-1,o+1)),disabled:n>=i-1,children:"Next"})]})]}):S.jsx("div",{className:"text-center py-12 text-gray-400",children:"No movies found."})})]})},pi=24,Dk=()=>{const[n,e]=D.useState(0),{items:t,isLoading:r,totalItems:s}=lr("series",{limit:pi,startIndex:n*pi}),i=Math.ceil(s/pi);return S.jsxs("div",{className:"min-h-screen bg-neutral-900 text-white",children:[S.jsx(zr,{}),S.jsx("div",{className:"container mx-auto px-4 pt-24 pb-16 pl-16 pr-16",children:r?S.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:Array.from({length:pi}).map((o,a)=>{const l=`skeleton-${a}-${pi}`;return S.jsx("div",{className:"w-full aspect-[2/3] bg-gray-800 animate-pulse rounded-md"},l)})}):t.length>0?S.jsxs(S.Fragment,{children:[S.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-6",children:t.map(o=>S.jsx(Ul,{item:o},o.Id))}),i>1&&S.jsxs("div",{className:"flex justify-center mt-8 gap-2",children:[S.jsx("button",{className:"px-4 py-2 rounded bg-gray-800 text-gray-200 hover:bg-gray-700 disabled:opacity-50",onClick:()=>e(o=>Math.max(0,o-1)),disabled:n===0,children:"Previous"}),S.jsxs("span",{className:"px-4 py-2",children:[n+1," / ",i]}),S.jsx("button",{className:"px-4 py-2 rounded bg-gray-800 text-gray-200 hover:bg-gray-700 disabled:opacity-50",onClick:()=>e(o=>Math.min(i-1,o+1)),disabled:n>=i-1,children:"Next"})]})]}):S.jsx("div",{className:"text-center py-12 text-gray-400",children:"No TV shows found."})})]})},Or=({children:n})=>{const{isAuthenticated:e,isLoading:t}=mn();return t?S.jsx("div",{className:"flex items-center justify-center h-screen bg-black",children:S.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-600"})}):e?S.jsx(S.Fragment,{children:n}):S.jsx(Ry,{to:"/login",replace:!0})},Pk=()=>{const n=localStorage.getItem("jellyfin_server_url")||"";return S.jsx(UL,{serverUrl:n,children:S.jsx(Ok,{})})},Ok=()=>S.jsx(sA,{children:S.jsxs(QT,{children:[S.jsx(Sn,{path:"/login",element:S.jsx(h1,{})}),S.jsx(Sn,{path:"/",element:S.jsx(Or,{children:S.jsx(Pm,{})})}),S.jsx(Sn,{path:"/movies",element:S.jsx(Or,{children:S.jsx(bk,{})})}),S.jsx(Sn,{path:"/shows",element:S.jsx(Or,{children:S.jsx(Dk,{})})}),S.jsx(Sn,{path:"/latest",element:S.jsx(Or,{children:S.jsx(Pm,{})})}),S.jsx(Sn,{path:"/details/:itemId",element:S.jsx(Or,{children:S.jsx(m1,{})})}),S.jsx(Sn,{path:"/play/:itemId",element:S.jsx(Or,{children:S.jsx(kk,{})})}),S.jsx(Sn,{path:"/search",element:S.jsx(Or,{children:S.jsx(Ck,{})})}),S.jsx(Sn,{path:"*",element:S.jsx(Ry,{to:"/",replace:!0})})]})});gy(document.getElementById("root")).render(S.jsx(D.StrictMode,{children:S.jsx(Pk,{})}));
